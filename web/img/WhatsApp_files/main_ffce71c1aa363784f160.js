/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */
webpackJsonp([0],Array(367).concat([function(e,t,n){e.exports={"default":n(1021),__esModule:!0}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){window.history.pushState({},"",window.location.href)}function o(){if(!Store.Conn.connected)return!1;var e=n(874),t=Store.Msg.any(function(e){return 0===e.ack&&e.local&&e.isSentByMe}),r=Store.Chat.any(function(e){return!!e.composeText});return t||r||e.hasText}var a=n(709),s=r(a),c=n(3),l=r(c),u=n(6),d=n(28);_.defaults(window.Store,n(993));var p=n(47),h=n(7),f=n(11),m=n(48),g=n(14),v=n(917),y=n(1008),E=n(953),b=n(347),w=n(1007),S=n(905),T=n(153),C=n(9),M=n(21),N=n(159),k=n(163),x=n(1006),P=n(928),D=n(58),A=n(102),I=n(1010),R=n(983),O=n(105),L=O.HotKeys,U=O.HotKeyMapMixin,F=n(63);F&&!function(){var e=n(365);Store.ProfilePicThumb.on("change",function(t){t.tag||navigator.serviceWorker.ready.then(function(){e.send(navigator.serviceWorker.controller,"removePP",t.id)})})}();var B=window.history&&window.history.pushState&&window.location,G=[[document,"mousemove"],[document,"scroll"],[document,"keydown"],[window,"focus"],[window,"blur"],[window,"resize"]],j=u.createClass({displayName:"Main",mixins:[T,U({}),A],statics:{hasPending:o},getInitialState:function(){var e=this;return this.onBlur=this.safeDebounce(function(){document.activeElement===document.body&&D.focusNode(d.findDOMNode(e))},10),{drawerActive:!1}},componentWillMount:function(){m.uiActive=!0,m.markAvailable()},componentWillUnmount:function(){this.onBlur=null,I.trigger(x.Event+":"+x.Events.LOGGED_OUT),B&&(window.removeEventListener("popstate",i),window.history.back()),m.uiActive=!1,this.clearIdleMonitor(),this.clearServerPropsQueryLoop()},componentDidMount:function(){if(I.trigger(x.Event+":"+x.Events.LOGGED_IN),B&&(window.history.pushState({},"",window.location.href),window.addEventListener("popstate",i)),this.beginIdleMonitor(!0),this.beginServerPropsQueryLoop(),this.addObserverAndRun(Store.Conn,"change:tos",this.showTOS),D.focusNode(d.findDOMNode(this)),p.isSafari){var e=g.getNUX(h.NUX.SAFARI_LIMITED_SUPPORT);(!e||e<e.maxViews)&&(this.safeDelay(function(){var e=l10n.t("whatsapp_safari_limited").replace("__chrome_homepage__",h.BROWSER_LINK.CHROME).replace("__firefox_homepage__",h.BROWSER_LINK.FIREFOX).replace("__opera_homepage__",h.BROWSER_LINK.OPERA);C.openModal(u.createElement(b,{onOK:C.closeModal.bind(C),okText:l10n.t("ok_got_it")},u.createElement("div",{dangerouslySetInnerHTML:{__html:e}})))},250),g.setNUX(h.NUX.SAFARI_LIMITED_SUPPORT,{views:1,maxViews:1}))}},beginIdleMonitor:function(e){var t=this;e=e?h.IDLE_TIMEOUT:0,this.idleMonitor=l["default"].loop(function(){return l["default"].delay(e).addCancelControl().then(function(){m.markUnavailable(3e4);var t=void 0,n=new l["default"](function(e){t=e});return G.forEach(function(e){var n=(0,s["default"])(e,2),r=n[0],i=n[1];r.addEventListener(i,t)}),n.addCancelControl()["finally"](function(){G.forEach(function(e){var n=(0,s["default"])(e,2),r=n[0],i=n[1];r.removeEventListener(i,t)})}).then(function(){m.markAvailable(),e=h.IDLE_TIMEOUT})})})["finally"](function(){t.idleMonitor=null})["catch"](l["default"].CancellationError,_.noop).endWithControls("cancel")},clearIdleMonitor:function(){this.idleMonitor&&this.idleMonitor.control.cancel()},beginServerPropsQueryLoop:function(){var e=this;this.serverPropsQueryLoop=N.setTimeout(function(){Store.Props.fetch()["catch"](M.WapDrop,_.noop),e.beginServerPropsQueryLoop()},moment().add("1","days").valueOf())},clearServerPropsQueryLoop:function(){N.clearTimeout(this.serverPropsQueryLoop)},calculateConversationPaneScale:function(){if(!(this.refs.chatlist&&this.refs.container&&this.refs.conversation))return null;var e=d.findDOMNode(this.refs.chatlist),t=d.findDOMNode(this.refs.conversation),n=d.findDOMNode(this.refs.container);return t.clientWidth/(n.clientWidth-e.clientWidth)},onRightDrawerIn:function(){this.setState({drawerActive:!0});var e=this.calculateConversationPaneScale();null!==e&&this.animateConversationPane(e)},onRightDrawerOut:function(){var e=this.calculateConversationPaneScale();null!==e&&this.animateConversationPane(e),1!==e&&this.setState({drawerActive:!1})},onRightDrawerAnimationComplete:function(){this.state.drawerActive&&this.setState({drawerActive:!1})},animateConversationPane:function(e){Velocity(d.findDOMNode(this.refs.conversation),{scaleX:[1,e]},{duration:300,easing:[.1,.82,.25,1]})},onRotateFocus:function(e){var t=1;e&&(e.stopPropagation(),e.preventDefault(),t=e.shiftKey?-1:1,L.flashFocus=Date.now());var n=_.toArray(d.findDOMNode(this).querySelectorAll("[data-tab]"));if(this.refs.drawer.isFlowActive(D.DRAWER_LEFT)){var r=d.findDOMNode(this.refs.chatlist);n=_.reject(n,function(e){return r.contains(e)})}if(this.refs.drawer.isFlowActive(D.DRAWER_MID)){var i=d.findDOMNode(this.refs.conversation);i&&(n=_.reject(n,function(e){return i.contains(e)}))}if(n.length){n=_.sortBy(n,function(e){return parseInt(e.getAttribute("data-tab"),10)||0});var o=0,a=document.activeElement;a&&(o=k.ring(_.findIndex(n,function(e){return e.contains(a)})+t,n));var s=n[o];L.flashFocus=Date.now(),s.restoreFocus?s.restoreFocus():D.focusNode(s)}},showTOS:function(){switch(Store.Conn.tos){case 1:case 2:C.openModal(u.createElement(R,null),void 0,void 0,!0);break;case 3:f.logout()}},render:function(){var e=this.state.drawerActive?"app three":"app two";p.isSafari&&(e+=" safari-fix");var t={tab:this.onRotateFocus,"shift+tab":this.onRotateFocus};return u.createElement(L,{handlers:t,ref:"container",className:e,onBlur:this.onBlur},u.createElement(w,null),u.createElement(S,null),u.createElement(y,null),u.createElement(E,{ref:"drawer",onRightDrawerIn:this.onRightDrawerIn,onRightDrawerOut:this.onRightDrawerOut,onRightDrawerAnimationComplete:this.onRightDrawerAnimationComplete}),u.createElement(v,{ref:"chatlist"}),u.createElement(P,{ref:"conversation"}))}});e.exports=j},function(e,t,n){e.exports={"default":n(1022),__esModule:!0}},function(e,t,n){e.exports={"default":n(1023),__esModule:!0}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=new Uint8Array(8);window.crypto.getRandomValues(e);for(var t=new Array(16),n=0,r=0;n<e.length;n++,r+=2){var i=e[n];t[r]=j[i>>4],t[r+1]=j[15&i]}return"3EB0"+String.fromCharCode.apply(String,t)}function o(e){return e in W}function a(e){return new d["default"](function(t,n){H.push(e),z[e.id]={resolve:t,reject:n},q.debounceAndCap(100,500)})}function s(e){return y.getPlaintextMediaInfo(e).then(function(t){if(200===t.status){var n=t.data;return n.length!==e.length?(m.error("Msg:refreshMedia returned length differs from orig")(),d["default"].reject("Msg:refreshMedia returned length differs from orig")):n.map(function(t,n){var r=e[n],i=r.duration||t.d;i=i?i.toString():void 0;var o={clientUrl:t.url,mimetype:t.mt,duration:i};"image"===r.type&&(o.fullWidth=t.w,o.fullHeight=t.h);var a=z[r.id];return a&&(delete z[r.id],a.resolve(o)),o})}return m.error("Msg:refreshMedia error "+t.status)(),d["default"].reject("Msg:refreshMedia error "+t.status)})["catch"](function(t){return e.forEach(function(e){var n=z[e.id];n&&(delete z[e.id],n.reject(t))}),d["default"].reject(t)})}function c(e,t){function n(){i=0}if(t&&!e.mediaKey)return m.log("processMedia encrypted msg without mediaKey")(),d["default"].reject(new E.MediaNeedsReupload);e.mediaState=B.FETCHING;var r=void 0;r=t?d["default"].resolve():a(e)["catch"](E.Server5xxDrop,function(){return d["default"].reject(new O)}).then(function(t){e.set(t)});var i=0;return r.loop(function(t){return A.getResponseIfOnline(e.clientUrl,"GET",null,S.RESP_TYPE.ARRAY_BUFFER).then(function(r){if(i++,!(r&&r.status<500)){if(i>3)return d["default"].reject(new E.MediaNeedsReupload);e.mediaState=B.NEED_POKE;var o=Math.floor(1e3*R.expBackoff(i,60,void 0,.1));return d["default"].all([d["default"].delay(o),D.waitForOnline]).addResolveControl("poke",n)}return r.status>=400?d["default"].reject(new E.MediaNeedsReupload):void t(r.response)})}).then(function(n){return t?(e.mediaState=B.DECRYPTING,e.needsMediaAck&&b.ackE2EMedia(e.type,e.mediaKey,e.clientUrl).then(function(){e.needsMediaAck=!1}),w.decryptE2EMedia(e.type,n,e.mediaKey,e.mimetype)["catch"](E.MediaEncryptionError,function(e){return m.assert(!1,"decryption-error","msg:processEncryptedMedia "+e)(),d["default"].reject(new L)})):new Blob([n],{type:e.mimetype})}).then(function(t){e.mimetype||(e.mimetype=t.type);var n=P.transcode(t,e.mimetype).then(function(e){return URL.createObjectURL(e)}),r=n.then(function(t){switch(e.type){case"image":return P.image(t);case"video":return P.video(t);case"audio":case"ptt":return P.audio(t);case"document":return P.file(t)}});return d["default"].props({preload:r,url:n,media:t})}).then(function(t){var n=t.media,r=t.url,i=t.preload;e.set(_.assign({mediaState:B.RESOLVED,decryptedMediaBlob:n,url:r},i))})}function l(e){return e.mediaState=B.REUPLOADING,y.requestMediaReupload(e)["catch"](E.WapDrop,function(e){return!(e instanceof E.LogoutDrop)},function(){throw new E.MediaNeedsReupload}).then(function(t){return 200===t.status?M.isEncryptedMedia(t.url)?(e.set({clientUrl:t.url,mediaKey:t.mediaKey||e.mediaKey,needsMediaAck:!0}),c(e,!0)):(e.set({clientUrl:t.url,needsMediaAck:!1}),c(e,!1)):404===t.status?d["default"].reject(new L):t.status>=400?d["default"].reject(new E.MediaNeedsReupload):void 0})}var u=n(3),d=r(u),p=n(707),h=r(p),f=n(7),m=n(1),g=n(60),v=n(156),y=n(35),E=n(21),b=n(896),w=n(894),S=n(109),T=n(22),C=n(353),M=n(61),N=n(889),k=n(80),x=n(892),P=n(898),D=n(110),A=n(29),I=n(62),R=n(83),O=E.define("WapBlockedMedia"),L=E.define("MediaNotOnPhone"),U={NOTIFICATION:"notification",GROUP_NOTIFICATION:"group_notification",GP2:"gp2",BROADCAST_NOTIFICATION:"broadcast_notification",E2E_NOTIFICATION:"e2e_notification",CALL_LOG:"call_log",CHAT:"chat",IMAGE:"image",VIDEO:"video",LOCATION:"location",AUDIO:"audio",PTT:"ptt",VCARD:"vcard",CIPHERTEXT:"ciphertext",DOCUMENT:"document"},F=(0,h["default"])({},U.IMAGE,"image/jpeg"),B={INIT:"media_init",UPLOADING:"media_uploading",SENDING:"media_sending",REUPLOADING:"media_reuploading",FETCHING:"media_fetching",DECRYPTING:"media_decrypting",RESOLVED:"media_resolved",NEED_POKE:"media_need_poke",NEED_UPLOAD:"media_need_upload",ERROR_MISSING:"media_error_missing",REMOTE_UPLOADING:"media_remote_uploading",REMOTE_NEED_UPLOAD:"media_remote_need_upload"},G=g.extend(N,{Collection:"Msg",props:{id:"msgKey",body:"string",type:{type:"string",values:_.values(U)},subtype:"string",t:"number",notifyName:"string",from:"string",to:"string",author:"string",self:{type:["string"],values:["in","out"],"default":"in"},ack:"number",invis:"boolean",isNewMsg:"boolean",star:["boolean",!0,!1],recvFresh:"boolean",clientUrl:"string",url:"string",caption:"string",mimetype:"string",duration:"string",filehash:"string",size:"number",loc:"string",lat:"string",lng:"string",height:"number",width:"number",filename:"string",title:"string",description:"string",canonicalUrl:"string",matchedText:"string",thumbnail:"string",recipients:"array",broadcast:"boolean",avparams:"object",mediaKey:"string",pageCount:"number"},session:{fullHeight:"number",fullWidth:"number",decryptedMediaBlob:"object",uploadhash:"string",mediaState:{type:"string",values:_.values(B),"default":B.INIT},mustDownloadMedia:{type:"boolean","default":!1},promises:{type:"object","default":function(){return{}}},_shouldUploadFromPhone:{type:"boolean","default":!1},local:"boolean",reupload:"function",needsMediaAck:"boolean",search:"boolean",msgChunk:"object",startOfDay:"number",startOfDaySkew:"number"},children:{senderObj:v},initialize:function(){this.sender&&(this.senderObj=Store.Contact.gadd({id:this.sender}),this.listenTo(this.senderObj,"all",this._getEventBubblingHandler("senderObj")));var e;(e=Store.Msg.preAck[this.id])&&(m.log("Msg:initialize updating msg with out of order ack",e)(),this.updateAck(e.ack),delete Store.Msg.preAck[this.id]),this.isMedia&&!this.mimetype&&(this.mimetype=F[this.type])},derived:{chat:{fn:function(){return Store.Chat.get(this.id.remote)}},isGroupMsg:{fn:function(){return T.isGroup(this.from)||T.isGroup(this.to)}},isSentByMe:{fn:function(){var e=this.id;return"in"===e.self||this.isNotification?!1:this.from===Store.Conn.me}},isNotification:{deps:["type"],fn:function(){switch(this.type){case U.GROUP_NOTIFICATION:case U.GP2:case U.BROADCAST_NOTIFICATION:case U.NOTIFICATION:case U.E2E_NOTIFICATION:case U.CALL_LOG:return!0;default:return!1}}},isMedia:{deps:["type"],fn:function(){return["image","video","audio"].indexOf(this.type)>-1}},isMMS:{deps:["type"],fn:function(){return o(this.type)}},hasSymbol:{deps:["type"],fn:function(){return["image","video","audio","ptt","location","vcard"].indexOf(this.type)>-1}},eventType:{deps:["type","invis"],fn:function(){var e,t,n=this.type,r=this.subtype;return this.isNewMsg?(n===U.GP2||n===U.GROUP_NOTIFICATION?"subject"===r?e="n":"add"===r?(t=_.first(this.recipients),e=t===Store.Conn.me?"s":"i"):"remove"===r?(t=_.first(this.recipients),e=t===Store.Conn.me?"n":"i"):e="create"===r?"n":"i":e=n===U.BROADCAST_NOTIFICATION||n===U.NOTIFICATION||n===U.E2E_NOTIFICATION||n===U.CALL_LOG?"create"===r?"n":"i":this.broadcast?"i":"d",this.invis?"i"===e?"i":"n":e):"i"}},sender:{fn:function(){return this.isSentByMe?this.from:this.isGroupMsg?this.author:this.from}},containsEmoji:{deps:["body","caption"],fn:function(){switch(this.type){case U.CHAT:return this.body&&C.containsEmoji(this.body);case U.IMAGE:return this.caption&&C.containsEmoji(this.caption);default:return!1}}},mayFail:{deps:["isSentByMe","ack"],fn:function(){return this.isSentByMe&&this.ack<=1}},isFailed:{deps:["isSentByMe","ack"],fn:function(){return this.isSentByMe&&this.ack<0}},vcardWAid:{deps:["type","body"],fn:function(){if(this.type===U.VCARD){var e=this.body.match(/TEL[^\n]*;waid=(\d+):/);return e?e[1]+"@c.us":void 0}}},canForward:{deps:["type"],fn:function(){return!0}},dir:{deps:["type","body","subtype"],fn:function(){switch(this.type){case U.CHAT:return x.dir(this.body);case U.VCARD:return x.dir(this.subtype);default:return}}},rtl:{deps:["type","body","subtype"],fn:function(){switch(this.type){case U.CHAT:return"rtl"===x.dir(this.body);case U.VCARD:return"rtl"===x.dir(this.subtype);default:return!1}}},linkPreview:{deps:["matchedText","body"],fn:function(){return _.isString(this.matchedText)&&this.body.indexOf(this.matchedText)>-1}},isPersistent:{fn:function(){return this.type===U.E2E_NOTIFICATION&&"encrypt"===this.subtype}}},isGroupLeave:function(){return"gp2"===this.type&&("leave"===this.subtype||"remove"===this.subtype)&&_.first(this.recipients)===Store.Conn.me},isTrusted:function(){return this.sender===Store.Conn.me?!0:this.senderObj&&this.senderObj.isMyContact?!0:this.isGroupMsg?this.chat.isTrusted():k.supportsFeature(k.F.SPAM)?this.chat.notSpam:!1},requestPhoneUpload:function(){this.mediaState===B.REMOTE_NEED_UPLOAD&&(this._shouldUploadFromPhone=!0,this.promises.mediaPromise?this.promises.mediaPromise.control.requestPhoneUpload():this.downloadMedia())},forceDownloadMedia:function(){return this.mustDownloadMedia=!0,this.downloadMedia()},cancelDownload:function(){this.promises.mediaPromise.control.cancel()},resumeUpload:function(){return this.reupload()},cancelUpload:function(){this.promises.uploadPromise2.control.cancel()},resumeRemoteUpload:function(){return this._shouldUploadFromPhone=!0,this.downloadMedia()},downloadMedia:function(){var e=this;if(!this.decryptedMediaBlob||this.promises.mediaPromise&&this.promises.mediaPromise.isPending()){if(this.promises.mediaPromise)return this.promises.mediaPromise.control.poke(),this.promises.mediaPromise}else{if(this.decryptedMediaBlob.slice(0,1).size>0)return d["default"].resolve();this.set({mediaState:B.FETCHING,url:null})}return this.promises.mediaPromise=d["default"].loop(function(t){var n=void 0;if(e.mediaState===B.REMOTE_UPLOADING)n=d["default"].sit("phoneResolved");else if(e.mediaState===B.REMOTE_NEED_UPLOAD){var r=k.supportsFeature(k.F.MEDIA_RETRY);if(e._shouldUploadFromPhone&&r)return e.set({_shouldUploadFromPhone:!1,mediaState:B.REMOTE_UPLOADING}),void Store.Msg.send(e).then(function(t){"success"!==t&&e.promises.mediaPromise.control.phoneResolved(!1)});n=d["default"].sit("requestPhoneUpload",function(){return!1}).addResolveControl("phoneResolved",_.identity)}return n?n.then(function(n){n?t():e.mediaState=B.REMOTE_NEED_UPLOAD}):void t()}).loop(function(t){var n=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],r=void 0;return r=n?l(e):c(e,M.isEncryptedMedia(e.clientUrl)),r.then(t)["catch"](E.MediaNeedsReupload,function(){return d["default"].loop(function(t){return m.log("msg:downloadMedia need rmr, will auto "+e.mustDownloadMedia)(),e.mustDownloadMedia?(e.mustDownloadMedia=!1,void t(!0)):(e.mediaState=B.NEED_POKE,d["default"].sit("poke"))})})["catch"](O,E.MediaLoadError,function(){return e.mediaState=B.NEED_POKE,d["default"].sit("poke")["return"](!1)})["catch"](L,function(){return e.mediaState=B.ERROR_MISSING,A.waitForBBEvent(e,"change:clientUrl")["return"](!1)})})["catch"](E.LogoutDrop,_.noop).endWithControls("poke","phoneResolved","cancel","requestPhoneUpload")},"delete":function(){this.decryptedMediaBlob&&this.unset("decryptedMediaBlob"),M.isBlob(this.url)&&URL.revokeObjectURL(this.url),g.prototype["delete"].call(this),Store.Msg.remove(this.id),Store.StarredMsg.remove(this.id),this.msgChunk&&this.msgChunk.remove(this.id);var e=Store.Chat.get(this.id.remote);e&&e.unreadMsgAnchor===this&&(e.unreadMsgAnchor=void 0)},displayName:function(e,t){if(!this.sender)return"";if(this.sender===Store.Conn.me)return l10n.t("web_you");var n=this.senderObj,r=e?n.shortName:void 0;if(r)return r;if(n.name)return n.name;var i=t&&this.notifyName?" ~"+this.notifyName:"";return l10n.isRTL()?l10n.embedLTR(T.formattedUser(this.sender))+i:T.formattedUser(this.sender)+i},updateAck:function(e){var t=this.ack;_.isNumber(e)&&("undefined"==typeof t||e>t)?this.ack=e:-1===e&&0===this.ack&&(this.ack=-1,this.mediaState===G.MEDIA_STATE.REMOTE_UPLOADING&&(this.promises.mediaPromise?this.promises.mediaPromise.control.phoneResolved(!1):this.mediaState=G.MEDIA_STATE.REMOTE_NEED_UPLOAD))},sendMediaMsg:function(e){var t=this,n=e.filehash;return this.mediaKey&&(delete e.name,e.mimetype=this.mimetype,e.size=this.size,e.type=this.type===U.PTT?"audio":this.type,e.height=this.height,e.width=this.width,e.duration=this.duration,e.filehash=this.filehash,this.type===U.DOCUMENT&&(e.filename=this.filename)),this.set({mediaState:B.SENDING,avparams:e,filehash:e.filehash,uploadhash:n,size:parseInt(e.size,10)}),Store.Msg.send(this).then(function(e){m.assert("dropped"!==e,"media-dropped","id: "+t.id)(),t.mediaState=B.RESOLVED})},sendPlayed:function(){if("ptt"===this.type&&!(this.isSentByMe||this.ack>=f.ACK_PLAYED)){var e=this;y.sendMessagePlayed(this.id).then(function(t){e.ack=f.ACK_PLAYED})["catch"](E.WapDrop,_.noop)}},avParams:function(){return this.avparams?this.avparams:{url:this.clientUrl,type:this.type,mimetype:this.mimetype,filehash:this.filehash,filename:this.filename,duration:this.duration,width:this.fullWidth,height:this.fullHeight}},resend:function(){return this.isFailed?(this.ack=0,this.isMMS?this.resumeRemoteUpload():Store.Msg.send(this)):d["default"].resolve()},handleUpload:function(e,t,n){var r=this,i=t.then(function(t){return e["return"](t)}).then(function(e){var t=e.avParams,n=e.mediaKey;m.assert(t,"empty-av-params","id: "+r.id)(),r.set({reupload:void 0,clientUrl:t.url,mediaKey:n,mediaState:B.RESOLVED}),r.promises.uploadPromise2=null,r.sendMediaMsg(t)})["catch"](E.GaveUpRetry,d["default"].CancellationError,E.CapabilityError,E.Server5xxDrop,function(e){m.error("msg:handleUpload failed to upload "+r.id+", "+e)(),r.set({mediaState:B.NEED_UPLOAD}),r.promises.uploadPromise2=null})["catch"](E.MediaMissing,function(){m.warn("msg:handleUpload can not forward "+r.id+", not on phone")(),r.set({uploadPromise2:null,mediaState:B.ERROR_MISSING})})["catch"](E.LogoutDrop,function(e){return _.noop})["catch"](function(e){m.assert(!1,"upload-uncaught-error","Error: "+e)()}),o=function(){return r.mediaState===B.NEED_UPLOAD?r.handleUpload(e,n(r.to),n):r.uploadPromise2||e};return this.set({mediaState:B.UPLOADING,uploadPromise2:t,reupload:o}),this.promises.uploadPromise2=t,i}}),j=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70],W={image:1,video:1,audio:1,ptt:1,document:1},H=[],z={},q=new I(function(){var e=H;H=[],s(e)});G.TYPE=U,G.MEDIA_STATE=B,G.newTag=i,G.typeIsMMS=o,e.exports=G},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(39),o=r(i),a=n(710),s=r(a),c=n(3),l=r(c),u=n(707),d=r(u),p=n(717),h=r(p),f=n(709),m=r(f),g=n(1),v=n(21),y=n(9),_=n(29),E=n(84),b={async:function(e,t){var n=e.split(".").slice(-1),r=(0,m["default"])(n,1),i=r[0];return this._asyncKey(i,e,t)},asyncState:function(e,t){var n=this,r=E.mapValues(e,function(e,t){return n._asyncKey(t,e)});for(var i in t)void 0===r[i]&&(r[i]=t[i]);return r},_asyncKey:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?this.props:arguments[2],r=t.split("."),i=this._getAsyncIndex(r),o=r.slice(0,i),a=(0,h["default"])(o),s=a[0],c=a.slice(1),l=r.slice(i+1),u=n[r[0]];return i&&(u=this._getObservable(e,s,c,n,r[i])),u?E.isFunction(u.on)||E.isFunction(u.off)?this._asyncObserver(e,r,c,u,l):g.trace("asyncMixin path resolved to non-observable: "+t):g.trace("asyncMixin path resolved to nonexistent state! path: "+t)},_getObservable:function(e,t,n,r,i){var o=n.length?r[t].getp(n):r[t];return o?Store[i].get(o):null},_asyncObserver:function(e,t,n,r,i){var o=this;this._loadStale(r);var a="change:"+i.join("."),s=function(){return o.setOrQueueState((0,d["default"])({},e,r.getp(i)))};return r.on(a,s),r.isState&&r._uiObservers++,this._asyncs=this._asyncs||{},this._asyncs[e]={key:e,splitPath:t,basePath:n,observable:r,callback:s,eventKey:a},r.getp(i)},_loadStale:function(e){var t=this;if(e.stale){var n=e.id;y.uiBusy?!function(){var r=t._waAsyncWaits||(t._waAsyncWaits=[]),i=_.waitForBBEvent(y,"ui_idle").then(function(){return e.getCollection().find(n)})["finally"](function(){t._waAsyncWaits=E.without(t._waAsyncWaits,i)})["catch"](v.WapDrop,E.noop)["catch"](l["default"].CancellationError,E.noop);r.push(i)}():e.getCollection().find(n)["catch"](v.WapDrop,E.noop)}},componentWillMount:function(){this.__willMount=!0,this.__stateQueue&&(this.setState(E.assign.apply(E,[{}].concat((0,s["default"])(this.__stateQueue)))),this.__stateQueue=void 0)},setOrQueueState:function(e){this.__willMount?this.setState(e):(this.__stateQueue=this.__stateQueue||[],this.__stateQueue.push(e))},_observersMatch:function(e,t,n,r){return n[e]!==r[e]?!1:!t.length||n[e].getp(t)===r[e].getp(t)},componentWillReceiveProps:function(e){var t=this;if(this._asyncs){var n={};E.forIn(this._asyncs,function(r,i){var o=r.splitPath,a=r.basePath,s=(0,m["default"])(o,1),c=s[0];if(!t._observersMatch(c,a,t.props,e)){var l=r.observable,u=r.callback,d=r.eventKey;l.off(d,u),l.isState&&l._uiObservers--,n[i]=t._asyncKey(i,o.join("."),e)}}),(0,o["default"])(n).length&&this.setOrQueueState(n)}},componentWillUnmount:function(){this._waAsyncUnmount=!0;var e=this._waAsyncWaits;if(e)for(;e.length;)e.shift().cancel();this._asyncs&&E.forIn(this._asyncs,function(e){var t=e.observable,n=e.callback,r=e.eventKey;t.off(r,n),t.isState&&t._uiObservers--})},_getAsyncIndex:function(e){for(var t=1;t<e.length;++t)if(e[t].charAt(0).toLowerCase()!==e[t].charAt(0))return t;return 0}};e.exports=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n,r,o,a){if(n>r)return-1;var s,c=Math.round((n+r)/2),l=e[c],u=l.offsetLeft-o;if(u>=t)s=a;else{if(u+l.clientWidth>t)return c;s=!a}return s?i(e,t,n,c-1,o,a):i(e,t,c+1,r,o,a)}function o(e,t){for(var n=0,r=e.childNodes,i=0;i<r.length;i++){var o=r[i];if(o===t)break;n+=o.clientWidth}return n}var a=n(3),s=r(a),c=n(6),l=n(28),u=n(353),d=n(47),p=n(104),h=n(81),f=n(153),m=n(9),g=n(29),v=n(46),y=n(708),E=n(80),b=n(849),w=n(1012),S=n(827),T=n(899),C=n(848),M=n(850),N=n(852),k=n(853),x=n(1013),P=4096,D={SMALL:"small",LARGE:"large"},A=c.createClass({displayName:"EmojiText",mixins:[h,p,f,y],statics:{EMOJI_SIZE:D},propTypes:{text:c.PropTypes.string,emojiSize:c.PropTypes.oneOf(_.values(D)),element:c.PropTypes.any,classes:c.PropTypes.string,direction:c.PropTypes.string,linkify:c.PropTypes.bool,titlify:c.PropTypes.bool,ellipsify:c.PropTypes.bool,selectable:c.PropTypes.bool,format:c.PropTypes.bool,wbr:c.PropTypes.number,dirMismatch:c.PropTypes.bool},getInitialState:function(){if(this.props.ellipsify&&this.props.format)throw new Error("ellipsify && format are not supported together");return this.debouncedRecompute=this.safeDebounce(this.recompute,20),this.reged=!1,{ellipsified:null}},getDefaultProps:function(){return{emojiSize:D.SMALL,element:"span"}},componentWillMount:function(){d.isWebkit&&this.props.ellipsify&&this.containsEmoji()&&this.regResizeListener()},componentWillReceiveProps:function(e){if(d.isWebkit&&this.props.ellipsify&&e.text!==this.props.text){var t=(e.text||"").substring(0,P);u.containsEmoji(t)?(this.recompute(),this.regResizeListener()):(this.setState({ellipsified:null}),this.unregResizeListener())}},containsEmoji:function(){var e=(this.props.text||"").substring(0,P);return u.containsEmoji(e)},regResizeListener:function(){this.reged||(this.regNativeListener(window,"resize",this.debouncedRecompute),this.regCmd("resize",this.debouncedRecompute),this.reged=!0)},unregResizeListener:function(){this.reged&&(this.unregNativeListener(window,"resize",this.debouncedRecompute),this.unregCmd("resize",this.debouncedRecompute),this.reged=!1)},recompute:function(){this.setState({ellipsified:null},this.ellipsify)},ellipsifyCheck:function(){this.isMounted()&&this.containsEmoji()&&this.ellipsify()},componentDidMount:function(){d.isWebkit&&this.props.ellipsify&&(m.uiBusy?g.waitForBBEvent(m,"ui_idle").then(this.ellipsifyCheck)["catch"](s["default"].CancellationError,_.noop):this.ellipsifyCheck())},ellipsify:function(){var e=l.findDOMNode(this);if(e){var t=e.querySelectorAll("img");if(0!==t.length){var n,r=!l10n.isRTL(),a=0;if(n=e.clientWidth){if(n===e.scrollWidth)return;a=0}else{var s=e.parentNode;if(a=o(s,e),n=s.clientWidth-a,s.clientWidth===s.scrollWidth)return}var c=i(t,r?n:0,0,t.length-1,r?a:0,r);if(!(0>c)){var u=t[c],d=10;d-=Math.floor(d/4);var p=i(t,r?n-d:d,0,c,r?a:0,r);p>-1&&(u=t[p]);for(var h=e.childNodes,f=[],m=0;m<h.length;m++){var g=h[m];if(g===u)break;3===g.nodeType?f.push(g.textContent||""):f.push(g.alt||"")}if(f.length){var v=f.length-1;f[v]=f[v].trimRight()}this.setState({ellipsified:f.join("")})}}}},render:function(){if(!this.props.text)return null;var e=this.state.ellipsified;e||(e=this.props.ellipsify?(this.props.text||"").substring(0,P):this.props.text);var t=this.props.selectable?"selectable-text":void 0,n=[],r=E.supportsFeature(E.F.RICH_TEXT)&&this.props.format;r&&n.push(new S(t)),this.props.linkify&&n.push(new M(t)),r&&(n.push(new k(t)),n.push(new C(t)),n.push(new N(t))),this.props.wbr&&n.push(new w(this.props.wbr)),n.push(new T(t,this.props.emojiSize));var i=b.parse(e,n),o=b.serialize(i,new x);this.state.ellipsified&&(o+="&hellip;");var a=v(this.props.classes,{emojitext:!this.props.classes,ellipsify:this.props.ellipsify,"inverse-text-direction":this.props.dirMismatch,"selectable-text":this.props.selectable}),s=this.props.element;return this.props.titlify?c.createElement(s,{className:a,dir:this.props.direction,title:this.props.text,dangerouslySetInnerHTML:{__html:o}}):c.createElement(s,{className:a,dir:this.props.direction,dangerouslySetInnerHTML:{__html:o}})}});e.exports=A},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(709),o=r(i),a=n(1020),s=r(a),c=n(3),l=r(c),u=n(6),d=n(7),p=n(1),h=n(60),f=n(834),m=n(798),g=n(156),v=n(890),y=n(847),E=n(824),b=n(80),w=n(9),S=n(48),T=n(35),C=n(14),M=n(154),N=n(21),k=n(108),x=n(61),P=n(22),D=n(360),A=n(82).ActionToast,I=n(82).ActionType,R=n(826),O={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"},L=h.extend({Collection:"Chat",props:{id:"string",t:"number",unreadCount:{type:"number","default":0},archive:"boolean",isReadOnly:"boolean",modifyTag:"number",muteExpiration:{type:"number","default":0},name:"string",notSpam:"boolean",pendingMsgs:"boolean"},session:{viewed:"boolean",createdLocally:"boolean",pendingAction:"number",formattedTitle:"string",active:"boolean",pausedTimerId:"number",presenceResendTimerId:"number",recording:"boolean",typing:"boolean",unreadDivider:"object",colors:"object",composeText:"string",composeSel:"object",squelch:"number",pendingSeenCount:{type:"number","default":0},markedUnread:"boolean",msgChunks:{type:"array","default":function(){return[]}},trusted:"boolean",canSend:"boolean",unreadMsgAnchor:"object",disableUnreadAnchor:"boolean",promises:{type:"object","default":function(){return{}}}},collections:{msgs:E},children:{presence:f,contact:g,mute:v,groupMetadata:y},initialize:function(){if(this.presence=Store.Presence.gadd(this.id),this.listenTo(this.presence,"all",this._getEventBubblingHandler("presence")),this.mute=Store.Mute.add({id:this.id,expiration:this.muteExpiration},{merge:!0}),this.listenTo(this.mute,"all",this._getEventBubblingHandler("mute")),this.contact=Store.Contact.gadd(this.id),this.name&&!this.contact.name&&(this.contact.name=this.name),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact")),this.listenTo(this.contact,"change:formattedName",this.updateTitle),this.isGroup&&(this.trusted=!0),this.isGroup||this.isBroadcast){var e;this.isBroadcast&&!Store.GroupMetadata.get(this.id)&&(e=!0),this.groupMetadata=Store.GroupMetadata.gadd({id:this.id}),this.listenTo(this.groupMetadata,"all",this._getEventBubblingHandler("groupMetadata")),this.listenTo(this.groupMetadata,"change:stale",this.updateReadOnly),this.listenTo(this.groupMetadata,"change:trusted change:stale",this.isTrusted),this.listenTo(this.groupMetadata.participants,"add remove reset",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"change:contact.formattedShortName",this.updateTitle),this.updateReadOnly();var t=this.id;this.listenTo(this,"change:isReadOnly",function(){this.isTrusted(),this.updateCanSend(),Store.ProfilePicThumb.update(t)["catch"](N.WapDrop,_.noop),Store.GroupMetadata.update(t)["catch"](N.WapDrop,_.noop)}),e&&Store.GroupMetadata.update(t)["catch"](N.WapDrop,_.noop)}else this.listenTo(this.presence,"change:isOnline",this._presenceOnlineChanged),this.listenTo(this.contact,"change:isMyContact",this.isTrusted),this.listenTo(Store.Blocklist,"add remove reset",this.updateCanSend);this.listenTo(this,"change:notSpam",this.isTrusted),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.msgs,"add",this.onNewMsg),this._saveAssignedColors=_.debounce(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this.onActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:pendingAction",this.onPendingActionUpdate)},derived:{kind:{fn:function(){return this.isGroup?O.GROUP:this.isBroadcast?O.BROADCAST:this.isUser?O.CHAT:void 0}},isGroup:{fn:function(){return P.isGroup(this.id)}},isBroadcast:{fn:function(){return P.isBroadcast(this.id)}},isUser:{fn:function(){return P.isUser(this.id)}},hasUnread:{deps:["unreadCount"],fn:function(){return 0!==this.unreadCount}}},onActiveUpdate:function(){this.isGroup&&this.active&&(this.squelch=-1),this.presence.chatActive=this.active},onPendingActionUpdate:function(){this.pendingAction<0&&(p.log("chat:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)},hasMaybeSentMsgToChat:function(){return 1===_(this.getAllMsgs()).filter(function(e){return e.isSentByMe;
}).take().value().length},isTrusted:function(){var e=void 0;return this.isGroup?e=b.supportsFeature(b.F.SPAM)?this.isReadOnly||this.notSpam||this.groupMetadata.isTrusted():this.groupMetadata.isTrusted():this.isBroadcast?e=!0:this.isUser&&(e=b.supportsFeature(b.F.SPAM)?this.notSpam||this.contact.isMyContact:!0),!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=e},updateTitle:function(){this.isBroadcast?this.formattedTitle=this.contact.name||this.groupMetadata.participants.map(function(e){return e.contact.formattedShortName}).join(", "):this.isUser?this.formattedTitle=this.contact.name||P.formattedUser(this.id):this.isGroup&&(this.formattedTitle=this.contact.name)},sendExit:function(){var e=this;if(!this.isGroup)return l["default"].reject(new N.ActionError);if(this.promises.sendExit)return this.promises.sendExit;this.promises.sendExit=T.leaveGroup(this.id);var t=new I(l10n.t("action_group_exiting")),n=this.promises.sendExit.then(function(e){return 200===e.status?new I(l10n.t("action_group_exited")):e.status>=400?new I(l10n.t("action_group_exit_failed")):void 0})["catch"](function(e){return p.error("models:chat:sendExit dropped")(e),new I(l10n.t("action_group_exit_failed"),l10n.t("action_try_again"),this.sendExit.bind(this))});return w.openToast(u.createElement(A,{id:A.genId(),initialAction:t,pendingAction:n})),this.promises.sendExit.bind(this).then(function(e){200!==e.status||e._duplicate||this.exit()})["finally"](function(){e.promises.sendExit=null})},canExit:function(){return b.supportsFeature(b.F.GROUP_EXIT)},exit:function(){this.isGroup&&(this.groupMetadata.participants.remove(Store.Conn.me),this.isReadOnly=!0)},sendDelete:function(){var e=this;if(this.promises.sendDelete)return this.promises.sendDelete;var t=this.msgs.last(),n=t?t.id:void 0;this.promises.sendDelete=T.sendConversationDelete(this.id,n);var r,i=this.kind;switch(i){case O.GROUP:r=l10n.t("action_group_deleting");break;case O.BROADCAST:r=l10n.t("action_broadcast_deleting");break;case O.CHAT:r=l10n.t("action_chat_deleting")}r=new I(r);var o=this.promises.sendDelete.bind(this).then(function(e){if(200===e.status)switch(i){case O.GROUP:return new I(l10n.t("action_group_deleted"));case O.BROADCAST:return new I(l10n.t("action_broadcast_deleted"));case O.CHAT:return new I(l10n.t("action_chat_deleted"))}else if(e.status>=400)switch(i){case O.GROUP:return new I(l10n.t("action_group_delete_failed"));case O.BROADCAST:return new I(l10n.t("action_broadcast_delete_failed"));case O.CHAT:return new I(l10n.t("action_chat_delete_failed"))}})["catch"](function(e){p.error("models:chat:sendDelete dropped")(e);var t=void 0;switch(i){case O.GROUP:t=l10n.t("action_group_delete_failed");break;case O.BROADCAST:t=l10n.t("action_broadcast_delete_failed");break;case O.CHAT:t=l10n.t("action_chat_delete_failed")}return new I(t,l10n.t("action_try_again"),this.sendDelete.bind(this))});return w.openToast(u.createElement(A,{id:A.genId(),initialAction:r,pendingAction:o})),this.promises.sendDelete.bind(this).then(function(e){if(200===e.status&&!e._duplicate){var n=this.msgs.last();t===n?this["delete"](!0):this.deleteMsgsBeforeMsgInclusive(t)}})["finally"](function(){e.promises.sendDelete=null})},updateCanSend:function(){return this.isReadOnly?this.canSend=!1:this.isUser?this.canSend=!this.contact.isBlocked():this.canSend=!0},canDelete:function(){return b.supportsFeature(b.F.DELETE)},canClear:function(){return b.supportsFeature(b.F.CHAT_CLEAR)},sendClear:function(e){var t=this;if(this.promises.sendClear)return this.promises.sendClear;var n=this.msgs.last(),r=n?n.id:void 0;this.promises.sendClear=T.sendConversationClear(this.id,r,!e);var i=new I(l10n.t("action_chat_clearing")),o=this.promises.sendClear.then(function(e){return 200===e.status?new I(l10n.t("action_chat_cleared")):e.status>=400?new I(l10n.t("action_chat_clear_failed")):void 0})["catch"](function(n){return p.error("models:chat:sendClear dropped")(n),new I(l10n.t("action_chat_clear_failed"),l10n.t("action_try_again"),t.sendClear.bind(t,e))});return w.openToast(u.createElement(A,{id:A.genId(),initialAction:i,pendingAction:o})),this.promises.sendClear.then(function(r){200!==r.status||r._duplicate||t.deleteMsgsBeforeMsgInclusive(n,e)})["finally"](function(){t.promises.sendClear=null})},"delete":function(e){this.cancelPendingPromises(),h.prototype["delete"].call(this),this.groupMetadata["delete"](),this.presence["delete"](),Store.Mute.remove(this.id),this.mute["delete"](),this.deleteMsgs(),Store.Chat.remove(this.id),w.clearChat(this)},isDirty:function(){return 0!==this.unreadCount},isNewlyCreated:function(){return!!this.createdLocally&&0===this.msgs.length},isVisible:function(){return this.viewed||!this.isNewlyCreated()},onNewMsg:function(e){if(e&&"i"!==e.eventType)if(this.t=e.t,this.archive&&(this.archive=!1),e.isSentByMe||this.presence.handle({id:this.id,participant:e.author,type:"available"}),e.isSentByMe)this.unreadCount=0;else if("d"===e.eventType)this.unreadCount=this.unreadCount+1||1,w.alertNewMsg(e),this.msgs.length<d.MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs();else if("s"===e.eventType){if("gp2"===e.type&&"add"===e.subtype&&_.first(e.recipients)===Store.Conn.me&&!this.contact.name)return;w.alertNewMsg(e)}},setArchive:function(e,t){var n=this;if(this.archive===e)return l["default"].reject(new N.ActionError);if(this.promises.setArchive)return this.promises.setArchive;var r=this.msgs.last(),i=r?r.id:void 0,o=T.sendConversationArchive(this.id,e,i),a=new I(e?l10n.t("action_chat_archiving"):l10n.t("action_chat_unarchiving"));t=t||A.genId();var s=o.then(function(r){var i=void 0;return 200===r.status?(i=e?l10n.t("action_chat_archived"):l10n.t("action_chat_unarchived"),new I(i,l10n.t("action_undo"),n.setArchive.bind(n,!e,t))):r.status>=400?new I(e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed")):void 0})["catch"](function(r){p.error("models:chat:setArchive dropped")(r);var i=e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed");return new I(i,l10n.t("action_try_again"),n.setArchive.bind(n,e,t))});return w.openToast(u.createElement(A,{id:t,initialAction:a,pendingAction:s})),this.promises.setArchive=o.bind(this).then(function(t){200!==t.status||t._duplicate||(this.archive=e)})["finally"](function(){n.promises.setArchive=null})},canArchive:function(){return this.isBroadcast?b.supportsFeature(b.F.ARCHIVE_BROADCAST):b.supportsFeature(b.F.ARCHIVE)},sendSeen:function(){if(this.markedUnread||0===this.unreadCount)return l["default"].resolve();if(!S.available)return this.listenTo(S,"change:available",this.sendSeen),l["default"].resolve();this.stopListening(S,"change:available",this.sendSeen);for(var e,t=this.msgs.length-1;t>=0;t--){var n=this.msgs.at(t);if(n&&(!n.isSentByMe||!n.local||n.ack>0)){e=n;break}}var r=this.unreadCount-this.pendingSeenCount;if(0===r)return l["default"].resolve();this.pendingSeenCount=this.unreadCount;var i=this,o=function(){i.pendingSeenCount=i.pendingSeenCount-r,i.pendingSeenCount<0&&(p.error("models:chat:sendSeen unread "+i.unreadCount+" pending: "+i.pendingSeenCount+" delta: "+r)(),i.pendingSeenCount=0)},a=e?e.id:void 0;return b.gte([0,4])?T.sendConversationSeen(this.id,a,r).bind(this).then(function(e){return o(),200!==e.status||e._duplicate||this.markSeen(r),e})["catch"](N.WapDrop,function(e){o(),p.error("models:chat:sendConversationSeen dropped")()}):(o(),this.markSeen(r),T.sendConversationSeen(this.id,a,r).bind(this).then(function(e){return e})["catch"](N.WapDrop,function(e){p.error("models:chat:sendConversationSeen dropped")()}))},markSeen:function(e){e&&"number"==typeof e?e>0&&e<=this.unreadCount?this.unreadCount=this.unreadCount-e:-1===e&&this.unreadCount<=0&&(this.unreadCount=0):this.unreadCount=0,this.unreadMsgAnchor=void 0,this.markedUnread=!1},markUnread:function(e,t){var n=this;if(e?this.active&&(this.markedUnread=!0):this.markedUnread=!1,this.promises.markUnread)return this.promises.markUnread;this.promises.markUnread=e?this.sendUnseen():this.sendSeen();var r=new I(e?l10n.t("action_chat_marking_unread"):l10n.t("action_chat_marking_read"));t=t||A.genId();var i=this.promises.markUnread.then(function(r){if(200===r.status){var i=e?l10n.t("action_chat_marked_unread"):l10n.t("action_chat_marked_read");return new I(i,l10n.t("action_undo"),n.markUnread.bind(n,!e,t))}return r.status>=400?new I(e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed")):void 0})["catch"](function(r){var i=e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed");return new I(i,l10n.t("action_try_again"),n.markUnread.bind(n,e,t))});return w.openToast(u.createElement(A,{id:t,initialAction:r,pendingAction:i})),this.promises.markUnread["finally"](function(){n.promises.markUnread=null})},canMarkUnseen:function(){return b.supportsFeature(b.F.CHAT_MARK_UNSEEN)},sendUnseen:function(){var e=this,t=this.msgs.last(),n=t?t.id:void 0;return T.sendConversationUnseen(this.id,n).then(function(t){return 200===t.status?e.markUnseen():e.markedUnread=!1,t})},markUnseen:function(){this.active&&(this.markedUnread=!0),this.unreadCount=-1},markRecording:function(){if((this.presence.isOnline||this.isGroup)&&!this.recording){var e=this.id;T.sendChatstateRecording(e).then(function(t){t.status>=400&&p.error("models:chat send presence recording error "+e)()})["catch"](N.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),d.PRESENCE_RESEND_WAIT)}this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.recording=!0,this.typing=!1},markComposing:function(){if((this.presence.isOnline||this.isGroup)&&!this.typing){var e=this.id;T.sendChatstateComposing(e).then(function(t){t.status>=400&&p.error("models:chat send presence composing error "+e)()})["catch"](N.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),d.PRESENCE_RESEND_WAIT)}this.typing=!0,this.pausedTimerId&&clearTimeout(this.pausedTimerId),this.pausedTimerId=_.delay(this.markPaused.bind(this),d.SEND_PAUSED_WAIT)},markPaused:function(){if((this.presence.isOnline||this.isGroup)&&(this.typing||this.recording)){var e=this.id;T.sendChatstatePaused(e).then(function(t){t.status>=400&&p.error("models:chat send presence paused error "+e)()})["catch"](N.WapDrop,_.noop)}this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=this.recording=!1},_resendPresence:function(){var e=this.id;if(this.recording)T.sendChatstateRecording(e).then(function(t){t.status>=400&&p.error("models:chat send presence resend recording error "+e)()})["catch"](N.WapDrop,_.noop);else{if(!this.typing)return void this.unset("presenceResendTimerId");T.sendChatstateComposing(e).then(function(t){t.status>=400&&p.error("models:chat send presence resend composing error "+e)()})["catch"](N.WapDrop,_.noop)}this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),d.PRESENCE_RESEND_WAIT)},_messageSent:function(){this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=!1},_presenceOnlineChanged:function(){this.presence.isOnline?this._resendPresence():this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId"))},handleGroupAction:function(e,t,n){var r;switch(e){case"subject":return void(this.contact.name=n.subject);case"add":case"promote":case"demote":var i="promote"===e;return r=_.map(n.participants,function(e){return{id:e,isAdmin:i}}),void this.groupMetadata.participants.add(r,{merge:!0});case"remove":return r=this.groupMetadata.participants,void _.each(n.participants,function(e){r.remove(e)});case"modify":return;default:return}},preload:function(){1===this.msgs.length&&this.loadEarlierMsgs()},loadEarlierMsgs:function(e){return e||(e=this.msgs),e.msgLoadState.noEarlierMsgs?l["default"].resolve():e.loadEarlierPromise?e.loadEarlierPromise:this._loadMsgs("before",e).then(function(t){return _.isArray(t)&&t.length<d.PAGE_SIZE&&(e.msgLoadState.noEarlierMsgs=!0),t})},isMostRecentCMC:function(e){return this.msgs===e},loadRecentMsgs:function(e){return e||(e=this.msgs),this.isMostRecentCMC(e)?l["default"].resolve():e.loadRecentPromise?e.loadRecentPromise:this._loadMsgs("after",e)},_loadMsgs:function(e,t){var n;n="after"===e?t.last():t.first();var r={};return n?r=n.id.clone():r.remote=this.id,r.count=d.PAGE_SIZE,r.direction=e,this._loadMsgsPromise(n,t,Store.Msg.findQuery(r),e)},_loadMsgsPromise:function(e,t,n,r){"after"===r?t.msgLoadState.isLoadingRecentMsgs=!0:"before"===r?t.msgLoadState.isLoadingEarlierMsgs=!0:"around"===r&&(t.msgLoadState.isLoadingAroundMsgs=!0);var i=this.regCancellablePromise(n)["finally"](function(){var n=e&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,n&&(e.msgChunk.msgLoadState.contextLoaded=!0),"after"===r?(t.msgLoadState.isLoadingRecentMsgs=!1,delete t.loadRecentPromise):"before"===r?(t.msgLoadState.isLoadingEarlierMsgs=!1,delete t.loadEarlierPromise):"around"===r&&(t.msgLoadState.isLoadingAroundMsgs=!1,delete t.loadAroundPromise)})["catch"](N.WapDrop,_.noop)["catch"](function(e){p.error("chat:loadMsgs:error "+e)()})["catch"](l["default"].CancellationError,_.noop);return"after"===r?t.loadRecentPromise=i:"before"===r?t.loadEarlierPromise=i:"around"===r&&(t.loadAroundPromise=i),i},getSearchContext:function(e){var t,n=e.msgChunk,r=(0,s["default"])(d.PAGE_SIZE/3*2);if(n&&n.msgLoadState.contextLoaded)t=n.loadAroundPromise||l["default"].resolve();else{n||(n=e.msgChunk=new E,n.add(e),this.msgChunks.push(n));var i=e.id.clone();i.count=r;var o=function(){return e.msgChunk};t=this._loadMsgsPromise(e,n,Store.Msg.getContext(i,o),"around"),t.then(function(t){var i=t[0];_.isArray(i)&&i.length<r&&(e.msgChunk.msgLoadState.noEarlierMsgs=!0,e.msgChunk!==n&&(n.msgLoadState.noEarlierMsgs=!0))})}return{collection:n,promise:t,msg:e,highlightMsg:!0}},sendStarMsgs:function(e,t,n){var r=this;if(!e)return l["default"].reject(new N.ActionError);if(_.any(e,function(e){return!e.id}))return l["default"].reject(new N.ActionError);if(this.promises.sendStarMsgs)return this.promises.sendStarMsgs;this.promises.sendStarMsgs=T.sendMessageStarred(this.id,_.map(e,function(e){return e.id}),t);var i=_.size(e),o={count:i,_plural:i},a=new I(t?l10n.t("action_message_starring",o):l10n.t("action_message_unstarring",o));n=n||A.genId();var s=this.promises.sendStarMsgs.then(function(i){if(200===i.status){var a=t?l10n.t("action_message_starred",o):l10n.t("action_message_unstarred",o);return new I(a,l10n.t("action_undo"),r.sendStarMsgs.bind(r,e,!t,n))}return i.status>=400?new I(t?l10n.t("action_message_star_failed",o):l10n.t("action_message_unstar_failed",o)):void 0})["catch"](function(i){p.error("models:chat:sendStarMsgs dropped")(i);var a=t?l10n.t("action_message_star_failed",o):l10n.t("action_message_unstar_failed",o);return new I(a,l10n.t("action_try_again"),r.sendStarMsgs.bind(r,e,t,n))});return w.openToast(u.createElement(A,{id:n,initialAction:a,pendingAction:s})),this.promises.sendStarMsgs.then(function(n){200===n.status&&(t?Store.StarredMsg.add(e):Store.StarredMsg.remove(e),_.forEach(e,function(e){e.set("star",t)}))})["finally"](function(){r.promises.sendStarMsgs=null})},sendNotSpam:function(e,t){var n=this;if(!b.supportsFeature(b.F.SPAM))return l["default"].resolve();if(this.notSpam)return l["default"].resolve();if(this.notSpam=!0,this.promises.sendNotSpam)return this.promises.sendNotSpam;if(this.promises.sendNotSpam=T.sendConversationNotSpam(this.id),e){var r=new I(l10n.t("action_mark_as_not_spam"));t=t||A.genId();var i=this.promises.sendNotSpam.then(function(e){return 200===e.status?new I(l10n.t("action_marked_as_not_spam")):e.status>=400?new I(l10n.t("action_mark_as_not_spam_failed")):void 0})["catch"](function(r){return p.error("models:chat:sendNotSpam dropped")(r),new I(l10n.t("action_mark_as_not_spam_failed"),l10n.t("action_try_again"),n.sendNotSpam(e,t))});w.openToast(u.createElement(A,{id:t,initialAction:r,pendingAction:i}))}return this.promises.sendNotSpam["finally"](function(){n.promises.sendNotSpam=null})},sendSpamReport:function(e){var t=this;if(this.promises.sendSpamReport)return this.promises.sendSpamReport;this.promises.sendSpamReport=T.sendSpamReport(this.id);var n=new I(l10n.t("action_spam_report"));e=e||A.genId();var r=this.promises.sendSpamReport.then(function(e){return 200===e.status?new I(l10n.t("action_spam_reported")):e.status>=400?new I(l10n.t("action_spam_report_failed")):void 0})["catch"](function(n){return p.error("models:chat:sendSpamReport dropped")(n),new I(l10n.t("action_spam_report_failed"),l10n.t("action_try_again"),t.sendSpamReport.bind(t,e))});return w.openToast(u.createElement(A,{id:e,initialAction:n,pendingAction:r})),this.promises.sendSpamReport["finally"](function(){t.promises.sendSpamReport=null})},sendDeleteMsgs:function(e,t){var n=this;if(!e)return l["default"].reject(new N.ActionError);if(_.any(e,function(e){return!e.id}))return l["default"].reject(new N.ActionError);if(this.promises.sendDeleteMsgs)return this.promises.sendDeleteMsgs;this.promises.sendDeleteMsgs=T.sendMessageDelete(this.id,_.map(e,function(e){return e.id}),!0);var r=_.size(e),i={count:r,_plural:r},o=new I(l10n.t("action_message_deleting",i));t=t||A.genId();var a=this.promises.sendDeleteMsgs.then(function(e){return 200===e.status?new I(l10n.t("action_message_deleted",i)):e.status>=400?new I(l10n.t("action_message_delete_failed",i)):void 0})["catch"](function(r){return p.error("models:chat:sendDeleteMsgs dropped")(r),new I(l10n.t("action_message_delete_failed",i),l10n.t("action_try_again"),n.sendDeleteMsgs.bind(n,e,t))});return w.openToast(u.createElement(A,{id:t,initialAction:o,pendingAction:a})),this.promises.sendDeleteMsgs.then(function(t){200===t.status&&_.forEach(e,function(e){e["delete"]()})})["finally"](function(){n.promises.sendDeleteMsgs=null})},removeMsg:function(e){var t=e.msgChunk;if(t){var n=t.indexOf(e);0>n||(p.log("models:Chat:removeMsg "+e.get("id"))(),t.remove(e),0===t.length&&(t===this.msgs?(p.log("models:Chat:removeMsg 0 messages left, querying...")(),this.loadEarlierMsgs()):this.removeMsgsCollection(t)))}},deleteMsgs:function(e){var t=this;this.getAllCMCs().forEach(function(n){n.filter(function(t){return(e||!t.star)&&!t.isPersistent}).forEach(function(e){e["delete"]()}),n.msgLoadState.noEarlierMsgs=!0,n!==t.msgs&&t.removeMsgsCollection(n)}),this.unreadCount=0},deleteMsgsOlderThan:function(e,t){var n=this.msgs,r=_.first(n.models);if(r&&!(r.t>=e)){if(r=_.last(n.models),r.t<e)return void this.deleteMsgs(t);var i=function(n){return n&&(n.star&&!t||n.t>=e||n.isPersistent)};this.deleteMsgsPartial(i)}},deleteMsgsBeforeMsgInclusive:function(e,t){if(e&&this.msgs.get(e.id)){var n=this.msgs.indexOf(e),r=function(e,r){return e.msgChunk===this.msgs&&r>n||t&&e.star||e.isPersistent};this.deleteMsgsPartial(r)}},deleteMsgsPartial:function(e){var t=this,n=this.unreadCount,r=_.flatten(this.getAllCMCs().map(function(t){return t.filter(function(){return!e.apply(this,arguments)},this)},this));if(r.forEach(function(e){e["delete"]()}),_.clone(this.msgChunks).forEach(function(e){0===e.length&&t.removeMsgsCollection(e)}),this.msgs.length>0){var i=n>this.msgs.length?this.msgs.length:n;this.unreadCount=i,this.msgs.msgLoadState.noEarlierMsgs=!0}},getFirstMsgWithStatus:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&(e.isSentByMe||e.type===m.TYPE.PTT)})},getFirstMsgFromMe:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&e.isSentByMe})},sendMessage:function(e){if(e="undefined"==typeof e?"":e.trim(),""===e)return l["default"].resolve();this._messageSent();var t=this.id,n=Store.Conn.me,r=new m({id:new k(n,t,m.newTag(),void 0,"out"),body:e,type:"chat",t:M.globalUnixTime(),from:n,to:t,self:"out",local:!0,ack:0}),i=Store.Msg.send(r);return this.msgs.add(r),i},sendMedia2:function(e){var t=this;e=_.isArray(e)?e:[e];var n=this.id;l["default"].each(e,function(e){e.uploadPromise2=e.reupload(n)}).mapSeries(function(e){var n=e.getDuration.then(function(e){return _.isFinite(e)?e+"":void 0}),r=e.getThumb?e.getThumb.then(function(e){var t=e.url;return x.parseDataURL(t).data}):void 0,i=e.caption;return"document"===e.msgType&&(i=i||e.filename),l["default"].props({id:new k(Store.Conn.me,t.id,m.newTag(),void 0,"out"),body:r,type:e.msgType,t:M.globalUnixTime(),from:Store.Conn.me,isNewMsg:!0,to:t.id,self:"out",url:window.URL.createObjectURL(e.blob),mediaState:m.MEDIA_STATE.UPLOADING,duration:n,ack:0,local:!0,mimetype:e.mimetype,height:e.height,width:e.width,fullHeight:e.height,fullWidth:e.width,size:e.blob.size,caption:i,filehash:e.getFilehash,filename:e.filename,decryptedMediaBlob:e.blob})["catch"](function(e){p.assert(!1,"media-props-failed","Got Error "+e)(e)}).then(function(n){if(n){var r=void 0,i=new l["default"](function(e){r=e}),o=e.reupload,a=e.uploadPromise2,s=Store.Msg.add(n),c=s.handleUpload(i,a,o);return t.msgs.add(s),function(){return r(),c}}})}).each(function(e){return e?e():void 0})},forwardMessages:function(e){var t=this,n=this.id,r=this.contact;if(r.isUser&&r.isBlocked())return l["default"].reject(new N.ContactBlocked("Forwarded to contact is blocked",r));var i=[],a=m.TYPE;return l["default"].mapSeries(e,function(e){var r=e.type===a.PTT?a.AUDIO:e.type,o=e.toJSON();switch(_.assign(o,{id:new k(Store.Conn.me,n,m.newTag(),void 0,"out"),from:Store.Conn.me,t:M.globalUnixTime(),to:n,type:r,ack:0,caption:r===a.DOCUMENT?e.caption:void 0,local:!0,self:"out",isNewMsg:!0,decryptedMediaBlob:e.decryptedMediaBlob,fullWidth:e.fullWidth,fullHeight:e.fullHeight}),r){case a.CHAT:case a.VCARD:case a.LOCATION:var s=Store.Msg.add(o);return t.msgs.add(s),[s,null];case a.DOCUMENT:case a.VIDEO:case a.IMAGE:case a.AUDIO:if(e.mediaState===m.MEDIA_STATE.ERROR_MISSING)return i.push(e),null;o.mediaState=m.MEDIA_STATE.UPLOADING;var c=void 0,u=new l["default"](function(e){c=e}),d=Store.Msg.add(o);t.msgs.add(d);var h=R.forwardMediaMsg(d,e,u);return[d,function(){return c(),h}];default:return p.assert(!1,"unrecognized-forward","type = "+r)(),null}}).each(function(e){if(e){var t=(0,o["default"])(e,2),n=t[0],r=t[1];return r?r()["catch"](_.noop):void Store.Msg.send(n)}})["return"](i)},shouldSendEncrypted:function(e,t){return R.shouldSendEncrypted(this,e,t)},updateReadOnly:function(){this.isGroup&&!this.groupMetadata.stale&&(this.isReadOnly=!this.groupMetadata.participants.get(Store.Conn.me)),this.isBroadcast&&this.updateTitle()},_updateAssignedColor:function(){if(this.colors){var e=this.groupMetadata.participants;if(0!==e.size){var t=this.colors,n=_.difference(_.keys(t),e.pluck("id").map(D));n.forEach(function(e){delete t[e]}),n.length&&this._saveAssignedColors()}}},loadAssignedColors:function(){return this.listenTo(this.groupMetadata.participants,"all",this._updateAssignedColor),C.getGroupParticipantAssignedColor(this.id)||{}},saveAssignedColors:function(){var e=this.colors;e&&C.setGroupParticipantAssignedColor(this.id,e)},assignedColor:function(e){var t,n=this.colors||(this.colors=this.loadAssignedColors()),r=D(e);return(t=n[r])?t:(t=_.keys(n).length%d.NUM_COLORS+1,n[r]=t,this._saveAssignedColors(),t)},setSubject:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=arguments[1];if(t=t.trim(),!t)return l["default"].reject(new N.ActionError);if(t===this.contact.name)return l["default"].reject(new N.ActionError);var r=T.changeSubject(this.id,t),i=this.contact.name,o=new I(l10n.t("action_group_renaming"));n=n||A.genId();var a=r.then(function(r){return 200===r.status?new I(l10n.t("action_group_renamed",{subject:t}),l10n.t("action_undo"),e.setSubject.bind(e,i,n)):r.status>=400?new I(l10n.t("action_group_rename_failed")):void 0})["catch"](function(r){return p.error("models:chat:setSubject dropped")(r),new I(l10n.t("action_group_rename_failed"),l10n.t("action_try_again"),e.setSubject.bind(e,t,n))});return w.openToast(u.createElement(A,{id:n,initialAction:o,pendingAction:a})),r.then(function(n){200!==n.status||n._duplicate||(e.contact.name=t)})},unstarAll:function(){this.getAllMsgs().forEach(function(e){e&&(e.star=!1)})},replaceMsgsCollection:function(e){p.info("model:Chat:replaceMsgsCollection:"+this.id)(),this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs),this.msgChunks=_.without(this.msgChunks,e)},notifyMsgCollectionMerge:function(e,t,n){this.trigger("change:cmc:merge",e,t,n)},removeMsgsCollection:function(e){this.msgChunks=_.without(this.msgChunks,e)},getAllCMCs:function(){return this.msgChunks.concat([this.msgs])},getAllMsgs:function(){return _.flatten(this.getAllCMCs().map(function(e){return e.models}))}});L.KIND=O,e.exports=L},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(707),o=r(i),a=n(6),s=n(46),c={LEFT:"left",MID:"mid",RIGHT:"right"},l=a.createClass({displayName:"Drawer",propTypes:{children:a.PropTypes.node.isRequired,id:a.PropTypes.string,variant:a.PropTypes.string,noContainer:a.PropTypes.bool,position:a.PropTypes.oneOf(_.values(c)),onDragLeave:a.PropTypes.func,onDrop:a.PropTypes.func,onDragOver:a.PropTypes.func},getDefaultProps:function(){return{position:"left"}},statics:{RIGHT:"right",LEFT:"left",MID:"mid"},getInitialState:function(){return{isDragging:!1}},isDragDropDrawer:function(){return this.props.onDragOver&&this.props.onDragLeave&&this.props.onDrop},onDragOver:function(e){e.preventDefault(),this.isDragDropDrawer()&&!this.state.isDragging&&(this.props.onDragOver(e),this.setState({isDragging:!0}))},onDrop:function(e){e.preventDefault(),e.stopPropagation(),this.setState({isDragging:!1}),this.props.onDrop(e)},onDragLeave:function(e){e.preventDefault(),e.stopPropagation(),this.state.isDragging&&(this.setState({isDragging:!1}),this.props.onDragLeave(e))},render:function(){var e,t=this.props,n=s("drawer",(0,o["default"])({},"drawer-"+t.id,!!t.id));if(this.isDragDropDrawer()){var r=this.state.isDragging?{}:{display:"none"};e=a.createElement("div",{key:"mask",className:"drag-drop-mask",style:r,onDragLeave:this.onDragLeave,onDrop:this.onDrop})}return a.createElement("div",{className:n,onDragOver:this.onDragOver},e,t.children)}});l.Position=c,e.exports=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(157),o=r(i),a=n(351),s=r(a),c=n(6),l=n(46),u=c.createClass({displayName:"DrawerBody",propTypes:{expands:c.PropTypes.bool,flex:c.PropTypes.bool,classes:c.PropTypes.string},getDefaultProps:function(){return{expands:!1}},render:function(){var e=this.props,t=(e.expands,e.classes),n=e.flex,r=(0,s["default"])(e,["expands","classes","flex"]),i=l("drawer-body","drawer-editable",t,{"drawer-body-flex":n});return c.createElement("div",(0,o["default"])({className:i},r),this.props.children)}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(352),o=n(46),a=n(58),s={SMALL:"small",LARGE:"large",POPUP:"popup",OFFSET:"offset"},c=r.createClass({displayName:"DrawerHeader",propTypes:{children:r.PropTypes.node,title:r.PropTypes.string,onBack:r.PropTypes.func,onCancel:r.PropTypes.func,a8n:r.PropTypes.string,type:r.PropTypes.oneOf(_.values(s)).isRequired},render:function(){var e=this.props,t=e.title,n=e.onBack,c=e.onCancel,l=e.type,u=e.children,d=null;if(t){var p=void 0,h={textAlign:"initial"};l===s.SMALL?(p={fontWeight:400,fontSize:16,lineHeight:"21px"},h.width=54):l===s.LARGE?(p={fontWeight:500,fontSize:19,lineHeight:"19px"},h.width=54):(p={fontWeight:500,fontSize:19,lineHeight:"19px"},h.width=48,h.opacity=.7);var f=o("icon btn-close-drawer",{"icon-back":l===s.SMALL,"icon-back-light":l!==s.SMALL}),m=n?r.createElement("span",{className:f,"data-a8n":i.key("btn-closer-drawer"),"data-ignore-capture":a.IGNORE_ANY,onClick:n}):null,g=o("icon btn-close-drawer",{"icon-x":l===s.SMALL,"icon-x-light":l!==s.SMALL}),v=c?r.createElement("span",{className:g,"data-a8n":i.key("btn-closer-drawer"),"data-ignore-capture":a.IGNORE_ANY,onClick:c}):null;d=r.createElement("div",{className:"drawer-title",style:p},r.createElement("div",{style:h,className:"drawer-title-action"},m,v),r.createElement("span",{"data-a8n":i.key(this.props.a8n),className:"drawer-title-body"},t))}var y=o({"drawer-header":l===s.LARGE,"drawer-header-small":l===s.SMALL,"drawer-header-offset":l===s.OFFSET,"drawer-header-popup":l===s.POPUP});return r.createElement("header",{className:y},d,u)}});c.Type=s,e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(922),o=n(799),a=n(107),s=n(22),c="large",l="medium",u="regular",d="low",p="high",h=r.createClass({displayName:"DetailImage",mixins:[o],propTypes:{id:r.PropTypes.string.isRequired,size:r.PropTypes.oneOf([u,l,c]),loader:r.PropTypes.bool,quality:r.PropTypes.oneOf([d,p]),onClick:r.PropTypes.func,onLoad:r.PropTypes.func},getDefaultProps:function(){return{size:u,quality:d}},statics:{LARGE:c,MEDIUM:l,REGULAR:u,LOW:d,HIGH:p},getInitialState:function(){var e=this.props.quality;return s.isBroadcast(this.props.id)?{loaded:!1}:e===h.HIGH?{loaded:!1,imgFull:this.async("id.ProfilePicThumb.imgFull")}:e===h.LOW?{loaded:!1,img:this.async("id.ProfilePicThumb.img")}:void 0},onLoad:function(e){this.state.loaded||this.setState({loaded:!0}),this.props.onLoad&&this.props.onLoad()},onError:function(e){if(410===e){var t=Store.ProfilePicThumb.get(this.props.id);t&&t.update()}},getClasses:function(){var e="avatar",t=this.props.id;return s.isUser(t)?e+=" icon-user-default":s.isGroup(t)?e+=" icon-group-default":s.isBroadcast(t)&&(e+=" icon-broadcast-default"),this.props.size===h.LARGE&&(e+=" avatar-l"),this.props.size===h.MEDIUM&&(e+=" avatar-m"),e},getStyle:function(){return this.props.onClick?{cursor:"pointer"}:null},render:function(){var e=this.state.img||this.state.imgFull,t=Store.ProfilePicThumb.get(this.props.id),n=void 0;return!this.props.loader||this.state.loaded||t&&!t.stale&&!e||(n=r.createElement("div",{className:"avatar-spinner-container"},r.createElement(a,{size:50,stroke:3}))),e=e?r.createElement(i,{src:e,onLoad:this.onLoad,onError:this.onError}):null,r.createElement("div",{className:this.getClasses(),style:this.getStyle(),onClick:this.props.onClick},e,n)}});e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(352),o=n(104),a=n(58),s=n(105),c=s.HotKeys,l=r.createClass({displayName:"MenuItem",mixins:[o],propTypes:{shortcut:r.PropTypes.string,action:r.PropTypes.func.isRequired,a8n:r.PropTypes.string},componentWillMount:function(){},onKeyDown:function(e){if(e.metaKey){var t=this.props.shortcut;t&&e.key===t+""&&(e.preventDefault(),this.onClick(e))}},onClick:function(e){this.props.action(e)||e.target&&e.target.hasAttribute("data-ignore-capture")?e.stopPropagation():a.pop(a.MENU)},render:function(){var e=null,t=_.isString(this.props.children)?this.props.children:null,n={enter:this.onClick};return n[l10n.LR("right","left")]=this.onClick,r.createElement(c,{component:"li",handlers:n,"data-a8n":i.key(this.props.a8n),className:"menu-item menu-shortcut",onClick:this.onClick},r.createElement("a",{className:"ellipsify",title:t},this.props.children),e)}});e.exports=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(157),o=r(i),a=n(707),s=r(a),c=n(351),l=r(c),u=n(6),d=n(28),p=n(160),h=n(46),f=n(9),m=n(104),g=n(153),v=72,y="data-list-scroll-container",E=u.createClass({displayName:"List",mixins:[m,g],propTypes:{extraItems:u.PropTypes.number,scrollTop:u.PropTypes.number,animate:u.PropTypes.bool.isRequired,classes:u.PropTypes.arrayOf(u.PropTypes.string),onPointerEventsOff:u.PropTypes.func,onPointerEventsOn:u.PropTypes.func,height:u.PropTypes.number.isRequired,data:u.PropTypes.arrayOf(u.PropTypes.element).isRequired},getDefaultProps:function(){return{classes:[],scrollTarget:null,data:null,height:v,extraItems:30,animate:!1}},statics:{DEFAULT_HEIGHT:v,SCROLL_ATTR:y},getInitialState:function(){return{scrollTarget:void 0,firstVisibleIndex:0,visibleCount:0,physicalCount:0,renderVisible:!0}},componentWillReceiveProps:function(e){_.isNumber(e.scrollTop)&&this.state.scrollTarget&&(this.state.scrollTarget.scrollTop=e.scrollTop),
this.props.scrollTarget===e.scrollTarget&&this.props.height===e.height&&this.props.data.length===e.data.length||this.initialize(e)},componentWillMount:function(){this.scrollTop=0,this._eventLoopBusy=!1,this._uiBusy=!1,this.renderedItems={},this.enablePointerEvents=this.safeDebounce(this._enablePointerEvents,150),this.disableUIBusy=this.safeDebounce(this._disableUIBusy,150)},componentDidMount:function(){this.initialize();var e=this;this.regNativeListener(window,"resize",function(){e.initialize()})},initialize:function(e){var t=e?e:this.props;this.state.scrollTarget&&this.unregNativeListener(this.state.scrollTarget,"scroll",this.onScroll);for(var n,r=d.findDOMNode(this),i=0;5>i;i++){if(r.hasAttribute(y)){n=r;break}r=r.parentNode}if(!n)throw new Error("list scroll container not found");this.regNativeListener(n,"scroll",this.onScroll),this.scrollTop=n.scrollTop;var o=Math.floor(this.scrollTop/t.height),a=n.clientHeight,s=Math.min(Math.ceil(a/t.height),t.data.length),c=Math.min(s+t.extraItems,t.data.length);return this.setState({scrollTarget:n,firstVisibleIndex:o,visibleCount:s,physicalCount:c,renderVisible:!0}),this.renderedItems={},n},_enablePointerEvents:function(e){this._pointerEvents=!1,d.findDOMNode(this.refs.viewport).style.pointerEvents="auto",this.props.onPointerEventsOn&&this.props.onPointerEventsOn()},disablePointerEvents:function(e){this.enablePointerEvents(),this._pointerEvents||(this.props.onPointerEventsOff&&this.props.onPointerEventsOff(),d.findDOMNode(this.refs.viewport).style.pointerEvents="none",this._pointerEvents=!0)},onScroll:function(e){this._eventLoopBusy||window.requestAnimationFrame(this._onScroll),this._eventLoopBusy=!0},_disableUIBusy:function(){f.setUiBusy(!1),this._uiBusy=!1},_onScroll:function(){if(this.isMounted()){this.disablePointerEvents(),this._uiBusy||(f.setUiBusy(!0),this._uiBusy=!0),this.disableUIBusy(),this.scrollTop=this.state.scrollTarget.scrollTop;var e=Math.floor(this.scrollTop/this.props.height);if(this.state.firstVisibleIndex===e)this._eventLoopBusy=!1;else{var t=this;this.setState({firstVisibleIndex:e,renderVisible:!1},function(){t._eventLoopBusy=!1})}}},getFirstPhysicalIndex:function(){var e=this.state.firstVisibleIndex+this.state.visibleCount/2,t=Math.max(0,Math.floor(e-this.state.physicalCount/2));return Math.min(t,this.props.data.length-this.state.physicalCount)},getComponents:function(){var e=this,t=this.getFirstPhysicalIndex(),n=Math.min(t+this.state.physicalCount,this.props.data.length),r={},i=_.chain(this.props.data).forEach(function(e,t){return r[e.key]=t}).slice(t,n).forEach(function(t,n){return e.renderedItems[t.key]=t}).value(),o=this.state.renderVisible?i:this.renderedItems;return _(o).sortBy("key").map(function(t){var n=0===r[t.key]?"first":null;return u.createElement(b,{key:t.key,rowHeight:e.props.height,classes:n,zIndex:e.props.data.length-r[t.key]-1,rowNumber:r[t.key]},t)}).value()},render:function(){var e={container:{},viewport:{height:this.props.data.length*this.props.height}},t={container:h("infinite-list",this.props.classes,{"infinite-list-animate":this.props.animate&&!this._eventLoopBusy}),viewport:"infinite-list-viewport"},n=this.getComponents();return u.createElement("div",{className:t.container,style:e.container},u.createElement("div",{className:t.viewport,ref:"viewport",style:e.viewport},n))}}),b=u.createClass({displayName:"ListItem",propTypes:{children:u.PropTypes.element.isRequired,rowNumber:u.PropTypes.number.isRequired,rowHeight:u.PropTypes.number.isRequired,zIndex:u.PropTypes.number.isRequired},getInitialState:function(){return{rendered:!1}},componentDidMount:function(){this.setState({rendered:!0})},render:function(){var e=this.props,t=e.children,n=e.rowNumber,r=e.rowHeight,i=e.zIndex,a=e.classes,c=(0,l["default"])(e,["children","rowNumber","rowHeight","zIndex","classes"]),d=(0,s["default"])({zIndex:i,height:r,willChange:"transform"},p.prefix("transform"),"translate3d(0, "+100*n+"%, 0)"),f=h(a,{"infinite-list-item":!0,"infinite-list-item-keyframe":!this.state.rendered,"infinite-list-item-transition":!0});return u.createElement("div",(0,o["default"])({className:f,style:d},c),t)}});e.exports=E},function(e,t,n){"use strict";function r(e,t){this.list=e,this.index=-1,this.value=void 0,this.getter=t||function(e){return e}}var i=n(49);_.assign(r.prototype,i,{init:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],n=void 0,r=void 0;if(this.value){if(n=_.indexOf(e,this.value),n>-1){if(n===this.index)return this.list=e;r=!0,t=!1}else n=e.length&&t&&this.index>-1?Math.min(Math.max(this.index,0),e.length-1):-1,r=n>-1;this.list=e,this.set(n,t,r)}else this.list=e},unset:function(){this.value&&this.trigger(this.getter(this.value),!1),this.value=void 0,this.index=-1},reset:function(){this.index<0||this.value&&this.trigger(this.getter(this.value),"focus")},set:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];if(this.list.length){var r=Math.min(Math.max(e,-1),this.list.length-1),i=this.value,o=r>-1?this.list[r]:void 0;o?(this.trigger(this.getter(o),t?"focus":"select"),this.value=o):n&&(this.value=void 0),n&&i&&i!==o&&this.trigger(this.getter(i),!1),this.index=r}},getVal:function(){return this.value},setVal:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=_.indexOf(this.list,e);n>-1?this.set(n,t):(this.unset(),this.value=e)},setFirst:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];_.isEmpty(this.list)||this.set(0,e)},setLast:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];_.isEmpty(this.list)||this.set(this.list.length-1,e)},setPrev:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];_.isEmpty(this.list)||this.set(this.prev(),e)},setNext:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];_.isEmpty(this.list)||this.set(this.next(),e)},prev:function(){return _.isEmpty(this.list)?-1:-1===this.index?-1:this.index-1},next:function(){return _.isEmpty(this.list)?-1:Math.min(this.index+1,this.list.length-1)}}),e.exports=r},function(e,t,n){"use strict";var r=n(6),i=n(9),o=n(153),a=n(46),s=4e3,c=r.createClass({displayName:"Toast",mixins:[o],propTypes:{id:r.PropTypes.string.isRequired,msg:r.PropTypes.string.isRequired,action:r.PropTypes.shape({actionText:r.PropTypes.string.isRequired,onAction:r.PropTypes.func.isRequired}),onDismiss:r.PropTypes.func,duration:r.PropTypes.number},statics:{genId:function(e){return _.uniqueId(e||"toast")}},getDefaultProps:function(){return{duration:s}},componentWillMount:function(){this.delay=this.safeDelay(function(){i.closeToast(this)},s)},restartDelay:function(){this.clearSafeTimeout(this.delay),this.delay=this.safeDelay(function(){i.closeToast(this)},s)},onDismiss:function(){i.closeToast(this),this.props.onDismiss&&this.props.onDismiss()},render:function(){var e,t=this.props,n=t.msg,i=t.action,o=t.className;return i&&(e=r.createElement("button",{className:"action",onClick:i.onAction},i.actionText)),r.createElement("div",{className:a("toast",o)},r.createElement("span",null,n),e,r.createElement("button",{className:"icon icon-x-alt",onClick:this.onDismiss}))}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=r.createClass({displayName:"HiddenToken",propTypes:{children:r.PropTypes.node.isRequired},render:function(){return r.createElement("span",{className:"hidden-token"},"⁠⁠⁠⁠",this.props.children,"⁠⁠⁠⁠⁠")}});e.exports=i},function(e,t,n){"use strict";function r(e){var t,n,r="";switch(e.subtype){case"identity":t=Store.Contact.get(e.body),n=t?t.formattedName:h.formattedUser(e.body),r=l10n.t("web_security_code_change",{name:n});break;case"encrypt":var i=e.id.remote;r=h.isGroup(i)?l10n.t("web_group_info_encrypted"):h.isBroadcast(i)?l10n.t("web_broadcast_info_encrypted"):l10n.t("web_contact_info_encrypted")}return r}function i(e){var t="";switch(e.subtype){case"miss":t=l10n.t("web_missed_call_system_message",{time:p.timestampStr(e.t)})}return t}function o(e,t){var n,r,i="";if("create"===e){var o=parseInt(t,10);i=l10n.t("web_you_created_list_unnamed",{count:o,_plural:o})}else"add"===e?(n=Store.Contact.get(t),r=n?n.get("name"):"",r=r?r:h.formattedUser(t),i=l10n.t("web_list_recipient_added",{name:r})):"remove"===e&&(n=Store.Contact.get(t),r=n?n.get("name"):"",r=r?r:h.formattedUser(t),i=l10n.t("web_list_recipient_removed",{name:r}));return i}function a(e){var t,n,r="",i=e.get("type"),o=e.get("subtype"),a=e.displayName(),s=e.get("author"),c=e.get("body");if("group_notification"===i)switch(o){case"add":r=s===Store.Conn.me?l10n.t("web_group_participant_added_you"):l10n.t("web_group_participant_added_name",{name:a});break;case"remove":r=s===Store.Conn.me?l10n.t("web_group_participant_removed_you"):l10n.t("web_group_participant_removed_name",{name:a});break;case"leave":r=s===Store.Conn.me?l10n.t("web_group_participant_left_you"):l10n.t("web_group_participant_left_name",{name:a});break;case"picture":r="remove"===c?s===Store.Conn.me?l10n.t("web_photo_removed_by_you"):l10n.t("web_photo_removed_by",{name:a}):s===Store.Conn.me?l10n.t("web_photo_changed_by_you"):l10n.t("web_photo_changed_by",{name:a});break;case"subject":r=s===Store.Conn.me?l10n.t("web_group_subject_changed_by_you",{subject:c}):l10n.t("web_group_subject_changed_by_name",{name:a,subject:c});break;case"modify":t=h.formattedUser(e.get("author")),n=h.formattedUser(c),r=t===a?l10n.t("web_group_participant_changed_number_unknown_name",{name:a,new_number:n}):l10n.t("web_group_participant_changed_number",{name:a,old_number:t,new_number:n});break;default:u.log("wa:formatGroupNotification:unknown message subtype: "+o)()}else if("gp2"===i){var l,d=e.recipients,p=d?d.map(function(e){var t=Store.Contact.get(e);return t?t.get("formattedName"):h.formattedUser(e)}).join(l10n.t("enumeration_comma")):"",f=d?_.first(d):"",m=Store.Contact.get(f),g=m?m.get("formattedName"):f?h.formattedUser(f):"";switch(o){case"add":r=s?s===Store.Conn.me?l10n.t("web_group_participants_you_added_names",{participants:p}):f===Store.Conn.me?l10n.t("web_group_participants_name_added_you",{name:a}):l10n.t("web_group_participants_name_added_names",{name:a,participants:p}):f===Store.Conn.me?l10n.t("web_group_participant_added_you"):l10n.t("web_group_participant_added_name",{name:g});break;case"remove":r=s?s===Store.Conn.me?l10n.t("web_group_participants_you_removed_names",{participants:p}):f===Store.Conn.me?l10n.t("web_group_participants_name_removed_you",{name:a}):l10n.t("web_group_participants_name_removed_names",{name:a,participants:p}):f===Store.Conn.me?l10n.t("web_group_participant_removed_you"):l10n.t("web_group_participant_removed_name",{name:g});break;case"leave":r=f===Store.Conn.me?l10n.t("web_group_participant_left_you"):l10n.t("web_group_participant_left_name",{name:p});break;case"picture":r="remove"===c?s===Store.Conn.me?l10n.t("web_photo_removed_by_you"):l10n.t("web_photo_removed_by",{name:a}):s===Store.Conn.me?l10n.t("web_photo_changed_by_you"):l10n.t("web_photo_changed_by",{name:a});break;case"subject":r=s===Store.Conn.me?l10n.t("web_group_subject_changed_by_you",{subject:c}):l10n.t("web_group_subject_changed_by_name",{name:a,subject:c});break;case"modify":t=h.formattedUser(s),n=h.formattedUser(f),r=t===a?l10n.t("web_group_participant_changed_number_unknown_name",{name:a,new_number:n}):l10n.t("web_group_participant_changed_number",{name:a,old_number:t,new_number:n});break;case"create":r=s===Store.Conn.me?c?l10n.t("web_group_created_by_you",{subject:c}):l10n.t("web_group_created_by_you_no_subject"):c?l10n.t("web_group_created_by_name",{name:a,subject:c}):l10n.t("web_group_created_by_name_no_subject",{name:a});break;case"delete":r=s===Store.Conn.me?l10n.t("web_group_ended_you"):l10n.t("web_group_ended_name",{name:a});break;case"promote":l=d.length,r=1===l&&f===Store.Conn.me?l10n.t("web_group_participant_promoted_you"):l10n.t("web_group_participant_promoted_names",{count:l,participants:p,_plural:l});break;case"demote":l=d.length,r=1===l&&f===Store.Conn.me?l10n.t("web_group_participant_demoted_you"):l10n.t("web_group_participant_demoted_names",{count:l,participants:p,_plural:l});break;default:u.log("wa:formatGroupNotification:unknown message subtype: "+o)()}}return l10n.isRTL()&&(r=l10n.forceRTL(r)),r}function s(e){if(!l.supportsFeature(l.F.RICH_TEXT))return e;var t=f.parse(e,C);return f.serialize(t,new g)}var c=n(892),l=n(80),u=n(1),d=n(47),p=n(154),h=n(22),f=n(849),m=n(798).TYPE,g=n(1015),v=n(827),y=n(850),E=n(853),b=n(848),w=n(852),S=n(900),T=n(901),C=[new v,new y,new E,new b,new w];e.exports={formatBroadcastNotification:o,formatGroupNotification:a,formatE2ENotification:r,formatCallLog:i,asDesktopNotification:function(e){var t,n,l,h,f="",g=e.dir,v=Store.Mute.getGlobalPreviews();switch(e.from!==Store.Conn.me&&e.isGroupMsg&&(f=e.displayName()),e.type){case m.CHAT:if(v)t=s(e.body);else if(e.isGroupMsg)t=f?l10n.t("hidden_group_message_text_with_author",{author:f}):l10n.t("hidden_group_message_text"),f="";else{var y=e.chat;t=l10n.t("hidden_message_text",{unreadCount:l10n.n(y.unreadCount),_plural:y.unreadCount})}break;case m.IMAGE:l=d.hasEmoji?"📷 ":"",t=l+(v&&e.caption||l10n.t("web_conversations_most_recent_image"));break;case m.VIDEO:l=d.hasEmoji?"🎥 ":"",h=v&&e.caption||l10n.t("web_conversations_most_recent_video"),t=l+" "+h+" ("+p.durationStr(e.duration)+")";break;case m.PTT:l=d.hasEmoji?"🎤 ":"",t=l+" "+l10n.t("web_conversations_most_recent_voice")+" ("+p.durationStr(e.duration)+")";break;case m.AUDIO:l=d.hasEmoji?"🎵 ":"",t=l+" "+l10n.t("web_conversations_most_recent_audio")+" ("+p.durationStr(e.duration)+")";break;case m.LOCATION:l=d.hasEmoji?"📍 ":"",t=l+(v&&e.loc||l10n.t("web_conversations_most_recent_location"));break;case m.GROUP_NOTIFICATION:case m.GP2:t=a(e),f="";break;case m.BROADCAST_NOTIFICATION:n=e.subtype;var _=e.body;t=o(n,_);break;case m.NOTIFICATION:t=e.body;break;case m.VCARD:l=d.hasEmoji?"👤 ":"",t=l+(e.subType||l10n.t("web_conversations_most_recent_contact"));break;case m.DOCUMENT:l=d.hasEmoji?"📄 ":"",t=l+(e.subType||l10n.t("web_conversations_most_recent_file"));break;case m.E2E_NOTIFICATION:t=r(e);break;case m.CALL_LOG:t=i(e);break;case m.CIPHERTEXT:t="<* ciphertext *>";break;default:return u.error("asDesktopNotification: Unrecognized type "+e.type)(),""}var E=l10n.isRTL()?"rtl":"ltr",b="";if(b=p.relativeStr(e.t),f){var w=c.dir(f);return"ltr"!==E||g&&"ltr"!==g||w&&"ltr"!==w?"ltr"!==E||g&&"ltr"!==g?"ltr"!==E||w&&"ltr"!==w?"ltr"===E?(b&&(b="- ‪"+b+"‬‬"),"‫"+f+"‏: "+t+"‏"+b):g&&"rtl"!==g||w&&"rtl"!==w?g&&"rtl"!==g?w&&"rtl"!==w?(b&&(b="- ‪"+b+"‬‬"),"‪"+f+"‎: "+t+"‎"+b):(b&&(b=" - "+b),f+"‏: ‪"+t+"‬‏"):(b&&(b=" - "+b),"‏‪"+f+"‬: "+t+"‏"):(b&&(b=" - "+b),f+"‏: "+t+"‏"):(b&&(b=" - "+b),f+"‎: ‫"+t+"‬‎"):(b&&(b=" - "+b),"‎‫"+f+"‬: "+t+"‎"):(b&&(b=" - "+b),f+"‎: "+t+"‎")}return"ltr"===E?t+"‎‏"+(b?" - ‪"+b+"‬":""):t+"‏‎"+(b?" - ‫"+b+"‬":"")},msgText:function(e){switch(e.type){case m.CHAT:return s(e.body);case m.IMAGE:return e.caption?e.caption:l10n.t("web_conversations_most_recent_image");case m.VIDEO:return e.caption?e.caption:l10n.t("web_conversations_most_recent_video");case m.PTT:var t=p.durationStr(e.duration);return t?t:l10n.t("web_conversations_most_recent_voice");case m.AUDIO:return l10n.t("web_conversations_most_recent_audio");case m.LOCATION:return e.loc||l10n.t("web_conversations_most_recent_location");case m.GROUP_NOTIFICATION:case m.GP2:return a(e);case m.BROADCAST_NOTIFICATION:return o(e.subtype,e.body);case m.NOTIFICATION:return e.body;case m.VCARD:return l10n.t("web_conversations_most_recent_contact");case m.DOCUMENT:var n=e.pageCount>0?l10n.t("web_conversations_most_recent_document",{count:e.pageCount+"",_plural:e.pageCount}):null;return _.compact([e.caption||e.filename||l10n.t("web_conversations_most_recent_file"),n]).join(" • ");case m.E2E_NOTIFICATION:return r(e);case m.CALL_LOG:return i(e);default:return""}},emojify:function(e){if(!l.supportsFeature(l.F.RICH_TEXT))return e;var t=[new v,new S],n=f.parse(e,t);return f.serialize(n,new T)}}},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(156),a=n(829),s=n(805),c=n(913),l=n(58),u=n(799),d=n(102),p=n(46),h=n(800),f=n(825),m=n(105),g=m.HotKeys,v={SMALL:"small",DEFAULT:"default"},y=r.createClass({displayName:"Contact",mixins:[u,d],propTypes:{contact:r.PropTypes.instanceOf(o).isRequired,onClick:r.PropTypes.func,mouseDownAsClick:r.PropTypes.bool,onDelete:r.PropTypes.func,onContext:r.PropTypes.func,contextEnabled:r.PropTypes.func,admin:r.PropTypes.bool,active:r.PropTypes.object,className:r.PropTypes.string,secondary:r.PropTypes.node,type:r.PropTypes.oneOf(_.values(v)),showNotifyName:r.PropTypes.bool},getInitialState:function(){var e=this.props.contact,t=this.props.active,n={formattedName:this.async("contact.formattedName"),pendingAction:this.async("contact.pendingAction"),active:t?t.value===e:!1,contextMenu:!1};return this.props.showNotifyName&&(n.notifyName=this.async("contact.notifyName")),n},componentWillMount:function(){var e=this,t=this.props.active;t&&this.addObserver(t,this.props.contact.id,function(t){if("focus"===t){var n=i.findDOMNode(e);l.focusNode(n),f.scrollIntoViewIfNeeded(n)}e.setState({active:!!t})})},componentWillUnmount:function(){var e=i.findDOMNode(this);e.contains(document.activeElement)&&l.focusNodeOrParent(e.parentNode)},contextEnabled:function(){return!1},onDelete:function(e){e.stopPropagation(),this.props.onDelete(e,this.props.contact)},onClick:function(e){_.isFunction(this.props.onClick)&&this.props.onClick(e,this.props.contact)},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),this.onClick(e)},onContext:function(e){return this.state.contextMenu?(l.pop(l.MENU),void this.setState({contextMenu:!1})):(this.props.onContext(e,this.props.contact,this.onContextClose),void this.setState({contextMenu:!0}))},onContextClose:function(){this.setState({contextMenu:!1})},indicateFocus:function(e){if(!(Date.now()-(g.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=i.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this.props,t=e.contact,n=e.secondary,i=e.onContext,o=e.onDelete,l=e.contextEnabled,u=e.admin,d=e.showNotifyName,f=e.className;f=p("contact",f,{active:!!this.state.active});var m=void 0,y=void 0,_=void 0;if(!t.name&&d&&this.state.notifyName&&(_=r.createElement("span",{className:"ellipsify screen-name"},r.createElement(h,{classes:"screen-name-text",direction:"auto",text:this.state.notifyName.name}))),u&&(y=r.createElement("div",{className:"chat-meta"},r.createElement("div",{className:"chat-marker chat-marker-admin"},l10n.t("web_group_admin")))),o){var E=p("icon",{"icon-x-alt-small":this.props.type===v.SMALL,"icon-x-alt":this.props.type!==v.SMALL});m=r.createElement("div",{className:"chat-controls"},r.createElement("button",{className:E,onClick:this.onDelete}))}n||(n=r.createElement(c,{status:t.status})),i&&(i=this.onContext);var b=r.createElement("div",{className:"chat-avatar"},r.createElement(s,{id:t.id})),w={enter:this.onEnter},S=this.props.mouseDownAsClick;return r.createElement(g,{handlers:w,onFocus:this.indicateFocus,onBlur:this.onBlur},r.createElement(a,{id:t.id,ref:"cell",className:f,contextEnabled:l||this.contextEnabled,pendingAction:this.state.pendingAction,detail:m,image:b,primary:this.state.formattedName,primaryDetail:y,secondary:n,secondaryDetail:_,onClick:S?null:this.onClick,onMouseDown:S?this.onMouseDown:null,onContext:i}))}});y.Type=v,e.exports=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i,o=n(707),a=r(o),s=n(6),c=n(9),l=n(46),u=n(58),d=n(103),p=(i={},(0,a["default"])(i,u.DRAWER_LEFT,"drawer-container-left"),(0,a["default"])(i,u.DRAWER_RIGHT,"drawer-container-right"),(0,a["default"])(i,u.DRAWER_MID,"drawer-container-mid"),(0,a["default"])(i,u.MODAL,"modal"),i),h={PUSH:"-push",POP:"-pop",DEFAULT_DRAWER:"flow-transition-drawer",DEFAULT_MODAL:"flow-transition-modal"},f={propTypes:{type:s.PropTypes.oneOf(_.keys(p))},getDefaultProps:function(){return{type:p[u.MODAL]}},getInitialState:function(){return this._currKey=void 0,{_stack:[]}},endFlow:function(){this.props.type===p[u.MODAL]?c.closeModal():c.closeDrawer(this.props.type)},push:function(e,t){var n=_(this.state._stack).concat(e).value(),r=(t||this.props.transition||h.DEFAULT_MODAL)+h.PUSH;this.setState({_stack:n,_transition:r})},pop:function(e,t){if(this.state._stack.length<=1)return this.endFlow();var n=_.dropRight(this.state._stack);if(e){var r=_.last(n);e.key=_.uniqueId("flow_"),r=s.cloneElement(r,e),n.splice(n.length-1,1,r)}var i=(t||this.props.transition||h.DEFAULT_MODAL)+h.POP;this.setState({_stack:n,_transition:i})},render:function(){var e=_.last(this.state._stack);_.isFunction(e)&&(e=e()),this._currKey=e.key;var t=l(p[this.props.type],{"flow-drawer-container":this.props.type!==p[u.MODAL]});return s.createElement(d,{transitionName:this.state._transition,className:t},e)}};f.Type=p,f.Transition=h,e.exports=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(21),s={rejectOnUnmount:function(){var e=this;return this._reject?this._reject:(this._reject=new o["default"](function(t,n){e._rejectFn=n}),this._reject["catch"](_.noop),this._reject)},componentWillUnmount:function(){this._rejectFn&&this._rejectFn(new a.Unmount)}};e.exports=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(157),o=r(i),a=n(351),s=r(a),c=n(6),l=n(107),u=n(46),d=function(e){var t=e.className,n=u("empty-icon",t);return c.createElement("div",{className:"empty-icon-container"},c.createElement("span",{className:n}))},p=function(e){var t=e.icon,n=e.title,r=e.text,i=e.className,a=e.children,l=(0,s["default"])(e,["icon","title","text","className","children"]),d=n?c.createElement("div",{className:"empty-title"},n):null,p=r?c.createElement("div",{className:"empty-text"},r):null,h=u("empty",i);return c.createElement("div",(0,o["default"])({className:h},l),t,d,p,a)},h=function(){var e=c.createElement(d,{className:"icon-empty-blocked"});return c.createElement(p,{icon:e,title:l10n.t("blocked_empty"),text:l10n.t("add_blocked_description")})},f=function(){var e=c.createElement(d,{className:"icon-empty-archived"});return c.createElement(p,{icon:e,title:l10n.t("archived_empty")})},m=function(){return c.createElement(p,{className:"empty-top",text:l10n.t("search_no_chats_or_contacts")})},g=function(){return c.createElement(p,{className:"empty-top",text:l10n.t("searching_chats_contacts_messages")})},v=function(){return c.createElement(p,{className:"empty-top",text:l10n.t("search_no_contacts")})},y=function(){return c.createElement(p,{className:"empty-top",text:l10n.t("search_no_groups")})},_=function(){return c.createElement(p,{text:l10n.t("no_chats")})},E=function(){return c.createElement(p,{text:l10n.t("no_contacts")})},b=function(){return c.createElement(p,{text:l10n.t("no_groups")})},w=function(){return c.createElement(p,{text:l10n.t("all_chats_archived")})},S=function(){return c.createElement(p,{text:l10n.t("no_starred_messages")})},T=function(){return c.createElement(p,null,c.createElement(l,{size:50,stroke:4}))};e.exports={Blocked:h,Archived:f,Search:m,SearchContacts:v,SearchGroups:y,ListChats:_,ListContacts:E,ListGroups:b,AllArchived:w,StarredMsgs:S,Loading:T,Searching:g}},function(e,t,n){"use strict";var r=n(6),i=n(810),o=n(800),a=n(798),s=n(9),c=n(22),l=n(46),u=function(e){function t(){Store.Chat.find(n.author).then(function(e){s.openChat(e)})}var n=e.msg,a=n.chat.assignedColor(n.sender),u=n.senderObj,d=l("message-author color-"+a,{"title-number":!u.name}),p=void 0;return p=u.name?r.createElement("span",{className:"text-clickable",onClick:t},r.createElement(o,{text:u.name})):[r.createElement("span",{className:"number text-clickable",key:n.id+"-number",onClick:t},c.formattedUser(u.id)),r.createElement("span",{className:"ellipsify screen-name",key:n.id+"-push-name",onClick:t},r.createElement(o,{classes:"screen-name-text",direction:"auto",text:n.notifyName}))],r.createElement("h3",{className:d},r.createElement(i,null,p))};u.shouldRender=function(e){return!e.isSentByMe&&e.isGroupMsg},u.propTypes={msg:r.PropTypes.instanceOf(a).isRequired},e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(810),o=n(944),a=n(798),s=n(46),c=n(154),l=n(9),u=n(80),d=r.createClass({displayName:"Meta",propTypes:{msg:r.PropTypes.instanceOf(a).isRequired},openInfoDrawer:function(){l.msgInfoDrawer(this.props.msg)},render:function(){var e,t,n=this.props.msg,l=n.broadcast||n.star?(n.type===a.TYPE.IMAGE||n.type===a.TYPE.VIDEO||n.type===a.TYPE.AUDIO)&&!n.caption:null;if(n.broadcast){var d=s("icon-s",{"icon-broadcast-light":l,"icon-broadcast":!l});e=r.createElement("span",{className:d})}if(n.star){var p=s("icon-s",{"icon-star-light":l,"icon-star":!l&&n.isSentByMe,"icon-star-in":!l&&!n.isSentByMe});t=r.createElement("span",{className:p})}var h=n.isSentByMe?r.createElement(o,{msg:this.props.msg}):null,f=n.isSentByMe&&u.supportsFeature(u.F.MESSAGE_INFO);return r.createElement("div",{className:f?"message-meta text-clickable":"message-meta",onClick:f?this.openInfoDrawer:null},t,e,r.createElement(i,null,r.createElement("span",{className:"message-datetime"},c.timestampStr(n.t))),h)}});e.exports=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(157),o=r(i),a=n(351),s=r(a),c=n(6),l=n(352),u=n(46),d=c.createClass({displayName:"DrawerSection",propTypes:{children:c.PropTypes.node.isRequired,title:c.PropTypes.node,subtitle:c.PropTypes.node,footer:c.PropTypes.node,expands:c.PropTypes.bool.isRequired,classes:c.PropTypes.string,onMouseDown:c.PropTypes.func,noContainer:c.PropTypes.bool,a8n:c.PropTypes.string},getDefaultProps:function(){return{expands:!1,noContainer:!1}},render:function(){var e=this.props,t=e.children,n=e.title,r=e.subtitle,i=e.footer,a=e.expands,d=e.classes,p=e.onMouseDown,h=e.noContainer,f=(0,s["default"])(e,["children","title","subtitle","footer","expands","classes","onMouseDown","noContainer"]),m=u(d,{"drawer-section-expand":!!a,"drawer-section":!a,well:!!n});if(!n)return c.createElement("div",{className:m},t);var g=r?c.createElement("div",{className:"col-side"},r):null,v=t;if(!h&&v){var y=u("drawer-section-body",{"drawer-section-body-expand":!!a,chatlist:!!a});v=c.createElement("div",{className:y},t)}return c.createElement("div",(0,o["default"])({className:m,onMouseDown:p},f),c.createElement("div",{className:"drawer-section-title title-underlined"},c.createElement("div",{"data-a8n":l.key(this.props.a8n),className:"col-main"},n),g),v,i)}});e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(878),o=n(879),a=n(921),s=n(103),c=n(9),l=n(354),u=n(58),d=n(158),p=n(46),h=r.createClass({displayName:"AdvancedInput",mixins:[d],propTypes:{id:r.PropTypes.string,editable:r.PropTypes.bool,value:r.PropTypes.string,maxLength:r.PropTypes.number,showRemaining:r.PropTypes.bool,selection:r.PropTypes.object,onEnter:r.PropTypes.func,onChange:r.PropTypes.func,onCancel:r.PropTypes.func,onSelectionChange:r.PropTypes.func,multiline:r.PropTypes.bool,placeholder:r.PropTypes.string,floating:r.PropTypes.bool,parent:r.PropTypes.object,disableEmoji:r.PropTypes.bool},getDefaultProps:function(){return{placeholder:"",floating:!0,multiline:!0,showRemaining:!1,editable:!1,disableEmoji:!1}},getInitialState:function(){return{active:!1}},componentDidMount:function(){this.regWithUIManager()},componentDidUpdate:function(e){!e.editable&&this.props.editable?this.regWithUIManager():e.editable&&!this.props.editable&&this.unregWithUIManager()},regWithUIManager:function(){this.props.id&&this.props.editable&&this.uimPush(this.props.parent||this,this.props.id,{popable:!0,maintainFocus:!0})},unregWithUIManager:function(){this.props.id&&this.uimPop(this.props.id),u.popDependents(this)},componentWillUnmount:function(){this.unregWithUIManager()},onEmoji:function(e){this.refs.inputLine.replaceSelection(e)},onFocus:function(){this.props.id&&u.stealFocus(this.props.id),this.setState({active:!0})},onBlur:function(){this.setState({active:!1})},restoreFocus:function(){this.refs.inputLine.restoreFocus()},onEmojiPicker:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=r.createElement(o,{onEmoji:this.onEmoji});this.props.id&&this.regWithUIManager(),c.openContextMenu(t,{anchor:e.target,parent:this,menuDirection:{y:l.Direction.Y.TOP},type:l.Type.EMOJI_PICKER}),this.restoreFocus()},uimClose:function(){this.props.onCancel&&this.props.onCancel()},uimFocus:function(){this.restoreFocus()},focus:function(){this.restoreFocus()},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.restoreFocus()},render:function(){var e=p("input-emoji input-advanced",this.props.className,{active:this.state.active,"static":!this.props.editable}),t=this.props.editable&&!this.props.disableEmoji?r.createElement("button",{className:"icon icon-emoji-input",onClick:this.onEmojiPicker}):null,n=this.props.floating?this.props.placeholder:void 0,o=this.props.value||this.props.floating?void 0:this.props.placeholder;return r.createElement("div",{className:e,onMouseDown:this.preventBlur},r.createElement(a,{placeholder:n,hasText:!!this.props.value},r.createElement("div",{className:"input-main"},r.createElement(i,{ref:"inputLine",value:this.props.value,className:"input-line",placeholder:o,onChange:this.props.onChange,onEnter:this.props.onEnter,editable:this.props.editable,maxLength:this.props.maxLength,showRemaining:this.props.showRemaining,onFocus:this.onFocus,onBlur:this.onBlur}),r.createElement(s,{transitionName:"pop",className:"btn-input"},t))))}});e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(801),a=n(829),s=n(805),c=n(871),l=n(918),u=n(868),d=n(924),p=n(865),h=n(907),f=n(869),m=n(873),g=n(910),v=n(822),y=n(799),E=n(102),b=n(7),w=n(58),S=n(9),T=n(46),C=n(825),M=n(895),N=n(21),k=n(105),x=k.HotKeys,P={LAST:"last",INFO:"info"},D=r.createClass({displayName:"Chat",mixins:[y,E],propTypes:{chat:r.PropTypes.instanceOf(o).isRequired,mode:r.PropTypes.oneOf(_.values(P)).isRequired,noContext:r.PropTypes.bool,mouseDownAsClick:r.PropTypes.bool,onClick:r.PropTypes.func,active:r.PropTypes.object},statics:{Mode:P},getDefaultProps:function(){return{mode:P.LAST}},getInitialState:function(){this.hoverCounter=0;var e=this.props.chat,t=this.props.active;return{formattedTitle:this.async("chat.formattedTitle"),hasUnread:this.async("chat.hasUnread"),isReadOnly:this.async("chat.isReadOnly"),pendingAction:this.async("chat.pendingAction"),active:t?t.value===e:!1,contextMenu:!1}},componentWillMount:function(){var e=this,t=this.props.active;t&&this.addObserver(t,this.props.chat.id,function(t){if("focus"===t){var n=i.findDOMNode(e);w.focusNode(n),C.scrollIntoViewIfNeeded(n)}e.setState({active:t})})},componentWillUpdate:function(e,t){this.state.isReadOnly!==t.isReadOnly&&w.pop(w.MENU)},componentWillUnmount:function(){var e=i.findDOMNode(this);e.contains(document.activeElement)&&w.focusNodeOrParent(e.parentNode),this.state.contextMenu&&w.pop(w.MENU)},contextEnabled:function(){var e=this.props,t=e.chat,n=e.noContext;return!n&&(t.mute.canMute()||t.canArchive()||t.canDelete()||t.canExit())},onMenu:function(e){if(this.state.contextMenu)return w.pop(w.MENU),void this.setState({contextMenu:!1});var t=this.props.chat,n=[];t.canArchive()&&n.push(r.createElement(l,{key:"archive",onArchive:this.onArchive,chat:t})),t.mute.canMute()&&n.push(r.createElement(c,{key:"mute",onMute:this.onMute,chat:t})),t.canDelete()&&n.push(r.createElement(u,{key:"delete",onDeleteOrExit:this.onDeleteOrExit,chat:t})),t.canMarkUnseen()&&n.push(r.createElement(d,{key:"mark_unread",onMarkUnread:this.onMarkUnread,chat:t})),this.setState({contextMenu:!0}),S.openContextMenu(n,{onDefault:this.onClick,onClose:this.removeContext,event:e.event,anchor:e.anchor,parent:this})},removeContext:function(){this.setState({
contextMenu:!1})},onMute:function(e){S.muteChat(this.props.chat,e,this)},onArchive:function(e){S.archiveChat(this.props.chat,e)},onDeleteOrExit:function(){S.deleteOrExitChat(this.props.chat,this)},onMarkUnread:function(e){S.markChatUnread(this.props.chat,e)},onClick:function(e){_.isFunction(this.props.onClick)&&this.props.onClick(e,this.props.chat)},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),x.flashFocus=Date.now(),this.onClick(e)},onDragEnter:function(e){var t=e.dataTransfer;_.contains(t.types,b.DRAG_TYPE_FILE)&&(0===this.hoverCounter&&this.setState({dragging:!0}),this.hoverCounter+=1)},onDragLeave:function(e){var t=e.dataTransfer;_.contains(t.types,b.DRAG_TYPE_FILE)&&(this.hoverCounter-=1,0===this.hoverCounter&&this.setState({dragging:!1}))},onDrop:function(e){var t=this;this.setState({dragging:!1});var n=e.dataTransfer;(_.contains(n.types,b.DRAG_TYPE_FILE)||_.contains(n.types,"text/uri-list")||_.contains(n.types,"text/html"))&&M.getFiles(e,0).then(function(e){S.openChat(t.props.chat,void 0,!1),S.openDrawer(r.createElement(v,{files:e,chat:t.props.chat,type:w.DRAWER_MID}),"slide-up")})["catch"](N.MediaDragDropError,function(e){S.openChat(t.props.chat,void 0,!1),S.pasteChatTextInput(t.props.chat,e.src)})},indicateFocus:function(e){if(!(Date.now()-(x.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=i.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this,t=this.props,n=t.chat,i=t.mode,o=t.secondary,c=t.className;c=T(c,{unread:this.state.hasUnread,active:!!this.state.active,"chat-drag":this.state.dragging});var l=void 0,u=void 0,d=void 0;switch(i){case P.LAST:l=r.createElement(p,{chat:n}),o||(o=r.createElement(h,{chat:n}),u=r.createElement(g,{chat:n})),d={enter:this.onEnter},d[l10n.LR("right","left")]=function(){return e.refs.cell.openContextMenu()};break;case P.INFO:o||(o=n.isGroup?r.createElement(f,{presence:n.presence,groupMetadata:n.groupMetadata,location:"list"}):r.createElement(m,{presence:n.presence,location:"list"})),d={enter:this.onEnter}}var v=r.createElement("div",{className:"chat-avatar"},r.createElement(s,{id:n.id})),y=this.props.mouseDownAsClick;return r.createElement(x,{handlers:d,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover",onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop},r.createElement(a,{id:n.id,ref:"cell",className:c,contextEnabled:this.contextEnabled,pendingAction:this.state.pendingAction,contextMenu:this.state.contextMenu,image:v,primary:this.state.formattedTitle,primaryDetail:l,secondary:o,secondaryDetail:u,onClick:y?null:this.onClick,onMouseDown:y?this.onMouseDown:null,onContext:this.onMenu}))}});e.exports=D},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(157),o=r(i),a=n(351),s=r(a),c=n(6),l=n(28),u=n(104),d=n(46),p={COVER:"cover",SCALE_DOWN:"scaleDown"},h=c.createClass({displayName:"ObjectFit",mixins:[u],propTypes:{children:c.PropTypes.node.isRequired,type:c.PropTypes.oneOf(_.values(p)).isRequired,size:c.PropTypes.shape({width:c.PropTypes.number.isRequired,height:c.PropTypes.number.isRequired})},statics:{TYPES:p},getInitialState:function(){return{style:this.props.size,className:"object-fit",computed:!1}},componentDidMount:function(){if(!this.shouldUseNativeObjectFit()){this.initialize();var e=this;this.regNativeListener(window,"resize",function(){e.initialize()})}},componentWillReceiveProps:function(e){this.initialize(e)},initialize:function(e){this.shouldUseNativeObjectFit()||(e=e||this.props,e.size&&this.setState(this[e.type](e.size.width,e.size.height)))},shouldUseNativeObjectFit:function(){return!1},cover:function(e,t){var n=l.findDOMNode(this),r=n.clientWidth,i=n.clientHeight,o=e,a=t,s=0,c=0;return o!==r&&(a*=r/o,o=r,a>i&&(s=i/2-a/2)),i>a&&(o*=i/a,a=i,o>r&&(c=r/2-o/2)),{style:{width:o,height:a,top:s,left:c,position:"absolute"},className:"object-fit object-fit-cover",computed:!0}},scaleDown:function(e,t){var n=l.findDOMNode(this),r=n.clientWidth,i=n.clientHeight,o=t,a=e;return o>i&&(o=i,a=e*(i/t)),a>r&&(a=r,o=t*(r/e)),{style:{width:a,height:o},className:"object-fit object-fit-scaledown",computed:!0}},render:function(){var e=this.props,t=e.children,n=(e.size,e.type,e.className),r=(0,s["default"])(e,["children","size","type","className"]);if(this.shouldUseNativeObjectFit())return c.createElement("div",{className:"native-scale-down"},t);var i=d(this.state.className,n),a=this.state.computed?this.state.style:{visibility:"hidden"};return c.createElement("div",(0,o["default"])({},r,{className:i}),c.createElement("div",{style:a},t))}});e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(813),o=n(881),a=n(801),s=n(9),c=n(47),l=n(58),u=r.createClass({displayName:"AttachMediaFlow",mixins:[i],propTypes:{files:r.PropTypes.array,state:r.PropTypes.string,chat:r.PropTypes.instanceOf(a).isRequired},componentWillMount:function(){l.pop(l.MENU),this.push(r.createElement(o,{files:this.props.files,state:this.props.state,onBack:this.endFlow,onSendMedia:_.once(this.sendMedia),onDropText:_.once(this.setText)}))},componentWillUnmount:function(){var e=this;c.isGecko?_.defer(function(){return s.focusChatTextInput(e.props.chat)}):s.focusChatTextInput(this.props.chat)},sendMedia:function(e){var t=this.props.chat;_.delay(function(){t.sendMedia2(e)},300),this.endFlow()},setText:function(e){var t=this.props.chat;_.delay(function(){s.pasteChatTextInput(t,e)},300),this.endFlow()}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(347),o=n(798),a=n(9),s=r.createClass({displayName:"RemoteUpload",propTypes:{msg:r.PropTypes.instanceOf(o).isRequired},render:function(){var e,t;switch(this.props.msg.type){case o.TYPE.IMAGE:e=l10n.t("retry_upload_photo_title"),t=l10n.t("retry_upload_photo_text");break;case o.TYPE.VIDEO:e=l10n.t("retry_upload_video_title"),t=l10n.t("retry_upload_video_text");break;case o.TYPE.AUDIO:case o.TYPE.PTT:e=l10n.t("retry_upload_audio_title"),t=l10n.t("retry_upload_audio_text")}return r.createElement(i,{title:e,onOK:a.closeModal.bind(a),okText:l10n.t("web_ok")},t)}});e.exports=s},function(e,t,n){"use strict";var r=n(348),i=n(798),o=n(60),a=o.extend({props:{noEarlierMsgs:"boolean",isLoadingEarlierMsgs:"boolean",isLoadingRecentMsgs:"boolean",isLoadingAroundMsgs:"boolean",contextLoaded:"boolean"}}),s=r.extend({model:i,initialize:function(){r.prototype.initialize.call(this),this.msgLoadState=new a({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1})},add:function(){var e=this,t=r.prototype.add.apply(this,arguments),n=Store.Msg.add(t,arguments[1]);return _.isArray(n)?n.forEach(function(t){e.isModel(t)&&(t.msgChunk=e)}):this.isModel(n)&&(n.msgChunk=this),this.trigger("bulk_add",t),t},replace:function(e){var t=this;this.set(e.models,{silent:!0,merge:!1}),e.models.forEach(function(e){t.isModel(e)&&(e.msgChunk=t)}),this.trigger("bulk_add",e.models)}});e.exports=s},function(e,t){"use strict";var n={scrollIntoViewIfNeeded:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=arguments[2];if(_.isFunction(e.scrollIntoViewIfNeeded))return e.scrollIntoViewIfNeeded(t);n=n||e.parentNode;var r=window.getComputedStyle(n,null),i=parseInt(r.getPropertyValue("border-top-width")),o=e.offsetTop-n.offsetTop<n.scrollTop,a=e.offsetTop-n.offsetTop+e.clientHeight-i>n.scrollTop+n.clientHeight,s=o&&!a;return(o||a)&&t&&(n.scrollTop=e.offsetTop-n.offsetTop-n.clientHeight/2-i+e.clientHeight/2),!o&&!a||t||e.scrollIntoView(s),!(o||a)},scrollIntoView:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=arguments[2];n=n||e.parentNode;var r=window.getComputedStyle(n,null),i=parseInt(r.getPropertyValue("border-top-width")),o=e.offsetTop-n.offsetTop<n.scrollTop,a=e.offsetTop-n.offsetTop+e.clientHeight-i>n.scrollTop+n.clientHeight,s=o&&!a;return t?n.scrollTop=e.offsetTop-n.offsetTop-n.clientHeight/2-i+e.clientHeight/2:e.scrollIntoView(s),!(o||a)}};e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){function r(e){return i?i(e):a}M.log("forwardMediaMsg "+e.id)();var i=void 0,a=h(e).then(function(n){return n?!0:e.decryptedMediaBlob?!1:t.forceDownloadMedia().addCancelControl().then(function(){return e.set({url:t.url,clientUrl:t.clientUrl,decryptedMediaBlob:t.decryptedMediaBlob,mediaState:t.mediaState,filehash:t.filehash}),h(e)})}).then(function(t){return t?{avParams:e.avParams(),mediaKey:e.mediaKey}:e.decryptedMediaBlob?o(e.decryptedMediaBlob).addCancelControl().then(function(t){return(i=t.reupload)(e.to)}):m["default"].reject(new b.MediaMissing("forward media not on phone"))}).endWithControls("cancel");return e.handleUpload(n,a,r)}function o(e){var t=void 0;return new m["default"](function(n,r){if(t=w.typeFromMimetype(e.type))if(e.size>g.MAX_MEDIA_UPLOAD_SIZE||"image"===t&&e.size>L)r(new b.MediaFileTooLarge(e));else if("document"!==t||T.supportsFeature(T.F.ENC_DOC))if("image"===t)C.rotateAndResize(e,g.IMG_MAX_EDGE,g.IMG_MAX_EDGE).then(function(e){return C.canvasToBlob(e,"image/jpeg").then(function(t){n({blob:t,h:e.height,w:e.width,getThumb:C.rotateAndResize(t,g.IMG_THUMB_MAX_EDGE,g.IMG_THUMB_MAX_EDGE).then(function(e){return{url:e.toDataURL("image/jpeg")}})})})})["catch"](r);else if("video"===t)!function(){var t=N.isSupported(e).then(function(t){return t?t:(M.error("prepFileForUpload bad file "+e.type)(e),m["default"].reject(new b.InvalidMediaFileType))}),i=C.generateVideoThumb(e,g.IMG_THUMB_MAX_EDGE,g.IMG_THUMB_MAX_EDGE),o=m["default"].all([t,i]).spread(function(t,n){return{blob:e,w:n.fullWidth,h:n.fullHeight,getThumb:i}})["catch"](r);n(o)}();else if("document"===t)if(e.type)"*"===O.DOC_MIMES||O.DOC_MIMES.indexOf(e.type)>-1?n({blob:e,getThumb:null}):r(new b.InvalidMediaFileType("disallowed mimetype: "+e.type));else{var i=w.blobToArrayBuffer(e).then(function(t){var n=S(new Uint8Array(t,0,Math.min(262,e.size)));if(n&&n.mime){var r="*"===O.DOC_MIMES?n.mime:O.isAllowedDocumentMimetype(n.mime,e.name);if(r)return{blob:e,getThumb:null,mimetype:r}}return m["default"].reject(new b.InvalidMediaFileType("type: "+e.type+" name: "+e.name))});n(i)}else n({blob:e,getThumb:null});else r(new b.InvalidMediaFileType);else r(new b.InvalidMediaFileType("type: "+e.type))}).then(function(n){var r=n.blob,i=n.h,o=n.w,s=n.getThumb,u=n.mimetype,p=w.getHash(r),h=void 0,f=void 0,g=void 0,y=function(n){return d(n,t,e.type||u).then(function(i){if(!i)return p.then(function(e){var n=e.hash,r=e.size;return A.requestMediaUpload(t,n,r)}).addCancelControl().then(function(t){var i=t.result,o=t.data;return"duplicate"===i?{avParams:o}:"ok"===i?c(o,r,n,e.name).then(function(e){return{avParams:e}}):void 0});var o=function(){h||(h=v.newB64MediaKey(),f=w.blobToArrayBuffer(r).then(function(e){return E.encryptE2EMedia(t,e,h)}),g=f.then(function(e){return w.getHash(e)}).then(function(e){var t=e.hash;return t}));var i=a(n,t,h);return{v:g.then(function(e){return A.requestEncryptedMediaUpload(t,e)}).addCancelControl().then(function(t){var n=t.data;return m["default"].all([i,f,g]).spread(function(t,r,i){return l(n,r,e.name,i,t)}).addRawControl("cancel",function(e,t,n){t(new m["default"].CancellationError),n.control.cancel()})}).then(function(e){return{avParams:e,mediaKey:h}})}}();return"object"==typeof o?o.v:void 0}).endWithControls("cancel")};return{blob:r,height:i,width:o,getThumb:s,getDuration:w.getFileDuration(e),msgType:t,getFilehash:p.then(function(e){var t=e.hash;return t}),reupload:y,mimetype:r.type||u,filename:e.name}})}function a(e,t,n){var r=void 0,i=Store.Conn.me;return r=e===i?[i]:I.isUser(e)?[e,i]:Store.GroupMetadata.find(e).then(function(e){return e.participants.map(function(e){return e.id})}),m["default"].resolve(r).then(function(e){var r=y.computeKeys(t,n).refKey;return v.computeRefs(r,e)})}function s(e,t){var n=e+"?f=j";return m["default"].loop(function(e,r,i){if(i>4)throw new b.GaveUpRetry("gave up mms upload after "+i+" tries");var o=3e5*(i+1);return x.getResponseIfOnline(n,"POST",t).addRawControl("cancel",function(e,t,n){t(new m["default"].CancellationError),n.control.cancel()}).timeout(o,"postMediaToMMSTimeout").then(function(t){if(!t||200!==t.status){M.log("MediaUpload error: "+(t?t.status:"offline"))();var n=Math.floor(1e3*P.expBackoff(i+1,60,void 0,.1));return m["default"].all([m["default"].delay(n),k.waitForOnline])}M.log("MediaUpload success: 200")(),e(JSON.parse(t.response))})["catch"](m["default"].TimeoutError,_.noop)})}function c(e,t,n,r){var i=new FormData;return i.append("from",I.user(Store.Conn.me)),i.append("to",I.user(n)),i.append("file",t,r),s(e,i)}function l(e,t,n,r,i){var o=new FormData;return o.append("file",t,n),o.append("hash",r),o.append("refs",i.join("\r\n")),s(e,o)}function u(e,t,n){var r=new FormData;return r.append("hash",t),r.append("refs",n.join("\r\n")),s(e,r)}function d(e,t,n){var r=Store.Contact.get(e);if(r.plaintextDisabled)return m["default"].resolve(!0);var i=!1;switch(t){case"audio":case"ptt":i=T.supportsFeature(T.F.ENC_AUDIO)&&_.has(U,n);break;case"video":i=T.supportsFeature(T.F.ENC_VIDEO)&&_.has(F,n);break;case"document":return T.supportsFeature(T.F.ENC_DOC)?r.canSendEncryptedMedia(t):m["default"].reject(new b.CapabilityUnsupported("User cannot send documents"));case"image":i=T.supportsFeature(T.F.ENC_IMAGE)}return i?r.canSendEncryptedMedia(t)["catch"](b.CapabilityUnsupported,function(){return!1}):m["default"].resolve(!1)}function p(e){return e.uploadhash?m["default"].resolve(e.uploadhash):e.filehash&&!D.isEncryptedMedia(e.clientUrl)?m["default"].resolve({filehash:e.filehash}):R.headRetry(e.clientUrl).then(function(t){if(200!==t.status)throw new b.MediaNeedsReupload;var n=t.getResponseHeader("X-WA-Metadata");return M.assert(n,"wa-metadata-header-missing","HEAD "+e.clientUrl+" got "+t.status)(),_.zipObject(n.split("; ").map(function(e){return e.split("=",2)}))})}function h(e){return m["default"].all([d(e.to,e.type,e.mimetype),p(e)]).addCancelControl().spread(function(t,n){var r=n.filehash,i=D.isEncryptedMedia(e.clientUrl);return t&&i?(e.uploadhash=r,A.requestEncryptedMediaUpload(e.type,r).then(function(t){var n=t.data;return a(e.to,e.type,e.mediaKey).then(function(e){return u(n,r,e)}).then(function(e){return!!e.url})})):t||i?!1:(e.set({uploadhash:r,filehash:r}),A.requestMediaUpload(e.type,r,e.size).then(function(e){return"duplicate"===e.result}))})["catch"](b.MediaNeedsReupload,function(){return!1})}var f=n(3),m=r(f),g=n(7),v=n(896),y=n(893),E=n(894),b=n(21),w=n(835),S=n(712),T=n(80),C=n(836),M=n(1),N=n(961),k=n(110),x=n(29),P=n(83),D=n(61),A=n(35),I=n(22),R=n(903),O=n(356),L=26214400,U=_.pick(O.MIMETYPES,function(e,t){return"audio"===e.msgType}),F=_.pick(O.MIMETYPES,function(e,t){return"video"===e.msgType});e.exports={computeRefs:a,prepFileForUpload:o,shouldSendEncrypted:d,forwardMediaMsg:i}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(59),o=r(i),a=n(106),s=r(a),c=n(155),l=r(c),u=n(350),d=r(u),p=n(349),h=r(p),f=n(838),m=n(46),g=function(e){function t(e){return(0,s["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).call(this,"```",/```([\s\S]+?)```/,1,e?{className:m(e)}:null))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"formatResult",get:function(){return!1}}]),t}(f);e.exports=g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(106),o=r(i),a=n(155),s=r(a),c=n(711),l=function(){function e(){(0,o["default"])(this,e)}return(0,s["default"])(e,[{key:"match",value:function(e){c(!1,"Subclasses of `Mutator` must implement `match(text)`")}},{key:"mutate",value:function(e,t){return e}},{key:"pick",value:function(e){return 0}},{key:"args",value:function(e,t,n){return[]}},{key:"isFragment",get:function(){return!1}},{key:"isFormatter",get:function(){return!1}},{key:"alwaysApply",get:function(){return!1}},{key:"formatResult",get:function(){return!0}}]),e}();e.exports=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(157),o=r(i),a=n(351),s=r(a),c=n(6),l=n(800),u=n(107),d=n(58),p=n(799),h=n(708),f=n(103),m=n(46),g=c.createClass({displayName:"Cell",mixins:[p,h],propTypes:{id:c.PropTypes.string.isRequired,contextEnabled:c.PropTypes.func.isRequired,pendingAction:c.PropTypes.number,contextMenu:c.PropTypes.bool,image:c.PropTypes.node,detail:c.PropTypes.node,primary:c.PropTypes.string.isRequired,primaryDetail:c.PropTypes.node,secondary:c.PropTypes.node,secondaryDetail:c.PropTypes.node,onClick:c.PropTypes.func,onContext:c.PropTypes.func},getInitialState:function(){return{hover:!1,contextMenu:!1}},componentWillUpdate:function(e){this.props.contextMenu&&this.state.contextMenu&&!e.contextMenu&&this.setState({contextMenu:!1})},onMenuClick:function(e){this.props.contextEnabled()&&(e.stopPropagation(),e.preventDefault(),this.props.onContext({anchor:e.target}))},onMenuMouseDown:function(e){e.stopPropagation()},onContextMenu:function(e){this.props.contextEnabled()&&(e.stopPropagation(),e.preventDefault(),this.props.onContext({event:e}))},openContextMenu:function(){var e=this;this.props.contextEnabled()&&this.setState({contextMenu:!0},function(){e.refs.context.click()})},mouseOver:function(){this.state.hover||this.props.contextMenu||!this.props.contextEnabled()||this.setState({hover:!0})},mouseEnter:function(){this.state.hover||this.props.contextMenu||!this.props.contextEnabled()||this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.setState({hover:!1})},render:function(){var e=this.props,t=(e.id,e.contextEnabled),n=e.className,r=e.pendingAction,i=e.image,a=e.detail,p=e.primary,h=e.primaryDetail,g=e.secondary,v=e.secondaryDetail,y=e.onClick,_=e.onContext,E=(0,s["default"])(e,["id","contextEnabled","className","pendingAction","image","detail","primary","primaryDetail","secondary","secondaryDetail","onClick","onContext"]),b=this.props.contextMenu||this.state.contextMenu,w=b||this.state.hover,S=m(n,{chat:!0,hover:w}),T=null,C=null;return r?C=c.createElement("div",{className:"btn-context icon-spinner"},c.createElement(u,{size:18,stroke:6})):w&&(T=c.createElement("span",{className:"icon icon-down btn-context",key:"icon-context",ref:"context","data-ignore-capture":_?d.IGNORE_CONTEXT:d.IGNORE_ANY,onMouseDown:this.onMenuMouseDown,onClick:this.onMenuClick})),a&&(a=c.createElement("div",{className:"chat-body chat-detail"},a)),c.createElement("div",(0,o["default"])({className:S,"data-ignore-capture":d.IGNORE_ANY,onClick:y,onContextMenu:t()?this.onContextMenu:null,onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},E),i,c.createElement("div",{className:"chat-body"},c.createElement("div",{className:"chat-main"},c.createElement("div",{className:"chat-title"},c.createElement(l,{text:p,direction:"auto",titlify:!0,ellipsify:!0})),h),c.createElement("div",{className:"chat-secondary"},g,c.createElement("div",{className:"chat-meta"},v,c.createElement(f,{transitionName:"pop"},C),c.createElement(f,{transitionName:"pop-fast-chat"},w?T:null)))),a)}});e.exports=g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(28),c=n(153),l=n(58),u=n(158),d=n(107),p=n(103),h=a.createClass({displayName:"ChatlistSearch",mixins:[c,u],propTypes:{searchText:a.PropTypes.string.isRequired,searchType:a.PropTypes.oneOf([l.CHAT_SEARCH,l.CONTACT_SEARCH]).isRequired,onSearch:a.PropTypes.func.isRequired,placeholder:a.PropTypes.string,searching:a.PropTypes.bool},getInitialState:function(){return{isSearching:!1}},componentWillUnmount:function(){this.onCancel()},componentWillReceiveProps:function(e){this.state.isSearching&&(e.searchText||s.findDOMNode(this).contains(document.activeElement)||this.setState({isSearching:!1}))},onBlur:o["default"].wrap(function(){this.props.searchText||this.onCancel()}),onChange:function(e){this.props.onSearch(e.target.value)},onCancel:function(e){this.uimPop(this.props.searchType)},onReset:function(e){e.stopPropagation(),this.focus(),this.props.onSearch("")},onSearchOn:function(e){this.setState({isSearching:!0}),this.uimPush(this,this.props.searchType,{escapable:!0}),this.safeDefer(this.focus)},focus:function(){l.focusNode(this.refs.input)},uimFocus:function(){this.focus()},uimClose:function(){this.safeIsMounted()&&(l.blurNode(this.refs.input),this.props.onSearch(""),this.setState({isSearching:!1}))},isAtBeginning:function(){var e=this.refs.input;return 0===e.selectionStart&&0===e.selectionEnd},isAtEnd:function(){var e=this.refs.input,t=e.value.length;return e.selectionStart===t&&e.selectionEnd===t},render:function(){var e="pane-subheader pane-list-subheader subheader-search";this.state.isSearching&&(e+=" active");var t=null;this.state.isSearching&&(this.props.searching?t=a.createElement("button",{className:"btn-context icon-spinner icon-x-alt",key:"icon-clear-search",onClick:this.onReset},a.createElement(d,{size:20,stroke:5})):_.size(this.props.searchText)&&(t=a.createElement("button",{className:"icon icon-x-alt",key:"icon-clear-search",onClick:this.onReset})));var n=this.props.placeholder||l10n.t("search_or_start_new_chat"),r=this.state.isSearching?this.onCancel:this.onSearchOn;return a.createElement("div",{className:e},a.createElement("button",{className:"icon icon-search-morph",onMouseDown:r},a.createElement("div",{className:"icon icon-back-blue"}),a.createElement("div",{className:"icon icon-search"})),a.createElement(p,{transitionName:"pop"},t),a.createElement("div",{className:"input-placeholder"},n),a.createElement("label",{htmlFor:"input-chatlist-search",className:"cont-input-search"},a.createElement("input",{type:"text",ref:"input",className:"input input-search","data-tab":2,dir:"auto",title:n,value:this.props.searchText,onBlur:this.onBlur,onFocus:this.state.isSearching?null:this.onSearchOn,onChange:this.onChange})))}});e.exports=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(157),o=r(i),a=n(351),s=r(a),c=n(3),l=r(c),u=n(6),d=n(48),p=n(11),h=n(102),f=n(814),m=n(29),g=n(109),v=n(21),y=n(61),E=n(83),b=n(7),w=10,S=u.createClass({displayName:"ImageTag",mixins:[h,f],propTypes:{hasPrivacyChecks:u.PropTypes.bool},getInitialState:function(){var e=new Image;return e.src=this.props.src,e.complete?{src:this.props.src}:(this.ensureLoaded(this.props.src),{src:null})},componentWillReceiveProps:function(e){this.props.src!==e.src&&this.ensureLoaded(e.src)},componentWillUnmount:function(){this.ensureLoadedPromise&&this.ensureLoadedPromise.cancel()},ensureLoaded:function(e){var t=this;this.ensureLoadedPromise&&this.ensureLoadedPromise.cancel(),this.ensureLoadedPromise=m.loopOnError(v.ShouldLoop,l["default"].TimeoutError,function(n){if(n>=w)throw new v.ImageError("Too many image retries",e);var r;return r=t.props.hasPrivacyChecks&&!d.phoneActive&&n>0?m.waitForBBEvent(d,"change:phoneActive",_.matches({phoneActive:!0})):p.state===p.STATE.CONNECTED?l["default"].delay(Math.floor(1e3*E.expBackoff(n,60,void 0,.1))):m.waitForBBEvent(p,"change:state",_.matches({state:p.STATE.CONNECTED})),n>0&&y.isHttp(e)&&(r=r.then(function(){return new l["default"](function(n,r){g.get(e).then(function(i){var o=i.status;o>=200&&400>o?n():o>=500?r(new v.ShouldLoop):(t.props.onError(o),r(new v.ImageError("Image error: "+o,e)))})["catch"](function(e){r(new v.ShouldLoop)})})}).timeout(3e4,"imageTagRetryTimeout")),r.then(function(){return new l["default"](function(t,n){var r=function(t){n(y.isHttp(e)?new v.ShouldLoop:new v.ImageError("Invalid Data URI",e))},i=new Image;i.onload=function(){t(e)},i.onerror=r,i.src=e})}).checkpoint(t.rejectOnUnmount()).then(function(e){t.setState({src:e})})["catch"](v.Unmount,_.noop)})["finally"](function(){delete t.ensureLoadedPromise})["catch"](l["default"].CancellationError,_.noop)["catch"](v.ImageError,this.props.onError||_.noop)},render:function(){var e,t,n=this.props,r=(n.src,n.onLoad,(0,s["default"])(n,["src","onLoad"]));return this.state.src?(t=this.state.src,e=this.props.onLoad):(t=b.ONE_BY_ONE_TRANS_GIF,e=null),u.createElement("img",(0,o["default"])({src:t,onLoad:e},r))}});e.exports=S},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(157),o=r(i),a=n(6),s=n(28),c=n(1),l=n(811),u=n(799),d=n(102),p=n(814),h=n(798),f=n(9),m=n(81),g=n(347),v=n(800),y=n(844),E=n(806),b=n(58),w=n(823),S=n(839),T=n(935),C=n(946),M=n(827),N=n(940),k=n(939),x=n(932),P=n(948),D=n(937),A=n(941),I=n(934),R=n(938),O=n(46),L=n(80),U=n(7),F=n(21),B=n(103),G={FRONT:"front",MID:"mid",END:"end",SINGLE:"single"},j=a.createClass({displayName:"Wrapper",mixins:[d,u,m,p],propTypes:{msg:a.PropTypes.instanceOf(h).isRequired,position:a.PropTypes.oneOf(_.values(G)),displayType:a.PropTypes.oneOf(_.values(U.DISP_TYPE)),hideMsgInfo:a.PropTypes.bool,selectable:a.PropTypes.bool,onMessageSelect:a.PropTypes.func,tailOverride:a.PropTypes.oneOf(["left","right"]),isFocusedMsg:a.PropTypes.bool,highlight:a.PropTypes.bool,didRenderFocusedMsg:a.PropTypes.func},getDefaultProps:function(){return{displayType:U.DISP_TYPE.CONVERSATION}},getInitialState:function(){return{contextMenu:!1,failed:this.props.msg.isFailed,hover:!1,selected:!1}},componentWillReceiveProps:function(e){e.selectable||this.setState({selected:!1}),this.props.isFocusedMsg&&!e.isFocusedMsg&&this.unregCmd("focus_show_msg",this.onFocusShow),!this.props.isFocusedMsg&&e.isFocusedMsg&&this.regCmd("focus_show_msg",this.onFocusShow)},shouldComponentUpdate:function(e,t){return t.hover!==this.state.hover||t.contextMenu!==this.state.contextMenu||t.failed!==this.state.failed||e.position!==this.props.position||t.selected!==this.state.selected||e.selectable!==this.props.selectable||e.isFocusedMsg!==this.props.isFocusedMsg||e.highlight!==this.props.highlight},componentWillMount:function(){var e=this,t=this.props.msg;L.supportsFeature(L.F.RESEND_ICON)&&t.mayFail&&(this.addObserver(t,"change:ack",this.onAckChange),this.addObserver(t,"change:urlState",function(){return e.forceUpdate()})),this.props.isFocusedMsg&&this.regCmd("focus_show_msg",this.onFocusShow),"ciphertext"===t.type&&this.addObserver(t,"change:type",function(){return e.forceUpdate()})},componentWillUnmount:function(){this.state.contextMenu&&b.pop(b.MENU)},onFocusShow:function(e){this.props.msg.id===e&&this.scrollIntoView(!0)},scrollIntoView:function(e){if(this.props.isFocusedMsg){var t=this.props.didRenderFocusedMsg;t&&this.isMounted()&&t(s.findDOMNode(this),e)}},componentDidUpdate:function(e,t){this.props.isFocusedMsg&&!e.isFocusedMsg&&this.scrollIntoView()},componentDidMount:function(){this.scrollIntoView()},onFailedChange:function(){var e=this.props.msg;e.mayFail||(this.removeObserver(e,"change:ack"),this.removeObserver(e,"change:urlState")),this.setState({failed:e.isFailed})},resend:function(){var e=this,t=this.props.msg;return t.isMMS&&!L.supportsFeature(L.F.MEDIA_RETRY)?void f.openModal(a.createElement(w,{msg:t})):(this.props.msg.resumeRemoteUpload(),void t.resend().checkpoint(this.rejectOnUnmount()).then(function(n){e.setState({failed:t.isFailed})})["catch"](F.Unmount,_.noop)["catch"](function(e){c.log("wrapper:resend failure: "+e)()}))},openForwardFlow:function(){var e=this.props.msg;if(e.ack<1&&e.isMMS&&e.isSentByMe)f.openModal(a.createElement(g,{title:l10n.t("err_unsent_forward_title"),onOK:f.closeModal.bind(f),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text")));else{if(this.props.displayType===U.DISP_TYPE.CONVERSATION)return void this.onSelectClick();f.openModal(a.createElement(y,{msgs:[this.props.msg]}),"modal-flow")}},openInfoDrawer:function(){f.msgInfoDrawer(this.props.msg)},openContactChat:function(){Store.Chat.find(this.props.msg.author).then(function(e){f.openChat(e)})},mouseEnter:function(){this.contextEnabled()&&!this.state.hover&&this.setState({hover:!0})},mouseOver:function(){this.contextEnabled()&&!this.state.hover&&this.setState({hover:!0})},mouseLeave:function(){this.contextEnabled()&&this.state.hover&&this.setState({hover:!1})},contextMenu:function(e){var t=this.props.msg;t.isNotification||e.stopPropagation()},contextEnabled:function(){return!this.props.msg.isNotification},removeContext:function(){this.setState({contextMenu:!1})},onDeleteMessage:function(){var e=this,t=function(){b.pop(b.MENU),f.closeModal(),e.props.msg.chat.sendDeleteMsgs([e.props.msg])},n=l10n.t("delete_message_confirmation");f.openModal(a.createElement(g,{onOK:t,okText:l10n.t("web_delete"),onCancel:f.closeModal.bind(f),cancelText:l10n.t("web_cancel")},a.createElement(v,{text:n})))},onStarMessage:function(){this.props.msg.chat.sendStarMsgs([this.props.msg],!0)},onUnstarMessage:function(){this.props.msg.chat.sendStarMsgs([this.props.msg],!1)},onMenu:function(e){if(e.stopPropagation(),e.preventDefault(),e.isTrusted&&this.state.contextMenu)return b.pop(b.MENU),void this.setState({contextMenu:!1});var t=this.props.msg,n=[];t.isSentByMe&&L.supportsFeature(L.F.MESSAGE_INFO)&&this.props.displayType!==U.DISP_TYPE.MSG_INFO&&n.push(a.createElement(E,{key:"info",action:this.openInfoDrawer},l10n.t("message_info"))),(t.type!==h.TYPE.DOCUMENT||L.supportsFeature(L.F.ENC_DOC))&&n.push(a.createElement(E,{key:"forward",action:this.openForwardFlow},l10n.t("forward_message"))),L.supportsFeature(L.F.STARRED)&&(t.star?n.push(a.createElement(E,{key:"star",action:this.onUnstarMessage},l10n.t("unstar_message"))):n.push(a.createElement(E,{key:"star",action:this.onStarMessage},l10n.t("star_message")))),L.supportsFeature(L.F.MESSAGE_DELETE)&&n.push(a.createElement(E,{key:"delete",action:this.onDeleteMessage},l10n.t("delete_message"))),t.isGroupMsg&&t.author&&!t.isSentByMe&&n.push(a.createElement(E,{key:"author",action:this.openContactChat},l10n.t("message_author",{author:t.displayName()}))),this.setState({contextMenu:!0}),f.openContextMenu(n,{onClose:this.removeContext,anchor:e.target,parent:this,classes:"dropdown-compact",onDefault:null})},openContextMenu:function(){var e=this;this.setState({contextMenu:!0},function(){e.refs.context.click()})},getMsgComponent:function(){var e=this.props,t=e.msg,n=e.position,r=t.type,i=t.subtype,o=this.props.displayType!==U.DISP_TYPE.STARRED_MSGS&&!(n===G.MID||n===G.END);switch(r){case h.TYPE.CHAT:return a.createElement(C,{msg:t,trusted:t.isTrusted(),ref:"component",senderName:t.senderObj?t.senderObj.name:null,displayAuthor:o});case h.TYPE.IMAGE:return a.createElement(N,{msg:t,ref:"component",displayType:this.props.displayType,displayAuthor:o});case h.TYPE.GROUP_NOTIFICATION:case h.TYPE.GP2:case h.TYPE.BROADCAST_NOTIFICATION:case h.TYPE.NOTIFICATION:case h.TYPE.E2E_NOTIFICATION:case h.TYPE.CALL_LOG:var s,u,d,p=t.body;switch(r){case h.TYPE.GP2:case h.TYPE.GROUP_NOTIFICATION:p=l.formatGroupNotification(t);break;case h.TYPE.BROADCAST_NOTIFICATION:p=l.formatBroadcastNotification(i,t.body);break;case h.TYPE.E2E_NOTIFICATION:p=l.formatE2ENotification(t),s=t.subtype,d=t.body,u=t.id.remote;break;case h.TYPE.CALL_LOG:p=l.formatCallLog(t)}return a.createElement(k,{text:p,ref:"component",e2eSubtype:s,participantJid:d,chatId:u});case h.TYPE.AUDIO:case h.TYPE.VIDEO:return a.createElement(x,{msg:t,displayAuthor:o,ref:"component"});case h.TYPE.VCARD:return a.createElement(P,{msg:t,displayAuthor:o,ref:"component"});case h.TYPE.LOCATION:return a.createElement(D,{msg:t,displayAuthor:o,ref:"component"});case h.TYPE.PTT:return a.createElement(A,{msg:t,displayAuthor:o,ref:"component"});case h.TYPE.DOCUMENT:return a.createElement(I,{msg:t,trusted:t.isTrusted(),ref:"component",senderName:t.senderObj?t.senderObj.name:null,displayAuthor:o});default:c.log("messageList:render Unknown message type: "+r)()}},onSelectClick:function(){var e=!this.state.selected;this.props.onMessageSelect(this.props.msg,e),this.setState({selected:e})},render:function(){var e,t=this.props,n=t.msg,r=t.position,i=t.displayType;(this.state.hover||this.state.contextMenu)&&(e=a.createElement(R,(0,
o["default"])({},this.props,{key:"icon-context",ref:"context",onClick:this.onMenu})));var s;L.supportsFeature(L.F.RESEND_ICON)&&i===U.DISP_TYPE.CONVERSATION&&n.isFailed&&n.mediaState!==h.MEDIA_STATE.REMOTE_UPLOADING&&(s=a.createElement(T,{onResend:this.resend}));var c=!n.isNotification&&this.props.selectable?a.createElement("div",{className:"msg-select",onClick:this.onSelectClick},a.createElement(S,{onChange:this.onSelectClick,checked:this.state.selected})):null,l=r===G.MID||r===G.END,u=n.type===h.TYPE.CHAT&&!!(new M).match(n.body),d={wrapper:O("msg",{"msg-continuation":r===G.FRONT||r===G.MID,"msg-group":n.isGroupMsg&&!l,selected:this.state.selected}),container:O("message message-"+n.type,{"message-system":n.isNotification,"message-out":!n.isNotification&&n.isSentByMe,"message-in":!n.isNotification&&!n.isSentByMe,"focused-msg":this.props.highlight,hover:this.state.contextMenu||this.state.hover,tail:!this.props.tailOverride&&(r===G.END||r===G.SINGLE),"tail-override-left":"left"===this.props.tailOverride,"tail-override-right":"right"===this.props.tailOverride,"message-chat":n.type===h.TYPE.CHAT&&!n.linkPreview,"message-code":u})},p=this.state.contextMenu?"none":"pop-fast";return a.createElement("div",{className:d.wrapper},a.createElement(B,{transitionName:"delay-leave"},c),a.createElement("div",{className:d.container,onContextMenu:this.contextMenu,onMouseOver:this.mouseOver,onMouseEnter:this.mouseEnter,onMouseLeave:this.mouseLeave},s,this.getMsgComponent(),a.createElement(B,{transitionName:p},e)))}});j.Position=G,e.exports=j},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(347),a=n(9),s=n(47),c={GUIDE_ALLOW:"guide-allow",GUIDE_UNBLOCK:"guide-unblock",GUIDE_NONE:"guide-none"},l={CHROME_MEDIA_ERROR:"__chrome_media_error__",FIREFOX_LOCK:"__firefox_lock__",OPERA_MEDIA:"__opera_media__"},u=r.createClass({displayName:"GuidePopup",propTypes:{title:r.PropTypes.string.isRequired,desc:r.PropTypes.string.isRequired,browserPrefixDesc:r.PropTypes.bool.isRequired,type:r.PropTypes.oneOf(_.values(c)).isRequired,onConfirm:r.PropTypes.func,onCancel:r.PropTypes.func},statics:{TYPE:c},getDefaultProps:function(){return{browserPrefixDesc:!0,type:c.GUIDE_NONE,onConfirm:a.closeModal.bind(a)}},componentDidMount:function(){var e=this.getDescription(),t=this.refs.description;e.indexOf(l.CHROME_MEDIA_ERROR)>-1&&(t.innerHTML=t.innerHTML.replace(l.CHROME_MEDIA_ERROR,'<span class="chrome-media-icon"></span>')),e.indexOf(l.FIREFOX_LOCK)>-1&&(t.innerHTML=t.innerHTML.replace(l.FIREFOX_LOCK,'<span class="firefox-lock-icon"></span>')),e.indexOf(l.OPERA_MEDIA)>-1&&(t.innerHTML=t.innerHTML.replace(l.OPERA_MEDIA,'<span class="opera-media-icon"></span>'))},getDescription:function(){var e=this.props.desc+"_"+s.browser;return this.props.browserPrefixDesc&&l10n.hasT(e)?l10n.t(e):l10n.t(this.props.desc)},render:function(){var e="popup-guide";if(s.browser===i.BROWSER_TYPE.CHROME)switch(s.os){case i.OS_TYPE.MAC:e+=" popup-guide-mac";break;case i.OS_TYPE.CHROMEOS:e+=" popup-guide-chrome";break;case i.OS_TYPE.WINDOWS:}var t=null;this.props.type!==c.GUIDE_NONE&&s.browser===i.BROWSER_TYPE.CHROME&&(t=r.createElement("div",{className:"round"},r.createElement("div",{className:"round-body "+this.props.type})));var n=this.props.onCancel?l10n.t("learn_more"):void 0;return r.createElement(o,{title:l10n.t(this.props.title),classes:e,onOK:this.props.onConfirm,okText:l10n.t("ok_got_it"),onCancel:this.props.onCancel,cancelText:n},t,r.createElement("div",{className:"text text-tip",ref:"description"},this.getDescription()))}});e.exports=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(7),s=n(1),c=n(22),l=n(60),u=n(355),d=n(35),p=n(154),h=1500,f=2e3,m=l.extend({props:{id:"string",type:{type:"string",values:["available","unavailable","composing","recording"]},t:{type:"number",allowNull:!0},deny:"boolean"},session:{updateTime:"number",_expireTimerId:0}}),g=u.extend({model:m}),v=l.extend({Collection:"Presence",props:{id:"string"},session:{isOnline:"boolean",stale:["boolean",!1,!0],hasData:["boolean",!1,!1],isSubscribed:["boolean",!1,!1],withholdDisplay:["boolean",!1,!0],forceDisplay:["boolean",!1,!1],chatActive:["boolean",!1,!1],withholdDisplayTimer:"number",forceDisplayTimer:"number"},children:{chatstate:m},collections:{chatstates:g},derived:{isGroup:{fn:function(){return c.isGroup(this.id)}},isUser:{fn:function(){return c.isUser(this.id)}}},initialize:function(){this.isGroup?(this.chatstate.set({id:"",type:"unavailable"}),this.listenTo(this.chatstates,"add change",function(){var e,t=!1;this.chatstates.forEach(function(n){"composing"!==n.type&&"recording"!==n.type||e&&!(e.updateTime<n.updateTime)||(e=n),t=t||"unavailable"!==n.type}),this.set({isOnline:t,chatstate:{id:e?e.id:"",type:e?e.type:"unavailable"}})})):(this.chatstate.set({id:this.id}),this.listenTo(this.chatstate,"change:type",function(){this.isOnline="unavailable"!==this.chatstate.type})),this.listenTo(this,"change:chatActive",this.onChatActiveChange)},"delete":function(){l.prototype["delete"].call(this),Store.Presence.remove(this.id),this.chatstate["delete"](),this.chatstates.forEach(function(e){e["delete"]()})},handle:function(e){"undefined"==typeof e.type?e.type=this.chatstate.type||"unavailable":"paused"===e.type&&(e.type="available"),this.isGroup&&"available"!==e.type&&(e.updateTime=Date.now());var t;if(this.isGroup){if(e.id=e.participant,e.participant=void 0,!e.id)return;t=this.chatstates.add(e,{merge:!0})}else t=this.chatstate.set(e);t._expireTimerId&&clearTimeout(t._expireTimerId),"composing"===t.type||"recording"===t.type?t._expireTimerId=_.delay(this._expireComposing,a.PRESENCE_COMPOSING_TIMEOUT,t):t._expireTimerId=0;var n=this.forceDisplay||this.isOnline||this.isUser&&!this.chatstate.deny;this.set({hasData:!0,forceDisplay:n})},_expireComposing:function(e){var t=e.type;"composing"===t||"recording"===t?e.type="available":s.error("models:presence:expireComposing "+t)()},reset:function(){this.hasData=!1,this.isGroup?this.chatstates.forEach(function(e){e.type="unavailable"}):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})},isActive:function(){var e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)},getFormattedString:function(){if(!this.hasData)return null;if(this.isGroup){var e=this.chatstate.id;if(!e)return null;var t=Store.Contact.get(e);if(!t)return null;var n=t.formattedShortName;return"composing"===this.chatstate.type?l10n.t("web_conversation_name_is_composing",{participant:n}):l10n.t("web_conversation_name_is_recording",{participant:n})}if(!this.isUser)return null;var r=this.chatstate;switch(r.type){case"available":return l10n.t("web_conversation_contact_online");case"composing":return l10n.t("web_conversation_is_composing");case"recording":return l10n.t("web_conversation_is_recording");case"unavailable":return r.deny||!r.t?null:p.lastSeenStr(r.t)}},onChatActiveChange:function(){var e=this.chatActive;e?(this.hasData?this.withholdDisplay=!1:this.withholdDisplayTimer=_.delay(function(e){e.set({withholdDisplay:!1,withholdDisplayTimer:0})},h,this),this.forceDisplayTimer=_.delay(function(e){e.set({forceDisplay:!0,forceDisplayTimer:0})},f,this)):(this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=0))},subscribe:function(){return this.isSubscribed?o["default"].resolve():this.isUser?this.update():this.isGroup?(this.isSubscribed=!0,o["default"].all([this.update(),d.presenceSubscribe(this.id)]).bind(this)["catch"](function(e){return this.isSubscribed=!1,o["default"].reject(e)})):o["default"].resolve()}});e.exports=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(709),o=r(i),a=n(3),s=r(a),c=n(1),l={blobToArrayBuffer:function(e){return new s["default"](function(t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=function(e){c.error("wa:blobToAB:fileReader:error:"+e)()},n.readAsArrayBuffer(e)})},fileToAudio:function(e,t){var n=document.createElement("audio");t&&n.addEventListener("loadeddata",function(){t(n)}),n.src=URL.createObjectURL(e)},fileToVideo:function(e,t){var n=document.createElement("video");t&&n.addEventListener("loadeddata",function(){t(n)}),n.src=URL.createObjectURL(e)},getHash:function(e){return new s["default"](function(t,n){var r=new FileReader;r.onload=function(e){var n=CryptoJS.lib.WordArray.create(e.target.result),r=CryptoJS.SHA256(n);t({hash:r.toString(CryptoJS.enc.Base64),size:n.sigBytes})},r.onerror=function(e){c.log("wa:getHash:filereader error: "+e)(),n(e)},r.readAsArrayBuffer(e)})},getFileDuration:function(e){var t=this;return new s["default"](function(n,r){var i=t.typeFromMimetype(e.type);switch(i){case"image":case"document":n(void 0);break;case"video":t.fileToVideo(e,function(e){n(~~e.seekable.end(0)),URL.revokeObjectURL(e.src)});break;case"audio":t.fileToAudio(e,function(e){n(~~e.seekable.end(0)),URL.revokeObjectURL(e.src)});break;default:r(new Error("file:getFileDuration unsupported type: "+i))}})},typeFromMimetype:function(e){var t=e.split("/"),n=(0,o["default"])(t,2),r=n[0],i=n[1];switch(r){case"image":case"video":case"audio":return r;case"application":switch(i){case"pdf":case"msword":case"vnd.ms-excel":case"vnd.ms-powerpoint":case"vnd.openxmlformats-officedocument.wordprocessingml.document":case"vnd.openxmlformats-officedocument.presentationml.presentation":case"vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"document"}}return"document"}};e.exports=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var n=t.x||0,r=t.y||0;t.degrees&&(t.radians=t.degrees*(Math.PI/180)),e.translate(n,r),e.rotate(t.radians),e.translate(-n,-r)}function o(e,t,n){var r=e.getContext("2d"),i=r.getImageData(0,0,t,n);e.width=t,e.height=n,r.putImageData(i,0,0)}function a(e){var t=e.getContext("2d");t.fillStyle="rgb(247,247,247)",t.fillRect(0,0,e.width,e.height)}function s(e,t,n){var r=u.boundHeightWidth(e.height,e.width,n,t),i=r.width,o=r.height;if(i>e.width&&o>e.height)return e;var a=document.createElement("canvas"),s=a.getContext("2d");return a.width=i,a.height=o,s.drawImage(e,0,0,i,o),a}var c=n(3),l=r(c),u=n(897),d=n(718),p=n(898),h=n(835),f=n(21),m={generateVideoThumb:function(e,t,n){var r=void 0;return new l["default"](function(i,o){var a=document.createElement("video");a.autoplay=!1,a.loop=!1,a.onloadeddata=function(){var e=document.createElement("canvas"),r=u.boundHeightWidth(a.videoHeight,a.videoWidth,n,t);e.width=r.width,e.height=r.height;var o=e.getContext("2d");return o.drawImage(a,0,0,r.width,r.height),i({url:e.toDataURL("image/jpeg"),width:r.width,height:r.height,fullWidth:a.videoWidth,fullHeight:a.videoHeight})},a.onerror=function(e){o(e)},a.src=r=window.URL.createObjectURL(e),a.load()})["finally"](function(){r&&window.URL.revokeObjectURL(r)})},crop:function(e,t,n,r,i,o,a){return new l["default"](function(s,c){var l=document.createElement("canvas"),u=l.getContext("2d"),d=new Image;d.onload=function(){return o&&a?(l.height=a,l.width=o,u.drawImage(d,t,n,r,i,0,0,o,a)):(l.height=i,l.width=r,u.drawImage(d,t,n,r,i)),s({url:l.toDataURL("image/jpeg"),width:r,height:i})};var p=function(e){return c("onabort",e)},h=function(e){return c("onerror",e)};0!==e.indexOf("data:")&&d.setAttribute("crossOrigin","anonymous"),d.onabort=p,d.onerror=h,d.src=e})},resizeDataURI:function(e,t,n){return new l["default"](function(r,i){var o=new Image;o.onload=function(){var e=document.createElement("canvas"),i=u.boundHeightWidth(o.height,o.width,n,t);e.width=i.width,e.height=i.height;var a=e.getContext("2d");a.drawImage(o,0,0,i.width,i.height),r(e.toDataURL("image/jpeg"))},o.onerror=i,o.src=e})},rotateAndResize:function(e,t,n){return l["default"].props({buffer:h.blobToArrayBuffer(e),image:p.image(window.URL.createObjectURL(e))}).then(function(e){var r=e.buffer,c=e.image,l={};try{l=d(r)}catch(p){}var h=0;switch(l.orientation||"UNKNOWN"){case"right-top":h=1;break;case"left-bottom":h=-1;break;case"bottom-right":h=2}var f=document.createElement("canvas");if(h){var m=c.fullWidth,g=c.fullHeight,v=Math.max(m,g),y=v/2;f.width=f.height=v;var _=f.getContext("2d");return a(f),i(_,{x:y,y:y,degrees:90*h}),1===h?_.drawImage(c.img,0,v-g):_.drawImage(c.img,v-m,0),i(_,{x:y,y:y,degrees:-90*h}),o(f,g,m),s(f,t,n)}var E=u.boundHeightWidth(c.fullHeight,c.fullWidth,n,t),b=E.width,w=E.height;f.width=b,f.height=w;var S=f.getContext("2d");return a(f),S.drawImage(c.img,0,0,b,w),f})},canvasToBlob:function(e){arguments.length<=1||void 0===arguments[1]?"image/jpeg":arguments[1];return e.toBlob?new l["default"](function(t){e.toBlob(t,"image/jpeg")}):l["default"].resolve(window.dataURLtoBlob(e.toDataURL("image/jpeg")))},urlToFile:function(e){return new l["default"](function(t,n){var r=new Image;r.crossOrigin="Anonymous",r.onload=function(e){r.onload=r.onerror=null;var n=document.createElement("canvas");n.width=r.naturalWidth,n.height=r.naturalHeight;var i=n.getContext("2d");a(n),i.drawImage(r,0,0),t(n)},r.onerror=function(t){r.onload=r.onerror=null,n(new f.MediaDragDropError("unable to render image",e))},r.src=e}).then(this.canvasToBlob)}};e.exports=m},function(e,t,n){"use strict";var r=n(807),i=3;e.exports={minHeight:function(e,t){return{minHeight:e.length>i?i*r.DEFAULT_HEIGHT+t:e.length*r.DEFAULT_HEIGHT+t}}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(59),o=r(i),a=n(106),s=r(a),c=n(155),l=r(c),u=n(350),d=r(u),p=n(349),h=r(p),f=n(828),m=function(e){function t(e,n,r){var i=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];(0,s["default"])(this,t);var a=(0,d["default"])(this,(0,o["default"])(t).call(this));return a._delimiter=e,a._regex=n,a._group=r,a._props=i,a}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){var t=this._regex.exec(e);return t?(t[0][0]!==this._delimiter[0]&&(t.index++,t[0]=t[0].slice(1)),t):t}},{key:"args",value:function(){return this._props}},{key:"pick",value:function(){return this._group}},{key:"isFormatter",get:function(){return!0}}]),t}(f);e.exports=m},function(e,t,n){"use strict";var r=n(6),i=n(104),o=n(46),a=r.createClass({displayName:"CheckBox",mixins:[i],propTypes:{checked:r.PropTypes.bool.isRequired,onChange:r.PropTypes.func.isRequired,disabled:r.PropTypes.bool},onToggle:function(e){e&&e.stopPropagation(),this.props.onChange()},render:function(){var e=o("checkbox",{checked:this.props.checked,unchecked:!this.props.checked,disabled:this.props.disabled});return r.createElement("div",{className:"checkbox-container",onClick:this.onToggle},r.createElement("div",{className:e,ref:"checkbox"},r.createElement("div",{className:"checkmark"})))}});e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(810),o=n(107),a=r.createClass({displayName:"Pending",render:function(){return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"icon-xl icon-media icon-media-disabled"},r.createElement(o,{size:50,stroke:3})))}}),s=r.createClass({displayName:"PendingCancel",render:function(){return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"icon-xl icon-media-cancel"},r.createElement(o,{size:50,stroke:3})))}}),c=r.createClass({displayName:"Cancel",render:function(){return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"icon-xl icon-media-download"}))}}),l=r.createClass({displayName:"Download",propTypes:{filesize:r.PropTypes.number.isRequired},render:function(){return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"btn-meta"},r.createElement("span",{className:"icon-xl icon-media-download-noborder"}),r.createElement(i,null,this.props.filesize>0?l10n.filesize(this.props.filesize):null)))}}),u=r.createClass({displayName:"Upload",propTypes:{filesize:r.PropTypes.number.isRequired},render:function(){return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"btn-meta"},r.createElement("span",{className:"icon-xl icon-media-upload-noborder"}),r.createElement(i,null,this.props.filesize>0?l10n.filesize(this.props.filesize):null)))}}),d=r.createClass({displayName:"Play",render:function(){return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"icon-xl icon-media-play"}))}}),p=r.createClass({displayName:"Missing",render:function(){var e;switch(this.props.msg.type){case"image":e=l10n.t("missing_photo_title");break;case"video":e=l10n.t("missing_video_title");break;case"audio":e=l10n.t("missing_audio_title")}return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"btn-meta missing-text"},e))}});e.exports={Pending:a,Cancel:c,PendingCancel:s,Download:l,Upload:u,Play:d,Missing:p}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(28),c=n(1),l=n(354),u=n(806),d=n(925),p=n(846),h=n(821),f=n(831),m=n(836),g=n(352),v=n(920),y=n(107),E=n(347),b=n(58),w=n(9),S=n(7),T=n(46),C=n(103),M=200,N=1.3,k=2,x={GROUP:"group",PROFILE:"profile",NO_EDIT:"no_edit"},P=a.createClass({displayName:"PhotoPicker",propTypes:{startImage:a.PropTypes.string,type:a.PropTypes.oneOf(_.values(x)).isRequired,id:a.PropTypes.string,pending:a.PropTypes.bool,onImageSet:a.PropTypes.func.isRequired},statics:{Type:x},getInitialState:function(){return{img:this.props.startImage,left:0,top:0,isEditing:!1,hover:!1,contextActive:!1}},componentWillReceiveProps:function(e){this.props.startImage!==e.startImage&&this.setState({img:e.startImage,isEditing:!1})},cropImage:function(){if(!this.refs.img)return o["default"].reject("Image missing from DOM");var e=s.findDOMNode(this.refs.img),t=this.state.scale,n=Math.abs(this.state.left/t),r=Math.abs(this.state.top/t),i=M/t,a=i;i>S.MAX_PIC_SIDE?a=S.MAX_PIC_SIDE:i<S.MIN_PIC_SIDE&&(a=S.MIN_PIC_SIDE);var c;return new o["default"](function(t,o){m.crop(e.src,n,r,i,i,a,a).then(function(e){return c=e,m.crop(c.url,0,0,S.PROF_PIC_THUMB_SIDE,S.PROF_PIC_THUMB_SIDE)}).then(function(e){t({thumb:e.url,full:c.url})})})},onZoomIn:function(){var e=this.state.scale*N;e>=k||this.setState({scale:e})},onZoomOut:function(){var e=this.state.scale/N;this.state.minScale>=e&&(e=this.state.minScale),this.setState({scale:e})},onCrop:function(){this.cropImage().bind(this).then(function(e){this.props.onImageSet(e.thumb,e.full)})["catch"](function(){this.setState({img:this.props.startImage,isEditing:!1})})},onDragEnd:function(e,t){this.setState({left:e,top:t})},onUpload:function(e){var t=this.refs.imageInput;return t.click(),!0},removeImage:function(){this.props.onImageSet(),w.closeModal()},onRemove:function(e){var t=this.props.type===x.GROUP?l10n.t("remove_group_icon"):l10n.t("remove_profile_photo");w.openModal(a.createElement(E,{onOK:this.removeImage,okText:l10n.t("remove"),onCancel:w.closeModal.bind(w),cancelText:l10n.t("web_cancel")},t))},onView:function(){var e=this.refs.imageContainer,t=function(t){t(e)};w.openModalMedia(a.createElement(p,{contact:Store.Contact.get(this.props.id),animateBorderRadius:!0,getZoomNode:t}),"profile-viewer")},onImageTake:function(e){this.createAndSetImage(e)},onImagePick:function(e){b.pop(b.MENU);var t=e.target.files[0];return t?(this.createAndSetImage(t),void(e.target.value="")):!1},createAndSetImage:function(e){var t=this;m.rotateAndResize(e,3*S.IMG_MAX_EDGE,3*S.IMG_MAX_EDGE).then(function(e){var n=M/Math.min(e.width,e.height);t.setState({img:e.toDataURL("image/jpeg"),isEditing:!0,scale:n,minScale:n})})["catch"](function(e){c.error("PhotoPicker:createAndSetImage:error "+e)(e)})},onImageClick:function(e){if(this.props.type===x.NO_EDIT&&this.state.img)return void this.onView();if(!this.state.isEditing){e.stopPropagation(),e.preventDefault();var t=[];this.props.id&&this.state.img&&t.push(a.createElement(u,{key:"view",action:this.onView},l10n.t("view_photo"))),navigator.getUserMedia&&t.push(a.createElement(d,{key:"take",onImageTake:this.onImageTake})),t.push(a.createElement(u,{key:"upload",action:this.onUpload},l10n.t("upload_photo"))),this.state.img&&t.push(a.createElement(u,{key:"remove",action:this.onRemove},l10n.t("remove_photo"))),w.openContextMenu(t,{onClose:this.contextClose,type:l.Type.DROPDOWN,event:e}),this.setState({contextActive:!0})}},contextClose:function(){this.setState({contextActive:!1})},onMouseOver:function(e){this.state.hover||this.setState({hover:!0})},onMouseEnter:function(e){this.state.hover||this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},onLoad:function(e){var t=e.target.clientWidth,n=e.target.clientHeight;this.setState({imageSize:{width:t,height:n}})},render:function(){var e;if(this.state.img&&this.state.isEditing){var t={width:M,height:M};e=a.createElement(v,{ref:"img",container:t,onStop:this.onDragEnd,scale:this.state.scale},a.createElement("img",{className:"avatar-original",src:this.state.img}))}else this.state.img&&(e=a.createElement(h,{type:h.TYPES.COVER,size:this.state.imageSize},a.createElement(f,{src:this.state.img,style:{height:"100%",width:"100%"},onLoad:this.onLoad})));var n;(this.props.pending||!this.state.isEditing&&this.state.img&&!this.state.imageSize)&&(n=a.createElement("div",{className:"avatar-spinner-container"},a.createElement(y,{size:50,stroke:3})));var r=null;if(!this.props.pending&&this.props.type!==x.NO_EDIT&&(!this.state.img||this.state.imageSize)&&(!this.state.img||this.state.contextActive||!this.state.isEditing&&this.state.hover)){var i;switch(this.props.type){case"group":i=this.state.img?l10n.t("change_group_icon"):l10n.t("add_group_icon");break;case"profile":i=this.state.img?l10n.t("change_profile_photo"):l10n.t("add_profile_photo")}r=a.createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},a.createElement("span",{className:"icon icon-camera-light"}),a.createElement("div",{"data-a8n":g.key("avatar-text"),className:"avatar-overlay-text"},i))}var o,s,c=T("avatar","avatar-l","draggable-container",{"icon-group-default":this.props.type!==x.PROFILE,"icon-user-default":this.props.type===x.PROFILE});this.state.isEditing&&(o=a.createElement("div",{className:"avatar-picker-controls",key:"zoom-controls"},a.createElement("button",{className:"icon icon-plus",onClick:this.onZoomIn}),a.createElement("button",{className:"icon icon-minus",onClick:this.onZoomOut})),s=a.createElement("div",{className:"tip-container tip-avatar-picker",key:"tip-controls"},a.createElement("div",{className:"tip"},a.createElement("div",{className:"tip-body"},l10n.t("adjust_image")),a.createElement("div",{className:"tip-controls"},a.createElement("button",{className:"button",onClick:this.onCrop},l10n.t("done_adjusting"))))));var l=this.props.type===x.NO_EDIT||this.props.pending||!this.state.imageSize&&this.state.img?_.noop:this.onImageClick;return a.createElement("div",{className:"avatar-picker"},a.createElement("div",{className:c,onClick:l,onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,ref:"imageContainer",dir:"ltr"},e,a.createElement(C,{transitionName:"fade"},n,r)),a.createElement(C,{transitionName:"fade"},o),a.createElement(C,{transitionName:"slide"},s),a.createElement("input",{ref:"imageInput",type:"file","data-ignore-capture":b.IGNORE_ANY,accept:"image/gif,image/jpeg,image/jpg,image/png",style:{display:"none"},onChange:this.onImagePick}))}});e.exports=P},function(e,t,n){"use strict";var r=n(6),i=r.createClass({displayName:"SectionHeader",propTypes:{header:r.PropTypes.string.isRequired},render:function(){return r.createElement("div",{className:"list-title"},this.props.header)}});e.exports=i},function(e,t,n){"use strict";var r=n(6),i=n(810),o=n(798),a=n(154),s=n(61),c=r.createClass({displayName:"PreviewImage",propTypes:{duration:r.PropTypes.oneOfType([r.PropTypes.string,r.PropTypes.number]),shade:r.PropTypes.bool,thumb:r.PropTypes.string,type:r.PropTypes.oneOf([o.TYPE.AUDIO,o.TYPE.LOCATION,o.TYPE.VIDEO,o.TYPE.PTT,o.TYPE.VCARD]).isRequired},getDefaultProps:function(){return{shade:!0}},getIconClassNames:function(){return this.props.type===o.TYPE.VIDEO?"icon-sm icon-video-inv":this.props.type===o.TYPE.AUDIO?"icon-sm icon-arrow-inv":void 0},getClassNames:function(){var e="preview";return e+=this.props.type===o.TYPE.VCARD?" icon-user-default":" icon-user-default-square",this.props.thumb||(e+=" preview-"+this.props.type+" no-image"),e},getStyles:function(){var e=this.props.thumb;return e?s.isHttp(e)?{backgroundImage:'url("'+e+'")'}:{backgroundImage:'url("data:image/jpeg;base64,'+e+'")'}:{}},render:function(){var e=a.durationStr(this.props.duration),t=this.props.shade?r.createElement("span",{className:"shade"}):null;return r.createElement("div",{className:this.getClassNames(),style:this.getStyles()},t,r.createElement("span",{className:"meta meta-audio"},r.createElement("span",{className:this.getIconClassNames()}),r.createElement(i,null,e)))}});e.exports=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(813),c=n(347),l=n(966),u=n(798),d=n(9),p=n(21),h=n(800),f=a.createClass({displayName:"ForwardMessageFlow",mixins:[s],propTypes:{msgs:a.PropTypes.arrayOf(a.PropTypes.instanceOf(u)).isRequired,onFoward:a.PropTypes.func},componentWillMount:function(){this.push(this.chatModal)},chatModal:function(){var e=this;return a.createElement(l,{onChat:this.confirmForward,key:"ChatModal",selectedTab:this.selectedTab,onSelectTab:function(t){e.selectedTab=t},title:l10n.t("forward_message_to")})},checkCanSend:function(e){var t={};return o["default"].map(this.props.msgs,function(n){var r=void 0;if(n.isMMS){var i=n.type;r=t[i]?t[i]:t[i]=e.shouldSendEncrypted(i).then(function(){return!0})["catch"](function(){return!1})}else r=!0;return o["default"].props({msg:n,canSend:r})})},confirmForward:function(e){var t,n=!1;e.isGroup?t=l10n.t("confirm_forward_to_group",{chat:e.formattedTitle}):e.isUser&&e.contact.isBlocked()?(t=l10n.t("confirm_unblock_contact_and_forward",{chat:e.formattedTitle}),n=!0):t=l10n.t("confirm_forward_to_contact",{chat:e.formattedTitle}),this.push(a.createElement(c,{onOK:_.partial(this.onForwardConfirmed,e,n),okText:l10n.t("web_ok"),onCancel:this.pop.bind(null,void 0,void 0),key:"ConfirmPopup",cancelText:l10n.t("web_cancel")},a.createElement(h,{text:t})))},onForwardConfirmed:function(e,t){var n,r=this,i=Date.now();n=t?e.contact.setBlock(!1):o["default"].resolve(!0),o["default"].all([this.checkCanSend(e),n]).spread(function(t,n){var r=_.pluck(_.filter(t,{canSend:!0}),"msg"),i=_.pluck(_.filter(t,{canSend:!1}),"msg");return o["default"].props({undelivered:e.forwardMessages(r),canSend:r,cannotSend:i})}).then(function(t){var n=t.undelivered,o=t.canSend,a=t.cannotSend;(n.length||a.length)&&r.showMediaSendError(e,o,a,n,i)})["catch"](p.ContactBlocked,function(){r.showContactBlocked(e,i)}),this.endFlow(),_.isFunction(this.props.onForward)&&this.props.onForward(this.props.msgs),d.openChat(e)},showContactBlocked:function(e,t){var n=Date.now()-t>1e3?void 0:!1;d.openModal(a.createElement(c,{key:"contactBlocked",onOK:d.closeModal.bind(d)},l10n.t("web_cannot_send_to_blocked_contact_1",{contact:e.contact.formattedName})),n)},showMediaSendError:function(e,t,n,r,i){var o=t.length-r.length,s=[];if(o){s.push(l10n.t("forwarded_some_messages",{count:o,_plural:o}));var l=void 0,u=n.length+r.length;l=r.length?n.length?e.isUser?l10n.t("cannot_forward_media_missing_and_capability_contact",{count:u,_plural:u,contact:e.formattedTitle}):l10n.t("cannot_forward_media_missing_and_capability_group",{count:u,_plural:u}):l10n.t("cannot_forward_media_missing",{count:u,_plural:u}):e.isUser?l10n.t("cannot_forward_capability_contact",{count:u,_plural:u,contact:e.formattedTitle}):l10n.t("cannot_forward_capability_group",{count:u,_plural:u}),l&&s.push(l)}else{var p=void 0;p=r.length?n.length?e.isUser?l10n.t("cannot_forward_media_missing_and_capability_contact_none",{contact:e.formattedTitle}):l10n.t("cannot_forward_media_missing_and_capability_group_none"):l10n.t("cannot_forward_media_missing_none"):e.isUser?l10n.t("cannot_forward_capability_contact_none",{contact:e.formattedTitle}):l10n.t("cannot_forward_capability_group_none"),p&&s.push(p)}d.openModal(a.createElement(c,{onOK:d.closeModal.bind(d),okText:l10n.t("web_ok")},s.map(function(e,t){return a.createElement("p",{key:t},e)})),!1)},showMediaSendError2:function(e,t,n){var r,i;if(1===e.length){var o=e[0].type;switch(o){case u.TYPE.VIDEO:r=l10n.t("missing_video_title"),i=l10n.t("missing_video_forward_text");break;case u.TYPE.AUDIO:case u.TYPE.PTT:r=l10n.t("missing_audio_title"),i=l10n.t("missing_audio_forward_text");break;case u.TYPE.IMAGE:r=l10n.t("missing_photo_title"),i=l10n.t("missing_photo_forward_text");break;case u.TYPE.DOCUMENT:r=l10n.t("missing_document_title"),i=l10n.t("missing_document_forward_text")}}else r=l10n.t("missing_media_title"),i=l10n.t("missing_media_forward_text",{count:e.length,_plural:e.length});var s=Date.now()-n>1e3?void 0:!1;d.openModal(a.createElement(c,{title:r,onOK:d.closeModal.bind(d),okText:l10n.t("web_ok")},i),s)}});e.exports=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(707),o=r(i),a=n(6),s=n(46),c=a.createClass({displayName:"Modal",propTypes:{type:a.PropTypes.oneOf(["compact","box","tower"]),classes:a.PropTypes.string,title:a.PropTypes.string,children:a.PropTypes.node.isRequired},getDefaultProps:function(){return{classes:"",type:"compact"}},statics:{COMPACT:"compact",BOX:"box",TOWER:"tower"},render:function(){var e=this.props.title?a.createElement("div",{className:"popup-title",dir:"auto"},this.props.title):null,t=s("popup",this.props.classes,(0,o["default"])({},"popup-"+this.props.type,this.props.type!==c.COMPACT));return a.createElement("div",{className:"backdrop"},a.createElement("div",{className:"popup-container"},a.createElement("div",{className:t},a.createElement("div",{className:"popup-body"},e,a.createElement("div",{className:"popup-contents"},this.props.children)))))}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(831),o=n(805),a=n(800),s=n(821),c=n(156),l=n(9),u=n(58),d=n(158),p=n(799),h=n(46),f=500,m=r.createClass({displayName:"PhotoViewerModal",mixins:[p,d],propTypes:{contact:r.PropTypes.instanceOf(c),imgFull:r.PropTypes.string,animateBorderRadius:r.PropTypes.bool,getZoomNode:r.PropTypes.func.isRequired},getInitialState:function(){return{formattedUser:this.async("contact.formattedUser"),imgFull:this.props.imgFull||this.async("contact.profilePicThumb.imgFull"),style:{visibility:"hidden"}}},componentWillMount:function(){this.uimPush(this,u.MEDIA_VIEWER,{popable:!0})},uimClose:function(){var e=void 0;if(this.props.getZoomNode(function(t){e=t}),!e)return l.closeModalMedia();var t=this.refs.image,n=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i=r.top-n.top,o=r.left-n.left,a=e.clientWidth/t.clientWidth;Velocity(t,{translateX:[o,0],translateY:[i,0],scale:[a,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){l.closeModalMedia()})},onClose:function(){u.find(u.MEDIA_VIEWER)&&this.uimPop(u.MEDIA_VIEWER)},onImageLoad:function(e){var t=this,n=e.target;this.setState({size:{width:n.naturalWidth,height:n.naturalHeight}},function(){t.props.getZoomNode(function(e){var r=n.getBoundingClientRect(),i=e.getBoundingClientRect(),o=i.top-r.top,a=i.left-r.left,s=e.clientWidth/n.clientWidth,c={visibility:"hidden",transform:"translateX("+a+"px) translateY("+o+"px) scale("+s+")",transition:"transform 0s"};t.props.animateBorderRadius&&(c.borderRadius="50%"),t.setState({style:c},function(){var e={transform:"translateX(0px) translateY(0px) scale(1)",transition:"transform "+f+"ms cubic-bezier(.1,.82,.25,1)"};t.props.animateBorderRadius&&(e={transform:"translateX(0px) translateY(0px) scale(1)",borderRadius:"0%",transition:"transform "+f+"ms cubic-bezier(.1,.82,.25,1),\n                                         border-radius "+f+"ms cubic-bezier(.1,.82,.25,1)"
}),t.setState({style:e})})})})},render:function(){var e=this.props.contact,t=h("media-viewer","media-viewer-animate"),n=h("media-panel-header",{});return r.createElement("div",{className:t,onWheel:this.onScroll,onClick:this.onClose},r.createElement("div",{className:n},r.createElement("div",{className:"chat media-chat"},r.createElement("div",{className:"chat-avatar"},r.createElement(o,{id:e.id})),r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},r.createElement(a,{text:this.state.formattedUser})))),r.createElement("div",{className:"menu menu-horizontal media-panel-tools"},r.createElement("div",{className:"menu-item"},r.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.onClose},l10n.t("web_close"))))),r.createElement("div",{className:"media-content",dir:"ltr",ref:"container"},r.createElement("div",{className:"media"},r.createElement(s,{type:s.TYPES.SCALE_DOWN,size:this.state.size},r.createElement("div",{className:"profile-viewer",ref:"image",style:this.state.style},r.createElement(i,{src:this.state.imgFull,hasPrivacyChecks:!0,onLoad:this.onImageLoad,className:"profile-viewer-img"}))))))}});e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(1),c=n(355),l=n(358),u=n(156),d=n(60),p=n(35),u=n(156),h=n(9),f=n(80),m=n(21),g=n(809),v=n(82).ActionToast,y=n(82).ActionType,_=d.extend({props:{id:"string",isAdmin:"boolean"},children:{contact:u},initialize:function(){this.contact=Store.Contact.gadd({id:this.id}),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact"))}}),E=c.extend(l,{model:_,comparator:function(e,t){return u.Comparator(e.contact,t.contact)},initialize:function(){this.listenTo(this,"change:contact.name",this.sort),this.listenTo(h,"locale_change",this.sort)},addParticipant:function(e,t){var n=this;if(this.get(e.id))return h.openToast(a.createElement(g,{id:g.genId(),msg:l10n.t("action_participant_failed_already_added",{participant:e.formattedShortName})})),o["default"].reject(new m.ActionError);if(!this.canAdd())return o["default"].reject(new m.ActionError);var r=p.addParticipant(this.parent.id,e.id),i=new y(l10n.t("action_participant_adding",{participant:e.formattedShortName}));t=t||v.genId();var c=r.then(function(t){return 200===t.status?new y(l10n.t("action_participant_added",{participant:e.formattedShortName})):404===t.status?new y(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new y(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new y(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(r){return s.error("models:groupMetadata:participantCollection:addParticipant dropped")(r),new y(l10n.t("action_participant_add_failed"),l10n.t("action_try_again"),n.addParticipant.bind(n,e,t))});return h.openToast(a.createElement(v,{id:t,initialAction:i,pendingAction:c})),r},removeParticipant:function(e,t){var n=this;if(!this.canRemove(e))return o["default"].reject(new m.ActionError);var r=p.removeParticipant(this.parent.id,e.id),i=new y(l10n.t("action_participant_removing",{participant:e.contact.formattedShortName}));t=t||v.genId();var c=r.then(function(t){return 200===t.status?new y(l10n.t("action_participant_removed",{participant:e.contact.formattedShortName})):404===t.status?new y(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new y(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new y(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(r){return s.error("models:groupMetadata:participantCollection:removeParticipant dropped")(r),new y(l10n.t("action_participant_remove_failed"),l10n.t("action_try_again"),n.removeParticipant.bind(n,e,t))});return h.openToast(a.createElement(v,{id:t,initialAction:i,pendingAction:c})),r},promoteParticipant:function(e,t){var n=this;if(!this.canPromote(e))return o["default"].reject(new m.ActionError);var r=p.promoteParticipant(this.parent.id,e.id),i=new y(l10n.t("action_participant_promoting",{participant:e.contact.formattedShortName}));t=t||v.genId();var c=r.then(function(t){return 200===t.status?new y(l10n.t("action_participant_promoted",{participant:e.contact.formattedShortName})):404===t.status?new y(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new y(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new y(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(r){return s.error("models:groupMetadata:participantCollection:removeParticipant dropped")(r),new y(l10n.t("action_participant_promote_failed"),l10n.t("action_try_again"),n.promoteParticipant.bind(n,e,t))});return h.openToast(a.createElement(v,{id:t,initialAction:i,pendingAction:c})),r},canAdd:function(){return f.supportsFeature(f.F.GROUP_ADD_PARTICIPANT)?!!this.iAmAdmin():!1},canPromote:function(e){return f.supportsFeature(f.F.GROUP_PROMOTE_PARTICIPANT)&&e?Store.Conn.me===e.id?!1:this.iAmAdmin()?!e.isAdmin:!1:!1},canRemove:function(e){return f.supportsFeature(f.F.GROUP_REMOVE_PARTICIPANT)&&e?Store.Conn.me===e.id?!1:!!this.iAmAdmin():!1},iAmMember:function(){return 1===this.where({id:Store.Conn.me}).length},iAmAdmin:function(){return 1===this.where({id:Store.Conn.me,isAdmin:!0}).length}}),b=d.extend({Collection:"GroupMetadata",props:{id:"string",creation:"number",owner:"string"},session:{stale:["boolean",!1,!0],trusted:["boolean",!1,!0]},collections:{participants:E},"delete":function(){d.prototype["delete"].call(this),Store.GroupMetadata.remove(this.id),this.participants.invoke("delete"),this.participants.stopListening(),this.participants.reset()},canSetSubject:function(){return f.supportsFeature(f.F.GROUP_SET_SUBJECT)?!!this.participants.iAmMember():!1},initialize:function(){this.listenTo(this.participants,"change:isAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this,"change:owner",this.isTrusted),this.isTrusted(),this.listenTo(this.participants,"add remove reset",this.onParticipantChange)},isTrusted:function(){if(this.stale)return this.trusted;if(!this.owner)return this.trusted=!1;if(this.owner===Store.Conn.me)return this.trusted=!0;var e=Store.Contact.get(this.owner);if(e&&e.isMyContact)return this.trusted=!0;for(var t=this.participants.models,n=0,r=t.length;r>n;++n){var i=t[n];if(i.isAdmin&&i.id!==Store.Conn.me&&i.contact.isMyContact)return this.trusted=!0}return this.trusted=!1},onParticipantChange:function(){Store.Contact.get(this.id).unset("_capabilities"),Store.GroupMetadata.trigger("group_participant_change",this.id)}});e.exports=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(59),o=r(i),a=n(106),s=r(a),c=n(350),l=r(c),u=n(349),d=r(u),p=n(838),h=n(46),f=function(e){function t(e){return(0,s["default"])(this,t),(0,l["default"])(this,(0,o["default"])(t).call(this,"_",/(?:^|[*_~\s])_((?:[^\n])+?)_(?=_|\W|$)/,1,e?{className:h(e)}:null))}return(0,d["default"])(t,e),t}(p);e.exports=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(710),o=r(i),a=n(709),s=r(a),c=n(1014),l=c.Node,u=c.Text,d=c.Delimiter,p=c.MutatorNode,h=function(e,t){return t.map(function(t){return[t,t.match(e)]}).filter(function(e){var t=(0,s["default"])(e,2),n=t[1];return!!n}).sort(function(e,t){var n=(0,s["default"])(e,2),r=n[1],i=(0,s["default"])(t,2),o=i[1];return r.index-o.index})},f=function(e){return e.map(function(e){return[e.index,e.index+e[0].length]})},m=function(e,t){return t.map(function(t){return t[0]<e[1]&&t[1]>=e[1]})},g=function(e,t){return t.map(function(t){return t[0]>e[0]&&t[1]<e[1]})},v=function(e,t,n,r,i){return r.some(function(r,o){if(!r&&!i[o])return!1;var a=(0,s["default"])(t[n],1),c=a[0],l=(0,s["default"])(t[n+o+1],1),u=l[0],d=e.indexOf(c),p=e.indexOf(u);return r&&d>p?!0:i[o]&&c.alwaysApply||!c.formatResult?!1:!(!i[o]||u.formatResult)})},y=function(e,t){if(!e.length)return[];if(1===e.length)return e[0];for(var n=f(e.map(function(e){var t=(0,s["default"])(e,2),n=t[1];return n})),r=0;r<n.length;++r){var i=n.slice(r+1),o=m(n[r],i),a=g(n[r],i);if(!v(t,e,r,o,a))return e[r]}return[]},_=function(e){var t=e.input;return[t.substring(0,e.index),e[0],t.substring(e.index+e[0].length)]},E=function(e,t){var n=e[0].split(e[t]),r=(0,s["default"])(n,2),i=r[0],o=r[1];return[i,e[t],o]},b=function(e,t){return e.filter(function(e){return e.alwaysApply||e!==t&&t.formatResult})},w=function(e){return e.reduce(function(e,t){if(!e.length)return[t];var n=e[e.length-1];return n instanceof u&&t instanceof u&&!(t instanceof d||n instanceof d)?(n.value+=t.value,e):(e.push(t),e)},[])},S=function M(e,t){if(!e)return e;if(e instanceof u){var n=function(){var n=y(h(e.value,t),t),r=(0,s["default"])(n,2),i=r[0],a=r[1];if(!a)return{v:e};var c=_(a),l=(0,s["default"])(c,3),f=l[0],m=l[2],g=E(a,i.pick(a)),v=(0,s["default"])(g,3),w=v[0],S=v[1],T=v[2],C=[];f&&C.push(new u(e.parent,f)),i.isFormatter&&w&&C.push(new d(e.parent,w));var N=b(t,i),k=i.mutate(S,a),x=new p(e.parent,k?[new u(k)]:[],i,i.args(a,S,k)),P=M(x,N);if(i.isFragment?(P.children.forEach(function(e){return e.parent=x.parent}),C.push.apply(C,(0,o["default"])(P.children))):C.push(P),i.isFormatter&&T&&C.push(new d(e.parent,T)),m){var D=M(new u(e.parent,m),t);C.push.apply(C,(0,o["default"])(Array.isArray(D)?D:[D]))}return{v:C}}();if("object"==typeof n)return n.v}return e.children.slice().forEach(function(n){var r=M(n,t);e.replaceChild.apply(e,[n].concat((0,o["default"])(Array.isArray(r)?r:[r])))}),e.children=w(e.children),e},T=function(e,t){return S(new l(null,[new u(e)]),t)},C=function N(e,t){if(e instanceof d)return t.onDelimiter(e.value);if(e instanceof u)return t.onText(e.value);var n=e.children.map(function(e){return N(e,t)}).filter(function(e){return!!e});return e instanceof p?t.onMutatorNode(e,n):t.onRoot(n)};e.exports={parse:T,serialize:C}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(59),o=r(i),a=n(106),s=r(a),c=n(155),l=r(c),u=n(350),d=r(u),p=n(349),h=r(p),f=n(828),m=n(46),g=n(84),v=n(1011),y=v.findLink,_={"http://":!0,"https://":!0,"mailto:":!0},E=g.memoize(y),b=function(e){function t(e){(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,o["default"])(t).call(this));return n._classes=e,n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function n(e){var n=E(e);return n&&_[n.scheme]?{href:n.href,0:n.url,input:e,index:n.index}:null}},{key:"args",value:function(e){return{props:{href:e.href,title:e.href,rel:"noopener noreferrer",target:"_blank",className:this._classes?m(this._classes):void 0}}}}]),t}(f);e.exports=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(106),o=r(i),a=n(155),s=r(a),c=function(){function e(){(0,o["default"])(this,e)}return(0,s["default"])(e,[{key:"onRoot",value:function(e){return e}},{key:"onMutatorNode",value:function(e,t){return{mutator:e.mutator,children:t}}},{key:"onDelimiter",value:function(e){return e}},{key:"onText",value:function(e){return e}}]),e}();e.exports=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(59),o=r(i),a=n(106),s=r(a),c=n(350),l=r(c),u=n(349),d=r(u),p=n(838),h=n(46),f=function(e){function t(e){return(0,s["default"])(this,t),(0,l["default"])(this,(0,o["default"])(t).call(this,"~",/(?:^|[*_~\s])~((?:[^\n])+?)~(?=_|\W|$)/,1,e?{className:h(e)}:null))}return(0,d["default"])(t,e),t}(p);e.exports=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(59),o=r(i),a=n(106),s=r(a),c=n(350),l=r(c),u=n(349),d=r(u),p=n(838),h=n(46),f=function(e){function t(e){return(0,s["default"])(this,t),(0,l["default"])(this,(0,o["default"])(t).call(this,"*",/(?:^|[*_~\s])\*((?:[^\n])+?)\*(?=_|\W|$)/,1,e?{className:h(e)}:null))}return(0,d["default"])(t,e),t}(p);e.exports=f},,,,,,,,,,function(e,t,n){"use strict";var r=n(6),i=n(798),o=n(799),a=n(46),s=r.createClass({displayName:"MsgAck",mixins:[o],propTypes:{msg:r.PropTypes.instanceOf(i)},getInitialState:function(){return{ack:this.async("msg.ack")}},render:function(){var e=this.props.msg.ack,t=a("icon",{"icon-status-time":1>e,"icon-status-check":1===e,"icon-status-dblcheck":2===e,"icon-status-dblcheck-ack":e>2});return r.createElement("span",{className:t})}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(1),o=n(798),a=n(102),s=r.createClass({displayName:"MsgSymbol",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(o)},componentWillMount:function(){var e=this.props.msg;"ptt"===e.type&&e.ack<4&&this.addObserver(this.props.msg,"change:ack")},getClasses:function(){var e="icon media-icon",t=this.props.msg;switch(t.type){case"location":case"image":case"video":case"audio":case"vcard":case"document":e+=" icon-status-"+t.type;break;case"ptt":var n=4===t.ack?"blue":t.isSentByMe?"gray":"green";e+=" icon-status-"+t.type+"-"+n;break;default:i.log("chat:getClasses Invalid msg type.")()}return e},render:function(){return r.createElement("span",{className:this.getClasses()})}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(801),o=n(798),a=n(154),s=n(102),c=n(81),l=r.createClass({displayName:"Timestamp",mixins:[s,c],propTypes:{chat:r.PropTypes.instanceOf(i),msg:r.PropTypes.instanceOf(o)},componentWillMount:function(){this.props.chat&&this.addObserver(this.props.chat.msgs,"change:last")},componentDidMount:function(){this.maybeRegMidnight()},componentDidUpdate:function(){this.maybeRegMidnight()},rerender:function(){this.forceUpdate()},maybeRegMidnight:function(){var e=this.timestamp();if(e){this.unregCmd("midnight",this.rerender);var t=moment().startOf("day").subtract(7,"day");e>=t.unix()&&this.regCmd("midnight",this.rerender)}},timestamp:function(){if(this.props.msg)return this.props.msg.t;var e=this.props.chat.msgs.last();return e&&e.t},render:function(){var e=this.timestamp();return e?r.createElement("div",{className:"chat-meta"},r.createElement("span",{className:"chat-time"},a.relativeStr(e))):null}});e.exports=l},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(807),a=n(812),s=n(842),c=n(808),l=n(105),u=l.HotKeys,d=r.createClass({displayName:"ContactList",propTypes:{contacts:r.PropTypes.array.isRequired,exclude:r.PropTypes.array,onClick:r.PropTypes.func,onFocusSearch:r.PropTypes.func},getInitialState:function(){this.selection=new c(this.props.contacts,function(e){return e.id});var e=this.props.exclude;return e&&(e=_.object(e.map(function(e){return[e.id,!0]}))),{exclude:e}},componentWillReceiveProps:function(e){this.selection.init(e.contacts)},onFocusGain:function(e){e.target===i.findDOMNode(this)&&(this.selection.index<0?this.focusFirst():this.selection.reset())},focusFirst:function(){this.selection.setFirst()},onNextContact:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrevContact:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.prev();t>-1?this.selection.setPrev():(this.selection.unset(),this.props.onFocusSearch(e))},render:function(){for(var e,t=this.props.contacts,n=[],i=t.length>10,c=this.state.exclude||{},l="XXX",d=0;d<t.length;d++){var p=t[d];if(e=null,i){var h=p.header;d<t.length-1&&h!==t[d+1].header&&(e="last"),h!==l&&(n.push(r.createElement(s,{key:h,header:h})),l=h)}var f=p.id;n.push(r.createElement(a,{contact:p,active:this.selection,className:e,onClick:this.props.onClick,member:c[f],key:f}))}var m={down:this.onNextContact,up:this.onPrevContact};return r.createElement(u,{handlers:m,onFocus:this.onFocusGain,"data-tab":3},r.createElement(o,{classes:["chatlist"],data:n,height:72,extraItems:4}))}});e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(11),a=n(81),s=n(104),c=n(153),l=n(9),u=n(47),d=n(798),p=r.createClass({displayName:"AudioTag",mixins:[a,s,c],propTypes:{msg:r.PropTypes.instanceOf(d).isRequired,className:r.PropTypes.string,controls:r.PropTypes.bool,preload:r.PropTypes.string,type:r.PropTypes.string,onClick:r.PropTypes.func,onPlay:r.PropTypes.func,onError:r.PropTypes.func,autoPlay:r.PropTypes.bool},componentDidMount:function(){var e=i.findDOMNode(this);this.regNativeListener(e,"error",this.onPlayerError,!0),this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying),(u.isGecko||u.isSafari)&&(this.props.autoPlay?(this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)):this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(o.state===o.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>40)return void this.onPlayerError({target:{src:this.state.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=i.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError(e.target.src)},onOtherPlaying:function(e){e!==this&&i.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),l.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){return r.createElement("audio",{src:this.props.msg.url,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,preload:this.props.preload,type:this.props.type,autoPlay:this.props.autoPlay},this.props.children)}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(801),o=n(799),a=n(806),s=r.createClass({displayName:"DeleteMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(i).isRequired,onDeleteOrExit:r.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e;switch(this.props.chat.kind){case i.KIND.GROUP:e=this.props.chat.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group");break;case i.KIND.BROADCAST:e=l10n.t("web_delete_list");break;case i.KIND.CHAT:e=l10n.t("delete_chat")}return r.createElement(a,{a8n:"mi-delete",action:this.props.onDeleteOrExit,shortcut:"x"},e)}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(102),o=n(800),a=n(21),s=n(834),c=n(847),l=r.createClass({displayName:"GroupSubtitle",mixins:[i],propTypes:{presence:r.PropTypes.instanceOf(s),groupMetadata:r.PropTypes.instanceOf(c),placeholder:r.PropTypes.node,location:r.PropTypes.oneOf(["list","title"])},componentWillMount:function(){Store.GroupMetadata.find(this.props.groupMetadata.id)["catch"](a.WapDrop,_.noop);var e=this.props.groupMetadata.participants;this.addObserver(e,"sort remove reset"),this.addObserver(this.props.presence,"change:chatstate.id change:chatstate.type change:forceDisplay change:withholdDisplay")},getSubtitle:function(){return this.props.groupMetadata.participants.map(function(e){return e.contact.formattedShortNameWithNonBreakingSpaces}).join(", ")},render:function(){var e,t=this.props.presence;return"list"===this.props.location?(e=t.getFormattedString()||this.getSubtitle(),e?r.createElement(o,{ellipsify:!0,titlify:!0,text:e}):null):(e=t.withholdDisplay?this.props.placeholder:t.getFormattedString()||(t.forceDisplay?this.getSubtitle():this.getSubtitle()||this.props.placeholder),e?r.createElement("div",{className:"chat-status ellipsify"},r.createElement(o,{ellipsify:!0,titlify:!0,text:e})):null)}});e.exports=l},function(e,t,n){"use strict";var r=n(6),i=n(58),o=n(103),a=n(352),s=n(158),c=r.createClass({displayName:"MenuBar",propTypes:{children:r.PropTypes.node,a8n:r.PropTypes.string},render:function(){return r.createElement("div",{className:"menu menu-horizontal"},this.props.children)}}),l=r.createClass({displayName:"MenuBarItem",mixins:[s],propTypes:{icon:r.PropTypes.string.isRequired,title:r.PropTypes.string.isRequired,children:r.PropTypes.node,transitionName:r.PropTypes.string,onClick:r.PropTypes.func,disabled:r.PropTypes.bool},getDefaultProps:function(){return{transitionName:"dropdown"}},getInitialState:function(){return{active:!1}},onClick:function(e){e.stopPropagation(),this.props.onClick(e)},onOpen:function(e){e.preventDefault(),e.stopPropagation(),this.setState({active:!0}),this.uimPush(this,i.MENU,{popable:!0})},onClose:function(e){e.preventDefault(),e.stopPropagation(),this.setState({active:!1}),this.uimPop(i.MENU)},uimClose:function(){this.setState({active:!1})},clickHandler:function(e){this.props.onClick&&this.onClick(e),e.isDefaultPrevented()||(this.state.active?this.onClose(e):this.onOpen(e))},render:function(){var e="icon icon-"+this.props.icon,t=this.state.active,n=null;if(this.props.children){var s=this.props.transitionName,c=r.Children.only(this.props.children);n=r.createElement(o,{transitionName:s},t?c:null)}var l="menu-item";return t&&(l+=" active"),this.props.disabled&&(l+=" disabled"),r.createElement("div",{"data-a8n":a.key(this.props.a8n),className:l,onClick:this.props.disabled?null:this.clickHandler},r.createElement("button",{className:e,"data-ignore-capture":i.IGNORE_ANY,title:this.props.title},this.props.title),n)}});e.exports={MenuBar:c,MenuBarItem:l}},function(e,t,n){"use strict";var r=n(6),i=n(801),o=n(799),a=n(806),s=r.createClass({displayName:"MuteMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(i).isRequired,onMute:r.PropTypes.func.isRequired},getInitialState:function(){return{isMuted:this.async("chat.mute.isMuted")}},render:function(){var e=this.props.onMute.bind(null,!this.state.isMuted);return r.createElement(a,{action:e,shortcut:"m"},this.state.isMuted?l10n.t("web_menuitem_mute_off"):l10n.t("web_menuitem_mute"))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=r.createClass({displayName:"Tooltip",propTypes:{body:r.PropTypes.node.isRequired,direction:r.PropTypes.oneOf(["top","right","bottom","left"]).isRequired},render:function(){var e="tooltip "+this.props.direction;return r.createElement("div",{className:e},this.props.body)}});e.exports=i},function(e,t,n){"use strict";var r=n(6),i=n(799),o=n(800),a=n(834),s=r.createClass({displayName:"UserSubtitle",mixins:[i],propTypes:{presence:r.PropTypes.instanceOf(a),placeholder:r.PropTypes.node,location:r.PropTypes.oneOf(["list","title"])},getInitialState:function(){return{hasData:this.async("presence.hasData"),type:this.async("presence.chatstate.type"),deny:this.async("presence.chatstate.deny"),t:this.async("presence.chatstate.t"),forceDisplay:this.async("presence.forceDisplay"),withholdDisplay:this.async("presence.withholdDisplay")}},render:function(){var e,t=this.props.presence;return"list"===this.props.location?(e=t.getFormattedString(),e?r.createElement(o,{ellipsify:!0,titlify:!0,text:e}):null):(e=t.withholdDisplay?this.props.placeholder:t.getFormattedString()||(t.forceDisplay?"":this.props.placeholder),e?r.createElement("div",{className:"chat-status ellipsify"},r.createElement(o,{ellipsify:!0,titlify:!0,text:e})):null)}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(7),a=n(801),s=n(879),c=n(878),l=n(81),u=n(153),d=n(58),p=n(158),h=n(799),f=n(9),m=n(347),g=n(21),v=n(103),y=n(835),E=n(822),b=n(951),w=n(80),S=n(849),T=n(901),C=n(900),M=n(827),N=n(105),k=N.HotKeys,x=n(950),P=r.createClass({displayName:"ComposeBox",mixins:[l,u,p,h],propTypes:{chat:r.PropTypes.instanceOf(a).isRequired,onPageUpDown:r.PropTypes.func.isRequired},getInitialState:function(){var e=this.props.chat;return this.text=e.composeText||"",this.selection=e.composeSel,{trusted:this.async("chat.trusted"),hasText:this.hasText(),emojiExpanded:!1,recording:!1}},componentWillMount:function(){var e=this.props.chat;e.unset("composeText"),e.unset("composeSel"),this.regCmd("focus_chat_text_input_"+this.props.chat.id,this.focusEmojiInput),this.regCmd("focus_chat_text_input",this.uimFocus),this.regCmd("paste_chat_text_input_"+this.props.chat.id,this.pasteEmojiInput),this.regCmd("enter_chat_text_input_"+this.props.chat.id,this.onSendText)},focusEmojiInput:function(){this.refs.input&&this.refs.input.restoreFocus(!0)},pasteEmojiInput:function(e){this.refs.input&&(this.refs.input.restoreFocus(!0),this.refs.input.pasteText(e))},componentWillUnmount:function(){var e=this.props.chat;e.set("composeText",this.text),e.set("composeSel",this.selection)},componentDidMount:function(){this.height=i.findDOMNode(this.refs.input).clientHeight},uimFocus:function(){this.refs.input&&this.refs.input.restoreFocus(!1)},uimClose:function(){this.state.emojiExpanded!==!1&&(this.setState({emojiExpanded:!1}),f.composeHeightChange())},onMaxPasteExceeded:function(){f.openModal(r.createElement(m,{title:l10n.t("message_too_large_title"),onOK:f.closeModal.bind(f),okText:l10n.t("web_ok")},l10n.t("message_too_large_text")))},onChange:function(e){var t=i.findDOMNode(this.refs.input),n=t.clientHeight,r=n-this.height;r&&f.composeHeightChange(r),this.height=n;var o=this.hasText();this.text=e.target.value;var a=this.hasText();a!==o&&this.setState({hasText:a}),a?(this.props.chat.presence.subscribe()["catch"](g.WapDrop,_.noop),this.props.chat.markComposing()):this.props.chat.markPaused()},onSelectionChange:function(e){this.selection=e},onFocus:function(){d.stealFocus(d.COMPOSE_INPUT)},onPaste:function(e){var t=e.clipboardData.items,n=_.filter(t,function(e){var t=y.typeFromMimetype(e.type);return"file"===e.kind&&("image"===t||"video"===t)}).map(function(e){return e.getAsFile()});if(n.length){e.preventDefault();var i=_.reject(t,{kind:"string",type:"text/html"});return void(i.length===n.length&&f.openDrawer(r.createElement(E,{files:n,chat:this.props.chat,type:d.DRAWER_MID}),"slide-up"))}},indicateFocus:function(e){if(!(Date.now()-(k.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.input_hotkey);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#ffffff","#D9F3FF"],borderColor:["#ffffff","#CBE4EF"]},{duration:1300,easing:[.24,.91,.01,.99]})}},onMouseDown:function(e){d.stealFocus(d.COMPOSE_INPUT),e.defaultPrevented&&this.refs.input.restoreFocus(!1)},onPageUpDown:function(e){if(this.props.onPageUpDown){e.stopPropagation(),this.props.onPageUpDown(e);var t=this.refs.input;this.safeDefer(function(){t.restoreFocus(!0)})}},maybeFocusChatSearch:function(e){e.repeat||this.refs.input.isAtBeginning()&&(e.stopPropagation(),e.preventDefault(),k.flashFocus=Date.now(),f.focusChatSearch())},onKeyPress:function(e){return"Enter"!==e.key||e.shiftKey||e.ctrlKey?void 0:(this.onSendText(),void e.preventDefault())},hasText:function(){return P.hasText=this.text.trim().length>0},onSendText:function(){if(this.hasText()){var e=this.text;if(this.text="",delete this.selection,this.forceUpdate(),w.supportsFeature(w.F.RICH_TEXT)){var t=S.parse(e,[new M,new C]);e=S.serialize(t,new T)}this.props.chat.sendMessage(e),this.closeEmojiPanel()}},handleEmoji:function(e){this.refs.input.replaceSelection(e)},openEmojiPanel:function(){this.state.emojiExpanded!==!0&&(this.setState({emojiExpanded:!0}),f.composeHeightChange(),this.uimPush(this,d.EMOJI,{escapable:!0}))},closeEmojiPanel:function(){this.state.emojiExpanded!==!1&&this.uimPop(d.EMOJI)},onPTT:function(e){e===x.REC?this.setState({recording:!0}):this.setState({recording:!1})},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.refs.input.restoreFocus(!1)},render:function(){var e=this.props.chat,t=this.state.emojiExpanded?r.createElement("button",{className:"icon icon-hide btn-emoji",onClick:this.closeEmojiPanel}):r.createElement("button",{className:"icon icon-smiley btn-emoji",onClick:this.openEmojiPanel}),n=this.state.emojiExpanded?r.createElement(s,{onEmoji:this.handleEmoji,key:"compose-emoji-panel"}):null,i="block-compose";this.state.recording&&(i+=" ptt-open");var a="input-container";this.state.recording&&(a+=" disabled");var l=null;l=navigator.getUserMedia&&window.AudioContext?this.hasText()?r.createElement("button",{className:"icon btn-icon icon-send send-container",onClick:this.onSendText}):r.createElement(x,{key:"ptt",chat:e,onStateChange:this.onPTT}):this.hasText()?r.createElement("button",{className:"icon btn-icon icon-send send-container",onClick:this.onSendText}):r.createElement("button",{className:"icon btn-icon icon-send send-container",onClick:this.onSendText,disabled:!0});var u={pagedown:this.onPageUpDown,pageup:this.onPageUpDown};u[l10n.LR("left","right")]=this.maybeFocusChatSearch;var p=l10n.t("type_a_message"),h=w.supportsFeature(w.F.SPAM)?r.createElement(b,{chat:this.props.chat}):null;return r.createElement(k,{component:"footer",handlers:u,className:"pane-footer pane-chat-footer",onMouseDown:this.preventBlur,onContextMenu:this.preventBlur},h,r.createElement(v,{transitionName:"emoji"},n),r.createElement("div",{className:i},t,r.createElement(k,{ref:"input_hotkey",className:a,"data-ignore-capture":d.IGNORE_ANY,onFocus:this.indicateFocus},r.createElement(c,{placeholder:p,editable:!this.state.recording,ref:"input",value:this.text,spellCheck:!0,selection:this.selection,multiline:!0,maxLength:o.MAX_TXT_MSG_SIZE,maxPaste:o.MAX_TXT_MSG_SIZE,onMaxPasteExceeded:this.onMaxPasteExceeded,onKeyPress:this.onKeyPress,onPaste:this.onPaste,onMouseDown:this.onMouseDown,onChange:this.onChange,onFocus:this.onFocus,onSelectionChange:this.onSelectionChange})),l))}});e.exports=P},function(e,t,n){"use strict";function r(e,t){var n=[];return n.push(a.createElement(c,{key:"info",action:function(){return s.groupInfoDrawer(e)},shortcut:"i"},l10n.t("web_group_info"))),n.push(a.createElement(c,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&n.push(a.createElement(l,{key:"mute",onMute:function(t){return s.muteChat(e,t)},chat:e})),e.canClear()&&n.push(a.createElement(c,{key:"clear",shortcut:"e",action:function(){return s.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(a.createElement(u,{key:"delete",onDeleteOrExit:function(){return s.deleteOrExitChat(e)},chat:e})),n}function i(e,t){var n=[];return n.push(a.createElement(c,{key:"info",action:function(){return s.broadcastInfoDrawer(e)},shortcut:"i"},l10n.t("web_list_info"))),n.push(a.createElement(c,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.canClear()&&n.push(a.createElement(c,{key:"clear",shortcut:"e",action:function(){return s.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(a.createElement(u,{key:"delete",onDeleteOrExit:function(){return s.deleteOrExitChat(e)},chat:e})),n}function o(e,t){var n=[];return n.push(a.createElement(c,{key:"info",a8n:"mi-contact",action:function(){return s.contactInfoDrawer(e)},shortcut:"i"},l10n.t("web_contact_info"))),n.push(a.createElement(c,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&n.push(a.createElement(l,{key:"mute",onMute:function(t){return s.muteChat(e,t)},chat:e})),e.canClear()&&n.push(a.createElement(c,{key:"clear",shortcut:"e",action:function(){return s.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(a.createElement(u,{key:"delete",onDeleteOrExit:function(){return s.deleteOrExitChat(e)},chat:e})),n}var a=n(6),s=n(9),c=n(806),l=n(871),u=n(868);e.exports={group:r,contact:o,broadcast:i}},function(e,t,n){"use strict";var r=n(6),i=n(800),o=n(877),a=n(798),s=r.createClass({displayName:"Caption",propTypes:{msg:r.PropTypes.instanceOf(a).isRequired},render:function(){var e=this.props.msg;return r.createElement("div",{className:"image-caption message-text","data-id":e.id},r.createElement(o,{msg:e}),r.createElement(i,{direction:"auto",selectable:!0,text:e.caption,linkify:!0,format:!0}))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(798),o=n(154),a=r.createClass({
displayName:"HiddenText",propTypes:{msg:r.PropTypes.instanceOf(i).isRequired},render:function(){var e=this.props.msg,t=e.senderObj.formattedUser,n="["+o.timeStr(e.t)+"]";return r.createElement("span",{className:"message-pre-text"},"⁠⁠",n," ",t,": ⁠⁠⁠")}});e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(81),o=n(104),a=n(153),s=n(353),c=n(902),l=n(47),u=n(713),d=n(58),p=n(46),h=r.createClass({displayName:"EmojiInput",mixins:[i,o,a],propTypes:{focusOnMount:r.PropTypes.bool,editable:r.PropTypes.bool,value:r.PropTypes.string,selection:r.PropTypes.object,className:r.PropTypes.string,placeholder:r.PropTypes.string,onKeyPress:r.PropTypes.func,onEnter:r.PropTypes.func,onChange:r.PropTypes.func,onFocus:r.PropTypes.func,onBlur:r.PropTypes.func,onMouseDown:r.PropTypes.func,onSelectionChange:r.PropTypes.func,maxLength:r.PropTypes.number,showRemaining:r.PropTypes.bool,multiline:r.PropTypes.bool,spellCheck:r.PropTypes.bool},getDefaultProps:function(){return{editable:!0,value:""}},getInitialState:function(){return this.value=this.props.value||"",this.length=c.multibyteLength(this.value),this.selection=this.props.selection,null},componentWillMount:function(){this.debouncedSaveSelection=this.safeDebounce(this._saveSelection,0)},componentWillReceiveProps:function(e){if(e.value!==this.value&&(this.setNewValue(e.value||"",!1),this.updateDOM(),this.safeDefer(this.restoreFocus.bind(this,!0))),this.props.editable!==e.editable){var t=this.refs.input;t.contentEditable=e.editable,e.editable&&this._disableObjectResize()}},restoreFocus:function(e){if(this.props.editable){var t=this.refs.input;if(d.blurNode(t),d.focusNode(t),this.selection&&!e)this.restoreSelection(this.selection);else{var n=window.getSelection();n&&(n.selectAllChildren(t),n.collapseToEnd())}this.debouncedSaveSelection()}},componentDidMount:function(){this.props.focusOnMount&&this.safeDefer(this.restoreFocus),this.props.editable&&this._disableObjectResize(),this.setRemaining(),this.refs.input.restoreFocus=this.restoreFocus},componentWillUnmount:function(){this.refs.input.restoreFocus=null},_disableObjectResize:function(){l.isGecko&&document.execCommand("enableObjectResizing",!1,!1)},limitLength:function(e){var t=this.props.maxLength;if(!t)return e;e=e||"";var n=this.selectionLength(),r=n+t-c.multibyteLength(this.value);return r>0?c.multibyteSubstr(e,0,r):""},onMouseDown:function(e){e.stopPropagation(),this.regNativeListener(window,"mouseup",this.onWindowMouseUp),this.props.onMouseDown&&this.props.onMouseDown(e)},onWindowMouseUp:function(){this.unregNativeListener(window,"mouseup",this.onWindowMouseUp),this.debouncedSaveSelection()},onContextMenu:function(e){e.stopPropagation()},onKeyUp:function(e){if(l.isTrident&&this.onInput(e),"Backspace"===e.key||"Delete"===e.key){var t=this.refs.input;switch(t.innerHTML){case"\n":case"\r\n":case"<br>":t.innerHTML="",this.setNewValue("",!0,!0)}}this.debouncedSaveSelection()},onKeyPress:function(e){if(l.isTrident&&this.onInput(e),!this.props.onKeyPress||(this.props.onKeyPress(e),!e.defaultPrevented)){this.props.multiline||"Enter"!==e.key||(e.preventDefault(),this.props.onEnter&&this.props.onEnter(e));var t=this.limitLength(u.ucs2.encode([e.charCode]));t.length||e.preventDefault()}},onInput:function(e){var t=this.refs.input;e=_.isBoolean(e)?e:void 0,this.setNewValue(s.NodeToEmoji(t),!0,e)},setNewValue:function(e,t,n){if(e!==this.value||n){if(e&&!this.value){var r=this.refs.placeholder;r&&(r.style.display="none")}else if(this.value&&!e){var i=this.refs.placeholder;i&&(i.style.display="")}this.value=e,this.length=c.multibyteLength(e),t&&this.props.onChange&&this.props.onChange({target:{value:e}}),this.setRemaining(),this.debouncedSaveSelection()}},setRemaining:function(){this.props.showRemaining&&this.props.maxLength&&(this.refs.counter.innerHTML=this.props.maxLength-this.length)},updateDOM:function(){var e=s.emojiToHTML(_.escape(this.value)),t=this.refs.input;t.innerHTML!==e&&(t.innerHTML=e),this.setRemaining()},selectionLength:function(){if(!this.props.editable)return 0;var e=this.refs.input;d.focusNode(e);var t=window.getSelection();if(t.rangeCount){var n=t.getRangeAt(0);return c.multibyteLength(s.NodeToEmoji(n.cloneContents()))}return 0},_saveSelection:function(){var e=this.getSelection();_.isEqual(e,this.prevSelection)||(this.props.onSelectionChange&&this.props.onSelectionChange(e),this.prevSelection=this.selection,this.selection=e)},isCollapsed:function(){if(this.isMounted()){var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection();return t.isCollapsed}},getCursor:function(){if(!this.isMounted())return-1;var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection(),n=t.anchorNode,r=t.anchorOffset,i=e.childNodes,o=0;e===n&&(n=i[r]);for(var a=0;a<i.length;a++){var s=i[a];if(s===n)return o+r;s.nodeType===window.Node.ELEMENT_NODE&&s.alt?o+=s.alt.length:s.nodeType===window.Node.TEXT_NODE&&(o+=s.length)}return o},isAtBeginning:function(){return this.isCollapsed()&&0===this.getCursor()},isAtEnd:function(){return this.isCollapsed()&&this.getCursor()===this.value.length},getSelection:function(){if(!this.isMounted())return null;var e=this.refs.input;if(document.activeElement!==e)return null;for(var t=window.getSelection(),n=t.anchorNode,r=t.anchorOffset,i=t.focusNode,o=t.focusOffset,a=e.childNodes,s=-1,c=-1,l=!1,u=!1,d=0;d<a.length;d++){var p=a[d];if(p===n&&(s=d,l=!0),p===i&&(c=d,u=!0),l&&u)break}return{anchor:{index:s,offset:r},focus:{index:c,offset:o}}},restoreSelection:function(e){var t,n,r,i,o,a,s=this.refs.input,c=s.childNodes;-1===e.anchor.index?(t=s,r=e.anchor.offset,o=0):(t=c[e.anchor.index],r=e.anchor.index,o=e.anchor.offset),-1===e.focus.index?(n=s,i=e.focus.offset,a=0):(n=c[e.focus.index],i=e.focus.index,a=e.focus.offset);var u;u=r===i?a>=o?"forward":"reverse":r>i?"reverse":"forward";var d=window.getSelection();if(t&&n)try{var p=document.createRange();return void(l.isTrident?("forward"===u?(p.setStart(t,e.anchor.offset),p.setEnd(n,e.focus.offset)):(p.setStart(n,e.focus.offset),p.setEnd(t,e.anchor.offset)),d.removeAllRanges(),d.addRange(p)):(p.setStart(t,e.anchor.offset),d.removeAllRanges(),d.addRange(p),d.extend(n,e.focus.offset)))}catch(h){d.selectAllChildren(s),d.collapseToEnd()}else d.selectAllChildren(s),d.collapseToEnd()},onCut:function(e){l.isTrident&&this.onInput(e)},onPaste:function(e){if(this.props.onPaste&&this.props.onPaste(e),!e.defaultPrevented){e.preventDefault();var t=l.isTrident?"text":"text/plain",n=e.clipboardData.getData(t);this.pasteText(n)}},pasteText:function(e){e&&(this.props.maxPaste&&e.length>this.props.maxPaste?this.props.onMaxPasteExceeded():this.replaceSelection(e))},replaceSelection:function(e){if(this.props.editable&&(d.focusNode(this.refs.input),e=this.limitLength(e),0!==e.length)){this.props.multiline||(e=e.replace(/\n+/g," ").replace(/(\r\n)+/g," "));var t=window.getSelection(),n=null;t.getRangeAt&&t.rangeCount&&(n=t.getRangeAt(0),n.deleteContents());var r=this.refs.input,i=r.scrollTop,o=r.scrollHeight,a=s.emojiToHTML(_.escape(e));l.isTrident?n&&this.replaceSelectionTrident(a,t,n):document.execCommand("insertHTML",!1,a),this.onInput(!0),this.debouncedSaveSelection(),this.scrollToCursor(i,o)}},scrollToCursor:function(e,t){var n=this.refs.input,r=n.scrollHeight,i=n.clientHeight;if(!(i>=r)){var o=r-t;this.refs.input.scrollTop=(e||0)+o}},replaceSelectionTrident:function(e,t,n){var r=document.createElement("div");r.innerHTML=e;for(var i,o,a=document.createDocumentFragment();i=r.firstChild;)o=a.appendChild(i);n.insertNode(a),o&&(n=n.cloneRange(),n.setStartAfter(o),n.collapse(!0),t.removeAllRanges(),t.addRange(n))},shouldComponentUpdate:function(){return!1},render:function(){var e=s.emojiToHTML(_.escape(this.value)),t=this.props.className?"input "+this.props.className:"input",n=this.props.showRemaining?r.createElement("span",{className:"input-counter",ref:"counter"}):null,i=p("input-emoji",{"input-remaining":this.props.showRemaining}),o=this.props.placeholder&&!this.props.value?r.createElement("div",{className:"input-placeholder",ref:"placeholder"},this.props.placeholder):null;return r.createElement("div",{className:i},o,r.createElement("div",{dangerouslySetInnerHTML:{__html:e},dir:"auto",ref:"input",spellCheck:this.props.spellCheck,"data-tab":this.props.editable?1:null,contentEditable:this.props.editable,className:t,onInput:this.onInput,onPaste:this.onPaste,onCut:this.onCut,onKeyUp:this.onKeyUp,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onFocus:this.props.onFocus,onBlur:this.props.onBlur}),n)}});e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(14),o=n(102),a=n(104),s=n(153),c=n(81),l=n(353),u=n(1009),d=n(800),p=n(9),h=n(806),f=n(354),m=n(58),g=n(103),v={RECENT:"Recent",SMILEYS_PEOPLE:"Smileys & People",ANIMALS_NATURE:"Animals & Nature",FOOD_DRINK:"Food & Drink",ACTIVITY:"Activity",TRAVEL_PLACES:"Travel & Places",OBJECTS:"Objects",SYMBOLS:"Symbols",FLAGS:"Flags"},y=["Recent","Smileys & People","Animals & Nature","Food & Drink","Activity","Travel & Places","Objects","Symbols","Flags"],E=[""].concat(l.skinToneVariations),b=r.createClass({displayName:"EmojiPanel",propTypes:{onEmoji:r.PropTypes.func.isRequired},getInitialState:function(){var e=Store.RecentEmoji.length>0?v.RECENT:v.SMILEYS_PEOPLE,t=i.getLastEmojiTab();return y.indexOf(t)>-1&&(e=t),{selected:e}},componentWillUnmount:function(){i.setLastEmojiTab(this.state.selected)},onSelectTab:function(e){var t=y.indexOf(this.state.selected),n=y.indexOf(e),r=n>t?"right":"left";this.setState({selected:e,direction:r})},onEmoji:function(e){this.props.onEmoji(e),Store.RecentEmoji.increment(e)},render:function(){var e=r.createElement("div",{className:"emoji-panel-body",key:"emoji-"+this.state.selected},r.createElement(w,{tab:this.state.selected,onEmoji:this.onEmoji})),t=[{css:"icon-emoji-recent",tab:v.RECENT},{css:"icon-emoji-people",tab:v.SMILEYS_PEOPLE},{css:"icon-emoji-nature",tab:v.ANIMALS_NATURE},{css:"icon-emoji-food",tab:v.FOOD_DRINK},{css:"icon-emoji-activity",tab:v.ACTIVITY},{css:"icon-emoji-travel",tab:v.TRAVEL_PLACES},{css:"icon-emoji-objects",tab:v.OBJECTS},{css:"icon-emoji-symbols",tab:v.SYMBOLS},{css:"icon-emoji-flags",tab:v.FLAGS}],n=this;t=t.map(function(e){var t=r.createElement("button",{className:"menu-item"+(n.state.selected===e.tab?" active":""),onClick:n.onSelectTab.bind(null,e.tab),key:e.tab,title:e.tab},r.createElement("span",{className:"icon "+e.css}));return t});var i=l10n.isRTL()?-1:1,o={width:100/y.length+"%",transform:"translateX("+100*y.indexOf(this.state.selected)*i+"%)"},a="right"===this.state.direction?"slide-forward":"slide-back";return r.createElement("div",{className:"emoji-panel k"},r.createElement("div",{className:"menu-tabs menu-tabs-emoji emoji-panel-header","data-active-tab":this.state.selected},r.createElement("div",{style:o,className:"menu-tabs-marker"}),t),r.createElement(g,{transitionName:a},e))}});e.exports=b;var w=r.createClass({displayName:"EmojiTab",mixins:[o,s,a,c],propTypes:{tab:r.PropTypes.oneOf(y).isRequired,onEmoji:r.PropTypes.func.isRequired},getInitialState:function(){return this.props.tab===v.RECENT?{recent:Store.RecentEmoji.models.map(function(e){return l.emojiMap[e["char"]]}),variants:{}}:void 0},componentDidMount:function(){var e=this;this.addObserver(Store.EmojiVariant,"add remove change:variant",function(){e.forceUpdate()})},componentWillUnmount:function(){m.popDependents(this)},onEmoji:function(e){m.popDependents(this),this.props.onEmoji(e)},setEmojiVariant:function(e,t){if(this.onEmoji(t),Store.EmojiVariant.setVariant(e,t),this.state.recent){var n=this.state.variants;n[e]=t,this.setState({variants:n})}return m.pop(m.TOOLTIP),!0},onContextMenu:function(e,t,n){this.clearPickerTimer(),e&&(e.preventDefault(),e.stopPropagation());var i=this.setEmojiVariant,o=l.skinToneEmojis[t],a=E.map(function(e,n){var a=o+e;return r.createElement(h,{key:a,action:_.partial(i,t,a)},r.createElement(d,{text:a,emojiSize:d.EMOJI_SIZE.LARGE}))});p.openTooltip(a,{anchor:n||e.target,type:f.Type.PICKER,parent:this,menuDirection:{x:f.Direction.X.RIGHT,y:f.Direction.Y.TOP}})},clearPickerTimer:function(){this.pickerTimer&&(this.unregNativeListener(window,"mouseup",this.clearPickerTimer,!0),this.clearSafeTimeout(this.pickerTimer),this.pickerTimer=null)},eatClick:function(e){e.preventDefault(),e.stopPropagation(),this.unregCmd("window_click",this.eatClick)},startPickerTimer:function(e,t){this.clearPickerTimer();var n=e.target;this.pickerTimer=this.safeDelay(function(){this.regCmd("window_click",this.eatClick),this.onContextMenu(null,t,n)},250),this.regNativeListener(window,"mouseup",this.clearPickerTimer,!0)},getEmoji:function(){var e=this.onContextMenu,t=this.startPickerTimer,n=this.onEmoji,i=this.state.recent?this.state.recent:u[this.props.tab];return i.map(function(i){var o,a,s,c=l.codeToEmoji[i];if(l.skinToneEmojis[c]){a=function(t){e(t,c,t.target)},s=_.partial(t,_,c);var u;this.state.recent?(u=this.state.variants[c],u?(i=l.emojiMap[u],o=_.partial(n,u)):o=_.partial(n,c)):(u=Store.EmojiVariant.getVariant(c),u?(i=l.emojiMap[u],o=_.partial(n,u)):o=a)}else o=_.partial(n,c);return r.createElement("span",{key:c,onClick:o,onContextMenu:a,onMouseDown:s,className:"emojik emoji"+i})}.bind(this))},render:function(){var e="emoji-"+this.props.tab;return r.createElement("div",{className:e},this.getEmoji())}})},function(e,t,n){"use strict";var r=n(6),i=n(9),o=n(104),a=n(976),s=r.createClass({displayName:"MediaViewerFlow",mixins:[o],propTypes:{startId:r.PropTypes.string.isRequired,getZoomNode:r.PropTypes.func},getInitialState:function(){this.zoomIn=!0;var e=Store.Msg.get(this.props.startId);if(e.msgChunk){var t=e.msgChunk.filter(function(e){return e.isMedia}),n=t.indexOf(e);return{mediaMsgs:t,index:n}}return{mediaMsgs:[e],index:0}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown)},componentDidMount:function(){this.zoomIn=!1},onKeyDown:function(e){37===e.keyCode?this.onPrev():39===e.keyCode&&this.onNext()},onNext:function(e){e&&e.stopPropagation(),this.state.index<this.state.mediaMsgs.length-1&&this.setState({index:this.state.index+1})},onPrev:function(e){e&&e.stopPropagation(),this.state.index>0&&this.setState({index:this.state.index-1})},endFlow:function(){i.closeModalMedia()},render:function(){var e=void 0,t=void 0;return(t=this.state.mediaMsgs[this.state.index])&&(e=r.createElement(a,{msg:t,onBack:this.endFlow,onNext:this.onNext,onPrev:this.onPrev,getZoomNode:this.props.getZoomNode,zoomIn:this.zoomIn})),r.createElement("div",null,e)}});e.exports=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(21),c=n(104),l=n(153),u=n(814),d=n(7),p=n(9),h=n(821),f=n(826),m=n(895),g=n(802),v=n(804),y=n(803),E=n(107),b=n(809),w=n(103),S=n(819),T=n(58),C=n(811),M=function(e){return 150+15*e},N=400,k="image",x="video",P="url",D="invalid",A={ACTIVE:"active",PROCESSING:"processing",INVALID:"invalid"},I=1,R=a.createClass({displayName:"AttachMediaDrawer",mixins:[c,l,u],propTypes:{files:a.PropTypes.array,state:a.PropTypes.oneOf(_.values(A)),onBack:a.PropTypes.func.isRequired,onSendMedia:a.PropTypes.func.isRequired,onDropText:a.PropTypes.func.isRequired},statics:{STATE:A},getDefaultProps:function(){return{state:A.PROCESSING,reason:null,isDragging:!1}},getInitialState:function(){return{state:this.props.state,activeIndex:-1,media:[]}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown),this.regNativeListener(window,"drop",this.onWindowDrop)},componentDidMount:function(){if(this.props.files){var e=this;this.safeDelay(function(){e.initialize()},300)}},componentWillUnmount:function(){this.state.media&&this.state.media.forEach(function(e){var t=e.url;t&&window.URL.revokeObjectURL(t)})},componentDidUpdate:function(){this.state.state!==A.INVALID&&this.state.reason&&this.setState({reason:null})},initialize:function(){var e=this,t=this.props.files;t=t.slice(0,Math.min(t.length,d.MAX_FILES)),this.processFiles(t).checkpoint(this.rejectOnUnmount()).then(function(t){var n=e.state.media.concat(t);e.setState({prevIndex:void 0,activeIndex:Math.min(e.state.media.length,9),media:n,state:A.ACTIVE})})["catch"](s.Unmount,_.noop)["catch"](function(t){e.setState({state:A.INVALID,activeIndex:-1,reason:t,prevIndex:void 0})})},getFileType:function(e){var t=e.type;return t.match(/url/)?P:t.match(/^image\/.*/)?k:t.match(/^video\/.*/)?x:D},processFiles:function(e){return this.setState({state:A.PROCESSING}),o["default"].map(_.map(e,function(e){return f.prepFileForUpload(e)["catch"](s.InvalidMediaFileType,function(e){return e})}),function(e){if(!e.msgType)return e;if(e.msgType!==k&&e.msgType!==x)return new s.InvalidMediaFileType;var t=I++,n=window.URL.createObjectURL(e.blob);return e.getThumb?e.getThumb.then(function(r){var i=r.url;return{media:e,uniqKey:t,url:i,preview:n}}):{media:e,uniqKey:t,url:"",preview:n}})},onDragOver:function(e){this.state.isDragging||this.setState({isDragging:!0})},onWindowDrop:function(e){_.isEmpty(this.props.files)&&_.isEmpty(this.state.media)&&this.props.onBack()},onDrop:function(e){this.setState({isDragging:!1}),this.onFilePick(e)},onDragLeave:function(e){this.state.media.length||this.props.onBack(),this.setState({isDragging:!1})},onKeyDown:function(e){if(this.state.state!==A.INVALID&&!e.repeat)if(37===e.keyCode){var t=this.state.media[this.state.activeIndex],n=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(t&&!t.media.caption||n&&n.isAtBeginning())&&this.onPrev()}else if(39===e.keyCode){var r=this.state.media[this.state.activeIndex],i=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(r&&!r.media.caption||i&&i.isAtEnd())&&this.onNext()}},onNext:function(){this.state.activeIndex+1<this.state.media.length&&this.setState({prevIndex:this.state.activeIndex,activeIndex:this.state.activeIndex+1,state:A.ACTIVE})},onPrev:function(){this.state.activeIndex>0&&this.setState({prevIndex:this.state.activeIndex,activeIndex:this.state.activeIndex-1,state:A.ACTIVE})},onSelectThumb:function(e,t){e!==this.state.activeIndex&&this.setState({prevIndex:this.state.activeIndex,activeIndex:e,state:A.ACTIVE})},onSend:function(){this.props.onSendMedia(_.map(this.state.media,function(e){var t=e.media;return t.caption=C.emojify(t.caption),t}))},onAddFileClick:function(e){var t=this.refs.input;t.click()},onFilePick:function(e){var t=this,n=e.type;m.getFiles(e,this.state.media.length).then(this.processFiles).checkpoint(this.rejectOnUnmount()).then(function(e){var r=t.state.media.concat(e),i=_.reject(r,function(e){return e instanceof Error}),o=r.length-i.length;if(o>0){var s="drop"===n?l10n.t("invalid_partial_dropped_media_files",{number:o,_plural:o}):l10n.t("invalid_partial_selected_media_files",{number:o,_plural:o});p.openToast(a.createElement(b,{msg:s,id:b.genId()}))}t.setState({prevIndex:void 0,activeIndex:Math.min(t.state.media.length,9),media:i,state:A.ACTIVE})})["catch"](s.Unmount,_.noop)["catch"](s.MediaDragDropError,function(e){if(t.state.media.length)throw e;t.props.onDropText(e.src)})["catch"](function(e){t.setState({state:A.INVALID,activeIndex:-1,reason:e,prevIndex:void 0})}),e.target.value=""},onRemoveThumb:function(e,t){t.stopPropagation(),t.preventDefault();var n=this.state.media;n.splice(e,1);var r=this.state.activeIndex;r>=e&&(r=Math.max(--r,0)),this.setState({prevIndex:void 0,activeIndex:n.length?r:-1,media:n})},onCaptionChange:function(e){var t=this.state.media;t[this.state.activeIndex].media.caption=e.target.value,this.setState({media:t})},render:function(){var e,t,n,r=this,i=0,o="media-scale",c=this.state.activeIndex;if(this.state.state===A.PROCESSING)e=a.createElement(E,{key:"processing"});else if(this.state.state===A.ACTIVE&&c>-1){var l=this.state.media[c],u=l.media.msgType,p=l.media.width&&l.media.height?{width:l.media.width,height:l.media.height}:null;switch(u){case k:e=a.createElement("img",{src:l.preview,className:"media-viewer-img"});break;case x:e=a.createElement("video",{controls:!0,className:"media-viewer-img",type:x,src:l.preview})}e=a.createElement("div",{className:"media-body-container",key:this.state.media[c].key},a.createElement("div",{className:"media-element-container"},a.createElement("div",{className:"media-element"},a.createElement(h,{type:h.TYPES.SCALE_DOWN,size:p},e))),a.createElement("div",{className:"media-caption"},a.createElement(S,{id:T.CAPTION_INPUT,ref:"emojiInput",editable:!0,value:this.state.media[c].media.caption,floating:!1,maxLength:d.MAX_CAPTION_LENGTH,showRemaining:!0,placeholder:l10n.t("add_a_caption"),onEnter:this.onSend,onChange:this.onCaptionChange}))),_.isNumber(this.state.prevIndex)&&this.state.prevIndex!==c&&(o=this.state.prevIndex<c?"media-slide-forward":"media-slide-back")}else if(this.state.state===A.INVALID){var f,m=this.state.reason;if(m instanceof s.MediaFileTooLarge)switch(this.getFileType(m.file)){case k:f=l10n.t("image_too_big");break;case x:f=l10n.t("video_too_big")}f=f||l10n.t("invalid_media_files"),e=a.createElement("div",{className:"invalid-media-container",key:"pending"},a.createElement("div",{className:"invalid-media"},f))}this.state.media.length>0&&(t=this.state.media.map(function(e,t){var n="media-thumb stagger-delay";t===r.state.activeIndex&&(n+=" active");var i=Math.max(r.state.media.length-r.state.activeIndex-1,1),o=M(t)/i*Math.max(0,t-r.state.activeIndex)+"ms",s={backgroundImage:"url("+e.url+")"};return a.createElement("div",{className:n,key:"media-"+e.uniqKey,onClick:r.onSelectThumb.bind(null,t),staggerDelay:o},a.createElement("span",{className:"btn-delete icon icon-x-alt-light",onClick:r.onRemoveThumb.bind(null,t)}),a.createElement("div",{className:"media-thumb-body",style:s}))}),i=1===this.state.media.length?N:N+M(this.state.media.length),n=a.createElement("div",{className:"drawer-controls"},a.createElement("button",{className:"btn btn-round btn-l","data-ignore-capture":T.IGNORE_ANY,onClick:this.onSend},a.createElement("span",{className:"icon icon-send-light"}))));var b=this.state.isDragging?a.createElement("div",{key:"container",className:"drag-drop"},a.createElement("div",{className:"stitching"},l10n.t("drag_media_here"))):null,C=this.state.media.length<d.MAX_FILES?a.createElement("div",{key:"media-more",className:"media-thumb btn-add-media",onClick:this.onAddFileClick},a.createElement("button",{className:"btn-fill"},a.createElement("span",{className:"icon icon-add-alt"}),l10n.t("add_media"))):null;return a.createElement(g,{key:"attach-image-modal",ref:"container",position:"right",id:"media",variant:"noheader",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},a.createElement(v,{title:l10n.t("web_preview_msg"),type:v.Type.OFFSET,onCancel:this.props.onBack}),a.createElement(y,null,b,a.createElement("div",{className:"media-body"},a.createElement(w,{transitionName:o},e)),a.createElement(w,{transitionName:"thumb-scale",className:"media-collection"},t,C),a.createElement(w,{transitionName:"btn",delay:i},n),a.createElement("input",{ref:"input",type:"file",accept:d.IMAGE_MIMES+","+d.VIDEO_MIMES,style:{display:"none"},onChange:this.onFilePick,multiple:!0})))}});e.exports=R},function(e,t,n){"use strict";var r=n(6),i=n(102),o=n(9),a=n(801),s=n(154),c=n(846),l=n(807),u=n(812),d=n(802),p=n(803),h=n(818),f=n(805),m=n(58),g=n(837),v=r.createClass({displayName:"BroadcastInfoDrawer",mixins:[i],propTypes:{chat:r.PropTypes.instanceOf(a).isRequired},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove sort reset")},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){o.openChat(e)})},onClose:function(){o.closeDrawer(this.props.type)},onDelete:function(){o.deleteOrExitChat(this.props.chat)},onViewPicture:function(e){var t=e.target,n=function(e){e(t)};o.openModalMedia(r.createElement(c,{contact:this.props.chat.contact,animateBorderRadius:!0,getZoomNode:n}),"profile-viewer")},render:function(){var e,t=this.props.chat,n=t.groupMetadata,i=this.onParticipantClick,o=n.participants.map(function(e){var t=Store.Contact.get(e.id)||Store.Contact.add({id:e.id});return r.createElement(u,{contact:t,admin:!!e.isAdmin,onClick:i,key:e.id})}),a=24,c=g.minHeight(o,a),v=o.length?r.createElement(h,{classes:"animate-enter1",title:l10n.t("web_recipients_title"),subtitle:l10n.n(o.length),style:c,expands:!0,"data-list-scroll-container":!0},r.createElement(l,{data:o,height:72,extraItems:4})):null;t.canDelete()&&(e=r.createElement(h,{classes:"animate-enter3 drawer-section-action"},r.createElement("div",{onClick:this.onDelete,className:"btn btn-danger"},l10n.t("web_delete_list"))));var y;return t.groupMetadata.creation?(y=s.timeStr(t.groupMetadata.creation),y=r.createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:y}))):y=null,r.createElement(d,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement("header",{className:"pane-header"},r.createElement("div",{className:"header-close"},r.createElement("button",{onClick:this.onClose,"data-ignore-capture":m.IGNORE_ANY},r.createElement("span",{className:"icon icon-x"}))),r.createElement("div",{className:"header-body"},r.createElement("div",{className:"header-main"},r.createElement("div",{className:"header-title"},l10n.t("broadcast_list_info")),y))),r.createElement(p,{expands:!!o.length},r.createElement(h,{classes:"drawer-scale drawer-section-photo"},r.createElement(f,{id:t.id,size:f.LARGE,onClick:this.onViewPicture})),v,e))}});e.exports=v},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(1),a=n(926),s=n(821),c=n(153),l=n(104),u=n(802),d=n(804),p=n(803),h=n(46),f=n(819),m=n(58),g=n(7),v=n(811),y=n(103),E={ANIMATING:"animating",LOADING:"loading",RECORDING:"active",SENDING:"sending"},b=r.createClass({displayName:"CaptureDrawer",mixins:[l,c],propTypes:{noContainer:r.PropTypes.bool,stream:r.PropTypes.object.isRequired,caption:r.PropTypes.bool,onBack:r.PropTypes.func.isRequired,onSend:r.PropTypes.func.isRequired},statics:{State:E},getInitialState:function(){return{state:E.ANIMATING,img:void 0,url:void 0}},componentDidMount:function(){this.safeDelay(function(){this.setState({state:E.LOADING,url:window.URL.createObjectURL(this.props.stream)})},300)},componentWillUnmount:function(){if(this.state.url){var e=this.props.stream;if(_.isFunction(e.stop))e.stop();else for(var t=e.getTracks(),n=0;n<t.length;n++)t[n].stop();window.URL.revokeObjectURL(this.state.url)}},onCapture:function(e){var t=document.createElement("canvas");if(this.refs.video){var n=i.findDOMNode(this.refs.video);t.height=n.videoHeight,t.width=n.videoWidth;var r=t.getContext("2d");r.translate(t.width,0),r.scale(-1,1),r.drawImage(n,0,0,n.videoWidth,n.videoHeight);var o=t.toDataURL("image/jpeg");this.setState({state:E.SENDING,img:o})}},onVideoLoaded:function(e){this.setState({state:E.RECORDING,videoSize:{width:e.target.videoWidth,height:e.target.videoHeight}})},onRetake:function(e){this.setState({state:E.RECORDING,caption:void 0})},onSend:function(e){this.props.onSend({file:window.dataURLtoBlob(this.state.img),caption:v.emojify(this.state.caption)})},onCaptionChange:function(e){this.setState({caption:e.target.value})},render:function(){var e,t,n,i;switch(this.state.state){case E.ANIMATING:break;case E.LOADING:case E.RECORDING:var c=h("capture-video media-viewer-img webcam",{"capture-video-inactive":this.state.state===E.LOADING});n=r.createElement("div",{key:"webcam"},r.createElement(s,{type:s.TYPES.COVER,size:this.state.videoSize},r.createElement(a,{className:c,autoPlay:!0,ref:"video",onPlay:this.onVideoLoaded,src:this.state.url}))),e=r.createElement("div",{className:"drawer-controls fade",key:"btn-capture"},r.createElement("button",{className:"btn btn-round btn-l",onClick:this.onCapture},r.createElement("span",{className:"icon icon-camera-light"})));break;case E.SENDING:var l={backgroundImage:"url("+this.state.img+")"};n=r.createElement("div",{key:"snapshot"},r.createElement(s,{type:s.TYPES.COVER,size:this.state.videoSize},r.createElement("div",{className:"capture-image snapshot",style:l})));var v=this.props.noContainer?"icon icon-checkmark-light-l":"icon icon-send-light";e=r.createElement("div",{className:"drawer-controls btn-send",key:"btn-send"},r.createElement("button",{className:"btn btn-round btn-l","data-ignore-capture":m.IGNORE_ANY,onClick:this.onSend},r.createElement("span",{className:v}))),t=r.createElement("div",{className:"drawer-header-action",onClick:this.onRetake},r.createElement("span",{className:"icon icon-refresh-light"}),l10n.t("retake")),i=r.createElement(f,{id:m.CAPTION_INPUT,ref:"emojiInput",editable:!0,value:this.state.caption,floating:!1,maxLength:g.MAX_CAPTION_LENGTH,showRemaining:!0,placeholder:l10n.t("add_a_caption"),onEnter:this.onSend,onChange:this.onCaptionChange});break;default:o.log("captureDrawer:render Unhandled video capture state "+this.state.state)()}var _=void 0;_=this.props.caption?r.createElement("div",{className:"media-collection"},r.createElement(y,{transitionName:"media-caption",className:"media-caption"},i),r.createElement(y,{transitionName:"pop_delay"},e)):r.createElement("div",{className:"media-collection-no-caption"},r.createElement(y,{transitionName:"pop_delay"},e));var b=this.props.noContainer?d.Type.POPUP:d.Type.OFFSET;return r.createElement(u,{key:"attach-capture-modal",position:"right",id:"capture",variant:"noheader",noContainer:this.props.noContainer},r.createElement(d,{title:l10n.t("take_photo"),type:b,onCancel:this.props.onBack},t),r.createElement(p,null,r.createElement("div",{className:"media-body"},r.createElement("div",{className:"media-body-container"},r.createElement(y,{transitionName:"capture"},n))),_))}});e.exports=b},function(e,t,n){"use strict";var r=n(6),i=n(799),o=n(153),a=n(814),s=n(102),c=n(9),l=n(807),u=n(846),d=n(820),p=n(802),h=n(803),f=n(818),m=n(805),g=n(923),v=n(800),y=n(21),E=n(58),b=n(156),w=n(837),S=n(22),T=r.createClass({displayName:"ContactInfoDrawer",mixins:[i,o,a,s],propTypes:{contact:r.PropTypes.instanceOf(b).isRequired},getInitialState:function(){return{status:this.async("contact.Status.status"),commonGroups:void 0}},componentDidMount:function(){this.safeDelay(function(){var e=this;this.props.contact.findCommonGroups().checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({commonGroups:t}),e.addObserver(Store.GroupMetadata,"group_participant_change",e.commonGroupsUpdate)})["catch"](y.Unmount,_.noop)["catch"](y.WapDrop,_.noop)["catch"](_.noop)},300)},commonGroupsUpdate:function(e){var t=this.state.commonGroups,n=this.props.contact.updateCommonGroups(t,e);n&&this.setState({commonGroups:n})},onDeleteChat:function(){var e=Store.Chat.get(this.props.contact.id);c.deleteOrExitChat(e)},onClose:function(){c.closeDrawer(this.props.type)},parseSelection:function(e){for(var t,n,r="",i=0;i<e.rangeCount;i++)for(n=document.createTreeWalker(e.getRangeAt(i).cloneContents(),window.NodeFilter.SHOW_ALL);n.nextNode();)t=n.currentNode,r+=t instanceof HTMLImageElement?t.alt:t.nodeValue?t.nodeValue:"";return r},onCopyPhone:function(e){var t=this.parseSelection(window.getSelection()),n="​",r="⁠",i=""+n+r+n;if(_.startsWith(t,i)){var o=t.match(new RegExp("^"+i+"(.*?)"+i));o&&o.length>1&&(t=_.last(o))}t=t.replace(new RegExp(""+i),""),e.clipboardData.setData("text/plain",t),e.stopPropagation(),e.preventDefault()},onViewPicture:function(e){if(this.canViewPicture){var t=e.target,n=function(e){e(t)};c.openModalMedia(r.createElement(u,{contact:this.props.contact,animateBorderRadius:!0,getZoomNode:n}),"profile-viewer")}},onDetailImageLoad:function(e){this.canViewPicture=!0},onClick:function(e,t){c.openChat(t),this.onClose()},render:function(){var e,t,n=this,i=this.props.contact,o=this.state.commonGroups;if(o=_.compact(_.values(o)),_.isArray(o)&&o.length){e=o.map(function(e){return r.createElement(d,{chat:e,mode:d.Mode.INFO,onClick:n.onClick,key:e.id})});var a=24,s=w.minHeight(o,a);e=r.createElement(f,{title:l10n.t("web_groups_participation_you_and_name"),subtitle:l10n.n(o.length),classes:"animate-enter drawer-section-list",
ref:"container",style:s,expands:!0,noContainer:!0},r.createElement("div",{className:"drawer-section-body drawer-section-body-expand chatlist",ref:"list","data-list-scroll-container":!0},r.createElement(l,{data:e,height:72,extraItems:4})))}var c=Store.Chat.get(i.id);_.isArray(o)&&c&&c.canDelete()&&(t=r.createElement(f,{classes:"animate-enter drawer-section-action"},r.createElement("div",{onClick:this.onDeleteChat,className:"btn btn-danger"},l10n.t("delete_chat"))));var u=this.state.status?r.createElement(f,{title:l10n.t("web_status"),classes:"animate-enter1"},r.createElement(v,{classes:"textfield-static",selectable:!0,direction:"auto",text:this.state.status})):null,y=null;return r.createElement(p,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement("header",{className:"pane-header"},r.createElement("div",{className:"header-close"},r.createElement("button",{onClick:this.onClose,"data-ignore-capture":E.IGNORE_ANY},r.createElement("span",{className:"icon icon-x"}))),r.createElement("div",{className:"header-body"},r.createElement("div",{className:"header-main"},r.createElement("div",{className:"header-title"},l10n.t("web_contact_info"))))),r.createElement(h,{expands:!!e},r.createElement(f,{classes:"drawer-scale drawer-section-photo"},r.createElement(m,{id:i.id,size:m.LARGE,loader:!0,onLoad:this.onDetailImageLoad,onClick:this.onViewPicture,quality:m.HIGH})),u,y,r.createElement(f,{title:l10n.t("web_contact_phone"),classes:"animate-enter2"},r.createElement(g,{className:"textfield-static selectable-text",onCopy:this.onCopyPhone,dir:"auto"},S.formattedUser(i.id))),e,t))}});e.exports=T},function(e,t,n){"use strict";var r=n(6),i=n(887),o=n(808),a=n(156),s=n(812),c=n(842),l=n(815),u=n(102),d=n(46),p=r.createClass({displayName:"ContactsModal",mixins:[u],propTypes:{title:r.PropTypes.string.isRequired,contacts:r.PropTypes.arrayOf(r.PropTypes.instanceOf(a)),filter:r.PropTypes.func,onCancel:r.PropTypes.func.isRequired,onSelect:r.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(e){return Store.Contact.isFilteredContact(e)}}},getInitialState:function(){return this.selection=new o([],function(e){return e.id}),{searchFilter:void 0}},componentWillMount:function(){this.props.contacts||this.addObserver(Store.Contact,"add remove change:name")},onSelect:function(e,t){var n=t.props.contact;this.props.filter(n)===!0&&this.props.onSelect(n)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this.props,t=e.title,n=e.onCancel,o=e.filter,a=e.onSelect,u=l10n.accentFold(this.state.searchFilter),p=this.props.contacts||Store.Contact,h=p.filter(function(e){return o(e)&&(!u||u&&e.searchMatch(u))}),f=[];if(h.length){this.selection.init(h.filter(function(e){return o(e)===!0}));for(var m=void 0,g=void 0,v=h.length>10,y=0;y<h.length;y++){m=h[y],v&&m.header!==g&&f.push(r.createElement(c,{key:m.header,header:m.header}));var E=_.isString(o(m)),b=void 0;y<h.length-1&&h[y+1].header!==m.header&&(b="last");var w=void 0;E&&(w=r.createElement("div",{className:"chat-status ellipsify",title:o(m)},o(m)),b=d(b,"member")),f.push(r.createElement(s,{contact:m,active:this.selection,className:b,secondary:w,onClick:E?void 0:a.bind(null,m),key:m.id})),g=m.header}}else f=r.createElement(l.SearchContacts,null);return r.createElement(i,{title:t,selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_contacts"),onSelect:this.onSelect,onCancel:n},f)}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(799),o=n(102),a=n(9),s=n(801),c=n(154),l=n(807),u=n(812),d=n(802),p=n(803),h=n(818),f=n(841),m=n(800),g=n(806),v=n(891),y=n(58),_=n(347),E=n(955),b=n(809),w=n(837),S=n(811),T=n(7),C=b.genId("max_participant_toast"),M=r.createClass({displayName:"GroupInfoDrawer",mixins:[i,o],propTypes:{chat:r.PropTypes.instanceOf(s).isRequired},getInitialState:function(){return{imgFull:this.async("chat.ProfilePicThumb.imgFull"),name:this.async("chat.contact.name")||"",isReadOnly:this.async("chat.isReadOnly"),pendingSubject:!1,pendingPhoto:!1}},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove reset sort change:isAdmin")},componentWillUnmount:function(){y.popDependents(this)},onImageSet:function(e,t){var n=Store.ProfilePicThumb.get(this.props.chat.id);this.setState({pendingPhoto:!0});var r;r=e&&t?n.setPicture(e,t):n.deletePicture(),r.bind(this).then(function(){this.isMounted()&&this.setState({pendingPhoto:!1})})},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){a.openChat(e)})},menuEnabled:function(e){var t=this.props.chat.groupMetadata.participants,n=t.get(e.id);return n&&(t.canPromote(n)||t.canRemove(n))},onParticipantMenu:function(e,t,n){var i=this.props.chat.groupMetadata.participants,o=i.get(t.id);if(this.menuEnabled(t)){var s=[];if(i.canPromote(o)){var c=this.confirmParticipantPromote.bind(this,o);s.push(r.createElement(g,{key:"promote",action:c},l10n.t("menuitem_make_group_admin")))}if(i.canRemove(o)){var l=this.confirmParticipantRemove.bind(this,o);s.push(r.createElement(g,{key:"remove",action:l,shortcut:"d"},l10n.t("menuitem_remove")))}a.openContextMenu(s,{parent:this,anchor:e.anchor,event:e.event,onClose:n})}},confirmParticipantRemove:function(e){var t=this.onParticipantRemove.bind(this,e),n=l10n.t("confirm_remove_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});a.openModal(r.createElement(_,{onOK:t,okText:l10n.t("remove"),onCancel:a.closeModal.bind(a),cancelText:l10n.t("web_cancel")},r.createElement(m,{text:n})))},onParticipantRemove:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.removeParticipant(e).then(function(){e.contact.pendingAction--}),a.closeModal()},confirmParticipantPromote:function(e){var t=this.onParticipantPromote.bind(this,e),n=l10n.t("confirm_promote_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});a.openModal(r.createElement(_,{onOK:t,okText:l10n.t("menuitem_make_group_admin"),onCancel:a.closeModal.bind(a),cancelText:l10n.t("web_cancel")},r.createElement(m,{text:n})))},onParticipantPromote:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.promoteParticipant(e).then(function(){e.contact.pendingAction--}),a.closeModal()},openAddGroupParticipantFlow:function(){if(this.props.chat.groupMetadata.participants.length>=T.MAX_GROUP_SIZE){var e=l10n.t("action_group_create_failed_participant",{max:T.MAX_GROUP_SIZE});a.openToast(r.createElement(b,{msg:e,id:C}))}else{var t=r.createElement(E,{chat:this.props.chat});a.openModal(t,"modal-flow")}},onClose:function(){a.closeDrawer(this.props.type)},onExitOrDeleteGroup:function(){a.deleteOrExitChat(this.props.chat)},onSubjectChange:function(e){this.setState({name:e.target.value})},validateSubject:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetSubjectError:function(){a.openModal(r.createElement(_,{onOK:a.closeModal.bind(a),okText:l10n.t("web_ok")},l10n.t("action_group_subject_empty")))},onSetSubject:function(e){var t=this.props.chat,n=t.groupMetadata;if(n.canSetSubject()){var r=S.emojify(this.state.name);if(r===t.contact.name)return this.setState({name:r});this.setState({pendingSubject:!0}),t.setSubject(r).bind(this)["finally"](function(){this.isMounted()&&this.setState({name:t.contact.name,pendingSubject:!1})})}},onCancelSubject:function(){this.setState({name:this.props.chat.contact.name})},render:function(){var e,t,n=this.props.chat,i=n.groupMetadata,o=this,a=i.participants.map(function(e){var t=e.contact;return r.createElement(u,{contact:t,key:e.id,admin:!!e.isAdmin,onClick:o.onParticipantClick,contextEnabled:o.menuEnabled.bind(o,t),onContext:o.onParticipantMenu,showNotifyName:!0})});n.canDelete()&&(t=r.createElement(h,{classes:"animate-enter3 drawer-section-action"},r.createElement("div",{onClick:this.onExitOrDeleteGroup,className:"btn btn-danger"},n.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group")))),i.participants.canAdd()&&(e=r.createElement("div",{className:"list-action",onClick:this.openAddGroupParticipantFlow},r.createElement("div",{className:"list-action-icon"},r.createElement("span",{className:"icon icon-add-user"})),r.createElement("div",{className:"list-action-body"},l10n.t("add_group_participant"))));var s=24,m=55,g=e?s+m:s,_=w.minHeight(a,g),E=a.length?r.createElement(h,{title:l10n.t("web_participants_title"),subtitle:l10n.t("web_participants_count",{count:a.length,max:T.MAX_GROUP_SIZE}),classes:"animate-enter2 drawer-section-list",expands:!0,style:_,ref:"container",noContainer:!0},e,r.createElement("div",{className:"drawer-section-body drawer-section-body-expand chatlist","data-list-scroll-container":!0},r.createElement(l,{data:a,height:l.DEFAULT_HEIGHT,extraItems:4}))):null,b=r.createElement(h,{title:l10n.t("subject"),classes:"animate-enter1"},r.createElement(v,{id:y.SUBJECT_INPUT,value:this.state.name,editable:i.canSetSubject(),pending:this.state.pendingSubject,showRemaining:!0,validate:this.validateSubject,maxLength:T.MAX_SUBJECT_LENGTH,onChange:this.onSubjectChange,onSave:this.onSetSubject,onError:this.onSetSubjectError,onCancel:this.onCancelSubject})),S=n.contact.profilePicThumb,C=n.isReadOnly||!S.canDelete()&&!S.canSet()?f.Type.NO_EDIT:f.Type.GROUP,M=r.createElement(f,{type:C,id:n.contact.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,onImageSet:this.onImageSet}),N=null;return n.groupMetadata.creation&&(N=r.createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:c.relativeDateAndTimeStr(n.groupMetadata.creation)}))),r.createElement(d,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement("header",{className:"pane-header"},r.createElement("div",{className:"header-close"},r.createElement("button",{onClick:this.onClose,"data-ignore-capture":y.IGNORE_ANY},r.createElement("span",{className:"icon icon-x"}))),r.createElement("div",{className:"header-body"},r.createElement("div",{className:"header-main"},r.createElement("div",{className:"header-title"},l10n.t("web_group_info"))),N)),r.createElement(p,{expands:!!a.length},r.createElement(h,{classes:"drawer-scale drawer-section-photo"},M),b,E,t))}});e.exports=M},function(e,t,n){"use strict";var r=n(6),i=n(802),o=n(804),a=n(803),s=n(105),c=s.HotKeys,l=n(830),u=n(58),d=n(807),p=n(845),h=n(808),f={LIST:"list",SEARCH:"search"},m=r.createClass({displayName:"ListModal",propTypes:{title:r.PropTypes.string.isRequired,selection:r.PropTypes.instanceOf(h),onSearch:r.PropTypes.func,searchPlaceholder:r.PropTypes.string,onCancel:r.PropTypes.func.isRequired,onSelect:r.PropTypes.func},getDefaultProps:function(){return{searchPlaceholder:l10n.t("search")}},getInitialState:function(){return{searchText:""}},onNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.props.selection;t&&t.setNext()},onPrev:function(e){var t=this.props.selection;if(t){e.preventDefault(),e.stopPropagation();var n=t.prev();n>-1?t.setPrev():(t.unset(),c.flashFocus=Date.now(),u.focusNode(this.refs[f.SEARCH]))}},onFocusList:function(e){this.refs[f.LIST]&&(e.preventDefault(),e.stopPropagation(),c.flashFocus=Date.now(),this.props.selection.setFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.first(this.props.children);t&&this.props.onSelect(e,t)},onSearch:function(e){this.setState({searchText:e}),this.props.onSearch(e)},render:function(){var e=this.props,t=e.title,n=e.onCancel,s=e.onSearch,h=e.searchPlaceholder,m=e.children,g={down:this.onFocusList,enter:this.onSelectFirst},v={down:this.onNext,up:this.onPrev},y=void 0;s&&(y=r.createElement(c,{handlers:g},r.createElement(l,{ref:f.SEARCH,searchText:this.state.searchText,onSearch:this.onSearch,searchType:u.CONTACT_SEARCH,placeholder:h})));var _=void 0;return _=m&&m.length?r.createElement(c,{handlers:v},r.createElement(d,{classes:["chatlist"],ref:f.LIST,data:m,height:72,extraItems:4})):m,r.createElement(p,{type:p.TOWER},r.createElement(i,{key:"contact-modal",onCancel:n,position:"right"},r.createElement(o,{title:t,type:o.Type.POPUP,onCancel:n}),y,r.createElement(a,{"data-list-scroll-container":!0},_)))}});e.exports=m},function(e,t,n){"use strict";var r=n(6),i=n(802),o=n(804),a=n(818),s=n(803),c=n(841),l=n(347),u=n(9),d=n(799),p=n(891),h=n(58),f=n(7),m=n(811),g=r.createClass({displayName:"ProfileDrawer",mixins:[d],propTypes:{id:r.PropTypes.string.isRequired,onClose:r.PropTypes.func},getInitialState:function(){return this.asyncState({status:"id.Status.status",imgFull:"id.ProfilePicThumb.imgFull"},{status:l10n.t("contact_status_loading"),pendingStatus:!1,pendingPhoto:!1})},validateStatus:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetStatusError:function(){u.openModal(r.createElement(l,{onOK:u.closeModal.bind(u),okText:l10n.t("web_ok")},l10n.t("action_status_empty")))},onSetStatus:function(e){if(Store.Status.canSetMyStatus()){var t=Store.Status.get(this.props.id).status,n=m.emojify(this.state.status);if(n===t)return this.setState({status:n});this.setState({pendingStatus:!0}),Store.Status.setMyStatus(m.emojify(this.state.status)).bind(this)["finally"](function(){this.isMounted()&&this.setState({status:Store.Status.get(this.props.id).status,pendingStatus:!1})})}},onBack:function(){this.props.onClose?this.props.onClose():u.closeDrawer(this.props.type)},onStatusChange:function(e){this.setState({status:e.target.value})},onCancelStatus:function(){this.setState({status:Store.Status.get(this.props.id).status})},onImageSet:function(e,t){var n=Store.ProfilePicThumb.get(this.props.id);this.setState({pendingPhoto:!0});var r;r=e&&t?n.setPicture(e,t):n.deletePicture(),r.bind(this).then(function(){this.isMounted()&&this.setState({pendingPhoto:!1})})},render:function(){var e=Store.ProfilePicThumb.get(this.props.id),t=e.canSet()||e.canDelete()?c.Type.PROFILE:c.Type.NO_EDIT,n=r.createElement(c,{type:t,id:this.props.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,onImageSet:this.onImageSet});return r.createElement(i,{onCancel:this.onBack,id:"profile"},r.createElement(o,{a8n:"drawer-title-profile",title:l10n.t("menuitem_profile_status"),onBack:this.onBack,type:o.Type.LARGE}),r.createElement(s,null,r.createElement("div",{className:"drawer-section drawer-scale drawer-section-photo"},n),r.createElement(a,{a8n:"col-main-profile",title:l10n.t("web_status"),classes:"animate-enter1"},r.createElement(p,{id:h.STATUS_INPUT,value:this.state.status,editable:Store.Status.canSetMyStatus(),pending:this.state.pendingStatus,showRemaining:!0,validate:this.validateStatus,maxLength:f.MAX_STATUS_LENGTH,onChange:this.onStatusChange,onSave:this.onSetStatus,onError:this.onSetStatusError,onCancel:this.onCancelStatus}))))}});e.exports=g},function(e,t,n){"use strict";var r=n(108),i={dataTypes:{msgKey:{set:function(e){return e instanceof r?{val:e,type:"msgKey"}:void 0},compare:function(e,t,n){return e&&t&&e.toString()===t.toString()}}}};e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(1),c=n(22),l=n(60),u=n(35),d=n(9),p=n(80),h=n(21),f=n(82).ActionToast,m=n(82).ActionType,g=n(159),v=l.extend({props:{id:"string",expiration:{type:"number","default":0}},session:{_unmuteTimer:"string",promises:{type:"object","default":function(){return{}}}},derived:{isMuted:{deps:["expiration"],fn:function(){return!!this.expiration}}},initialize:function(){this.expiration&&this.mute(this.expiration)},setMute:function(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))},mute:function y(e,t,n){var r=this;if(!_.isNumber(e))return s.log("models:Mute:mute called with invalid expiration "+e)(),o["default"].reject(new h.ActionError);e=Math.round(e),e>2e9&&s.log("models:Mute:mute called with wrong units?"+this.id+" exp:"+e)();var y=function(){this.isMuted&&this._clearUnmuteTimer();var t=e-moment().unix();s.log("models:Mute:mute "+this.id+" duration:"+t)(),this._unmuteTimer=g.setTimeout(this.unmute.bind(this),1e3*e),this.set({expiration:e})}.bind(this),i=c.isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;this.promises.mute=u.sendConversationMute(this.id,e,this.expiration);var l=new m(i?l10n.t("action_group_muting"):l10n.t("action_chat_muting"));n=n||f.genId();var p=this.promises.mute["catch"](function(o){s.error("models:Mute:mute dropped")(o);var a=i?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed");throw new m(a,l10n.t("action_try_again"),r.mute.bind(r,e,t,n))}).then(function(e){if(200===e.status){var o=i?l10n.t("action_group_muted"):l10n.t("action_chat_muted");return new m(o,l10n.t("action_undo"),r.unmute.bind(r,t,n))}if(e.status>=400)throw new m(i?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed"))});return d.openToast(a.createElement(f,{id:n,initialAction:l,pendingAction:p})),this.promises.mute.then(function(e){200!==e.status||e._duplicate||y()})["finally"](function(){r.promises.mute=null})}return y(),o["default"].resolve()},canMute:function(){return p.supportsFeature(p.F.MUTE)&&c.isGroup(this.id)||p.supportsFeature(p.F.MUTE_1_1)&&c.isUser(this.id)},_clearUnmuteTimer:function(){g.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0},unmute:function E(e,t){var n=this,E=function(){s.log("models:Mute:unmute "+this.id)(),this._clearUnmuteTimer()}.bind(this),r=c.isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;this.promises.unmute=u.sendConversationMute(this.id,!1,this.expiration);var i=new m(r?l10n.t("action_group_unmuting"):l10n.t("action_chat_unmuting"));t=t||f.genId();var l=this.promises.unmute["catch"](function(i){s.error("models:Mute:unmute dropped")(i);var a=r?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed");return o["default"].reject(new m(a,l10n.t("action_try_again"),n.unmute.bind(n,e,t)))}).then(function(e){if(200===e.status)return new m(r?l10n.t("action_group_unmuted"):l10n.t("action_chat_unmuted"));if(e.status>=400)throw new m(r?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed"))});return d.openToast(a.createElement(f,{id:t,initialAction:i,pendingAction:l})),this.promises.unmute.then(function(e){200!==e.status||e._duplicate||E()})["finally"](function(){n.promises.unmute=null})}return E(),o["default"].resolve()},"delete":function(){l.prototype["delete"].call(this),this._clearUnmuteTimer()}});e.exports=v},function(e,t,n){"use strict";var r=n(6),i=n(819),o=n(103),a=n(107),s=n(46),c=n(58),l=r.createClass({displayName:"TextField",propTypes:{id:r.PropTypes.string,value:r.PropTypes.string.isRequired,placeholder:r.PropTypes.string,editable:r.PropTypes.bool,pending:r.PropTypes.bool,maxLength:r.PropTypes.number,showRemaining:r.PropTypes.bool,validate:r.PropTypes.func,onChange:r.PropTypes.func,onSave:r.PropTypes.func,onCancel:r.PropTypes.func},getDefaultProps:function(){return{placeholder:"",id:"",maxLength:25,editable:!1,showRemaining:!1,forceCancel:!1}},getInitialState:function(){return{editing:!1,value:this.props.value}},componentWillReceiveProps:function(e){this.setState({value:e.value})},onEdit:function(){this.setState({editing:!0})},onSave:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=!0;this.props.validate&&(t=this.props.validate(this.props.value)),t?(this.props.onSave&&this.props.onSave(),this.setState({editing:!1})):this.props.onError&&this.props.onError()},uimClose:function(){this.onCancel()},uimFocus:function(){this.refs.input.focus()},onCancel:function(){this.state.editing&&this.setState({editing:!1},this.props.onCancel)},render:function(){var e,t=s({textfield:!0,"textfield-editable":this.props.editable,active:this.state.editing});return this.props.pending?e=r.createElement("div",{className:"icon icon-spinner"},r.createElement(a,{size:18,stroke:6})):this.state.editing?e=r.createElement("span",{className:"icon icon-checkmark",onClick:this.onSave,key:"btn-done",title:l10n.t("click_to_save_esc_to_cancel")},l10n.t("save_button")):this.props.editable&&(e=r.createElement("span",{className:"icon icon-pencil","data-ignore-capture":c.IGNORE_ANY,onClick:this.onEdit,key:"btn-edit",title:l10n.t("edit_button")},l10n.t("edit_button"))),r.createElement("div",{className:t},r.createElement(i,{id:this.props.id,ref:"input",placeholder:this.props.placeholder,value:this.state.value,editable:this.state.editing,maxLength:this.props.maxLength,showRemaining:this.props.showRemaining,onEnter:this.onSave,onChange:this.props.onChange,onCancel:this.onCancel,parent:this}),r.createElement(o,{transitionName:"pop",component:"div",className:"textfield-controls"},e))}});e.exports=l},function(e,t,n){"use strict";function r(){if(!o){var e=n(1031),t=e.length/2;o=new Int32Array(t),a=new Int32Array(t);for(var r=0,i=0;t>r;r++,i+=2)o[r]=e[i]+(0===r?0:o[r-1]),a[r]=e[i+1]}}function i(e){r();for(var t=0;t<e.length;t++){var n=0|e.charCodeAt(t);if(n>=55296&&56320>n&&(n=((1023&n)<<10|1023&e.charCodeAt(++t))+65536),!(n<o[0])){for(var i=0|o.length,s=0,c=i-1|0;c>s;){var l=c+s>>1;if(o[l]>n)c=l-1|0;else{if(o[l+1]>n){c=l;break}s=l+1|0}}var u=a[c],d=o[c]+Math.abs(u)|0;if(d>n)return 0>u?"rtl":"ltr"}}}var o,a;e.exports={dir:i}},function(e,t,n){"use strict";function r(e){return CryptoJS.lib.WordArray.create(new Uint8Array(e))}var i=n(8),o=n(21),a=n(366),s=n(161),c=n(712),l={image:"WhatsApp Image Keys",video:"WhatsApp Video Keys",audio:"WhatsApp Audio Keys",ptt:"WhatsApp Audio Keys",document:"WhatsApp Document Keys"},u={decryptE2EMedia:function(e,t,n,a){try{if(t.length<10)throw new o.MediaEncryptionError("ciphertext too short: "+t.length);var s=this.computeKeys(e,n),l=s.iv,u=s.cipherKey,d=s.macKey,p=i.wrap(t),h=p.slice(p.limit-10).toBase64(),f=p.slice(p.offset,p.limit-10).toBuffer(),m=i.concat([new Uint8Array(l),f]).toBuffer(),g=CryptoJS.lib.WordArray.create(m),v=CryptoJS.HmacSHA256(g,r(d)).toString(CryptoJS.enc.Base64),y=i.fromBase64(v).slice(0,10).toBase64();if(!y||!h||y!==h)throw new o.MediaEncryptionError("hmac fail computed: "+v+" given: "+h);var _=CryptoJS.AES.decrypt({ciphertext:CryptoJS.lib.WordArray.create(f),salt:void 0},r(u),{iv:r(l),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),E=i.fromBase64(_.toString(CryptoJS.enc.Base64)).toBuffer();if(!a){var b=c(new Uint8Array(E,0,Math.min(262,E.byteLength)));if(b)a=b.mime;else{if("image"!==e)throw new o.MediaEncryptionError("unknown mime decrypt error for type:"+e);a="image/jpeg"}}return new Blob([E],{type:a})}catch(w){throw w instanceof o.MediaEncryptionError?w:new o.MediaEncryptionError("unknown decrypt error: "+w+" stack: "+w.stack)}},encryptE2EMedia:function(e,t,n){try{var a=this.computeKeys(e,n),s=a.iv,c=a.cipherKey,l=a.macKey,u=CryptoJS.AES.encrypt(CryptoJS.lib.WordArray.create(t),r(c),{iv:r(s),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),d=u.iv.concat(u.ciphertext),p=CryptoJS.HmacSHA256(d,r(l));p.sigBytes=10,p.clamp();var h=u.ciphertext.concat(p),f=i.fromBase64(h.toString(CryptoJS.enc.Base64)).toBuffer();return new Blob([f])}catch(m){throw m instanceof o.MediaEncryptionError?m:new o.MediaEncryptionError("unknown encrypt error: "+m+" stack: "+m.stack)}},computeKeys:function(e,t){var n=l[e];if(!t||!n)throw new o.MediaEncryptionError("computeKeys fail: !!mediakey: "+!!t+" info: "+n+" type: "+e);var r=a.extractAndExpand(s.decode(t),void 0,n,112,!0);if(!r||r.length<112)throw new o.MediaEncryptionError("computeKeys:hkdf error");return{iv:r.slice(0,16),cipherKey:r.slice(16,48),macKey:r.slice(48,80),refKey:r.slice(80,112)}}};e.exports=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){return(0,u["default"])(_.pick(e,["message","filename","lineno","colno"]))}function o(e,t,n,r){if(!e)throw new p.MediaEncryptionError('decrypt async, missing "type"');if(!t)throw new p.MediaEncryptionError('decrypt async, missing "buffer"');if(!n)throw new p.MediaEncryptionError('decrypt async, missing "mediaKey"');return new c["default"](function(i,o){var a=new d;a.onmessage=i,a.onerror=o,a.postMessage({command:"decrypt-e2e-media",type:e,buffer:t,mediaKey:n,mimetype:r})})["catch"](function(e){throw new Error(i(e))}).then(function(e){return e.data})}function a(e,t,n){if(!e)throw new p.MediaEncryptionError('encrypt async, missing "type"');if(!t)throw new p.MediaEncryptionError('encrypt async, missing "buffer"');if(!n)throw new p.MediaEncryptionError('encrypt async, missing "mediaKey"');return new c["default"](function(r,i){var o=new d;o.onmessage=r,o.onerror=i,o.postMessage({command:"encrypt-e2e-media",type:e,buffer:t,mediaKey:n})})["catch"](function(e){throw new Error(i(e))}).then(function(e){return e.data})}var s=n(3),c=r(s),l=n(23),u=r(l),d=n(1032),p=n(21);e.exports={decryptE2EMedia:o,encryptE2EMedia:a}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(836),s=n(21),c=n(7),l={getFiles:function(e,t){for(var n=[],r=e.target.files||e.dataTransfer.files,i=r.length+t>c.MAX_FILES?Math.max(c.MAX_FILES-t,0):r.length,l=0;i>l;l++)n.push(r[l]);if(r.length||t>=c.MAX_FILES)return o["default"].resolve(n);if(e.dataTransfer.getData("text/uri-list"))return a.urlToFile(e.dataTransfer.getData("text/uri-list")).then(function(e){return[e]});if(e.dataTransfer.getData("text/html")){var u=new DOMParser,d=u.parseFromString(e.dataTransfer.getData("text/html"),"text/html");if(d.createNodeIterator(d.childNodes[0],NodeFilter.SHOW_TEXT).nextNode()){if(e.dataTransfer.getData("text/plain")&&!t)return o["default"].reject(new s.MediaDragDropError("dropped html has text nodes",e.dataTransfer.getData("text/plain")))}else{var p=d.getElementsByTagName("img");if(p.length)return a.urlToFile(p[0].src).then(function(e){return[e]})}}return o["default"].resolve(n)}};e.exports=l},function(e,t,n){"use strict";function r(e){return CryptoJS.lib.WordArray.create(new Uint8Array(e))}var i=n(893),o=n(8),a=n(21),s=n(161),c=n(1),l=n(903),u=n(22),d={ackE2EMedia:function(e,t,n){if(t&&n&&e){var a=u.userToLegacy(Store.Conn.me),d=o.fromUTF8(a).toBuffer(),p=CryptoJS.lib.WordArray.create(d),h=r(i.computeKeys(e,t).refKey),f=CryptoJS.HmacSHA256(p,h);f.sigBytes=20,f.clamp();var m=s.urlSafe(f.toString(CryptoJS.enc.Base64)),g=n+"?ack="+m;return c.log("crypto:ack:"+g)(),l.postRetry(g)}},computeRefs:function(e,t){if(!e||!t||t.filter(function(e){return!u.isUser}).length>0)throw new a.MediaEncryptionError("computeRefs error: "+!!e+","+(t&&t.join()));var n=r(e);return t.map(function(e){var t=CryptoJS.HmacSHA256(CryptoJS.enc.Utf8.parse(u.userToLegacy(e)),n);return t.sigBytes=20,t.clamp(),s.urlSafe(t.toString(CryptoJS.enc.Base64))})},newB64MediaKey:function(){var e=new Uint8Array(32);return window.crypto.getRandomValues(e),s.encode(e)}};e.exports=d},function(e,t){"use strict";var n={boundHeightWidth:function(e,t,n,r){return t=t||r,e=e||n,t>e?t>r&&(e*=r/t,t=r):e>n&&(t*=n/e,e=n),{width:Math.max(t,1),height:Math.max(e,1)}}};e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){return new u["default"](function(t,n){var r=new Image;r.onload=function(i){r.onload=r.onerror=null,r.naturalWidth>0?t({img:r,fullWidth:r.naturalWidth,fullHeight:r.naturalHeight}):n(new d.MediaLoadError("image loaded with zero width",e))},r.onerror=function(t){r.onload=r.onerror=null,n(new d.MediaLoadError("unable to render image",e))},r.src=e})}function o(e){return new u["default"](function(t,n){var r=document.createElement("video");r.volume=0,r.autoplay=!0,r.onplay=function(i){r.pause(),r.onplay=r.onerror=null,r.videoWidth>0?t({video:r,fullWidth:r.videoWidth,fullHeight:r.videoHeight}):n(new d.MediaLoadError("video loaded with zero width",e))},r.onerror=function(t){r.onplay=r.onerror=null,n(new d.MediaLoadError("unable to play video",e))},r.src=e})}function a(e){return new u["default"](function(t,n){var r=document.createElement("audio");r.volume=0,r.autoplay=!0,r.onplay=function(e){r.pause(),r.onplay=r.onerror=null,t({audio:r})},r.onerror=function(t){r.onplay=r.onerror=null,n(new d.MediaLoadError("unable to play audio",e))},r.src=e})}function s(e){return u["default"].resolve()}function c(e,t){var n=t.indexOf(p.MIMETYPE_OGG)>-1;if(n&&!m){if(e.size<=f){var r=new h(e);return r.generateBlob()}throw new d.MediaLoadError("media-load:transcode blob too large",e.size)}return u["default"].resolve(e)}var l=n(3),u=r(l),d=n(21),p=n(7),h=n(1016),f=3e5,m=(new Audio).canPlayType("audio/ogg");e.exports={image:i,video:o,audio:a,file:s,transcode:c}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(59),o=r(i),a=n(106),s=r(a),c=n(155),l=r(c),u=n(350),d=r(u),p=n(349),h=r(p),f=n(353),m=n(828),g=function(e){function t(e,n){(0,s["default"])(this,t);var r=(0,d["default"])(this,(0,o["default"])(t).call(this));return r._classes=e,r._size=n,r}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){return f.emojiIndex(e)}},{key:"mutate",value:function(){return""}},{key:"args",value:function(e){return{classes:this._classes,size:this._size,emoji:e[0]}}},{key:"alwaysApply",get:function(){return!0}}]),t}(m);e.exports=g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(39),o=r(i),a=n(59),s=r(a),c=n(106),l=r(c),u=n(155),d=r(u),p=n(350),h=r(p),f=n(349),m=r(f),g=n(828),v=function(e){function t(){(0,l["default"])(this,t);var e=(0,h["default"])(this,(0,s["default"])(t).call(this));e.substitutions={"(y)":"👍","(n)":"👎",":-)":"😄",":-(":"😦"};var n=(0,o["default"])(e.substitutions).map(function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")});return e.regex=new RegExp("("+n.join("|")+")","i"),e}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"match",value:function(e){return this.regex.exec(e)}},{key:"mutate",value:function(e){return this.substitutions[e]||e}},{key:"isFragment",get:function(){return!0}}]),t}(g);e.exports=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(59),o=r(i),a=n(106),s=r(a),c=n(155),l=r(c),u=n(350),d=r(u),p=n(349),h=r(p),f=n(851),m=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"onRoot",value:function(e){return e.join("")}},{key:"onMutatorNode",value:function(e,t){return t.join("")}}]),t}(f);e.exports=m},function(e,t,n){"use strict";var r=n(713),i={multibyteLength:function(e){return r.ucs2.decode(e).length},multibyteSubstr:function(e,t,n){var i=r.ucs2.decode(e);if("undefined"==typeof n)i=i.slice(t);else{if(0>=n)return"";i=i.slice(t,t+n)}return r.ucs2.encode(i)}};e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return s(function(){return p.get(e,t)})}function o(e){return s(function(){return p.head(e)})}function a(e,t){return s(function(){return p.post(e,t)})}function s(e){return d.loopOnError(f.ShouldLoop,function(t){var n;return n=u.state===u.STATE.CONNECTED?l["default"].delay(Math.floor(1e3*h.expBackoff(t,60,void 0,.1))):d.waitForBBEvent(u,"change:state",_.matches({state:u.STATE.CONNECTED})),n.then(function(){return e().then(function(e){if(e.status>=500)throw new f.ShouldLoop;return e})["catch"](function(){throw new f.ShouldLoop})})})}var c=n(3),l=r(c),u=n(11),d=n(29),p=n(109),h=n(83),f=n(21);e.exports={headRetry:o,getRetry:i,postRetry:a}},function(e,t,n){e.exports=function(){return new Worker(n.p+"6561b6897a62fa5320ca.worker.js")}},function(e,t,n){"use strict";var r=n(6),i=n(9),o=n(81),a=n(801),s=n(58),c=r.createClass({displayName:"ActionListener",mixins:[o],componentWillMount:function(){this.regCmd("mute_chat",this.onMute),this.regCmd("delete_or_exit_chat",this.onDeleteOrExit),this.regCmd("archive_chat",this.onArchive),this.regCmd("clear_chat_msgs",this.onClear),this.regCmd("mark_chat_unread",this.onMarkUnread),this.regCmd("msg_info_drawer",this.onMsgInfoDrawer),this.regCmd("group_info_drawer",this.onGroupInfoDrawer),this.regCmd("contact_info_drawer",this.onContactInfoDrawer),
this.regCmd("broadcast_info_drawer",this.onBroadcastInfoDrawer)},onGroupInfoDrawer:function(e){var t=n(886);return s.find(s.DRAWER_RIGHT)?void i.closeDrawer():void i.openDrawer(r.createElement(t,{chat:e,type:s.DRAWER_RIGHT}),"slide-left")},onBroadcastInfoDrawer:function(e){var t=n(882);return s.find(s.DRAWER_RIGHT)?void i.closeDrawer():void i.openDrawer(r.createElement(t,{chat:e,type:s.DRAWER_RIGHT}),"slide-left")},onContactInfoDrawer:function(e){var t=n(884);return s.find(s.DRAWER_RIGHT)?void i.closeDrawer(s.DRAWER_RIGHT):void i.openDrawer(r.createElement(t,{contact:e.contact,type:s.DRAWER_RIGHT}),"slide-left")},onMute:function l(e,t,o){if(t){var a=n(977),l=function(t){e.pendingAction++,e.mute.mute(t,!0)["finally"](function(){e.pendingAction--})};i.openModal(r.createElement(a,{chat:e,onMute:l}),null,o)}else e.pendingAction++,e.mute.unmute(!0)["finally"](function(){e.pendingAction--})},onDeleteOrExit:function(e,t){var o=n(970),a=function(t){e.pendingAction++,t["finally"](function(){e.pendingAction--})};i.openModal(r.createElement(o,{chat:e,onDeleteOrExit:a}),null,t)},onClear:function(e,t){var o=n(967);i.openModal(r.createElement(o,{chat:e}),null,t)},onArchive:function(e,t){e.pendingAction++,e.setArchive(t)["catch"](_.noop)["finally"](function(){e.pendingAction--})},onMarkUnread:function(e,t){e.pendingAction++,e.markUnread(t)["finally"](function(){e.pendingAction--})},onMsgInfoDrawer:function(e){if(e.chat.kind===a.KIND.CHAT){var t=n(969);i.openDrawer(r.createElement(t,{msg:e,key:e.id.toString(),type:s.DRAWER_RIGHT}),"slide-left")}else{var o=n(974);i.openDrawer(r.createElement(o,{msg:e,key:e.id.toString(),type:s.DRAWER_RIGHT}),"slide-left")}},render:function(){return null}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(1),o=n(47),a=n(166),s=n(11),c=n(111),l=n(48),u=n(162),d=n(38),p=n(62),h=n(29),f=n(102),f=n(102),m=n(81),g=n(153),v=n(7),y=n(9),v=n(7),E=n(46),b=n(103),w=n(833),S=r.createClass({displayName:"ButterBar",mixins:[f,m],getInitialState:function(){this._showNotifyTimer=new p(this,this.showPrompt),this._showBatteryTimer=new p(this,this.batteryUpdate);var e=u.battery<v.BATTERY_LOW_THRESHOLD_1?u.battery<v.BATTERY_LOW_THRESHOLD_2?2:1:0;return{lowBatteryWarning:e,notifyPermission:window.Notification&&window.Notification.permission,showNotify:!1}},componentWillMount:function(){this.addObserver(l,"change:displayInfo"),this.addObserver(l,"change:needsUpdate"),this.addObserver(l,"change:needsManualDownload"),this.addObserver(u,"change:plugged",this.batteryUpdate),this.addObserver(u,"change:battery",this.batteryUpdate)},componentWillUnmount:function(){this._showNotifyTimer.cancel(),this._showBatteryTimer.cancel()},onReload:function(){a.restart()},onClickManualDownload:function(){},batteryUpdate:function(e){var t=this.state.lowBatteryWarning;u.plugged||u.battery>v.BATTERY_LOW_THRESHOLD_1?0!==t&&this.setState({lowBatteryWarning:0}):u.battery<=v.BATTERY_LOW_THRESHOLD_2?-2!==t&&(e?this._showBatteryTimer.before(v.BATTERY_DELAY):2!==t&&this.setState({lowBatteryWarning:2})):t>-1&&u.battery<=v.BATTERY_LOW_THRESHOLD_1&&(e?this._showBatteryTimer.before(v.BATTERY_DELAY):1!==t&&this.setState({lowBatteryWarning:1}))},dismissLowBatteryWarning:function(){var e=this.state.lowBatteryWarning;e>0&&this.setState({lowBatteryWarning:-e})},showPrompt:function(e){this.setState({showNotify:e})},guideConfirm:function(){y.closeModal()},guideLearnMore:function(){switch(o.browser){case v.BROWSER_TYPE.CHROME:return window.open("http://www.whatsapp.com/faq/web/28080004","_blank");case v.BROWSER_TYPE.FIREFOX:return window.open("http://www.whatsapp.com/faq/web/28080006","_blank");case v.BROWSER_TYPE.SAFRI:return window.open("http://www.whatsapp.com/faq/web/28080008","_blank");case v.BROWSER_TYPE.OPERA:return window.open("http://www.whatsapp.com/faq/web/28080007","_blank");default:return window.open("http://www.whatsapp.com/faq/web/28080004","_blank")}},requestPermissions:function(){y.openModal(r.createElement(w,{title:"guide_desktop_notifications_title",desc:"guide_desktop_notifications_description",onConfirm:this.guideConfirm,onCancel:this.guideLearnMore,type:w.TYPE.GUIDE_ALLOW}));var e=this;window.Notification.requestPermission(function(t){y.closeModal(),e.setState({notifyPermission:t})})},render:function(){var e=null;switch(l.displayInfo){case l.INFO.OFFLINE:e=r.createElement(M,{key:"bbar"});break;case l.INFO.OPENING:case l.INFO.CONNECTING:e=r.createElement(N,{key:"bbar"});break;case l.INFO.NORMAL:break;case l.INFO.RESUMING:case l.INFO.TIMEOUT:var t=function(){window.open("http://www.whatsapp.com/faq/web/28080002")},n=r.createElement("span",null,l10n.t("make_sure_phone_active_internet_connection")," ",r.createElement("span",{className:"action",onClick:t},l10n.t("learn_more")));e=r.createElement(T,{type:"phone",key:"bbar",title:l10n.t("phone_not_connected"),text:n})}if(!e&&this.state.lowBatteryWarning>0&&(e=r.createElement(T,{type:"battery",key:"bbar",title:l10n.t("phone_battery_low"),text:l10n.t("charge_phone_description"),dismissable:!0,onDismiss:this.dismissLowBatteryWarning})),!e&&l.needsUpdate&&(e=r.createElement(T,{type:"update",key:"bbar",title:l10n.t("update_available"),text:l10n.t("click_to_update_whatsapp_web"),action:this.onReload})),!e&&l.needsManualDownload&&(e=r.createElement(T,{type:"update",key:"bbar",title:l10n.t("desktop_client_update_available"),text:l10n.t("click_to_download_desktop_client"),action:this.onClickManualDownload})),e)this.state.showNotify&&this._showNotifyTimer.before(0,!1);else if(this.state.showNotify){if(window.Notification&&this.state.notifyPermission===v.PERMISSION_DEFAULT){var i=r.createElement("span",{className:"action",onClick:this.requestPermissions},l10n.t("enable_desktop_notifications"));e=r.createElement(T,{type:"notification",key:"bbar",title:l10n.t("get_notified_of_new_messages"),text:i})}}else this._showNotifyTimer.before(v.NOTIFICATION_PROMPT_DELAY,!0);return r.createElement("div",{className:"butterbar-container"},r.createElement(b,{transitionName:"butterbar"},e))}}),T=r.createClass({displayName:"BB",propTypes:{type:r.PropTypes.oneOf(["computer","phone","notification","battery","update"]),title:r.PropTypes.node.isRequired,text:r.PropTypes.node,dismissable:r.PropTypes.bool,onDismiss:r.PropTypes.func,action:r.PropTypes.func},onClick:function(){this.props.action&&this.props.action()},render:function(){var e,t;switch(this.props.type){case"computer":case"phone":case"notification":case"battery":case"update":e="butterbar-"+this.props.type,t="icon-alert-"+this.props.type;break;default:i.log("butterbar:render invalid type")()}var n=E("butterbar",e,{action:this.props.action}),o=E("icon","icon-alert",t),a=this.props.dismissable?r.createElement("div",{className:"butterbar-controls"},r.createElement("button",{className:"icon icon-x-light",onClick:this.props.onDismiss})):null,s=this.props.text?r.createElement("div",{className:"butterbar-text"},this.props.text):null;return r.createElement("div",{className:"butterbar-wrapper"},r.createElement("div",{className:n,onClick:this.onClick},r.createElement("div",{className:"butterbar-icon"},r.createElement("span",{className:o})),r.createElement("div",{className:"butterbar-body"},r.createElement("div",{className:"butterbar-title"},this.props.title),s),a))}}),C=3e3,M=r.createClass({displayName:"Offline",mixins:[g],getInitialState:function(){return{allowReconnect:!0}},reconnect:function(){var e=c.numSocketsAttempted+1;s.poke(),h.waitForBBEvent(l,"change:displayInfo",function(){return l.displayInfo===l.INFO.NORMAL}).then(function(){new d.WebcManualWebsocketAttempt({webcManualWebsocketAttemptSuccessful:c.numSocketsAttempted===e}).commit()}),this.setState({allowReconnect:!1}),this.reconnectTimeout=this.safeDelay(this.resetReconnectTimeout,C)},resetReconnectTimeout:function(){this.clearSafeTimeout(this.reconnectTimeout),delete this.reconnectTimeout,this.setState({allowReconnect:!0})},render:function(){var e,t;return this.state.allowReconnect?(e=r.createElement("span",null,l10n.t("make_sure_computer_active_internet_connection")+" ",r.createElement("span",{className:"action",onClick:this.reconnect},l10n.t("reconnect"))),t=l10n.t("computer_not_connected")):(e=null,t=l10n.t("connecting_to_whatsapp_or_phone")),r.createElement(T,{type:"computer",title:t,text:e})}}),N=r.createClass({displayName:"Resume",mixins:[g,f],getInitialState:function(){return{takingTooLong:!1,didShowSubtitle:!1}},componentWillMount:function(){this.addObserver(s,"change:state",this.onProgress),this.addObserver(s,"change:retryTimestamp",this.onProgress)},onProgress:function(){this.clearSafeInterval(this.interval),delete this.interval,this.startTimeout(),this.setState({takingTooLong:!1})},componentDidMount:function(){this.startTimeout()},startTimeout:function(){this.safeDelay(this.connectTimeout,3e3)},connectTimeout:function(){this.interval=this.safeInterval(this.timeoutTick,1e3),this.setState({takingTooLong:!0,didShowSubtitle:!0})},timeoutTick:function(){this.setState({now:Date.now()})},retry:function(e){s.poke(),this.onProgress()},cancel:function(e){s.logout()},render:function(){var e,t;if(l.displayInfo===l.INFO.OPENING)e=l10n.t("connecting_to_whatsapp");else{if(l.displayInfo!==l.INFO.CONNECTING)return null;e=l10n.t("connecting_to_whatsapp_or_phone")}if(this.state.takingTooLong){var n=s.retryTimestamp-Date.now();if(1>n)n=l10n.t("retrying"),_.defer(function(){return s.poke()});else if(6e4>n){var i=Math.ceil(n/1e3);n=l10n.t("retrying_in_some_seconds",{number:i,_plural:i})}else n=l10n.t("retrying_in",{duration:moment.duration(n).humanize()});t=r.createElement("span",null,n," ",r.createElement("span",{className:"action",onClick:this.retry},l10n.t("retry_now")))}else t=this.state.didShowSubtitle?r.createElement("span",null,l10n.t("retrying")):null;return r.createElement(T,{type:"computer",title:e,text:t})}});e.exports=S},function(e,t,n){"use strict";var r=n(6),i=n(801),o=n(800),a=n(911),s=n(102),c=r.createClass({displayName:"ChatstateInfo",mixins:[s],propTypes:{chat:r.PropTypes.instanceOf(i)},componentWillMount:function(){var e=this.props.chat;this.addObserver(e,"change:cmc:merge"),this.addObserver(e.msgs,"change:last"),this.addObserver(e.presence,"change:chatstate.id change:chatstate.type change:withholdDisplay")},render:function(){var e=this.props.chat,t=e.presence;if(t.isActive()){var n=t.getFormattedString();return r.createElement("div",{className:"chat-status typing ellipsify",dir:"auto"},r.createElement(o,{ellipsify:!0,titlify:!0,text:n}))}var i=e.msgs.last();return i?r.createElement(a,{key:i.id,msg:i}):r.createElement("div",{className:"chat-status"})}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(154),o=r.createClass({displayName:"ContactMsgInfoCell",propTypes:{title:r.PropTypes.string.isRequired,icon:r.PropTypes.node.isRequired,t:r.PropTypes.number},render:function(){var e=this.props,t=e.title,n=e.t,o=e.icon,a=n?i.relativeDateAndTimeStr(n):"-",s={cursor:"auto"};return r.createElement("div",{className:"contact chat",style:s},r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},r.createElement("div",{className:"chat-title"},r.createElement("span",{className:"ellipsify",dir:"auto"},o,t))),r.createElement("div",{className:"chat-secondary"},r.createElement("div",{className:"chat-status ellipsify"},r.createElement("span",{className:"ellipsify",dir:"auto"},a)))))}});e.exports=o},function(e,t,n){"use strict";var r=n(6),i=n(829),o=n(805),a=n(154),s=n(799),c=r.createClass({displayName:"GroupMsgInfoCell",mixins:[s],propTypes:{participant:r.PropTypes.instanceOf(Object).isRequired},getInitialState:function(){return{formattedName:this.async("participant.contact.formattedName")}},render:function(){var e=this.props.participant,t=r.createElement("div",{className:"chat-avatar"},r.createElement(o,{id:e.id})),n={cursor:"auto"};return r.createElement(i,{id:e.id,contextEnabled:function(){return!1},image:t,primary:this.state.formattedName,secondary:a.relativeDateAndTimeStr(e.t),style:n})}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(799),o=n(103),a=r.createClass({displayName:"Icons",mixins:[i],propTypes:{chat:r.PropTypes.object.isRequired},getInitialState:function(){return{isMuted:this.async("chat.mute.isMuted"),unreadCount:this.async("chat.unreadCount"),archive:this.async("chat.archive")}},render:function(){var e=this.props.chat,t=this.state.isMuted?r.createElement("span",{className:"icon icon-meta icon-muted",key:"icon-muted"}):null,n=0!==e.unreadCount?r.createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},e.unreadCount>0?l10n.n(this.state.unreadCount):r.createElement("span",null," ")):null,i=this.state.archive?r.createElement("span",{className:"icon-meta chat-marker chat-marker-archived",key:"icon-archived"},l10n.t("chat_archived")):null;return r.createElement(o,{transitionName:"pop"},t,i,n)}});e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(798),o=n(47),a=n(811),s=n(863),c=n(864),l=n(800),u=n(799),d=n(102),p=n(46),h=r.createClass({displayName:"LastMsg",mixins:[u,d],propTypes:{msg:r.PropTypes.instanceOf(i).isRequired},getInitialState:function(){return this.props.msg.sender?{formattedShortName:this.async("msg.senderObj.formattedShortName")}:{}},componentWillMount:function(){"ptt"===this.props.msg.type&&this.addObserver(this.props.msg,"change:duration"),this.addObserver(this.props.msg,"change:type")},render:function(){var e=this.props.msg,t=[];if(e.isSentByMe&&t.push(r.createElement(s,{msg:e,key:"symbol"})),!e.isSentByMe&&e.isGroupMsg&&!e.isNotification){var n=p("chat-status-name",{number:!e.senderObj.name});t.push(r.createElement(l,{text:this.state.formattedShortName,direction:"auto",classes:n,key:"author"})),t.push(r.createElement("span",{className:"chat-status-divider",key:"divider"},":"))}(e.hasSymbol||e.type===i.TYPE.DOCUMENT)&&t.push(r.createElement(c,{msg:e,key:"msg-symbol"})),t.push(r.createElement(l,{direction:e.dir,ellipsify:!0,text:a.msgText(e),key:"status"}));var u="chat-status";o.isGecko&&(u+=" ellipsify");var d=l10n.embedDir(a.msgText(e),e.rtl);return r.createElement("div",{className:u,title:d},t)}});e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(799),a=n(829),s=n(800),c=n(865),l=n(864),u=n(798),d=n(58),p=n(46),h=n(825),f=n(102),m=n(47),g=n(811),v=n(798),y=n(863),E=n(105),b=E.HotKeys,w=r.createClass({displayName:"Message",mixins:[o,f],propTypes:{msg:r.PropTypes.instanceOf(u).isRequired,mouseDownAsClick:r.PropTypes.bool,onClick:r.PropTypes.func,active:r.PropTypes.object},getInitialState:function(){var e=this.props,t=e.msg,n=e.active,r={formattedTitle:this.async("msg.chat.formattedTitle"),active:n?n.value===t:!1};return t.sender&&t.isGroupMsg&&!t.isNotification&&(t.isSentByMe?r.formattedShortName=t.senderObj.formattedShortName:r.formattedShortName=this.async("msg.senderObj.formattedShortName")),r},componentWillMount:function(){var e=this,t=this.props.active;t&&this.addObserver(t,this.props.msg.id.toString(),function(t){if("focus"===t){var n=i.findDOMNode(e);d.focusNode(n),h.scrollIntoViewIfNeeded(n)}e.setState({active:t})})},componentWillUnmount:function(){var e=i.findDOMNode(this);e.contains(document.activeElement)&&d.focusNodeOrParent(e.parentNode)},onClick:function(e){if(_.isFunction(this.props.onClick)){var t=this.props.msg,n=t.chat,r=n.getSearchContext(t);r.msg=t,this.props.onClick(e,n,r)}},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),b.flashFocus=Date.now(),this.onClick(e)},indicateFocus:function(e){if(!(Date.now()-(b.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=i.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},contextEnabled:function(){return!1},render:function(){var e=this.props.msg,t=r.createElement(c,{msg:e}),n=[];if(e.isSentByMe&&n.push(r.createElement(y,{msg:e,key:"symbol"})),!e.isSentByMe&&e.isGroupMsg&&!e.isNotification){var i=p("chat-status-name",{number:!e.senderObj.name});n.push(r.createElement(s,{text:this.state.formattedShortName,direction:"auto",classes:i,key:"author"})),n.push(r.createElement("span",{className:"chat-status-divider",key:"divider"},":"))}(e.hasSymbol||e.type===v.TYPE.DOCUMENT)&&n.push(r.createElement(l,{msg:e,key:"msg-symbol"})),n.push(r.createElement(s,{direction:e.dir,ellipsify:!0,text:g.msgText(e),key:"status"}));var o="chat-status";m.isGecko&&(o+=" ellipsify");var u=l10n.embedDir(g.msgText(e),e.rtl),d=r.createElement("div",{className:o,title:u},n),h={enter:this.onEnter},f=p("message",{active:!!this.state.active}),_=this.props.mouseDownAsClick;return r.createElement(b,{handlers:h,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover"},r.createElement(a,{id:e.id+"",ref:"cell",contextEnabled:this.contextEnabled,className:f,primary:e.chat.formattedTitle,primaryDetail:t,secondary:d,onClick:_?null:this.onClick,onMouseDown:_?this.onMouseDown:null,onContext:this.onMenu}))}});e.exports=w},function(e,t,n){"use strict";var r=n(6),i=n(359),o=n(800),a=n(799),s=r.createClass({displayName:"Status",mixins:[a],propTypes:{status:r.PropTypes.instanceOf(i)},getInitialState:function(){return{status:this.async("status.status")}},render:function(){return _.isUndefined(this.state.status)?r.createElement("div",{className:"muted"},l10n.t("contact_status_loading")):r.createElement("div",{className:"chat-status ellipsify",title:this.state.status},r.createElement(o,{direction:"auto",ellipsify:!0,text:this.state.status}))}});e.exports=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(710),o=r(i),a=n(6),s=n(28),c=n(807),l=n(9),u=n(842),d=n(102),p=n(81),h=n(104),f=n(808),m=n(820),g=n(801),v=n(812),y=n(912),E=n(80),b=n(105),w=b.HotKeys,S=a.createClass({displayName:"Chatlist",mixins:[d,p,h],propTypes:{isSearching:a.PropTypes.bool,chats:a.PropTypes.array,contacts:a.PropTypes.array,ftsResult:a.PropTypes.array,onClick:a.PropTypes.func,selection:a.PropTypes.instanceOf(f),onFocusSearch:a.PropTypes.func},getDefaultProps:function(){return{chats:[]}},getInitialState:function(){var e=this;return this._listPointerEvents=!0,this.debouncedOpenSelected=_.debounce(function(){e.openSelected(e.focusComposer),e.focusComposer=!1},200),{}},componentWillMount:function(){this.props.selection.init(this.getSelection())},componentWillUnmount:function(){var e=this.getSelection(),t=this.props.selection.getVal();t&&t.isState&&!this.props.isSearching&&!e.length&&l.clearChat(t)},componentDidMount:function(){this.regCmd("focus_chat_list",this.restoreFocus),this.regCmd("focus_next_chat",this.onNextChat.bind(this,null,!0)),this.regCmd("focus_prev_chat",this.onPrevChat.bind(this,null,!0)),this.regCmd("open_chat",this.updateSelected)},componentDidUpdate:function(){var e=this.props.selection.getVal();this.props.selection.init(this.getSelection(),!this.props.isSearching),e!==this.props.selection.getVal()&&this.debouncedOpenSelected()},onListPointerEventsOff:function(){this._listPointerEvents=!1},onListPointerEventsOn:function(){this._listPointerEvents=!0},updateSelected:function(e,t,n){this.debouncedOpenSelected.cancel(),this.props.selection.setVal(e,n)},openSelected:function(e){e=e||!1;var t=this.props.selection.getVal();t&&t instanceof g&&l.openChat(t,!1,e,!1)},onClick:function(e,t,n){var r=this;e.preventDefault(),e.stopPropagation(),Store.Chat.find(t.id).then(function(e){r.props.isSearching&&r.props.onClick&&r.props.onClick(),l.openChat(e,n,!0),n&&l.focusShowMsg(n.msg.id)})},getSelection:function(){return[].concat((0,o["default"])(this.props.chats),(0,o["default"])(this.props.contacts),(0,o["default"])(this.getFTSStarred()),(0,o["default"])(this.getFTSMessages()))},getFTSStarred:function(){return _.filter(this.props.ftsResult,{star:!0})},getFTSMessages:function(){return _.filter(this.props.ftsResult,{star:!1})},getList:function(){for(var e=this.props,t=e.chats,n=e.contacts,r=e.ftsResult,i=[],o=0;o<t.length;o++){var s=t[o];s&&(this.props.isSearching&&0===o&&(n.length||r.length)&&i.push(a.createElement(u,{key:"chat-header",header:l10n.t("web_chats")})),i.push(a.createElement(m,{chat:s,mode:m.Mode.LAST,onClick:this.onClick,mouseDownAsClick:!0,active:this.props.selection,key:s.id})))}for(var c=0;c<n.length;c++){var l=n[c];l&&(0===c&&i.push(a.createElement(u,{key:"contact-header",header:l10n.t("web_contacts")})),i.push(a.createElement(v,{contact:l,active:this.props.selection,onClick:this.onClick,mouseDownAsClick:!0,key:l.id})))}if(E.supportsFeature(E.F.FULL_TEXT_SEARCH)){for(var d=this.getFTSStarred(),p=0;p<d.length;p++){var h=d[p];0===p&&i.push(a.createElement(u,{key:"fts-header-starred",header:l10n.t("web_starred_messages")})),i.push(a.createElement(y,{msg:h,onClick:this.onClick,active:this.props.selection,key:h.id.toString()}))}for(var f=this.getFTSMessages(),g=0;g<f.length;g++){var _=f[g];0===g&&i.push(a.createElement(u,{key:"fts-header-messages",header:l10n.t("web_messages")})),i.push(a.createElement(y,{msg:_,onClick:this.onClick,active:this.props.selection,key:_.id.toString()}))}}return i},restoreFocus:function(){this.props.selection.reset()},onFocusGain:function(e){e.target===s.findDOMNode(this)&&this._listPointerEvents&&(this.props.selection.index<0?this.focusFirst():this.props.selection.reset())},focusFirst:function(){this.props.selection.setFirst(),this.debouncedOpenSelected()},onNextChat:function(e,t,n){e&&(e.preventDefault(),e.stopPropagation());var r=this.props.selection.next();this.props.selection.index!==r&&(this.props.selection.setNext(),this.focusComposer=n,this.debouncedOpenSelected())},onPrevChat:function(e,t,n){e&&(e.stopPropagation(),e.preventDefault());var r=this.props.selection.prev();r>-1?(this.props.selection.setPrev(),this.focusComposer=n,this.debouncedOpenSelected()):t||(this.debouncedOpenSelected.cancel(),this.openSelected(),this.props.onFocusSearch())},render:function(){var e=this,t={down:function(t){return e.onNextChat(t)},up:function(t){return e.onPrevChat(t)}};return a.createElement(w,{handlers:t,onFocus:this.onFocusGain,"data-tab":3},a.createElement(c,{classes:["chatlist"],data:this.getList(),height:72,animate:!0,extraItems:4,onPointerEventsOff:this.onListPointerEventsOff,onPointerEventsOn:this.onListPointerEventsOn}))}});e.exports=S},function(e,t,n){"use strict";var r=n(6),i=n(11),o=n(58),a=n(888),s=n(347),c=n(957),l=n(958),u=n(959),d=n(963),p=n(982),h=n(14),f=n(354),m=n(806),g=n(805),v=n(9),y=n(799),_=n(870),E=_.MenuBarItem,b=_.MenuBar,w=n(80),S=n(809),T=n(46),C=n(980),M=n(103),N="global_mute",k=r.createClass({displayName:"ChatlistHeader",mixins:[y],getDefaultProps:function(){return{muteId:N}},getInitialState:function(){return Store.Mute.globalMute(),{isMuted:this.async("muteId.Mute.isMuted")}},onMouseDown:function(){},onDrag:function(e){this.didDrag=!0},onClickCapture:function(e){},onNewChat:function(e){e.preventDefault(),v.openDrawer(r.createElement(c,{type:o.DRAWER_LEFT}))},onProfile:function(){v.openDrawer(r.createElement(a,{type:o.DRAWER_LEFT,id:Store.Conn.me}))},onUnmute:function(){Store.Mute.globalMute().unmute(),v.openToast(r.createElement(S,{msg:l10n.t("global_unmuted"),id:S.genId()}))},render:function(){var e=null;this.state.isMuted&&(e=r.createElement(E,{icon:"dnd",title:l10n.t("global_unmute"),onClick:this.onUnmute,key:"btn-dnd"}));var t=T("pane-list-user",{});return r.createElement("header",{className:"pane-header pane-list-header",onMouseDown:this.onMouseDown,onClickCapture:this.onClickCapture},r.createElement("div",{className:t},r.createElement(g,{id:Store.Conn.me,onClick:this.onProfile})),r.createElement("div",{className:"pane-list-controls"},r.createElement(b,{key:"chatlist-header"},r.createElement(M,{transitionName:"btn"},e,r.createElement(E,{a8n:"menu-bar-chat",icon:"chat",title:l10n.t("web_menuitem_new"),onClick:this.onNewChat}),r.createElement(E,{a8n:"menu-bar-menu",icon:"menu",title:l10n.t("menutitle_menu")},r.createElement(x,null))))))}});e.exports=k;var x=r.createClass({displayName:"ChatlistHeaderDropdown",getInitialState:function(){return{rememberMe:h.getRememberMe()}},onCreateGroup:function(){v.openDrawer(r.createElement(l,{type:o.DRAWER_LEFT}))},onProfile:function(){v.openDrawer(r.createElement(a,{type:o.DRAWER_LEFT,id:Store.Conn.me}))},onUploadLogs:function(){v.openModal(r.createElement(C,null))},onDisconnect:function(){var e=Store.Msg.any(function(e){return 0===e.ack&&e.local&&e.isSentByMe});return e?void v.openModal(r.createElement(s,{title:l10n.t("confirm_logout"),onOK:function(){return i.logout()},okText:l10n.t("menuitem_logout"),onCancel:function(){return v.closeModal()},cancelText:l10n.t("web_cancel")},l10n.t("some_of_your_messages_are_still_sending"))):i.logout()},onArchived:function(){v.openDrawer(r.createElement(d,{type:o.DRAWER_LEFT}))},onSettings:function(){v.openDrawer(r.createElement(u,{type:o.DRAWER_LEFT}))},onStarred:function(){Store.StarredMsg.sync(!1),v.openDrawer(r.createElement(p,{type:o.DRAWER_LEFT}))},render:function(){var e=w.supportsFeature(w.F.GROUP_CREATE)?r.createElement(m,{a8n:"mi-new-group menu-item",action:this.onCreateGroup,shortcut:"g"},l10n.t("web_menuitem_groupchat")):null,t=w.supportsFeature(w.F.STARRED)&&w.supportsFeature(w.F.FULL_TEXT_SEARCH)?r.createElement(m,{a8n:"mi-starred menu-item",action:this.onStarred},l10n.t("menuitem_starred")):null;return r.createElement(f,{type:f.Type.DROPDOWN_MENU,flipOnRTL:!0,key:"ChatlistHeader",direction:{x:f.Direction.X.LEFT}},e,r.createElement(m,{a8n:"mi-profile-status menu-item",action:this.onProfile},l10n.t("menuitem_profile_status")),r.createElement(m,{a8n:"mi-archived menu-item",action:this.onArchived},l10n.t("menuitem_archived")),t,r.createElement(m,{action:this.onSettings},l10n.t("menuitem_settings")),r.createElement(m,{a8n:"mi-logout menu-item",action:this.onDisconnect,shortcut:"q"},l10n.t("menuitem_logout")))}})},function(e,t,n){"use strict";var r=n(6),i=n(812),o=n(105),a=o.HotKeys,s=n(808),c=r.createClass({displayName:"ParticipantList",propTypes:{contacts:r.PropTypes.array.isRequired,onDelete:r.PropTypes.func.isRequired,onFocusSearch:r.PropTypes.func.isRequired},getInitialState:function(){return this.selection=new s(this.props.contacts,function(e){return e.id}),null},componentWillReceiveProps:function(e){this.selection.init(e.contacts,!0)},focusLast:function(){_.size(this.props.contacts)&&this.selection.setLast()},focusPrev:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.prev();t>-1&&this.selection.setPrev()},focusNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.next();this.selection.index===t?(this.selection.unset(),this.props.onFocusSearch(e)):this.selection.setNext()},deleteContact:function(e){e.preventDefault(),e.stopPropagation();var t=_.find(this.props.contacts,this.selection.getVal());this.props.onDelete(e,t)},onParticipantClick:function(e,t){this.selection.setVal(t)},render:function(){var e=this.props.contacts;if(!e)return null;var t=_.size(this.props.contacts)?_.map(this.props.contacts,function(e){return r.createElement(i,{contact:e,active:this.selection,onDelete:this.props.onDelete,onClick:this.onParticipantClick,type:i.Type.SMALL,key:e.id})},this):null,n={up:this.focusPrev,down:this.focusNext,backspace:this.deleteContact};n[l10n.LR("left","right")]=this.focusPrev,n[l10n.LR("right","left")]=this.focusNext;var o=r.createElement("ul",{ref:"list"},t);return r.createElement(a,{handlers:n},o)}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(102),a=n(81),s=n(814),c=n(915),l=n(830),u=n(914),d=n(815),p=n(906),h=n(58),f=n(9),m=n(80),g=n(902),v=n(21),y=n(808),E=n(708),b=n(105),w=b.HotKeys,S=2,T=r.createClass({displayName:"ChatlistPanel",mixins:[o,a,E,s],getInitialState:function(){var e=this;return this.fts=_.debounce(function(){e.pending=!1;var t=_.trim(e.state.searchText||"");g.multibyteLength(t)<S||Store.Msg.search(t,1,100).checkpoint(e.rejectOnUnmount()).then(function(n){t===e.state.searchText&&e.setState({ftsResult:n.messages,searching:!1})})["catch"](v.Unmount,_.noop)["catch"](function(){e.pending||e.setState({searching:!1})})},750),this.selection=new y([],function(e){return e.id.toString()}),this.throttledFilteredChats=_.throttle(function(){var t=e.getFilteredChats(e.state.searchText);e.setState({chats:t})},450,{trailing:!0}),this.throttledFilteredContacts=_.throttle(function(){var t=e.getFilteredContacts(e.state.searchText);e.setState({contacts:t})},450,{trailing:!0}),{searchText:"",searching:!1,ftsResult:[],chats:this.getFilteredChats(),contacts:this.getFilteredContacts()}},componentDidMount:function(){this.regCmd("focus_chat_search",this.onFocusSearch)},componentWillUnmount:function(){this.fts.cancel(),this.throttledFilteredChats.cancel(),this.throttledFilteredContacts.cancel()},getFilteredContacts:function(e){if(!e)return[];e=l10n.accentFold(e);var t=Store.Contact.getFilteredContacts();return t.filter(function(t){var n=t.searchMatch(e);if(!n)return!1;var r=Store.Chat.get(t.id);return!r||r.isNewlyCreated()})},getFilteredChats:function(e){return e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.contact.searchMatch(e)&&!t.isNewlyCreated()})):Store.Chat.filter(function(e){return!e.archive&&!e.isNewlyCreated()})},fullTextSearch:function(e){var t=_.trim(e);g.multibyteLength(t)>=S&&m.supportsFeature(m.F.FULL_TEXT_SEARCH)?(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0})):(this.fts.cancel(),this.pending=!1,this.state.searching&&this.setState({searching:!1}))},componentWillMount:function(){var e=this;this.addObserver(Store.Chat,"sort remove change:archive",function(){e.state.searchText||(e.throttledFilteredChats.cancel(),e.throttledFilteredContacts.cancel(),e.setState({chats:e.getFilteredChats(),contacts:e.getFilteredContacts()}))})},onSearch:function(e){var t={searchText:e};this.state.searchText!==e&&(this.fullTextSearch(e),this.throttledFilteredChats(),this.throttledFilteredContacts(),t.ftsResult=[]),e||(this.fts.cancel(),this.throttledFilteredChats.cancel(),this.throttledFilteredContacts.cancel(),t.chats=this.getFilteredChats(),t.contacts=this.getFilteredContacts()),this.setState(t)},onStopSearch:function(){this.fts.cancel(),this.throttledFilteredChats.cancel(),this.throttledFilteredContacts.cancel(),this.pending=!1,this.setState({searchText:"",ftsResult:[],chats:this.getFilteredChats(),contacts:this.getFilteredContacts(),searching:!1})},onFocusList:function(e){e.repeat||this.refs.chatlist&&this.refs.search.isAtEnd()&&(e.preventDefault(),e.stopPropagation(),w.flashFocus=Date.now(),this.refs.chatlist.focusFirst())},onOpenFirst:function(e){var t=this;e.preventDefault();var n=_.first(this.state.chats)||_.first(this.state.contacts);n&&Store.Chat.find(n.id).then(function(e){t.onStopSearch(),w.flashFocus=Date.now(),f.openChat(e),f.focusChatTextInput(e)})},onFocusConversation:function(e){e.repeat||this.refs.search.isAtEnd()&&(e.stopPropagation(),e.preventDefault(),w.flashFocus=Date.now(),f.focusChatTextInput())},onFocusSearch:function(e){h.find(h.DRAWER_LEFT)||(w.flashFocus=Date.now(),h.focusNode(this.refs.search))},indicateFocus:function(e){if(!(Date.now()-(w.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.input_hotkey);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},getEmptyChatlistState:function(e,t,n){if(e.length||t.length||n.length)return null;if(this.state.searchText)return this.state.searching?r.createElement(d.Searching,null):r.createElement(d.Search,null);var i=_.some(Store.Chat.filter(function(e){return!e.isNewlyCreated()}));return i?r.createElement(d.AllArchived,null):r.createElement(d.ListChats,null)},render:function(){var e=this.state,t=e.chats,n=e.contacts,i=this.state.ftsResult,o=this.getEmptyChatlistState(t,n,i);o||(o=r.createElement(u,{ref:"chatlist",chats:t,contacts:n,isSearching:!!this.state.searchText,ftsResult:i,selection:this.selection,onFocusSearch:this.onFocusSearch,onClick:this.onStopSearch}));var a={down:this.onFocusList,
enter:this.onOpenFirst};return a[l10n.LR("right","left")]=this.onFocusConversation,r.createElement("div",{id:"side",className:"pane pane-list pane-one"},r.createElement(c,{key:"ChatHeader"}),r.createElement(p,{key:"ButterBar"}),r.createElement(w,{handlers:a,onFocus:this.indicateFocus,ref:"input_hotkey",className:"search-container"},r.createElement(l,{searchText:this.state.searchText,ref:"search",onSearch:this.onSearch,searchType:h.CHAT_SEARCH,searching:this.state.searching})),r.createElement("div",{ref:"panel",className:"pane-body pane-list-body",id:"pane-side","data-list-scroll-container":!0},o))}});e.exports=T},function(e,t,n){"use strict";var r=n(6),i=n(801),o=n(799),a=n(806),s=r.createClass({displayName:"ArchiveMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(i).isRequired,onArchive:r.PropTypes.func.isRequired},getInitialState:function(){return{archive:this.async("chat.archive")}},render:function(){var e=this.props.onArchive.bind(null,!this.state.archive);return r.createElement(a,{a8n:"mi-archive",action:e,shortcut:"a",key:"ArchiveMenuItem"},this.state.archive?l10n.t("unarchive_chat"):l10n.t("archive_chat"))}});e.exports=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(157),o=r(i),a=n(351),s=r(a),c=n(6),l=n(107),u=n(46),d=function(e){var t=e.className,n=e.children,r=(0,s["default"])(e,["className","children"]),i=u("doc-state",t);return c.createElement("div",(0,o["default"])({className:i},r),n)},p=function(){return c.createElement(d,null,c.createElement("span",{className:"icon doc-state-icon icon-audio-download"}))},h=function(){return c.createElement(d,null,c.createElement(l,{stroke:3,size:32}))},f=function(){return c.createElement(d,null,c.createElement("span",{className:"icon doc-state-icon icon-audio-cancel-noborder"},c.createElement(l,{stroke:3,size:32})))},m=function(){return c.createElement(d,null,c.createElement("span",{className:"icon doc-state-icon icon-audio-upload"}))};e.exports={Download:p,Pending:h,PendingCancel:f,Upload:m}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(707),o=r(i),a=n(6),s=n(28),c=n(104),l=n(160),u=a.createClass({displayName:"Draggable",mixins:[c],propTypes:{children:a.PropTypes.node.isRequired,start:a.PropTypes.shape({x:a.PropTypes.number,y:a.PropTypes.number}),scale:a.PropTypes.number,container:a.PropTypes.shape({width:a.PropTypes.number.isRequired,height:a.PropTypes.number.isRequired}),onStart:a.PropTypes.func,onDrag:a.PropTypes.func,onStop:a.PropTypes.func},getInitialState:function(){return{dragging:!1,x:0,y:0,offsetX:0,offsetY:0}},componentDidMount:function(){this.updateContainer()},componentWillReceiveProps:function(e){e.scale!==this.props.scale||e.container.width!==this.props.container.width||e.container.height!==this.props.container.height?this.updateContainer(e,!0):this.updateContainer(e)},updateContainer:function(e,t){e=e||this.props;var n=e.container;if(n&&this.refs.draggable){var r,i=s.findDOMNode(this.refs.draggable),o=this.state.x,a=this.state.y,c=i.width*e.scale,l=i.height*e.scale;this.props.scale!==e.scale&&this.state.center?(r=this.state.center,o=n.width/2-r.x*c,a=n.height/2-r.y*l):r={x:(n.width/2-o)/c,y:(n.height/2-a)/l},o>0?o=0:o+c<n.width&&(o=n.width-c),a>0?a=0:a+l<n.height&&(a=n.height-l),this.setState({width:c,height:l,x:o,y:a,center:r}),this.props.onStop&&t&&e.onStop(o,a)}},handleMouseDown:function(e){e.preventDefault(),this.setState({dragging:!0,offsetX:e.clientX-this.state.x,offsetY:e.clientY-this.state.y}),this.regNativeListener(window,"mousemove",this.handleMouseMove),this.regNativeListener(window,"mouseup",this.handleMouseUp),this.props.onStart&&this.props.onStart()},handleMouseUp:function(e){this.unregisterListeners(),this.setState({dragging:!1}),this.props.onStop&&this.props.onStop(this.state.x,this.state.y)},handleMouseMove:function(e){if(this.state.dragging){var t=e.clientX-this.state.offsetX,n=e.clientY-this.state.offsetY,r=this.props.container;r&&((t>0||t+this.state.width<r.width)&&(t=this.state.x),(n>0||n+this.state.height<r.height)&&(n=this.state.y)),this.setState({x:t,y:n}),this.props.onDrag&&this.props.onDrag(t,n)}},render:function(){var e=this.props.scale?" scale("+this.props.scale+")":"",t=(0,o["default"])({},l.prefix("transform"),"translate("+this.state.x+"px, "+this.state.y+"px)"+e);this.state.dragging||(t[l.prefix("transition")]="transform 200ms");var n="draggable";return this.state.dragging&&(n+=" dragging"),a.cloneElement(a.Children.only(this.props.children),{style:t,draggable:!0,ref:"draggable",className:n,onMouseDown:this.handleMouseDown})}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=r.createClass({displayName:"FloatingPlaceholder",propTypes:{children:r.PropTypes.node.isRequired,placeholder:r.PropTypes.string,hasText:r.PropTypes.bool},render:function(){var e="placeholder";return this.props.hasText&&(e+=" placeholder-enter"),this.props.placeholder?r.createElement("div",{className:"floating-placeholder"},r.createElement("span",{className:e},this.props.placeholder),this.props.children):this.props.children}});e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(157),o=r(i),a=n(351),s=r(a),c=n(6),l=n(831),u=n(46),d=c.createClass({displayName:"ImageLoader",propTypes:{src:c.PropTypes.string.isRequired,onError:c.PropTypes.func},getInitialState:function(){return{loaded:!1}},componentWillMount:function(){var e=new Image;e.src=this.props.src,e.complete&&this.onLoad()},onLoad:function(e){this.state.isLoaded||this.setState({loaded:!0}),this.props.onLoad&&this.props.onLoad(e)},render:function(){var e=this.props,t=e.className,n=(e.onLoad,(0,s["default"])(e,["className","onLoad"]));return t=u("avatar-image",t,{"is-loaded":this.state.loaded}),c.createElement(l,(0,o["default"])({hasPrivacyChecks:!0,onLoad:this.onLoad,className:t},n))}});e.exports=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(351),o=r(i),a=n(6),s=a.createClass({displayName:"IsolatedBlock",propTypes:{Component:a.PropTypes.string.isRequired},getDefaultProps:function(){return{Component:"span"}},render:function(){var e=this.props,t=e.Component,n=e.children,r=(0,o["default"])(e,["Component","children"]);return a.createElement(t,r,"​⁠​",n,"​⁠​")}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(801),o=n(799),a=n(806),s=r.createClass({displayName:"MarkUnreadMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(i).isRequired,onMarkUnread:r.PropTypes.func.isRequired},getInitialState:function(){return{unreadCount:this.async("chat.unreadCount")}},render:function(){var e=this.props.onMarkUnread.bind(null,!this.state.unreadCount);return r.createElement(a,{action:e,shortcut:"r",key:"MarkUnreadMenuItem"},this.state.unreadCount?l10n.t("mark_read_chat"):l10n.t("mark_unread_chat"))}});e.exports=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(58),c=n(21),l=n(9),u=n(806),d=n(965),p=n(833),h=a.createClass({displayName:"TakePhotoMenuItem",propTypes:{onImageTake:a.PropTypes.func.isRequired},onCapture:function(){s.pop(s.MENU);var e=this,t=new o["default"](function(n,r){navigator.getUserMedia({video:!0},function(r){l.closeModal(),n(r),t.isPending()||l.openModal(a.createElement(d,{stream:r,onSend:e.props.onImageTake}))},function(e){var n=_.isString(e)?e:e.name,i=c.GUM[n]||c.GUM.GUMError;r(new i),t&&!t.isPending()&&l.closeModal()})}).bind(this).timeout(1500,"waitForGUMTakePhotoTimeout").then(function(e){l.openModal(a.createElement(d,{stream:e,onSend:this.props.onImageTake}))})["catch"](o["default"].TimeoutError,function(e){l.openModal(a.createElement(p,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:p.TYPE.GUIDE_ALLOW}))})["catch"](c.GUM.PermissionDeniedError,function(){l.openModal(a.createElement(p,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:p.TYPE.GUIDE_UNBLOCK}))})["catch"](c.GUM.GUMError,function(){l.openModal(a.createElement(p,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:p.TYPE.GUIDE_NONE}))})},render:function(){return a.createElement(u,{action:this.onCapture},l10n.t("take_photo"))}});e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(104),a=n(708),s=r.createClass({displayName:"Video",mixins:[o,a],propTypes:{src:r.PropTypes.string.isRequired,onPlay:r.PropTypes.func},componentDidMount:function(){var e=i.findDOMNode(this),t=this;this.regNativeListener(e,"playing",function(n){e.videoHeight&&e.videoWidth||(e.pause(),e.play()),e.videoHeight&&e.videoWidth&&t.props.onPlay(n)})},render:function(){return r.createElement("video",this.props)}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(11),a=n(81),s=n(104),c=n(153),l=n(9),u=n(47),d=n(798),p=r.createClass({displayName:"VideoTag",mixins:[a,s,c],propTypes:{msg:r.PropTypes.instanceOf(d).isRequired,poster:r.PropTypes.string,className:r.PropTypes.string,controls:r.PropTypes.bool,width:r.PropTypes.number,height:r.PropTypes.number,onClick:r.PropTypes.func,onPlay:r.PropTypes.func,onError:r.PropTypes.func,autoPlay:r.PropTypes.bool},componentDidMount:function(){var e=i.findDOMNode(this);this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying),this.regNativeListener(e,"error",this.onPlayerError,!0),(u.isGecko||u.isSafari)&&(this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(o.state===o.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>240)return void this.onPlayerError({target:{src:this.props.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=i.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e)},onOtherPlaying:function(e){e!==this&&i.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),l.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){var e={height:this.props.height,width:this.props.width};return r.createElement("video",{src:this.props.msg.url,poster:this.props.poster,style:e,width:this.props.width,height:this.props.height,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,autoPlay:this.props.autoPlay},this.props.children)}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(81),a=n(104),s=n(102),c=n(952),l=n(960),u=n(21),d=n(7),p=n(48),h=n(9),f=void 0,m=r.createClass({displayName:"Conversation",mixins:[o,a,s],getInitialState:function(){return{chat:void 0,msgCollection:void 0,focusCtx:void 0}},componentWillMount:function(){this.regCmd("open_chat",this.handleOpenChat),this.regCmd("clear_chat",this.handleClearChat),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus)},componentDidMount:function(){this.regNativeListener(window,"resize",this.windowResized),this.windowResized()},windowResized:_.debounce(function(){f=i.findDOMNode(this).clientHeight},100),componentDidUpdate:function(e,t){var n=this.state.chat,r=t.chat;n&&r!==n&&(this.addObserver(n,"change:cmc:merge",this.msgCollectionChanged),r&&this.removeObserver(r,"change:cmc:merge"))},msgCollectionChanged:function(e,t,n){var r=this.state.msgCollection;r!==e&&r!==t||this.setState({msgCollection:n})},windowGainedFocus:function(){p.markAvailable();var e=this.state.conversation;e&&e.isUser&&e.presence.subscribe()["catch"](u.WapDrop,_.noop)},windowLostFocus:function(){p.markUnavailable(d.SEND_UNAVAILABLE_WAIT)},handleClearChat:function(e){this.state.chat===e&&this.setState({chat:void 0,msgCollection:void 0,focusCtx:void 0})},handleOpenChat:function(e,t,n,r,i){if(n&&this.state.chat===e&&h.focusChatTextInput(e),r||this.state.chat!==e||t&&this.state.msgCollection!==t.collection||!t&&this.state.msgCollection!==this.state.chat.msgs||t&&this.state.focusCtx&&this.state.focusCtx.msg!==t.msg){h.setUiBusy(!0);var o=function(){n&&h.focusChatTextInput(e),h.setUiBusy(!1)};this.setState({chat:e,msgCollection:t?t.collection:e.msgs,focusCtx:i?void 0:t?t:void 0},o)}},render:function(){var e=this.state.chat;return e?r.createElement(c,{key:e.id,chat:e,msgCollection:this.state.msgCollection,height:f,focusCtx:this.state.focusCtx}):r.createElement(l,null)}});e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(28),c=n(7),l=n(356),u=n(799),d=n(814),p=n(58),h=n(875),f=n(801),m=n(869),g=n(873),v=n(805),y=n(800),E=n(822),b=n(956),w=n(884),S=n(886),T=n(882),C=n(9),M=n(833),N=n(347),k=n(21),x=n(870),P=x.MenuBar,D=x.MenuBarItem,A=n(354),I=n(826),R=n(962),O=n(872),L=a.createClass({displayName:"ConversationHeader",mixins:[u],propTypes:{chat:a.PropTypes.instanceOf(f).isRequired,onSelectMessages:a.PropTypes.func.isRequired,canAttach:a.PropTypes.bool.isRequired},statics:{ATTACH_MEDIA_ACTIVE:"attach_media_active",GROUP_CHAT_ACTIVE:"group_chat_active"},getInitialState:function(){return this.asyncState({img:"chat.ProfilePicThumb.img",formattedTitle:"chat.formattedTitle"},{activeDropdown:void 0})},onMouseDown:function(e){},onDrag:function(e){this.didDrag=!0},onClickCapture:function(e){},onClick:function(){var e=this.props.chat;e.isUser?C.openDrawer(a.createElement(w,{contact:e.contact,type:p.DRAWER_RIGHT}),"slide-left"):e.isBroadcast?C.openDrawer(a.createElement(T,{chat:e,type:p.DRAWER_RIGHT}),"slide-left"):e.isGroup&&C.openDrawer(a.createElement(S,{chat:e,type:p.DRAWER_RIGHT}),"slide-left")},checkForDrawerMid:function(e){p.find(p.DRAWER_MID)&&e.preventDefault()},render:function(){var e,t,n=this.props.chat;return n.isUser?(e=a.createElement(j,{chat:n,onSelectMessages:this.props.onSelectMessages}),t=a.createElement(g,{presence:n.presence,placeholder:l10n.t("click_here_for_user_info"),location:"title"})):n.isBroadcast?(e=a.createElement(G,{chat:n,onSelectMessages:this.props.onSelectMessages}),t=null):n.isGroup&&(e=a.createElement(B,{chat:n,onSelectMessages:this.props.onSelectMessages}),t=a.createElement(m,{presence:n.presence,groupMetadata:n.groupMetadata,placeholder:l10n.t("click_here_for_group_info"),location:"title"})),a.createElement("header",{className:"pane-header pane-chat-header",onClickCapture:this.onClickCapture,onMouseDown:this.onMouseDown},a.createElement("div",{className:"chat-avatar",onClick:this.onClick},a.createElement(v,{id:n.id})),a.createElement("div",{className:"chat-body",onClick:this.onClick},a.createElement("div",{className:"chat-main"},a.createElement("h2",{className:"chat-title",dir:"auto"},a.createElement(y,{text:this.state.formattedTitle,titlify:!0,ellipsify:!0}))),t),a.createElement("div",{className:"pane-chat-controls"},a.createElement(P,{key:"conversation-header"},a.createElement(D,{a8n:"conversation-clip",icon:"clip",title:l10n.t("menutitle_attach"),transitionName:"menu",disabled:!this.props.canAttach,onClick:this.checkForDrawerMid},a.createElement(U,{chat:n})),a.createElement(D,{a8n:"conversation-menu",icon:"menu",title:l10n.t("menutitle_menu"),onClick:this.checkForDrawerMid},e))))}}),U=a.createClass({displayName:"AttachMenuDropdown",mixins:[d],propTypes:{chat:a.PropTypes.instanceOf(f).isRequired},getInitialState:function(){return{canSendDocument:void 0}},componentWillMount:function(){var e=this;this.props.chat.shouldSendEncrypted("document").checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({canSendDocument:t})})["catch"](k.CapabilityError,function(){e.setState({canSendDocument:!1})})["catch"](k.Unmount,_.noop)},confirmDocumentSend:function(e){var t=this,n=this.props.chat,r=void 0;r=n.isUser?l10n.t("confirm_document_send_chat",{name:e.name,chat:this.props.chat.formattedTitle}):n.isGroup?l10n.t("confirm_document_send_group",{name:e.name,chat:this.props.chat.formattedTitle}):l10n.t("confirm_document_send_broadcast",{name:e.name}),C.openModal(a.createElement(N,{key:"doc_confirm",onOK:function(){t.sendDocument(n,e)},onCancel:function(){C.closeModal()}},r))},sendDocument:function(e,t){var n=this;e.shouldSendEncrypted("document").then(function(e){return!!e})["catch"](function(){return!1}).then(function(r){r?I.prepFileForUpload(t).then(function(t){e.sendMedia2(t)})["catch"](n.showCantSendDocument):n.showCantSendDocument()}),C.closeModal()},onDocumentPick:function(e){e.stopPropagation();var t=e.target.files[0];e.target.value="",p.pop(p.MENU),this.state.canSendDocument===!1?this.showCantSendDocument():this.confirmDocumentSend(t)},onFilePick:function(e){e.stopPropagation();var t=_.toArray(e.target.files);e.target.value="",p.pop(p.MENU),this.openAttachMediaFlow(t)},openAttachMediaFlow:function(e){C.openDrawer(a.createElement(E,{files:e,chat:this.props.chat,type:p.DRAWER_MID}),"slide-up")},onImageClick:function(e){e.preventDefault(),e.stopPropagation(),s.findDOMNode(this.refs.imagePicker).click()},onDocumentClick:function(e){e.preventDefault(),e.stopPropagation(),this.state.canSendDocument===!1?(p.pop(p.MENU),this.showCantSendDocument()):s.findDOMNode(this.refs.documentPicker).click()},showCantSendDocument:function(e){var t;if(e instanceof k.InvalidMediaFileType)t=l10n.t("cannot_send_document_type_unsupported");else{var n=this.props.chat;t=n.isUser?l10n.t("cannot_send_document_to_contact_unsupported",{contact:n.formattedTitle}):l10n.t("cannot_send_document_to_group_unsupported",{group:n.formattedTitle})}C.openModal(a.createElement(N,{key:"doc_cant_send",onOK:C.closeModal.bind(C)},a.createElement(y,{text:t})))},onCaptureClick:function(){var e=this;p.pop(p.MENU);var t=this.props.chat,n=new o["default"](function(r,i){navigator.getUserMedia({video:!0},function(i){if(C.closeModal(),r(i),!n.isPending()){if(!e.isMounted())return;C.openDrawer(a.createElement(b,{chat:t,stream:i,type:p.DRAWER_MID}),"slide-up")}},function(e){var t=_.isString(e)?e:e.name,r=k.GUM[t]||k.GUM.GUMError;i(new r),n&&!n.isPending()&&C.closeModal()})}).bind(this).timeout(1e3,"waitForGUMConversationHeaderTimeout").then(function(e){C.openDrawer(a.createElement(b,{chat:t,stream:e,type:p.DRAWER_MID}),"slide-up")})["catch"](o["default"].TimeoutError,function(){C.openModal(a.createElement(M,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:M.TYPE.GUIDE_ALLOW}))})["catch"](k.GUM.PermissionDeniedError,function(){C.openModal(a.createElement(M,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:M.TYPE.GUIDE_UNBLOCK}))})["catch"](k.GUM.GUMError,function(){C.openModal(a.createElement(M,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:M.TYPE.GUIDE_NONE}))})},render:function(){var e,t,r=a.createElement(O,{direction:"left",body:l10n.t("attach_capture")}),i=navigator.getUserMedia?a.createElement(R,{tooltip:r,onAction:this.onCaptureClick},a.createElement("button",{className:"menu-icons-item"},a.createElement("div",{className:"icon-xl icon-camera"}))):null,o=n(80);if(o.supportsFeature(o.F.ENC_DOC)){var s=a.createElement(O,{direction:"left",body:l10n.t("attach_document")});e=a.createElement(R,{tooltip:s,onAction:this.onDocumentClick},a.createElement("button",{className:"menu-icons-item"},a.createElement("div",{className:"icon-xl icon-document"}))),t=a.createElement(F,{ref:"documentPicker",mime:l.DOC_MIMES,onPick:this.onDocumentPick})}var u=a.createElement(O,{direction:"left",body:l10n.t("attach_media")}),d=a.createElement(R,{tooltip:u,onAction:this.onImageClick},a.createElement("button",{className:"menu-icons-item"},a.createElement("div",{className:"icon-xl icon-image"})));return a.createElement("div",null,a.createElement(A,{type:A.Type.MENU,key:"AttachMenuDropdown"},d,i,e),t,a.createElement(F,{ref:"imagePicker",multiple:!0,mime:[c.IMAGE_MIMES,c.VIDEO_MIMES].join(","),onPick:this.onFilePick}))}}),F=a.createClass({displayName:"FilePicker",propTypes:{mime:a.PropTypes.string.isRequired,multiple:a.PropTypes.bool,onPick:a.PropTypes.func.isRequired},stopPropagation:function(e){e.stopPropagation()},render:function(){return a.createElement("input",{accept:this.props.mime,type:"file",multiple:this.props.multiple,style:{display:"none"},onChange:this.props.onPick,onClick:this.stopPropagation})}}),B=a.createClass({displayName:"GroupMenuDropdown",mixins:[u],propTypes:{chat:a.PropTypes.instanceOf(f).isRequired,onSelectMessages:a.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e=h.group(this.props.chat,this.props.onSelectMessages);return a.createElement(A,{type:A.Type.DROPDOWN_MENU,key:"GroupMenuDropdown",flipOnRTL:!0,direction:{x:A.Direction.X.LEFT}},e)}}),G=a.createClass({displayName:"BroadcastMenuDropdown",propTypes:{chat:a.PropTypes.instanceOf(f).isRequired,onSelectMessages:a.PropTypes.func.isRequired},render:function(){var e=h.broadcast(this.props.chat,this.props.onSelectMessages);return a.createElement(A,{type:A.Type.DROPDOWN_MENU,key:"BroadcastMenuDropdown",flipOnRTL:!0,direction:{x:A.Direction.X.LEFT}},e)}}),j=a.createClass({displayName:"ContactMenuDropdown",propTypes:{chat:a.PropTypes.instanceOf(f).isRequired,onSelectMessages:a.PropTypes.func.isRequired},render:function(){var e=h.contact(this.props.chat,this.props.onSelectMessages);return a.createElement(A,{type:A.Type.DROPDOWN_MENU,key:"ContactMenuDropdown",flipOnRTL:!0,direction:{x:A.Direction.X.LEFT}},e)}});e.exports=L},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){for(var t=arguments.length<=1||void 0===arguments[1]?window.innerHeight:arguments[1],n=0,r=e.length,i=1;r>i;++i){var o=e[r-i];switch(o.type){case"notification":case"group_notification":case"gp2":case"broadcast_notification":n+=40;break;case"chat":n+=30+20*Math.ceil((o.body||"").length/80);break;case"image":case"video":case"audio":n+=200;break;case"location":case"ptt":case"vcard":case"document":n+=100}if(n>t)break}return i}var o=n(707),a=r(o),s=n(3),c=r(s),l=n(6),u=n(28),d=n(7),p=n(799),h=n(102),f=n(81),m=n(153),g=n(814),v=n(949),y=n(931),E=n(9),b=n(801),w=n(824),S=n(49),T=n(104),C=n(47),M=n(835),N=n(825),k=n(58),x=n(822),P=n(46),D=n(875),A=n(62),I=n(1018),R=n(798),O=n(945),L=n(103),U=n(21),F=3e3,B=l.createClass({displayName:"ConversationMsgs",mixins:[p,f,h,T,m,g],propTypes:{chat:l.PropTypes.instanceOf(b).isRequired,msgCollection:l.PropTypes.instanceOf(w).isRequired,selectable:l.PropTypes.bool,onMessageSelect:l.PropTypes.func.isRequired,onSelectMessages:l.PropTypes.func.isRequired,height:l.PropTypes.number,focusCtx:l.PropTypes.object},getInitialState:function(){var e=this.props,t=e.focusCtx,n=e.chat,r=e.msgCollection,o=e.height;this.dateMarkerPositions=null,this.floatingDateMarker=S.createEmitter();var a=i.bind(this,r.models,o),s=t||this.getUnreadFocusCtx(),c=s&&s.msg;return{msgListKey:0,cursor:new I(r.indexOf(c),a),unreadCount:n.unreadCount,newUnread:0,focusCtx:s}},componentWillMount:function(){this._hideStickyDateMarkerTimer=new A(this,this.hideFloatingMarker)},componentDidMount:function(){var e=this.refs.messageList;!this._scrollMsg&&e&&e.scrollBottom(this.refs.scrollContainer,!0);var t=this.props,n=t.chat,r=t.msgCollection;if(this.regCmd("open_chat",this.onOpenChat),this.regCmd("compose_height_change",this.composeHeightChange),this.attachMsgCollectionObservers(this.props,void 0),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus),this.addObserver(n,"change:trusted"),n.isGroup?this.addObserver(n.groupMetadata.participants,"change:contact.name change:contact.isMyContact",this.rerender):n.isUser&&this.addObserver(n.contact,"change:isMyContact",this.rerender),this.addObserver(r,"change:star",this.rerender),!this.props.focusCtx){var i=u.findDOMNode(this.refs.scrollContainer);0===i.scrollTop&&this.loadEarlierMsgs()}this.updateFloatingDateMarker(),n.sendSeen()},rerender:function(){var e=this,t=u.findDOMNode(this.refs.scrollContainer),n=t.scrollTop;this.setState({msgListKey:this.state.msgListKey+1},function(){e.setScrollTop(t,n)})},componentDidUpdate:function(e,t){if(this.loadingRecent=!1,t.msgListKey===this.state.msgListKey){var n=e.chat===this.props.chat;this.updateFloatingDateMarker(n)}},attachMsgCollectionObservers:function(e,t){var n=this,r=e.chat,i=e.msgCollection,o=e.focusCtx;this.props.msgCollection&&(this.removeObserver(this.props.chat,"change:unreadCount"),this.removeObserver(this.props.msgCollection,"change:last"),this.removeObserver(this.props.msgCollection,"remove")),i===r.msgs&&(this.addObserver(r,"change:unreadCount",this.onUnreadCount),this.addObserver(i,"change:last",this.onLastMsgChanged)),this.addObserver(i,"remove");var a=void 0;if(o&&o!==t||!o&&(a=this.getUnreadFocusCtx())){var s=i.loadAroundPromise||c["default"].resolve();s.checkpoint(this.rejectOnUnmount()).then(function(){var e=o||a;n.setState({cursor:n.state.cursor.init(i.indexOf(e.msg)),focusCtx:e},function(){n._scrollMsg&&n.isMounted()&&N.scrollIntoView(n._scrollMsg,!0,n._scrollMsg.parentNode.parentNode)})})["catch"](U.Unmount,_.noop)}},isMostRecentCMC:function(){return this.props.chat.msgs===this.props.msgCollection},componentWillReceiveProps:function(e){this.attachMsgCollectionObservers(e,this.props.focusCtx)},componentWillUnmount:function(){this._hideStickyDateMarkerTimer.cancel(),this.maybeSendSeen()&&(this.props.chat.markedUnread=!1)},loadEarlierMsgs:function(){var e=this,t=this.props,n=t.chat,r=t.msgCollection,i=this.state.cursor;if(i.start>0)this.setState({cursor:i.loadBefore()});else{if(r.msgLoadState.noEarlierMsgs||r.msgLoadState.isLoadingEarlierMsgs)return;n.loadEarlierMsgs(r).checkpoint(this.rejectOnUnmount()).then(function(){e.setState({cursor:i.loadBefore()})})["catch"](U.Unmount,_.noop)["catch"](function(e){})}},loadRecentMsgs:function(){var e=this,t=this.props,n=t.chat,r=t.msgCollection,i=this.state.cursor;if(i.end<r.length)this.loadingRecent=!0,this.setState({cursor:i.loadAfter()});else{if(r.msgLoadState.isLoadingRecentMsgs)return;n.loadRecentMsgs(r).checkpoint(this.rejectOnUnmount()).then(function(){e.loadingRecent=!0,e.setState({cursor:i.loadAfter()})})["catch"](U.Unmount,_.noop)["catch"](function(e){})}},composeHeightChange:function(e){var t=this,n=u.findDOMNode(this.refs.scrollContainer);if(e){if(0>e&&n.scrollTop===n.scrollHeight-n.clientHeight)return;this.setScrollTop(n,n.scrollTop+e)}else{var r=n.scrollHeight-(n.scrollTop+n.clientHeight);Velocity(n,{tween:18},{progress:function(){t.setScrollTop(n,n.scrollHeight-r-n.clientHeight)},duration:300},[.1,.82,.25,1])}},onStickyDateMarkerUpdated:function(e){var t=this.refs.stickyDateMarker;t&&t.updateDateMarkerText(e)},dateMarkerPositionsChanged:function(e){_.isEqual(e,this.dateMarkerPositions)||(this.dateMarkerPositions=e,this.updateFloatingDateMarker())},hideFloatingMarker:function(){var e=this.refs.stickyDateMarker;e&&e.hideStickyDateMarker(!0)},setScrollTop:function(e,t){this.programmaticScroll=Date.now(),e.scrollTop=t},updateFloatingDateMarker:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];if(this.isMounted()&&this.dateMarkerPositions){var t=e||Date.now()-(this.programmaticScroll||0)<200;if(!t){var n=this.refs.stickyDateMarker;n&&n.hideStickyDateMarker(!1)}var r=u.findDOMNode(this.refs.scrollContainer).scrollTop,i=this.dateMarkerPositions.length,o=_.findIndex(this.dateMarkerPositions,function(e){return r+8.5>=e});-1===o&&this.onStickyDateMarkerUpdated();var a=-1===o?o:i-o-1;this.floatingDateMarker.trigger("update_floating_date_marker",a),t||this._hideStickyDateMarkerTimer.debounce(F)}},nearBottom:function(e){return e=e||u.findDOMNode(this.refs.scrollContainer),e.scrollTop+d.SCROLL_FUDGE>e.scrollHeight-e.clientHeight},getUnreadFocusCtx:function(){var e,t=this.props,n=t.chat,r=t.msgCollection,i=t.focusCtx;if(!i&&n.unreadCount){var o=(e={},(0,a["default"])(e,R.TYPE.CHAT,R.TYPE.CHAT),(0,a["default"])(e,R.TYPE.IMAGE,R.TYPE.IMAGE),(0,a["default"])(e,R.TYPE.VIDEO,R.TYPE.VIDEO),(0,a["default"])(e,R.TYPE.AUDIO,R.TYPE.AUDIO),(0,a["default"])(e,R.TYPE.VCARD,R.TYPE.VCARD),(0,a["default"])(e,R.TYPE.LOCATION,R.TYPE.LOCATION),(0,a["default"])(e,R.TYPE.PTT,R.TYPE.PTT),e),s=_(r.toArray()).filter(function(e){return!!o[e.type]}).reverse().take(n.unreadCount).value();if(s.length===n.unreadCount)return s=_.last(s),{msg:s,isUnreadDivider:!0,highlightMsg:!1}}},getMsgs:function(){var e=this.props.msgCollection,t=this.state,n=t.focusCtx,r=t.cursor,i=n?n.msg:void 0,o=e.indexOf(i);return 0>o&&(o=e.length),r.setIndex(o,e.length),e.toArray().slice(r.start,r.end+1)},onScroll:function(e){this.handleScroll(e.target,this.props.chat,this.nearBottom,this)},handleScroll:_.throttle(function(e,t,n,r){0===e.scrollTop&&this.loadEarlierMsgs(),n(e)&&(r.maybeSendSeen(!0),r.isMostRecentCMC()&&this.state.newUnread&&this.setState({newUnread:0}),(r.state.cursor.end<r.props.msgCollection.length||!r.isMostRecentCMC())&&r.loadRecentMsgs()),this.updateFloatingDateMarker()},100),windowGainedFocus:function(){var e=this.props.chat;!this.clearUnreadTimer&&e.isDirty()&&(this.clearUnreadTimer=this.safeDelay(function(){delete this.clearUnreadTimer,this.maybeSendSeen()},d.CLEAR_CHAT_DIRTY_WAIT))},windowLostFocus:function(){if(this.state.unreadCount&&this.isMostRecentCMC()){var e=this.props.chat;0===e.unreadCount&&this.setState({unreadCount:0}),e.markedUnread=!1}},maybeSendSeen:function(e,t){var n=this.props,r=n.chat,i=n.msgCollection,o=this.state.cursor;return r.isDirty()&&this.isMostRecentCMC()&&o.end>=i.length&&(_.isUndefined(t)&&(t=document.hasFocus()),t&&(_.isUndefined(e)&&(e=this.nearBottom()),e))?(r.sendSeen(),!0):void 0},onOpenChat:function(e){e.id===this.props.chat.id&&this.isMostRecentCMC()&&!this.props.focusCtx&&this.scrollToBottom()},jumpToBottom:function(){this.isMostRecentCMC()?this.scrollToBottom():E.openChat(this.props.chat,void 0,!1,!0,!0)},scrollToBottom:function(){var e=u.findDOMNode(this.refs.scrollContainer);this.setScrollTop(e,e.scrollHeight)},onLastMsgChanged:function(){var e=this.props,t=e.msgCollection,n=e.chat,r=this.state,i=r.focusCtx,o=r.cursor,a=t.last(),s=document.hasFocus(),c=this.nearBottom();(s&&c||a&&a.isSentByMe)&&(n.unreadCount||this.setState({unreadCount:0}),a&&a.isSentByMe&&n.isDirty()&&this.jumpToBottom()),this.isMostRecentCMC()&&(i?this.setState({cursor:o.loadAfter(1)}):this.setState({cursor:o.loadBefore(1)}))},onUnreadCount:function(){var e=this.props.chat,t=this.nearBottom(),n=document.hasFocus();this.maybeSendSeen(t,n);var r={};if(e.unreadCount&&!e.pendingSeenCount){r.unreadCount=e.unreadCount;var i=this.getUnreadFocusCtx();i&&(r.focusCtx=i)}t||e.pendingSeenCount||this.state.newUnread===e.unreadCount||(r.newUnread=e.unreadCount),_.isEmpty(r)||this.setState(r)},onPageUpDown:function(e){k.focusNode(u.findDOMNode(this.refs.scrollContainer))},onKeyPress:function(e){e.metaKey||e.ctrlKey||("Enter"!==e.key||e.shiftKey?C.isGecko?E.pasteChatTextInput(this.props.chat,String.fromCharCode(e.charCode)):E.focusChatTextInput(this.props.chat):E.enterChatTextInput(this.props.chat))},onContextMenu:function(e){var t,n=this.props.chat,r=this.props.onSelectMessages;if(n.isUser)t=D.contact(n,r);else if(n.isGroup)t=D.group(n,r);else{if(!n.isBroadcast)return;t=D.broadcast(n,r)}e.preventDefault(),e.stopPropagation(),E.openContextMenu(t,{event:e,parent:this})},onPaste:function(e){e.preventDefault();var t=e.clipboardData.items,n=_.filter(t,function(e){var t=M.typeFromMimetype(e.type);return"file"===e.kind&&("image"===t||"video"===t)}).map(function(e){return e.getAsFile()});return n.length?void(t.length===n.length&&E.openDrawer(l.createElement(x,{files:n,chat:this.props.chat,type:k.DRAWER_MID}),"slide-up")):void E.pasteChatTextInput(this.props.chat,e.clipboardData.getData("text/plain"));
},scrollToMsg:function(e,t){this._scrollMsg=e},render:function(){var e=this.props,t=e.chat,n=e.msgCollection,r=e.selectable,i=e.onMessageSelect,o=this.state.focusCtx,a=P("pane-chat-msgs pane-chat-body lastTabIndex",{selectable:r}),s=this.isMostRecentCMC(),c=!!o,u=l.createElement(v,{key:"ml-"+t.id+"-"+this.state.msgListKey,ref:"messageList",isLoadingRecent:this.loadingRecent,unreadCount:this.state.unreadCount,selectable:r,onMessageSelect:i,msgs:this.getMsgs(),focusedMsgCtx:o,didRenderFocusedMsg:this.scrollToMsg,dateMarkerPositionsChanged:this.dateMarkerPositionsChanged,updateStickyDateMarkerText:this.onStickyDateMarkerUpdated,floatingDateMarker:this.floatingDateMarker}),d=l.createElement(y,{direction:"around",isMostRecentCMC:s,loadMoreMsgs:_.noop,msgCollection:n}),p=void 0;(this.state.cursor.start>0||!n.msgLoadState.noEarlierMsgs)&&(p=l.createElement(y,{direction:"earlier",isMostRecentCMC:s,loadMoreMsgs:this.loadEarlierMsgs,msgCollection:n}));var h=void 0;(this.state.cursor.end<n.length-1||!s)&&(h=l.createElement(y,{direction:"recent",isMostRecentCMC:s,loadMoreMsgs:this.loadRecentMsgs,msgCollection:n})),c&&n.msgLoadState.isLoadingAroundMsgs?(h=void 0,p=void 0,u=void 0):d=void 0;var f=void 0,m=this.state.newUnread;return t.unreadCount&&m>0&&(f=l.createElement("div",{className:"incoming-msgs",onClick:this.jumpToBottom},l.createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},l10n.n(this.state.newUnread)),l.createElement("span",{className:"icon icon-down"}))),l.createElement("div",null,l.createElement(O,{ref:"stickyDateMarker"}),l.createElement(L,{transitionName:"pop"},f),l.createElement("div",{className:a,ref:"scrollContainer",onScroll:this.onScroll,onKeyPress:this.onKeyPress,onContextMenu:this.onContextMenu,onPaste:this.onPaste,tabIndex:"0"},l.createElement("div",{className:"pane-chat-empty"}),d,p,u,h))}});e.exports=B},function(e,t,n){"use strict";var r=n(6),i=n(107),o=n(102),a=n(824),s=r.createClass({displayName:"LoadMoreMessages",mixins:[o],propTypes:{direction:r.PropTypes.oneOf(["recent","earlier","around"]).isRequired,isMostRecentCMC:r.PropTypes.bool.isRequired,loadMoreMsgs:r.PropTypes.func.isRequired,msgCollection:r.PropTypes.instanceOf(a).isRequired},getInitialState:function(){return this.props.msgCollection.msgLoadState.toJSON()},componentWillMount:function(){this.attachObservers()},componentWillReceiveProps:function(e){this.attachObservers(e)},attachObservers:function(e){var t=this,n=this.props.msgCollection.msgLoadState;e&&(this.removeObserver(n,"change"),n=e.msgCollection.msgLoadState),this.addObserver(n,"change",function(){t.setState(n.toJSON())})},loadMoreMsgs:function(e){"earlier"===this.props.direction&&this.state.isLoadingEarlierMsgs||"recent"===this.props.direction&&this.state.isLoadingRecentMsgs||"around"===this.props.direction&&this.state.isLoadingAroundMsgs||this.props.loadMoreMsgs()},render:function(){var e=this.props.direction;if("earlier"===e&&this.state.isLoadingEarlierMsgs||"recent"===e&&this.state.isLoadingRecentMsgs||"around"===e&&this.state.isLoadingAroundMsgs)return r.createElement("div",{className:"more"},r.createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},r.createElement(i,{stroke:6,size:24})));var t;return t="earlier"===e?l10n.t("load_earlier_messages"):"recent"===e?l10n.t("load_recent_messages"):l10n.t("loading_messages"),r.createElement("div",{className:"more"},r.createElement("div",{className:"btn-more",title:t,onClick:this.loadMoreMsgs},r.createElement("span",{className:"icon icon-refresh"})))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(798),o=n(799),a=n(104),s=n(840),c=n(876),l=n(817),u=n(816),d=n(9),p=n(880),h=n(347),f=n(823),m=n(80),g=n(154),v=r.createClass({displayName:"AudioVideo",mixins:[o,a],propTypes:{msg:r.PropTypes.instanceOf(i).isRequired,displayAuthor:r.PropTypes.bool},getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},showMediaMissing:function(){var e,t;switch(this.props.msg.type){case i.TYPE.VIDEO:e=l10n.t("missing_video_title"),t=l10n.t("missing_video_text");break;case i.TYPE.AUDIO:e=l10n.t("missing_audio_title"),t=l10n.t("missing_audio_text")}d.openModal(r.createElement(h,{title:e,onOK:d.closeModal.bind(d),okText:l10n.t("web_ok")},t))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){m.supportsFeature(m.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():d.openModal(r.createElement(f,{msg:this.props.msg}))},launchMediaViewer:function(e){this.props.msg.downloadMedia(),e&&e.stopPropagation(),d.openModalMedia(r.createElement(p,{startId:this.props.msg.id.toString()}),"media-viewer")},stopEvent:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t=e.caption&&e.type!==i.TYPE.VIDEO||e.type===i.TYPE.AUDIO?null:r.createElement("div",{className:"shade"}),n=e.caption?r.createElement(c,{msg:e}):null,o="bubble-image bubble-video";e.caption&&(o+=" bubble-image-caption");var a=null,d=_.noop;switch(e.mediaState){case i.MEDIA_STATE.RESOLVED:case i.MEDIA_STATE.INIT:a=r.createElement(s.Play,null),d=this.launchMediaViewer;break;case i.MEDIA_STATE.NEED_POKE:a=r.createElement(s.Download,{filesize:e.size}),d=this.downloadMedia;break;case i.MEDIA_STATE.NEED_UPLOAD:a=r.createElement(s.Upload,{filesize:e.size}),d=this.resumeUpload;break;case i.MEDIA_STATE.NEED_REMOTE_UPLOAD:a=r.createElement(s.Upload,{filesize:e.size}),d=this.resumeRemoteUpload;break;case i.MEDIA_STATE.ERROR_MISSING:d=this.showMediaMissing;break;default:a=r.createElement(s.Pending,null)}var p=g.durationStr(e.duration)||null;p&&(p=r.createElement("span",{className:"message-duration"},e.type===i.TYPE.VIDEO?r.createElement("span",{className:"icon-s icon-msg-video-light"}):r.createElement("span",{className:"icon-s icon-msg-audio-light"}),p));var h;if(e.type===i.TYPE.VIDEO){var f="data:image/jpeg;base64,"+e.body,m={backgroundImage:'url("'+f+'")'};h=r.createElement("div",{className:"image-thumb-body",style:m})}else e.type===i.TYPE.AUDIO&&(h=r.createElement("div",{className:"image-audio"}));var v=this.props.displayAuthor&&u.shouldRender(e)?r.createElement(u,{msg:e}):null;return r.createElement("div",{onClick:this.stopEvent},r.createElement("div",{className:o},v,r.createElement("div",{className:"image-thumb",onClick:d},a,h,t,p),n,r.createElement(l,{msg:this.props.msg})))}});e.exports=v},function(e,t,n){"use strict";var r=n(6),i=n(102),o=n(810),a=n(800),s=n(81),c=n(46),l=n(154),u=r.createClass({displayName:"DateMarker",mixins:[s,i],propTypes:{timestamp:r.PropTypes.number.isRequired,order:r.PropTypes.number.isRequired,floatingDateMarker:r.PropTypes.object.isRequired,updateStickyDateMarkerText:r.PropTypes.func.isRequired},getInitialState:function(){return{floatingDateMarker:-1}},componentDidMount:function(){this.addObserver(this.props.floatingDateMarker,"update_floating_date_marker",this.floatingDateMarkerUpdated),this.maybeRegMidnight(),this.maybeUpdateStickyDateMarker()},componentDidUpdate:function(){this.maybeRegMidnight(),this.maybeUpdateStickyDateMarker()},rerender:function(){this.forceUpdate()},floatingDateMarkerUpdated:function(e){this.state.floatingDateMarker!==e&&this.setState({floatingDateMarker:e})},maybeUpdateStickyDateMarker:function(){var e=l.relativeDateStr(this.props.timestamp).toUpperCase();this.props.order===this.state.floatingDateMarker&&this.props.updateStickyDateMarkerText(e)},maybeRegMidnight:function(){this.unregCmd("midnight",this.rerender);var e=moment().startOf("day").subtract(7,"day");this.props.timestamp>=e.unix()&&this.regCmd("midnight",this.rerender)},render:function(){var e=l.relativeDateStr(this.props.timestamp).toUpperCase(),t=c("message-system-body",{"date-marker-floating":this.state.floatingDateMarker===this.props.order});return r.createElement("span",{className:t},r.createElement(o,null,r.createElement(a,{direction:"auto",text:e})))}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(799),o=n(814),a=n(816),s=n(817),c=n(798),l=n(800),u=n(46),d=n(347),p=n(823),h=n(919),f=n(80),m=n(9),g=n(356).MIMETYPES,v=n(21),y=_.pick(g,function(e,t){return"document"===e.msgType}),E=r.createClass({displayName:"Doc",mixins:[i,o],propTypes:{msg:r.PropTypes.instanceOf(c).isRequired,displayAuthor:r.PropTypes.bool},getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},showMediaMissing:function(){m.openModal(r.createElement(d,{title:l10n.t("missing_document_title"),onOK:m.closeModal.bind(m),okText:l10n.t("web_ok")},l10n.t("missing_document_text")))},downloadMedia:function(){var e=this;this.props.msg.forceDownloadMedia()["catch"](_.noop).checkpoint(this.rejectOnUnmount()).then(function(){e.props.msg.mediaState===c.MEDIA_STATE.RESOLVED&&e.triggerDownload()})["catch"](v.Unmount,_.noop)},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){f.supportsFeature(f.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():m.openModal(r.createElement(p,{msg:this.props.msg}))},triggerDownload:function(e){this.refs.download.click()},render:function(){var e,t=this.props,n=t.msg,i=t.displayAuthor,o=u("bubble","bubble-doc",{"bubble-broadcast":n.broadcast,"bubble-star":n.star}),d=i&&a.shouldRender(n)?r.createElement(a,{msg:n}):null;n.pageCount>0&&(e=r.createElement("span",{className:"document-meta-value"},l10n.t("web_conversations_most_recent_document",{count:n.pageCount,_plural:n.pageCount})));var p,f=n.size>0?r.createElement("span",{className:"document-meta-value"},l10n.filesize(n.size)):null,m="icon-doc";_.has(y,n.mimetype)&&(p=r.createElement("span",{className:"document-meta-value"},y[n.mimetype].ext),m=u(m,y[n.mimetype].icon));var g=n.body?r.createElement("div",{className:"document-thumb",style:{backgroundImage:"url(data:image/jpeg;base64,"+n.body+")"}}):null,v=n.caption||n.filename||l10n.t("untitled_document"),E=null,b=_.noop,w=null;switch(n.mediaState){case c.MEDIA_STATE.RESOLVED:b=this.triggerDownload,w=r.createElement("a",{href:n.url,ref:"download",download:v});break;case c.MEDIA_STATE.FETCHING:E=r.createElement(h.PendingCancel,null),b=this.cancelDownload;break;case c.MEDIA_STATE.NEED_POKE:case c.MEDIA_STATE.INIT:E=r.createElement(h.Download,null),b=this.downloadMedia;break;case c.MEDIA_STATE.UPLOADING:E=r.createElement(h.PendingCancel,null),b=this.cancelUpload;break;case c.MEDIA_STATE.NEED_UPLOAD:E=r.createElement(h.Upload,null),b=this.resumeUpload;break;case c.MEDIA_STATE.NEED_REMOTE_UPLOAD:E=r.createElement(h.Upload,null),b=this.resumeRemoteUpload;break;case c.MEDIA_STATE.ERROR_MISSING:b=this.showMediaMissing;break;default:E=r.createElement(h.Pending,null)}return r.createElement("div",{className:o},d,r.createElement("div",{className:"document-container",onClick:b,title:l10n.t("web_download_document",{name:v})},g,r.createElement("div",{className:"document-body"},r.createElement("div",{className:"document-icon"},r.createElement("div",{className:m})),r.createElement("div",{className:"document-text"},r.createElement(l,{text:v,ellipsify:!0,selectable:!1,dirMismatch:n.rtl!==l10n.isRTL(),direction:"auto"})),w,E)),r.createElement("div",{className:"document-meta"},e,p,f),r.createElement(s,{msg:n}))}});e.exports=E},function(e,t,n){"use strict";var r=n(6),i=n(872),o=n(105),a=o.HotKeys,s=r.createClass({displayName:"FailedMsgIcon",propTypes:{onResend:r.PropTypes.func.isRequired},getInitialState:function(){return{hover:!1}},onMouseEnter:function(){this.setState({hover:!0})},onMouseLeave:function(){this.setState({hover:!1})},render:function(){var e=r.createElement("span",null,l10n.t("resend_message")),t=this.state.hover?r.createElement(i,{direction:"left",body:e}):null;return r.createElement(a,{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,style:{"float":"right"},className:"icon-error-container"},r.createElement("button",{className:"error",onClick:this.props.onResend},r.createElement("span",{className:"icon icon-error"})),t)}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(798),o=n(61),a=n(708),s=n(46),c=r.createClass({displayName:"LinkPreview",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(i).isRequired},render:function(){var e=this.props.msg,t=e.thumbnail?r.createElement("img",{className:"link-preview-media",src:"data:image/jpeg;base64,"+e.thumbnail}):null,n=e.title?r.createElement("div",{className:"link-preview-title",title:e.title},e.title):null,i=e.description?r.createElement("div",{className:"link-preview-description",title:e.description},e.description):null,a=s("link-preview-body",{nothumb:!t}),c=o.hostname(e.canonicalUrl||e.matchedText),l=function(){window.open(e.matchedText)};return r.createElement("div",{className:"link-preview-container",onClick:l},t,r.createElement("div",{className:a},n,i,r.createElement("div",{className:"link-preview-source ellipsify"},c)))}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(810),o=n(843),a=n(799),s=n(798),c=n(817),l=n(816),u=n(61),d=r.createClass({displayName:"Location",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(s).isRequired,displayAuthor:r.PropTypes.bool},getInitialState:function(){return{url:this.async("msg.body")}},googleMapUrl:function(){var e=this.props.msg,t=this.loc();return t&&t.name?["https://maps.google.com/maps/search",encodeURIComponent(t.name),"@"+e.lat+","+e.lng+",17z"].join("/"):u.build("https://maps.google.com/maps",{q:e.lat+","+e.lng,z:17})},mapUrl:function(){return this.props.msg.clientUrl||this.googleMapUrl()},loc:function p(){var p=this.props.msg.loc;return p?(p=p.split("\n"),2===p.length?{name:p[0],addr:p[1]}:{name:p}):void 0},render:function(){var e,t,n=this.props.msg,a=r.createElement("a",{href:this.googleMapUrl(),className:"preview-location",target:"_blank"},r.createElement(o,{thumb:n.body,type:n.type,shade:!1})),s=n.isSentByMe?"text no-author":"text",u=this.loc();u?(e=r.createElement("a",{href:this.mapUrl(),title:u.name,target:"_blank",className:"text-title"},r.createElement(i,null,u.name)),t=u.addr?r.createElement("div",{title:u.addr,className:"text-contents"},r.createElement(i,null,u.addr)):null):e=r.createElement("a",{href:this.mapUrl(),title:l10n.t("web_view"),target:"_blank",className:"text-title"},r.createElement(i,null,l10n.t("web_view")));var d=this.props.displayAuthor&&l.shouldRender(n)?r.createElement(l,{msg:n}):null;return r.createElement("div",{className:"bubble bubble-attach bubble-location"},d,r.createElement("div",{className:"wrapper"},a,r.createElement("div",{className:"contents"},r.createElement("div",{className:s},e,t),r.createElement(c,{msg:n}))))}});e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(798),o=n(46),a={FRONT:"front",MID:"mid",END:"end",SINGLE:"single"},s=r.createClass({displayName:"Menu",propTypes:{msg:r.PropTypes.instanceOf(i).isRequired,position:r.PropTypes.oneOf(_.values(a)).isRequired,onClick:r.PropTypes.func,isFocusedMsg:r.PropTypes.bool,highlight:r.PropTypes.bool},click:function(){this.refs.context.click()},render:function(){var e=this.props,t=e.msg,n=e.position,s=e.onClick,c=t.isMedia,l=t.isSentByMe,u=t.isGroupMsg,d=t.type,p=l?"context-out":"context-in",h=t.type===i.TYPE.DOCUMENT&&!t.body,f=t.type===i.TYPE.DOCUMENT&&t.body;c=c||f;var m;u&&(m=!l&&(n===a.FRONT||n===a.SINGLE),c=c&&!m);var g=d===i.TYPE.CHAT&&t.body.indexOf(t.matchedText)>-1&&!m&&t.isTrusted(),v=o("js-context-icon",c?"context-icon-media":"context-icon"),y=o(p,{context:!(c||g),"focused-msg":this.props.highlight,"context-media":c,"context-media-document":f,"context-location":d===i.TYPE.LOCATION&&!m,"context-ptt":d===i.TYPE.PTT,"context-ptt-author":d===i.TYPE.PTT&&m,"context-special":(g||h)&&!m,"context-doc":h&&!m});return r.createElement("div",{className:y},r.createElement("div",{className:v,ref:"context",onClick:s}))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(810),o=n(800),a=n(708),s=n(9),c=n(973),l=r.createClass({displayName:"Notification",mixins:[a],propTypes:{text:r.PropTypes.string.isRequired,e2eSubtype:r.PropTypes.string,participantJid:r.PropTypes.string,chatId:r.PropTypes.string},onSecurityClick:function(){s.openModal(r.createElement(c,{e2eSubtype:this.props.e2eSubtype,jid:this.props.participantJid,chatId:this.props.chatId}))},render:function(){var e=r.createElement(i,null,r.createElement(o,{direction:"auto",text:this.props.text})),t=!!this.props.e2eSubtype,n=t?r.createElement("button",{className:"message-system-e2e",onClick:this.onSecurityClick},e):r.createElement("span",{className:"message-system-body"},e);return n}});e.exports=l},function(e,t,n){"use strict";var r=n(6),i=n(799),o=n(816),a=n(876),s=n(46),c=n(9),l=n(347),u=n(823),d=n(840),p=n(880),h=n(817),f=n(798),m=n(104),g=n(80),v=n(7),y=r.createClass({displayName:"Picture",mixins:[i,m],propTypes:{msg:r.PropTypes.instanceOf(f).isRequired,displayType:r.PropTypes.string,displayAuthor:r.PropTypes.bool},defaultWidth:330,getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},componentDidMount:function(){this.props.msg.downloadMedia()},getImgStyle:function(){var e=this.getHeight(),t=this.aspect(this.defaultWidth,e);return this.isPortrait(t)?{width:this.defaultWidth}:{height:"100%"}},getStyle:function(){return{width:this.defaultWidth+"px",height:this.getHeight()}},getHeight:function(){var e,t,n=this.props.msg;n.url?(e=n.fullWidth||n.width,t=n.fullHeight||n.height):(e=n.width||1,t=n.height||1);var r,i=this.defaultWidth,o=this.aspect(e,t),a=this.isPortrait(o);return a?r=i:o&&(o>2.4?r=i/2.4:e&&t&&(r=t*(i/e))),Math.round(r)},isPortrait:function(e){return e?1>=e:null},aspect:function(e,t){return e&&t?e/t:void 0},showMediaMissing:function(){c.openModal(r.createElement(l,{title:l10n.t("missing_photo_title"),onOK:c.closeModal.bind(c),okText:l10n.t("web_ok")},l10n.t("missing_photo_text")))},launchMediaViewer:function(e){var t=this;e&&e.stopPropagation();var n=void 0;"conversation"!==this.props.displayType&&(n=function(e){e(t.isMounted()?t.refs.img:null)}),c.openModalMedia(r.createElement(p,{startId:this.props.msg.id.toString(),getZoomNode:n}),"media-viewer")},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){g.supportsFeature(g.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():c.openModal(r.createElement(u,{msg:this.props.msg}))},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(v.DRAG_TYPE_LOCAL_IMAGE,!0)},stopEvent:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t=e.caption?null:r.createElement("div",{className:"shade"}),n=e.caption?r.createElement(a,{msg:e}):null,i=e.url||"data:image/jpeg;base64,"+e.body,c=null,l=_.noop;switch(e.mediaState){case f.MEDIA_STATE.RESOLVED:l=this.launchMediaViewer;break;case f.MEDIA_STATE.FETCHING:c=r.createElement(d.PendingCancel,null),l=this.cancelDownload;break;case f.MEDIA_STATE.NEED_POKE:c=r.createElement(d.Download,{filesize:e.size}),l=this.downloadMedia;break;case f.MEDIA_STATE.UPLOADING:c=r.createElement(d.PendingCancel,null),l=this.cancelUpload;break;case f.MEDIA_STATE.NEED_UPLOAD:c=r.createElement(d.Upload,{filesize:e.size}),l=this.resumeUpload;break;case f.MEDIA_STATE.NEED_REMOTE_UPLOAD:c=r.createElement(d.Upload,{filesize:e.size}),l=this.resumeRemoteUpload;break;case f.MEDIA_STATE.ERROR_MISSING:l=this.showMediaMissing;break;default:c=r.createElement(d.Pending,null)}var u=s("bubble-image",{"bubble-image-caption":e.caption,"bubble-broadcast":e.caption&&e.broadcast,"bubble-star":e.caption&&e.star}),p=s("image-thumb-body",{"image-thumb-lores":i!==e.url}),m=this.props.displayAuthor&&o.shouldRender(e)?r.createElement(o,{msg:e}):null;return r.createElement("div",{className:u,onClick:this.stopEvent},m,r.createElement("div",{className:"image-thumb",onClick:l,style:this.getStyle()},c,r.createElement("img",{src:i,onDragStart:this.onDragStart,className:p,style:this.getImgStyle(),ref:"img"}),t),n,r.createElement(h,{msg:this.props.msg}))}});e.exports=y},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(798),a=n(799),s=n(817),c=n(816),l=n(843),u=n(942),d=n(823),p=n(9),h=n(80),f=n(347),m=n(107),g=r.createClass({displayName:"PTT",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired,displayAuthor:r.PropTypes.bool},getInitialState:function(){return this.asyncState({mediaState:"msg.mediaState",img:"msg.sender.ProfilePicThumb.img",ack:"msg.ack"},{currentTime:0,playing:!1,autoPlay:!1})},componentDidMount:function(){this.props.msg.downloadMedia()},showMediaMissing:function(){p.openModal(r.createElement(f,{title:l10n.t("missing_audio_title"),onOK:p.closeModal.bind(p),okText:l10n.t("web_ok")},l10n.t("missing_audio_text")))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){h.supportsFeature(h.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():p.openModal(r.createElement(d,{msg:this.props.msg}))},handleTimeUpdate:function(e){this.setState({currentTime:e})},handlePlayingUpdate:function(e){this.setState({autoPlay:!1,playing:e})},loader:function(e,t,n){return n=n?r.createElement(m,{stroke:3,size:38}):null,r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{className:"btn-audio "+(t?"icon "+t:""),onClick:e},n)),r.createElement("div",{className:"audio-body"},r.createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))},getStatusClass:function(e){return e+=" audio-state-default",this.state.ack===i.ACK_PLAYED&&(e+=" audio-state-played"),e},render:function(){var e=this.props.msg,t=this.getStatusClass("bubble bubble-attach bubble-audio"),n="audio-status icon ";n+=this.state.ack===i.ACK_PLAYED?e.isSentByMe?"icon-ptt-out-blue":"icon-ptt-in-blue":e.isSentByMe?"icon-ptt-out-gray":"icon-ptt-in-green";var a,d=r.createElement("span",{className:n,key:"status"}),p=this.state.playing?this.state.currentTime:e.duration,h=r.createElement(l,{key:"image",thumb:this.state.img,type:e.type,shade:!1,duration:p}),f=e.isSentByMe?[h,d]:null,m=e.isSentByMe?null:[h,d],g=e.isSentByMe?"text no-author":"text";switch(e.mediaState){case o.MEDIA_STATE.RESOLVED:a=r.createElement(u,{msg:e,autoPlay:this.state.autoPlay,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;case o.MEDIA_STATE.NEED_POKE:a=this.loader(this.downloadMedia,"icon-audio-download");break;case o.MEDIA_STATE.NEED_UPLOAD:a=this.loader(this.resumeUpload,"icon-audio-upload");break;case o.MEDIA_STATE.NEED_REMOTE_UPLOAD:a=this.loader(this.resumeRemoteUpload,"icon-audio-upload");break;case o.MEDIA_STATE.ERROR_MISSING:a=this.loader(this.showMediaMissing,"icon-audio-play");break;default:a=this.loader(null,null,!0)}var v=this.props.displayAuthor&&c.shouldRender(e)?r.createElement(c,{msg:e}):null;return r.createElement("div",{className:t},r.createElement("div",{className:"wrapper"},f,r.createElement("div",{className:"contents"},v,r.createElement("div",{className:g},a)),m,r.createElement(s,{msg:e})))}});e.exports=g},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(7),a=n(798),s=n(104),c=n(867),l=r.createClass({displayName:"PTTPlayer",mixins:[s],propTypes:{msg:r.PropTypes.instanceOf(a).isRequired,autoPlay:r.PropTypes.bool.isRequired,onPlayingUpdate:r.PropTypes.func.isRequired,onTimeUpdate:r.PropTypes.func.isRequired},playing:!1,dragging:!1,getInitialState:function(){return{progress:0}},onPlayClick:function(){var e=i.findDOMNode(this.refs.audio);this.playing?e.pause():e.play()},onPlaying:function(){this.playing=!0;var e=this.props.msg;!e.get("isSentByMe")&&e.get("ack")<o.ACK_PLAYED&&e.sendPlayed(),this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onPause:function(){this.playing=!1,this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onEnded:function(){var e=i.findDOMNode(this.refs.audio);e.currentTime=0,e.load()},onTimeUpdate:function(){var e=i.findDOMNode(this.refs.audio),t=0;_.isFinite(e.duration)&&(t=Math.round(100*Math.min(1,e.currentTime/e.duration)),this.props.onTimeUpdate&&this.props.onTimeUpdate(e.currentTime)),this.setState({progress:t})},componentDidMount:function(){var e=i.findDOMNode(this.refs.audio);this.regNativeListener(e,"playing",this.onPlaying),this.regNativeListener(e,"pause",this.onPause),this.regNativeListener(e,"ended",this.onEnded),this.regNativeListener(e,"timeupdate",this.onTimeUpdate),this.regNativeListener(e,"durationchange",this.onTimeUpdate),this.regNativeListener(e,"progress",this.onTimeUpdate)},onDrag:function(e){var t=i.findDOMNode(this.refs.audio);this.setState({progress:e}),t.duration&&(t.currentTime=t.duration/100*e)},onPlayerError:function(e){},render:function(){var e="btn-audio icon ";e+=this.playing?"icon-audio-pause":"icon-audio-play";var t={value:this.state.progress,requestChange:this.onDrag},n={width:this.state.progress-this.state.progress/100*3+"%"};return r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{ref:"play_pause",className:e,onClick:this.onPlayClick})),r.createElement("div",{className:"audio-body"},r.createElement("div",{className:"audio-track-container"},r.createElement("span",{className:"audio-progress",style:n}),r.createElement("input",{type:"range",className:"audio-track",valueLink:t,min:"0",max:"100"}))),r.createElement(c,{ref:"audio",msg:this.props.msg,preload:"auto",onError:this.onPlayerError,autoPlay:this.props.autoPlay}))}});e.exports=l},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(798),a=n(102),s=n(832),c=n(46),l=n(154),u=n(800),d=n(58),p=n(825),h=n(805),f=n(22),m=n(7),g=n(105),v=g.HotKeys,y=r.createClass({displayName:"StarredMsg",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired,currSelection:r.PropTypes.object,activeSelection:r.PropTypes.object,onSelectMsg:r.PropTypes.func.isRequired},getInitialState:function(){var e=this.props.currSelection,t=this.props.activeSelection,n=this.props.msg;return{hover:!1,current:e?e.value===n:!1,active:t?t.value===n:!1,focus:!1}},componentWillMount:function(){var e=this,t=this.props.msg,n=this.props.currSelection;n&&this.addObserver(n,t.id.toString(),function(t){var n="focus"===t;if(n){var r=i.findDOMNode(e);d.focusNode(r),p.scrollIntoViewIfNeeded(r)}e.setState({current:n})});var r=this.props.activeSelection;r&&this.addObserver(r,t.id.toString(),function(t){var n="focus"===t;if(n){var r=i.findDOMNode(e);d.focusNode(r),p.scrollIntoViewIfNeeded(r)}e.setState({active:n})})},mouseOver:function(){this.state.hover||this.setState({hover:!0})},mouseEnter:function(){this.state.hover||this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.setState({hover:!1})},onEnter:function(e){e.stopPropagation(),e.preventDefault(),this.props.onSelectMsg(this.props.msg)},openContextMenu:function(e){e.preventDefault(),e.stopPropagation(),this.refs.wrapper.openContextMenu()},onFocus:function(e){this.setState({focus:!0}),this.indicateFocus(e)},onBlur:function(e){this.finishFocusIndication(e),this.setState({focus:!1})},indicateFocus:function(e){if(!(Date.now()-(v.flashFocus||0)>200)){var t=this.refs.row,n=this.state.active?"#d6d7d8":"#e2e3e3";Velocity(t,"stop"),Velocity(t,{backgroundColor:[n,"#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.finishFocusIndication})}},finishFocusIndication:function(e){var t=this.refs.row;t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this,t=this.props.msg,n=t.senderObj.formattedName,i=t.chat.isUser?Store.Contact.get(t.to).formattedName?Store.Contact.get(t.to).formattedName:f.formattedUser(t.to):t.chat.formattedTitle,a=c("starred-msg-wrapper",{"starred-msg-resize":t.type===o.TYPE.PTT||t.type===o.TYPE.IMAGE||t.type===o.TYPE.LOCATION||t.type===o.TYPE.VCARD,hover:this.state.hover,current:this.state.current&&this.state.focus,active:this.state.active}),d={enter:this.onEnter};return d[l10n.LR("right","left")]=this.openContextMenu,r.createElement(v,{handlers:d,onFocus:this.onFocus,onBlur:this.onBlur},r.createElement("div",{ref:"row",className:a,onClick:function(){return e.props.onSelectMsg(t)},onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},r.createElement("div",{className:"starred-msg-title"},r.createElement("div",{className:"starred-title-main"},r.createElement(h,{id:t.senderObj.id}),r.createElement(u,{classes:"starred-msg-author",text:n,direction:"auto",ellipsify:!0,titlify:!0}),r.createElement("span",{className:"starred-title-divider"}),r.createElement(u,{classes:"starred-msg-chat",text:i,direction:"auto",ellipsify:!0,titlify:!0})),r.createElement("div",{className:"starred-title-meta"},l.relativeStr(t.t)),r.createElement("div",{className:"icon icon-chevron-right-alt"})),r.createElement(s,{msg:t,key:t.id,ref:"wrapper",displayType:m.DISP_TYPE.STARRED_MSGS,position:s.Position.END,tailOverride:"left"})))}});e.exports=y},function(e,t,n){"use strict";var r=n(6),i=n(798),o=n(799),a=r.createClass({displayName:"Status",mixins:[o],propTypes:{msg:r.PropTypes.instanceOf(i).isRequired},getInitialState:function(){var e=this.props.msg;return{ack:e.ack<3?this.async("msg.ack"):e.ack}},getStatus:function(){var e=this.props.msg,t="icon",n=e.ack;return t+=1>n?" icon-msg-time":1===n?" icon-msg-check":2===n?" icon-msg-dblcheck":" icon-msg-dblcheck-ack",e.isMedia&&!e.caption&&(t+="-light"),t},render:function(){return r.createElement("span",{onClick:this.openInfoDrawer,className:this.getStatus()})}});e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(810),o=n(800),a=n(103),s=r.createClass({displayName:"StickyDateMarker",proptypes:{},getInitialState:function(){return{date:null,hide:!1}},updateDateMarkerText:function(e){this.setState({date:e})},hideStickyDateMarker:function(e){this.setState({hide:e})},render:function(){var e=void 0;return this.state.date&&!this.state.hide&&(e=r.createElement("div",{className:"msg sticky-date-marker-floating-container"},r.createElement("div",{className:"sticky-date-marker-floating-wrapper"},r.createElement("span",{className:"message-system-body"},r.createElement(i,null,r.createElement(o,{direction:"auto",text:this.state.date})))))),r.createElement(a,{transitionName:"slide-down-date"},e)}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(816),o=n(817),a=n(936),s=n(877),c=n(798),l=n(800),u=n(46),d=n(708),p=r.createClass({displayName:"Text",mixins:[d],propTypes:{msg:r.PropTypes.instanceOf(c).isRequired,senderName:r.PropTypes.string,displayAuthor:r.PropTypes.bool,trusted:r.PropTypes.bool},render:function(){var e=this.props,t=e.msg,n=e.displayAuthor,c=e.trusted,d=n&&i.shouldRender(t),p=u("bubble","bubble-text",{"bubble-broadcast":t.broadcast,"bubble-star":t.star,"has-author":d}),h=d?r.createElement(i,{msg:t}):null,f=c&&t.linkPreview?r.createElement(a,{msg:t}):null,m=u("message-text",{"message-link":c&&t.linkPreview,"heart-animation":1===t.body.length&&"❤"===t.body});return r.createElement("div",{className:p},h,r.createElement("div",{className:m,"data-id":t.id},f,r.createElement(s,{msg:t}),r.createElement(l,{text:t.body,selectable:!0,dirMismatch:t.rtl!==l10n.isRTL(),direction:t.dir,linkify:c,format:!0,wbr:15})),r.createElement(o,{msg:t}))}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(810),o=r.createClass({displayName:"Unread",propTypes:{count:r.PropTypes.number.isRequired},render:function(){var e=l10n.t("unread_message_count",{count:l10n.n(this.props.count),_plural:this.props.count});return r.createElement("span",{className:"msg-unread-body"},r.createElement(i,null,e))}});e.exports=o},function(e,t,n){"use strict";var r=n(6),i=n(843),o=n(816),a=n(817),s=n(798),c=n(46),l=n(9),u=n(1019),d=n(800),p=n(805),h=n(102),f=n(954),m=r.createClass({
displayName:"Vcard",mixins:[h],propTypes:{msg:r.PropTypes.instanceOf(s).isRequired,displayAuthor:r.PropTypes.bool},componentWillMount:function(){var e=this,t=this.props.msg.vcardWAid;t&&(this._findPicThumb=Store.ProfilePicThumb.find(t).then(function(t){e.addObserverAndRun(t,"change:img",function(){e.setState({img:t.img})})})["catch"](_.noop)["finally"](function(){e._findPicThumb=null}))},componentWillUnmount:function(){this._findPicThumb&&this._findPicThumb.cancel()},openContactChat:function(){var e=this.props.msg.vcardWAid;Store.Chat.find(e).then(function(e){l.openChat(e)})},addContactToGroup:function(){Store.Contact.find(this.props.msg.vcardWAid).then(function(e){l.openModal(r.createElement(f,{contact:e}),"modal-flow")})},render:function(){var e=this.props.msg,t=this.state.img?r.createElement("div",{className:"preview"},r.createElement(p,{id:e.vcardWAid,size:p.REGULAR,quality:p.LOW})):r.createElement(i,{thumb:u.thumbnail(e.body),type:e.type,ref:"media",shade:!1,duration:e.duration}),n=e.isSentByMe?t:null,s=e.isSentByMe?null:t,l=e.author?"text":"text no-author",h=c(["bubble","bubble-attach","bubble-contact"],{"bubble-attach-caption":!!e.caption}),f=void 0;e.vcardWAid&&(f=r.createElement("div",{className:"bubble-actions"},r.createElement("div",{className:"bubble-btn",onClick:this.openContactChat,title:l10n.t("message_author",{author:e.subtype})},l10n.t("message")),r.createElement("div",{className:"bubble-btn",onClick:this.addContactToGroup,title:l10n.t("add_contact_to_group")},l10n.t("add_contact_to_group"))));var m=this.props.displayAuthor&&o.shouldRender(e)?r.createElement(o,{msg:e}):null;return r.createElement("div",null,r.createElement("div",{className:h},r.createElement("div",{className:"wrapper"},n,r.createElement("div",{className:"contents"},m,r.createElement("div",{className:l},r.createElement(a,{msg:e,contextMenu:this.contextMenu})),r.createElement(d,{text:e.subtype,element:"div",classes:"button button-contact",selectable:!0,dirMismatch:e.rtl!==l10n.isRTL(),direction:e.dir,wbr:15})),s),f))}});e.exports=m},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(798),a=n(933),s=n(947),c=n(832),l=n(81),u=n(46),d=n(154),p={NEW:"new",FRONT:"front",BACK:"back",MUTATE:"mutate",UNREAD:"unread"},h=r.createClass({displayName:"MessageList",mixins:[l],propTypes:{msgs:r.PropTypes.arrayOf(r.PropTypes.instanceOf(o)).isRequired,isLoadingRecent:r.PropTypes.bool,unreadCount:r.PropTypes.number,selectable:r.PropTypes.bool,onMessageSelect:r.PropTypes.func.isRequired,focusedMsgCtx:r.PropTypes.object,didRenderFocusedMsg:r.PropTypes.func,dateMarkerPositionsChanged:r.PropTypes.func,updateStickyDateMarkerText:r.PropTypes.func.isRequired,floatingDateMarker:r.PropTypes.object.isRequired},propChangeType:function(e){var t=this.props.msgs,n=e.msgs;return this.props.unreadCount!==e.unreadCount?p.UNREAD:t.length&&n.length&&t[0].id!==n[0].id?p.BACK:t.length===n.length||n.length<t.length?p.MUTATE:e.isLoadingRecent?p.FRONT:p.NEW},componentWillMount:function(){this.regCmd("is_msg_visible",this.isMsgVisible)},scrollBottom:function(e,t){(t||this.shouldScrollBottom!==!1&&!this.props.focusedMsgCtx)&&(e.scrollTop=e.scrollHeight),this.updateDateMarkerPositions()},componentWillUpdate:function(e){var t=i.findDOMNode(this).parentNode,n=this.propChangeType(e);if(n===p.NEW){var r=_.last(e.msgs);(r.isSentByMe||t.scrollTop+t.offsetHeight===t.scrollHeight)&&(this.shouldScrollBottom=!0),this.shouldScrollBottom||(this.shouldRestoreScroll=t.scrollHeight-t.scrollTop-t.clientHeight)}else n!==p.BACK&&n!==p.UNREAD||(this.shouldRestoreScroll=t.scrollHeight-t.scrollTop-t.clientHeight)},componentDidUpdate:function(e){var t=i.findDOMNode(this).parentNode;this.shouldScrollBottom?(t.scrollTop=t.scrollHeight,this.shouldScrollBottom=!1):"undefined"!=typeof this.shouldRestoreScroll&&(t.scrollTop=t.scrollHeight-this.shouldRestoreScroll-t.clientHeight,this.shouldRestoreScroll=void 0),this.updateDateMarkerPositions()},updateDateMarkerPositions:function(){var e=_.pick(this.refs,function(e,t){return _.startsWith(t,"dateMarkerAnchor")}),t=_.map(_.values(e),function(e){return e.offsetTop}),n=_(_.sortBy(t)).reverse().value();this.props.dateMarkerPositionsChanged(n)},processHiddenText:function(e,t){var n="​",r="⁠",i=r+r,o=r+r+r,a=i+"([^"+r+"]+)"+o,s=r+r+r+r,c=r+r+r+r+r,l=s+"[^"+r+"]+"+c;if(e=e.replace(new RegExp(n,"g"),""),e=e.replace(new RegExp(""+l,"g"),""),e=e.replace(new RegExp("^[^"+r+"]+"+c+"(.*)","g"),"$1"),e=e.replace(new RegExp("(.*)"+s+"[^"+r+"]+$","g"),"$1"),!new RegExp("^"+a).test(e)&&new RegExp(""+a,"g").test(e)){for(var u,p=t.getRangeAt(0).startContainer,h=0;5>h&&!(u=p.getAttribute&&p.getAttribute("data-id"));h++)p=p.parentNode;var f=Store.Msg.get(u);if(f){var m="["+d.timeStr(f.t)+"]",g=f.senderObj.formattedUser;e=i+m+" "+g+": "+o+e}}e=e.replace(new RegExp("^(.*)"+a+"$","g"),"$1");var v=e.match(new RegExp(a,"g"));return v&&1===v.length&&(e=e.replace(new RegExp(a,"g"),"")),e=e.replace(new RegExp(""+a,"g"),"\n$1"),"\n"===e.charAt(0)&&(e=e.slice(1)),e},parseSelection:function(e){for(var t,n,r="",i=0;i<e.rangeCount;i++)for(n=document.createTreeWalker(e.getRangeAt(i).cloneContents(),window.NodeFilter.SHOW_ALL);n.nextNode();)t=n.currentNode,r+=t instanceof HTMLImageElement?t.alt:t.nodeValue?t.nodeValue:"";return r},onCopy:function(e){var t=window.getSelection(),n=this.parseSelection(t);e.clipboardData.setData("text/plain",this.processHiddenText(n,t)),e.stopPropagation(),e.preventDefault()},isMsgVisible:function(e,t){var n=void 0,r=this.refs[e.toString()];if(r){var o=i.findDOMNode(this).parentNode,a=o.scrollTop,s=a+o.clientHeight,c=i.findDOMNode(r);c.offsetTop+c.clientHeight>a&&c.offsetTop<s&&(n=i.findDOMNode(r.refs.component.refs.img))}t(n)},render:function(){var e,t,n=[],i=this.props.msgs,l=this.props,p=l.focusedMsgCtx,h=l.unreadCount,f=!1,m=void 0,g=0;for(t=0;t<i.length;t++)if(e=i[t]){var v=d.dayOfMsg(e);if(0===t||m!==v){var y="msg-"+e.id+"-date",E="dateMarkerAnchor"+g,b=r.createElement("div",{className:"msg",key:y,ref:E},r.createElement("div",{className:"message message-system"},r.createElement(a,{key:y,timestamp:e.t,order:g,updateStickyDateMarkerText:this.props.updateStickyDateMarkerText,floatingDateMarker:this.props.floatingDateMarker})));n.push(b),f=!1,g+=1}m=v,h>0&&p&&p.isUnreadDivider&&p.msg===e&&(n.push(r.createElement("div",{className:"msg-unread",key:"msg-unread"},r.createElement(s,{count:h}))),f=!1);var w=_.matches({from:e.from,startOfDay:e.startOfDay}),S=_.matches({author:e.author,startOfDay:e.startOfDay}),T=e.isGroupMsg?S:w,C=c.Position.SINGLE,M=i[t+1];(M&&h&&p&&p.isUnreadDivider&&p.msg===M||M&&M.isNotification||M&&v!==d.dayOfMsg(M))&&(M=!1),e.isNotification?C=c.Position.SINGLE:T(M)&&!T(f)?C=c.Position.FRONT:T(f)&&T(M)?C=c.Position.MID:T(f)&&!T(M)&&(C=c.Position.END);var N=p&&p.msg===e,k=N&&p.highlightMsg;e.type===o.TYPE.IMAGE?n.push(r.createElement(c,{key:"msg-"+e.id,ref:e.id.toString(),msg:e,selectable:this.props.selectable,onMessageSelect:this.props.onMessageSelect,position:C,isFocusedMsg:N,highlight:k,didRenderFocusedMsg:this.props.didRenderFocusedMsg})):n.push(r.createElement(c,{key:"msg-"+e.id,msg:e,selectable:this.props.selectable,onMessageSelect:this.props.onMessageSelect,position:C,isFocusedMsg:N,highlight:k,didRenderFocusedMsg:this.props.didRenderFocusedMsg})),f=e.isNotification?!1:e}var x=u("message-list",{selectable:this.props.selectable});return r.createElement("div",{className:x,onCopy:this.onCopy},n)}});e.exports=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(1),c=n(9),l=n(801),u=n(58),d=n(158),p=n(104),h=n(153),f=n(21),m=n(833),g=n(1017),v=n(826),y=n(103),E=a.createClass({displayName:"PTT",mixins:[h,p,d],propTypes:{chat:a.PropTypes.instanceOf(l),onStateChange:a.PropTypes.func.isRequired},statics:{READY:"ready",DELAY:"delay",REC:"recording",PROCESSSING:"processsing",GUM_TIMEOUT:"ptt_gum_timeout",PERMISSION_DENIED:"permission_denied",NOT_SUPPORTED_ERROR:"not_supported_error",MANDATORY_UNSATISFIED_ERROR:"mandatory_unsatisfied_error",CANCEL:"cancel",SEND:"send"},getInitialState:function(){return{state:E.READY,active:void 0,elapsedTimeInterval:void 0,elapsedTime:0,startTime:0}},componentDidMount:function(){this.regNativeListener(window,"blur",this.cancelRecording)},isRecording:function(){var e=this.state.state;return e===E.REC||e===E.DELAY||e===E.PROCESSSING},getRecorder:function(){var e;return e=new o["default"](function(t,n){navigator.getUserMedia({audio:!0},function(n){if(e.isPending())t(n);else{if(_.isFunction(n.stop))n.stop();else for(var r=n.getTracks(),i=0;i<r.length;i++)r[i].stop();c.closeModal()}},function(t){var r=_.isString(t)?t:t.name,i=f.GUM[r]||f.GUM.GUMError;n(new i),e&&!e.isPending()&&c.closeModal()})}).bind(this).timeout(1500,"waitForGUMConversationPTTTimeout").then(function(e){return this.recorder=new g({bitRate:16e3,encoderSampleRate:16e3,encoderApplication:2048}),this.recorder.initStream(e),this.recorder})["catch"](o["default"].TimeoutError,function(e){throw c.openModal(a.createElement(m,{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_description",type:m.TYPE.GUIDE_ALLOW})),e})["catch"](f.GUM.PermissionDeniedError,function(e){throw c.openModal(a.createElement(m,{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_fail_description",type:m.TYPE.GUIDE_UNBLOCK})),e})["catch"](f.GUM.GUMError,function(e){if(e instanceof f.GUM.PermissionDeniedError)throw e;throw c.openModal(a.createElement(m,{title:"guide_desktop_mic_missing_title",desc:"guide_desktop_mic_missing_description",type:m.TYPE.GUIDE_NONE})),e})},cancelRecording:function(){this.isRecording()&&(this.state.state!==E.READY&&this.props.onStateChange(E.READY),this.safeIsMounted()&&this.setState({state:E.READY,active:void 0,elapsedTime:0,startTime:0}),this.clearSafeInterval(this.elapsedTimeInterval),delete this.elapsedTimeInterval,this.recorder&&this.recorder.stop(),this.props.chat.markPaused())},startInterval:function(){var e=this;this.elapsedTimeInterval=this.safeInterval(function(){e.setState({elapsedTime:e.state.elapsedTime+1})},1e3),this.setState({elapsedTime:0,startTime:Date.now()})},cancelPTTTimer:function(){this.pttTimer&&(this.clearSafeTimeout(this.pttTimer),delete this.pttTimer)},onPTTReady:function(){delete this.pttTimer,this.state.state===E.DELAY&&this.setState({state:E.REC})},uimClose:function(){this.cancelRecording()},onMouseOverSend:function(){this.setState({active:E.SEND})},onMouseOutSend:function(){this.setState({active:void 0})},onMouseOverCancel:function(){this.setState({active:E.CANCEL})},onMouseOutCancel:function(){this.setState({active:void 0})},onMouseUpCancel:function(){this.state.elapsedTime<1||(this.cancelPTTTimer(),this.uimPop(u.PTT))},onMouseUpSend:function(){var e=this;if(!(this.state.elapsedTime<1)){this.cancelPTTTimer();var t=this.props.chat;this.state.state===E.REC?t.regCancellablePromise(new o["default"](function(n,r){e.setState({state:E.PROCESSSING}),e.props.onStateChange(E.READY),e.recorder.addEventListener("dataAvailable",function(r){e.recorder.removeEventListener("dataAvailable"),n(),v.prepFileForUpload(r.detail).then(function(e){e.msgType="ptt",t.sendMedia2([e])}),e.uimPop(u.PTT)}),e.recorder.stop()}))["catch"](o["default"].CancellationError,function(){e.uimPop(u.PTT)}):(this.uimPop(u.PTT),s.log("ptt:onMouseUpSend duration too short")())}},onMouseDown:function(){this.state.state===E.READY&&this.getRecorder().bind(this).then(function(){this.recorder.start(),this.props.chat.presence.update()["catch"](f.WapDrop,_.noop),this.props.chat.markRecording(),this.setState({state:E.DELAY}),this.props.onStateChange(E.REC),this.uimPush(this,u.PTT,{popable:!0}),u.stealFocus(u.PTT),this.pttTimer=this.safeDelay(this.onPTTReady,1500),this.startInterval()})["catch"](function(e){this.recorder&&this.recorder.stop(),s.error("PTT Recording Error")(e)})},render:function(){var e="btn-close btn-border ptt-close";this.state.active===E.CANCEL&&(e+=" is-hover");var t="btn-border ptt-send";this.state.active===E.SEND&&(t+=" is-hover");var n=this.state.state===E.DELAY||this.state.state===E.REC?a.createElement("div",{className:"ptt-recording",key:"recording"},a.createElement("button",{className:e,onMouseOver:this.onMouseOverCancel,onMouseOut:this.onMouseOutCancel,onMouseUp:this.onMouseUpCancel},a.createElement("span",{className:"icon icon-round-x btn-state-default"}),a.createElement("span",{className:"icon icon-round-x-inv btn-state-hover"})),a.createElement("div",{className:"ptt-counter"},moment.unix(this.state.elapsedTime).format("m:ss")),a.createElement("button",{className:t,onMouseOver:this.onMouseOverSend,onMouseOut:this.onMouseOutSend,onMouseUp:this.onMouseUpSend},a.createElement("span",{className:"icon icon-round-send btn-state-default"}),a.createElement("span",{className:"icon icon-round-send-inv btn-state-hover"}))):null,r=this.state.state===E.READY||this.state.state===E.PROCESSSING?a.createElement("button",{className:"icon btn-icon icon-ptt",onMouseDown:this.onMouseDown,disabled:this.state.state===E.PROCESSSING,key:"button"}):null,i="ptt-container";return n&&(i+=" active"),a.createElement("div",{className:i},a.createElement(y,{transitionName:"ptt"},n||r))}});e.exports=E},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(801),c=n(347),l=n(9),u=n(102),d=n(29),p=a.createClass({displayName:"Spam",mixins:[u],propTypes:{chat:a.PropTypes.instanceOf(s).isRequired},componentWillMount:function(){this.addObserver(Store.Blocklist,"add remove reset"),this.addObserver(this.props.chat,"change:trusted")},confirmReportGroupSpam:function(){l.openModal(a.createElement(c,{onOK:this.reportGroupSpam,okText:l10n.t("report_group_spam"),onCancel:l.closeModal.bind(l),cancelText:l10n.t("web_cancel")},l10n.t("report_group_spam_ack")))},reportGroupSpam:function(){var e=this.props.chat,t=e.sendSpamReport(!0);if(!e.isReadOnly){var n=e.sendExit(),r=d.waitForBBEvent(e.msgs,"change:last",function(e){return e.isGroupLeave()});t=o["default"].all([t,n,r])}t.then(function(){return e.sendDelete()})["catch"](_.noop),l.closeModal()},confirmReportSpam:function(){l.openModal(a.createElement(c,{onOK:this.reportSpam,okText:l10n.t("report_spam"),onCancel:l.closeModal.bind(l),cancelText:l10n.t("web_cancel")},l10n.t("report_spam_ack")))},reportSpam:function(){var e=this.props.chat;e.sendSpamReport().then(function(){return e.contact.setBlock(!0)}).then(function(){return e.sendDelete()})["catch"](_.noop),l.closeModal()},notSpam:function(){this.props.chat.sendNotSpam(!0)["catch"](_.noop)},confirmBlock:function(){l.openModal(a.createElement(c,{onOK:this.block,okText:l10n.t("block"),onCancel:l.closeModal.bind(l),cancelText:l10n.t("web_cancel")},l10n.t("block_ack")))},block:function(){this.props.chat.contact.setBlock(!0)["catch"](_.noop),l.closeModal()},confirmUnblock:function(){l.openModal(a.createElement(c,{okText:l10n.t("unblock_button"),onOK:this.unblock,cancelText:l10n.t("web_cancel"),onCancel:l.closeModal.bind(l)},l10n.t("unblock_confirmation",{contact:this.props.chat.contact.formattedName})))},unblock:function(){this.props.chat.contact.setBlock(!1)["catch"](_.noop),l.closeModal()},render:function(){var e=this.props.chat;if(e.isNewlyCreated())return null;if(e.trusted)return null;var t,n=[];if(e.isGroup)t=l10n.t("group_admin_not_a_contact"),n.push(a.createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportGroupSpam},l10n.t("report_group_spam")));else{t=l10n.t("sender_not_a_contact"),n.push(a.createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportSpam},l10n.t("report_spam")));var r=Store.Blocklist.get(e.id);r?n.push(a.createElement("button",{onClick:this.confirmUnblock,key:"unblock",className:"spam-button btn-plain"},l10n.t("unblock_button"))):n.push(a.createElement("button",{onClick:this.confirmBlock,key:"block",className:"spam-button btn-plain"},l10n.t("block")))}return n.push(a.createElement("button",{onClick:this.notSpam,key:"not_spam",className:"spam-button btn-plain"},l10n.t("not_spam"))),a.createElement("div",{className:"spam"},a.createElement("div",{className:"spam-text"},t),a.createElement("div",{className:"spam-controls"},n))}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(102),o=n(58),a=n(801),s=n(824),c=n(929),l=n(930),u=n(874),d=n(1005),p=n(822),h=n(881),f=n(9),m=n(38),g=n(103),v=n(158),y=r.createClass({displayName:"ConversationPanel",mixins:[i,v],propTypes:{chat:r.PropTypes.instanceOf(a).isRequired,msgCollection:r.PropTypes.instanceOf(s).isRequired,focusCtx:r.PropTypes.object},getInitialState:function(){return{canCompose:this.props.chat.canSend,selectable:!1,selectedMessages:[]}},componentWillMount:function(){var e=this.props.chat;this.addObserver(e,"change:canSend",this.onComposeState),this.openEvent=new m.WebcChatOpen({webcUnreadCount:e.unreadCount})},componentDidMount:function(){var e=this.props.chat;e.set({active:!0,viewed:!0}),this.openEvent&&(this.openEvent.markWebcChatOpenT(),this.openEvent.commit(),delete this.openEvent)},componentWillUnmount:function(){f.closeDrawer(o.DRAWER_RIGHT),this.props.chat.set("active",!1)},onComposeState:function(){var e=this.props.chat.canSend;this.state.canCompose!==e&&this.setState({canCompose:e})},uimClose:function(){this.setState({selectable:!1,selectedMessages:[]})},onSelectMessages:function(){this.state.selectable||(this.setState({selectable:!0}),this.uimPush(this,o.CONVERSATION_FOOTER,{escapable:!0}))},onCancelSelection:function(){this.uimPop(o.CONVERSATION_FOOTER)},onMessageSelect:function(e,t){this.onSelectMessages();var n;t?(n=this.state.selectedMessages.concat(e),this.setState({selectedMessages:n})):(n=_.without(this.state.selectedMessages,e),this.setState({selectedMessages:n}))},onPageUpDown:function(e){this.refs.msgs.onPageUpDown(e)},onDragStart:function(e){this.blockDrop=!0},onDragEnd:function(e){this.blockDrop=!1},onDragEnter:function(e){!this.blockDrop&&(_.contains(e.dataTransfer.types,"Files")||_.contains(e.dataTransfer.types,"text/uri-list")||_.contains(e.dataTransfer.types,"text/html"))&&(f.openDrawer(r.createElement(p,{chat:this.props.chat,state:h.STATE.ACTIVE,type:o.DRAWER_MID}),"slide-up"),e.stopPropagation(),e.preventDefault())},render:function(){var e,t,n=this.props,i=n.chat,o=n.msgCollection,a=n.focusCtx;if(this.state.selectable)t=r.createElement(d,{chat:i,selectedMessages:this.state.selectedMessages,onCancel:this.onCancelSelection}),e=r.createElement("footer",{className:"pane-footer pane-chat-footer"});else if(this.state.canCompose)e=r.createElement(u,{chat:i,onPageUpDown:this.onPageUpDown});else{var s=i.isGroup?l10n.t("web_cannot_send_not_a_group_participant"):l10n.t("web_cannot_send_to_blocked_contact_1",{contact:i.contact.formattedName});e=r.createElement("footer",{className:"pane-footer pane-chat-footer"},r.createElement("div",{className:"block-message"},s))}return r.createElement("div",{id:"main",className:"pane pane-chat pane-two",onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,onDragOver:this.onDragOver,onDragEnter:this.onDragEnter},r.createElement(c,{chat:i,canAttach:this.state.canCompose,onSelectMessages:this.onSelectMessages}),r.createElement("div",{className:"pane-body pane-chat-tile-container"},r.createElement(l,{ref:"msgs",chat:i,selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,msgCollection:o,onSelectMessages:this.onSelectMessages,focusCtx:a}),r.createElement("div",{className:"pane-chat-tile"})),e,r.createElement(g,{transitionName:"slide-up"},t))}});e.exports=y},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(1),a=n(81),s=n(58),c=n(47),l=n(158),u=n(103),d=n(105),p=d.HotKeys,h=r.createClass({displayName:"DrawerManager",mixins:[a,l],propTypes:{onRightDrawerIn:r.PropTypes.func.isRequired,onRightDrawerOut:r.PropTypes.func.isRequired,onRightDrawerAnimationComplete:r.PropTypes.func.isRequired},statics:{DEFAULT_TRANSITION:"drawer-left"},getInitialState:function(){var e={};return e[s.DRAWER_LEFT]={flow:null,transition:h.DEFAULT_TRANSITION},e[s.DRAWER_MID]={flow:null,transition:h.DEFAULT_TRANSITION},e[s.DRAWER_RIGHT]={flow:null,transition:h.DEFAULT_TRANSITION},{flows:e}},componentWillMount:function(){this.regCmd("open_drawer",this.openFlow),this.regCmd("close_drawer",this.closeFlow),this.regCmd("chat_delete",this.chatDelete)},openFlow:function(e,t,n){var r=e.props.type;return r?(r!==s.DRAWER_RIGHT||s.find(s.DRAWER_RIGHT)||this.props.onRightDrawerIn(),this.uimPush(this,r,{escapable:!0,parent:n}),this.state.flows[r]={flow:e,transition:t||h.DEFAULT_TRANSITION},void this.setState(this.state.flows,this.focus)):void o.log("drawerManager:openFlow Tried to open flow without a type.")()},focus:function(){var e=i.findDOMNode(this);e.contains(document.activeElement)||s.focusNode(e)},uimClose:function(e){e===s.DRAWER_RIGHT&&this.props.onRightDrawerOut();var t=this.state.flows;t[e]={flow:null,transition:t[e].transition},this.setState(t)},chatDelete:function(){this.closeFlow(s.DRAWER_RIGHT)},closeFlow:function(e){e?this.uimPop(e):(this.uimPop(s.DRAWER_MID),this.uimPop(s.DRAWER_RIGHT))},isFlowActive:function(e){var t=this.state.flows[e];return t&&t.flow},checkRTL:function(e){return l10n.isRTL()?e+"-rtl":e},onKeyPress:function(e){if(!e.metaKey&&!e.ctrlKey){var t=i.findDOMNode(this);if(t===document.activeElement){var n=_.toArray(t.querySelectorAll("input[data-tab]"));if(n.length){var r=_.first(n);p.flashFocus=Date.now(),r.restoreFocus?r.restoreFocus():s.focusNode(r)}}}},preventBlur:function(e){this.isFlowActive(s.DRAWER_MID)&&document.activeElement===i.findDOMNode(this)&&"Escape"!==e.key&&(e.preventDefault(),e.stopPropagation())},render:function(){var e=s,t=this.state.flows[e.DRAWER_LEFT].flow,n=this.checkRTL(this.state.flows[e.DRAWER_LEFT].transition),i=this.state.flows[e.DRAWER_MID].flow,o=c.isTrident?"fade":this.state.flows[e.DRAWER_MID].transition,a=this.state.flows[e.DRAWER_RIGHT].flow,l=this.checkRTL(this.state.flows[e.DRAWER_RIGHT].transition),d=a?void 0:this.props.onRightDrawerAnimationComplete;return r.createElement("div",{tabIndex:"-1",onKeyDown:this.preventBlur,onKeyPress:this.onKeyPress,className:"drawer-manager"},r.createElement(u,{transitionName:n,className:"pane pane-one"},t),r.createElement(u,{transitionName:o,className:"pane pane-two"},i),r.createElement(u,{transitionName:l,className:"pane pane-three",onAnimationComplete:d},a))}});e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(813),o=n(347),a=n(156),s=n(800),c=n(9),l=n(975),u=r.createClass({displayName:"AddContactToGroupFlow",mixins:[i],propTypes:{contact:r.PropTypes.instanceOf(a).isRequired},filter:function(e){var t=e.groupMetadata;return!e.isGroup||e.isGroup&&!t.participants.iAmMember()?!1:t.participants.get(this.props.contact.id)?l10n.t("already_added_to_group"):t.participants.iAmAdmin()?!0:l10n.t("chat_not_an_admin")},componentWillMount:function(){this.push(r.createElement(l,{chats:Store.Chat.filter(function(e){return e.isGroup}),filter:this.filter,onCancel:this.onBack,onGroup:this.confirmAddToGroup}))},confirmAddToGroup:function(e){this.push(r.createElement(o,{onOK:this.addToGroup.bind(null,e),okText:l10n.t("add_group_participant"),onCancel:this.onBack,cancelText:l10n.t("web_cancel")},r.createElement(s,{text:l10n.t("confirm_add_group_participant",{participant:this.props.contact.formattedName,subject:e.contact.name})})))},addToGroup:function(e){e.groupMetadata.participants.addParticipant(this.props.contact).then(function(){c.openChat(e)})["catch"](_.noop),this.endFlow()},onBack:function(){this.pop()}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(813),o=n(347),a=n(885),s=n(801),c=n(9),l=n(800),u=r.createClass({displayName:"AddGroupParticipantFlow",mixins:[i],propTypes:{chat:r.PropTypes.instanceOf(s).isRequired},componentWillMount:function(){this.push(this.contactsModal)},contactsModal:function(){return r.createElement(a,{key:"contacts",title:l10n.t("add_group_participant"),filter:this.contactFilter,onCancel:this.onBack,onSelect:_.once(this.confirmAddParticipant)})},contactFilter:function(e){var t=this.props.chat.groupMetadata;return Store.Contact.isFilteredContact(e)?t.participants.get(e.id)?l10n.t("already_added_to_group"):!0:!1},confirmAddParticipant:function(e){var t=this.onAddParticipant.bind(this,e),n=l10n.t("confirm_add_group_participant",{participant:e.formattedName,subject:this.props.chat.contact.name});this.push(r.createElement(o,{key:"confirm_add",onOK:t,okText:l10n.t("add_group_participant"),onCancel:this.onBack,cancelText:l10n.t("web_cancel")},r.createElement(l,{text:n})))},onBack:function(){this.pop()},onAddParticipant:function(e){this.props.chat.groupMetadata.participants.addParticipant(e)["catch"](_.noop),c.closeModal()}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(813),o=n(883),a=n(801),s=n(826),c=r.createClass({displayName:"CaptureFlow",mixins:[i],propTypes:{chat:r.PropTypes.instanceOf(a).isRequired,stream:r.PropTypes.object.isRequired},componentWillMount:function(){this.push(r.createElement(o,{onBack:this.endFlow,caption:!0,onSend:this.sendMedia,stream:this.props.stream}))},sendMedia:function(e){var t=this,n=e.file,r=e.caption;s.prepFileForUpload(n).then(function(e){r&&(e.caption=r),t.props.chat.sendMedia2([e])}),this.endFlow()}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(813),o=n(968),a=n(9),s=r.createClass({displayName:"NewChatFlow",mixins:[i],componentWillMount:function(){this.push(r.createElement(o,{title:l10n.t("new_chat_flow_title"),onBack:this.endFlow,onClick:this.onClick}))},onClick:function(e,t){Store.Chat.find(t.id).then(a.openChat.bind(a)),this.endFlow()}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(813),o=n(978),a=n(979),s=r.createClass({displayName:"NewGroupFlow",mixins:[i],getDefaultProps:function(){return{transition:i.Transition.DEFAULT_DRAWER}},componentWillMount:function(){this.push(r.createElement(o,{key:"NewGroupDrawer",onBack:this.endFlow,onContinue:this.groupParticipants}))},groupParticipants:function(e,t,n){this.push(r.createElement(a,{key:"NewGroupParticipantsDrawer",subject:e,thumb:t,full:n,onBack:this.participantsBack,onContinue:this.createGroup}))},createGroup:function(e,t,n,r){Store.Chat.createGroup(e,t,n,r),this.endFlow()},participantsBack:function(e,t,n){this.pop({subject:e,thumb:t,full:n})}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(813),o=n(981),a=n(964),s=n(888),c=n(58),l=r.createClass({displayName:"SettingsFlow",mixins:[i],getDefaultProps:function(){return{transition:i.Transition.DEFAULT_DRAWER}},componentWillMount:function(){var e=r.createElement(o,{key:"SettingsDrawer",profileId:Store.Conn.me,type:c.SETTINGS_DRAWER,onBlocked:this.showBlockedDrawer,onProfile:this.showProfileDrawer,onClose:this.settingsClose});this.push(e),c.push(this,c.SETTINGS_DRAWER,{escapable:!0})},showBlockedDrawer:function(){var e=r.createElement(a,{key:"BlockedDrawer",type:c.BLOCKED_DRAWER,onClose:this.blockedClose});this.push(e),c.push(this,c.BLOCKED_DRAWER,{escapable:!0})},showProfileDrawer:function(){var e=r.createElement(s,{key:"ProfileDrawer",type:c.DRAWER_LEFT,id:Store.Conn.me,onClose:this.profileClose});this.push(e),c.push(this,c.PROFILE_DRAWER,{escapable:!0})},uimClose:function(){this.pop()},profileClose:function(){c.pop(c.PROFILE_DRAWER)},blockedClose:function(){c.pop(c.BLOCKED_DRAWER)},settingsClose:function(){c.pop(c.SETTINGS_DRAWER)}});e.exports=l},function(e,t,n){"use strict";var r=n(6),i=n(352),o=r.createClass({displayName:"IntroPanel",componentDidMount:function(){var e=this.refs.image,t=this.refs.text;Velocity(e,{scale:[1,0],opacity:[1,0]},{delay:1340,duration:180,easing:[.05,1.02,0,1.01]}),Velocity(t,{translateY:[0,80],opacity:[1,0]},{delay:1300,duration:140,easing:[.05,1.02,0,1.01]})},render:function(){return r.createElement("div",{className:"pane pane-intro pane-two"},r.createElement("div",{className:"intro-body"},r.createElement("div",{ref:"image",className:"intro-image"}),r.createElement("div",{ref:"text",className:"intro-text-container"},r.createElement("h1",{"data-a8n":i.key("intro-title"),className:"intro-title"},l10n.t("intro_title")),r.createElement("div",{"data-a8n":i.key("intro-text"),className:"intro-text"},l10n.t("intro_connection")))))}});e.exports=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=void 0,n=void 0;return new a["default"](function(r,i){c.info("MediaAnalyzer:isSupported sending file to worker")(),n=new u.WebcMediaAnalyzed,t=new l,t.onmessage=r,t.onerror=i,t.postMessage(e)}).then(function(n){return"FileReader undefined"===n.data?new a["default"](function(t,n){c.log("MediaAnalyzer:isSupported sending buffer to worker")();var r=new FileReader;r.onload=t,r.onerror=n,r.onabort=n,r.readAsArrayBuffer(e)}).then(function(e){return new a["default"](function(n,r){t.onmessage=n,t.onerror=r,t.postMessage(e.target.result,[e.target.result])})}):n}).then(function(t){var r=t.data;if(c.info("MediaAnalyzer:isSupported got result "+r)(t),"boolean"!=typeof r)throw r;var i=void 0;if(e.name){var o=e.name.split(".");o.length>1&&(i=o[o.length-1])}return n.set({webcMediaSupported:r,webcMediaExtensions:i}),n.markWebcMediaAnalyzeT(),n.commit(),r})["catch"](function(e){return c.error("MediaAnalyzer:isSupported got error! "+e)(e),s.upload("media-detection-error"),!1})["finally"](function(){t&&t.terminate()})}var o=n(3),a=r(o),s=n(10),c=n(1),l=n(1033),u=n(38);e.exports={isSupported:i}},function(e,t,n){"use strict";var r=n(6),i=n(105),o=i.HotKeys,a=r.createClass({displayName:"MenuItemWithTooltip",propTypes:{tooltip:r.PropTypes.node.isRequired,children:r.PropTypes.node.isRequired,onAction:r.PropTypes.func},getInitialState:function(){return{hover:!1,focus:!1}},onMouseEnter:function(){this.setState({hover:!0})},onMouseLeave:function(){this.setState({hover:!1})},onFocus:function(){this.setState({focus:!0})},onBlur:function(){this.setState({focus:!1})},render:function(){var e=this.state.hover,t=this.state.focus,n=this.props.onAction||_.noop,i=e||t?this.props.tooltip:null,a={enter:n};return r.createElement(o,{component:"li",handlers:a,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onFocus,onBlur:this.onBlur,onClick:n,className:"menu-item menu-shortcut",style:{"float":"right"}},this.props.children,i)}});e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(9),a=n(802),s=n(804),c=n(803),l=n(807),u=n(815),d=n(820),p=n(102),h=n(808),f=n(58),m=n(105),g=m.HotKeys,v=r.createClass({displayName:"ArchivedDrawer",mixins:[p],getInitialState:function(){this.selection=new h([],function(e){return e.id})},componentDidMount:function(){this.addObserver(Store.Chat,"change:archive add remove"),this.refs.list&&f.focusNode(i.findDOMNode(this.refs.list))},onClick:function(e,t){o.openChat(t),this.onClose()},onClose:function(){o.closeDrawer(this.props.type)},getList:function(){return Store.Chat.filter("archive")},onNextChat:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrevChat:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setPrev()},render:function(){var e=this,t=void 0,n=this.getList();if(this.selection.init(n,!0),n.length>0){var i=n.map(function(t){return r.createElement(d,{chat:t,mode:d.Mode.LAST,key:t.id,active:e.selection,onClick:e.onClick})}),o={down:this.onNextChat,up:this.onPrevChat};t=r.createElement(g,{handlers:o,ref:"list",className:"drawer-section-main chatlist","data-list-scroll-container":!0},r.createElement(l,{data:i,height:l.DEFAULT_HEIGHT,extraItems:4}))}else t=r.createElement(u.Archived,null);return r.createElement(a,{id:"blocked",onCancel:this.onClose},r.createElement(s,{title:l10n.t("archived_flow_title"),onBack:this.onClose,type:s.Type.LARGE}),r.createElement(c,null,t))}});e.exports=v},function(e,t,n){"use strict";var r=n(6),i=n(9),o=n(802),a=n(804),s=n(803),c=n(807),l=n(815),u=n(812),d=n(347),p=n(102),h=n(885),f=r.createClass({displayName:"BlockedDrawer",mixins:[p],propTypes:{onClose:r.PropTypes.func},componentWillMount:function(){this.addObserver(Store.Blocklist,"add remove")},onBlockConfirm:function(e){e.setBlock(!0)["catch"](_.noop),
i.closeModal()},onBlock:function(e){var t=function(e){return Store.Contact.isFilteredContact(e)?Store.Blocklist.get(e.id)?l10n.t("participant_already_blocked"):!0:!1};i.openModal(r.createElement(h,{title:l10n.t("add_blocked_title"),filter:t,onCancel:i.closeModal.bind(i),onSelect:_.once(this.onBlockConfirm)}))},onUnblockConfirm:function(e){e.setBlock(!1)["catch"](_.noop),i.closeModal()},onUnblockCancel:function(){i.closeModal()},onUnblock:function(e,t){i.openModal(r.createElement(d,{okText:l10n.t("unblock_button"),onOK:this.onUnblockConfirm.bind(this,t),cancelText:l10n.t("web_cancel"),onCancel:this.onUnblockCancel},l10n.t("unblock_confirmation",{contact:t.formattedName})))},render:function(){var e=this,t=void 0,n=void 0;if(Store.Blocklist.length>0){var i=Store.Blocklist.map(function(t){return r.createElement(u,{contact:t.contact,key:t.contact.id,onClick:e.onUnblock,onDelete:e.onUnblock})});t=r.createElement("div",{className:"drawer-section-main chatlist","data-list-scroll-container":!0},r.createElement(c,{data:i,height:c.DEFAULT_HEIGHT,extraItems:4})),n=r.createElement("div",{className:"hint"},l10n.t("add_blocked_description"))}else t=r.createElement(l.Blocked,null);return r.createElement(o,{id:"blocked",onCancel:this.props.onClose},r.createElement(a,{title:l10n.t("blocked_flow_title"),onBack:this.props.onClose,type:a.Type.LARGE}),r.createElement(s,null,r.createElement("div",{className:"list-action",onClick:this.onBlock},r.createElement("div",{className:"list-action-icon"},r.createElement("span",{className:"icon icon-add-user"})),r.createElement("div",{className:"list-action-body"},l10n.t("add_blocked_title"))),t,n))}});e.exports=f},function(e,t,n){"use strict";var r=n(6),i=n(845),o=n(883),a=n(9),s=r.createClass({displayName:"CaptureModal",propTypes:{onSend:r.PropTypes.func.isRequired,stream:r.PropTypes.object.isRequired},onCancel:function(){a.closeModal()},onSend:function(e){this.props.onSend(e.file),this.onCancel()},render:function(){return r.createElement(i,{type:i.BOX},r.createElement(o,{onBack:this.onCancel,caption:!1,onSend:this.onSend,stream:this.props.stream,noContainer:!0}))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(845),a=n(9),s=n(802),c=n(804),l=n(803),u=n(103),d=n(830),p=n(820),h=n(812),f=n(807),m=n(815),g=n(58),v=n(808),y=n(105),E=y.HotKeys,b=n(46),w={RECENT:"recent",GROUPS:"groups",CONTACTS:"contacts"},S=r.createClass({displayName:"ChatModal",propTypes:{title:r.PropTypes.string,onChat:r.PropTypes.func.isRequired,selectedTab:r.PropTypes.oneOf(_.values(w)),onSelectTab:r.PropTypes.func},getInitialState:function(){return{searchText:"",selected:this.props.selectedTab||w.RECENT}},componentWillMount:function(){this.selection=new v(this.getData(),function(e){return e.id})},onSelectTab:function(e){var t=this,n=_.values(w).indexOf(this.state.selected),r=_.values(w).indexOf(e),i=r>n?"right":"left";this.tabSelected=!0,this.setState({searchText:"",selected:e,direction:i},function(){delete t.tabSelected}),this.props.onSelectTab&&this.props.onSelectTab(e)},getFilteredChats:function(){var e=this.state.searchText;return e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.contact.searchMatch(e)&&!t.isNewlyCreated()})):Store.Chat.filter(function(e){return!e.isNewlyCreated()})},getFilteredGroups:function(){var e=this.state.searchText;return e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.isGroup&&t.contact.searchMatch(e)&&!t.isNewlyCreated()})):Store.Chat.filter(function(e){return e.isGroup&&!e.isNewlyCreated()})},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},getData:function(){switch(this.state.selected){case w.CONTACTS:return this.getFilteredContacts();case w.GROUPS:return this.getFilteredGroups();case w.RECENT:return this.getFilteredChats()}},getList:function(){var e,t=this;switch(this.state.selected){case w.CONTACTS:e=this.getFilteredContacts(),e=e.map(function(e){return r.createElement(h,{active:t.selection,contact:e,onClick:t.forwardToContact,secondary:e.isBlocked()?l10n.t("confirm_unblock_contact_and_forward_text"):null,key:e.id})});break;case w.GROUPS:e=this.getFilteredGroups(),e=e.map(function(e){return r.createElement(p,{active:t.selection,chat:e,mode:p.Mode.INFO,noContext:!0,onClick:t.forwardToChat,key:e.id})});break;case w.RECENT:e=this.getFilteredChats(),e=e.map(function(e){return e.isGroup?r.createElement(p,{active:t.selection,chat:e,mode:p.Mode.INFO,noContext:!0,onClick:t.forwardToChat,key:e.id}):r.createElement(h,{active:t.selection,contact:e.contact,onClick:t.forwardToContact,secondary:e.contact.isBlocked()?l10n.t("confirm_unblock_contact_and_forward_text"):null,key:e.id})})}return 0===e.length?null:r.createElement(f,{data:e,ref:"list",scrollTop:this.tabSelected?0:void 0,height:72,extraItems:4})},getTabs:function(){var e=this;return[{tab:w.RECENT,title:l10n.t("web_recent_chats")},{tab:w.GROUPS,title:l10n.t("web_groups")},{tab:w.CONTACTS,title:l10n.t("web_contacts")}].map(function(t){var n=b("menu-item",{active:e.state.selected===t.tab});return r.createElement("button",{className:n,onClick:e.onSelectTab.bind(null,t.tab),key:t.tab,title:t.title},t.title)})},forwardToContact:function(e,t){Store.Chat.find(t.id).then(this.forwardToChat.bind(this,e))},forwardToChat:function(e,t){this.props.onChat(t)},onSearch:function(e){this.setState({searchText:e})},onStopSearch:function(){this.setState({searchText:""})},onCancel:function(){a.closeModal()},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.first(this.getData());t&&this.forwardToContact(e,t)},onFocusList:function(e){e.preventDefault(),e.stopPropagation(),E.flashFocus=Date.now(),this.selection.setFirst()},indicateSearchFocus:function(e){if(this.selection.unset(),!(Date.now()-(E.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.search);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},onListFocus:function(e){e.target===i.findDOMNode(this.refs.list)&&(this.selection.index<0?this.selection.setFirst():this.selection.reset())},onNext:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrev:function(e){e.stopPropagation(),e.preventDefault();var t=this.selection.prev();t>-1?this.selection.setPrev():(this.selection.unset(),E.flashFocus=Date.now(),g.focusNode(this.refs.search))},render:function(){var e=this.getList();if(this.selection.init(this.getData()),!e)if(this.state.searchText)e=r.createElement(m.Search,null);else switch(this.state.selected){case w.CONTACTS:e=r.createElement(m.ListContacts,null);break;case w.GROUPS:e=r.createElement(m.ListGroups,null);break;case w.RECENT:e=r.createElement(m.ListChats,null)}var t="right"===this.state.direction?"slide-forward":"slide-back",n={down:this.onFocusList,enter:this.onSelectFirst},i={down:this.onNext,up:this.onPrev};return r.createElement(o,{type:o.TOWER},r.createElement(s,{key:"chat-modal",onCancel:this.onCancel},r.createElement(c,{title:this.props.title,type:c.Type.POPUP,onCancel:this.onCancel}),r.createElement("div",{className:"menu-tabs menu-tabs-lists","data-active-tab":this.state.selected},this.getTabs()),r.createElement(E,{handlers:n,onFocus:this.indicateSearchFocus},r.createElement(d,{ref:"search",searchText:this.state.searchText,onSearch:this.onSearch,key:this.state.selected,searchType:g.CHAT_SEARCH,placeholder:l10n.t("search")})),r.createElement(l,{"data-list-scroll-container":!0},r.createElement(u,{transitionName:t,className:"column"},r.createElement(E,{handlers:i,onFocus:this.onListFocus,"data-tab":3,className:"column",ref:"list",key:this.state.selected},r.createElement("div",{className:"chatlist column"},e))))))}});e.exports=S},function(e,t,n){"use strict";var r=n(6),i=n(352),o=n(801),a=n(9),s=n(80),c=n(839),l=n(800),u=n(347),d=r.createClass({displayName:"ClearChatPopup",propTypes:{onCancel:r.PropTypes.func,onDeleteOrExit:r.PropTypes.func,chat:r.PropTypes.instanceOf(o).isRequired},getInitialState:function(){return{keepStarred:!0}},getText:function(){var e=this.props.chat;switch(e.kind){case o.KIND.GROUP:return l10n.t("clear_chat_group",{name:e.formattedTitle});case o.KIND.CHAT:return l10n.t("clear_chat_chat",{name:e.formattedTitle});case o.KIND.BROADCAST:return l10n.t("clear_chat_broadcast");default:return""}},onCancel:function(){a.closeModal()},onClear:function(){var e=this.props.chat;e.pendingAction++,e.sendClear(s.supportsFeature(s.F.STARRED)&&s.supportsFeature(s.F.CHAT_CLEAR_STARRED)&&this.state.keepStarred)["finally"](function(){e.pendingAction--}),a.closeModal()},onToggleStarred:function(){this.setState({keepStarred:!this.state.keepStarred})},render:function(){var e=void 0;return s.supportsFeature(s.F.STARRED)&&s.supportsFeature(s.F.CHAT_CLEAR_STARRED)&&(e=r.createElement("div",{className:"controls-section",onClick:this.onToggleStarred},r.createElement("div",{"data-a8n":i.key("menu-icon-clear-chat"),className:"control"},r.createElement(c,{onChange:this.onToggleStarred,checked:this.state.keepStarred})),r.createElement("div",{className:"label"},l10n.t("keep_starred")))),r.createElement(u,{title:l10n.t("are_you_sure"),onOK:this.onClear,okText:l10n.t("clear_button"),onCancel:this.onCancel},r.createElement("div",null,r.createElement(l,{text:this.getText()}),e))}});e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(802),o=n(804),a=n(803),s=n(866),c=n(830),l=n(153),u=n(58),d=n(105),p=d.HotKeys,h=r.createClass({displayName:"ContactDrawer",mixins:[l],propTypes:{onBack:r.PropTypes.func.isRequired,onClick:r.PropTypes.func.isRequired},getInitialState:function(){return{searchText:"",cancelSearch:!1,active:!1}},componentDidMount:function(){this.safeDefer(function(e){e.setState({active:!0})},this)},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},uimClose:function(){return this.searchText?(this.setState({searchText:"",cancelSearch:!0}),!0):!1},onSearch:function(e){this.setState({searchText:e})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),p.flashFocus=Date.now(),this.refs.list.focusFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.first(this.getFilteredContacts());t&&(p.flashFocus=Date.now(),this.props.onClick(e,t))},onFocusSearch:function(e){p.flashFocus=Date.now(),u.focusNode(this.refs.search)},render:function(){var e=this.state.active?r.createElement(s,{ref:"list",contacts:this.getFilteredContacts(),onFocusSearch:this.onFocusSearch,onClick:this.props.onClick}):null,t={down:this.onFocusList,enter:this.onSelectFirst};return r.createElement(i,{key:"contact-modal",onCancel:this.props.onBack},r.createElement(o,{title:this.props.title,type:o.Type.LARGE,onBack:this.props.onBack}),r.createElement(p,{handlers:t},r.createElement(c,{ref:"search",searchText:this.state.searchText,isSearching:!this.state.cancelSearch,onSearch:this.onSearch,searchType:u.CONTACT_SEARCH,placeholder:l10n.t("search_contacts")})),r.createElement(a,{"data-list-scroll-container":!0},e))}});e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(9),o=n(102),a=n(802),s=n(804),c=n(803),l=n(818),u=n(908),d=n(832),p=n(107),h=n(809),f=n(798),m=n(46),g=n(7),v=r.createClass({displayName:"ContactMsgInfoDrawer",mixins:[o],propTypes:{msg:r.PropTypes.instanceOf(f)},getInitialState:function(){return{msgInfo:void 0}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg).then(function(t){e.setState({msgInfo:t}),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](function(){e.setState({unimplemented:!0}),i.openToast(r.createElement(h,{msg:l10n.t("msg_info_failed"),id:h.genId("msg_info_failed")}))})},componentDidMount:function(){this.props.msg.type===f.TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight)},onClose:function(){i.closeDrawer(this.props.type)},render:function(){var e=this.props.msg,t=this.state,n=t.msgInfo,i=t.unimplemented,o=void 0,h=void 0;if(n){var v=[],y=void 0,_=void 0,E=void 0;n.isPTT&&(h=l10n.t("message_info_seen"),y=n.played.first(),_=y&&y.t,E=r.createElement("span",{className:"icon icon-status icon-status-ptt-blue"}),v.push(r.createElement(u,{title:l10n.t("message_info_played"),t:_,icon:E,key:"played"}))),y=n.read.first(),_=y&&y.t,E=r.createElement("span",{className:"icon icon-status icon-status-dblcheck-ack"}),h=h||l10n.t("message_info_read"),v.push(r.createElement(u,{title:h,t:_,icon:E,key:"read"})),y=n.delivery.first(),_=y&&y.t,E=r.createElement("span",{className:"icon icon-status icon-status-dblcheck"}),v.push(r.createElement(u,{title:l10n.t("message_info_delivered"),t:_,icon:E,key:"delivery"})),o=r.createElement(l,{classes:"drawer-section-info well animate-enter"},v)}var b=void 0;n||i||(b=r.createElement(l,{classes:"drawer-section-spinner",key:"spinner"},r.createElement(p,{size:50,stroke:4})));var w=m("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":e.type===f.TYPE.PTT||e.type===f.TYPE.IMAGE||e.type===f.TYPE.LOCATION||e.type===f.TYPE.VCARD});return r.createElement(a,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement(s,{title:l10n.t("message_info"),type:s.Type.SMALL,onCancel:this.onClose}),r.createElement("div",{className:w,ref:"scrollable"},r.createElement("div",{className:"pane-preview"},r.createElement("div",{className:"pane-chat-tile"}),r.createElement(d,{msg:e,displayType:g.DISP_TYPE.MSG_INFO,position:d.Position.END}))),r.createElement(c,{classes:"drawer-body-msg-info"},b,o))}});e.exports=v},function(e,t,n){"use strict";var r=n(6),i=n(352),o=n(1),a=n(801),s=n(9),c=n(799),l=n(800),u=r.createClass({displayName:"DeleteChatPopup",mixins:[c],propTypes:{onCancel:r.PropTypes.func,onDeleteOrExit:r.PropTypes.func,chat:r.PropTypes.instanceOf(a).isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},getText:function(){var e=this.props.chat,t=e.formattedTitle;return e.isGroup?this.state.isReadOnly?l10n.t("web_delete_group_dialog_title",{groupName:t}):l10n.t("web_exit_group_dialog_title",{groupName:t}):e.isUser?l10n.t("delete_chat_dialog_title",{name:t}):e.isBroadcast?l10n.t("delete_list_dialog_title"):void 0},getButton:function(){var e=this.props.chat;return e.isGroup?this.state.isReadOnly?l10n.t("web_delete"):l10n.t("web_exit"):e.isUser||e.isBroadcast?l10n.t("web_delete"):void 0},onCancel:function(){s.closeModal(),_.isFunction(this.props.onCancel)&&this.props.onCancel()},onDelete:function(){var e,t=this.props.chat;t.isGroup?e=this.state.isReadOnly?t.sendDelete():t.sendExit():t.isUser||t.isBroadcast?e=t.sendDelete():o.error("deleteChatPopup:onDelete Unsupported chat type")(),_.isFunction(this.props.onDeleteOrExit)&&e&&this.props.onDeleteOrExit(e),s.closeModal()},render:function(){return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:"popup"},r.createElement("div",{className:"popup-body"},r.createElement("div",{className:"popup-title"},l10n.t("are_you_sure")),r.createElement("div",{className:"popup-contents"},r.createElement(l,{text:this.getText()}))),r.createElement("div",{className:"popup-controls"},r.createElement("button",{"data-a8n":i.key("cancel-btn"),className:"btn-plain popup-controls-item",onClick:this.onCancel},l10n.t("web_cancel")),r.createElement("button",{"data-a8n":i.key("delete-btn"),className:"btn-plain btn-default popup-controls-item",onClick:this.onDelete},this.getButton())))))}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(352),o=n(1),a=n(9),s=n(839),c=n(809),l=n(46),u={title:0,hour:1,day:24,week:168},d=r.createClass({displayName:"DoNotDisturbSettings",getInitialState:function(){return{notifications:Store.Mute.getGlobalNotifications(),sounds:Store.Mute.getGlobalSounds(),previews:Store.Mute.getGlobalPreviews(),dnd:u.title}},componentWillUnmount:function(){this.state.dnd!==u.title&&a.openToast(r.createElement(c,{msg:this.globalMuteDurationLabel(this.state.dnd),id:c.genId()}))},globalMuteDurationLabel:function(e){switch(this.state.dnd){case 1:return l10n.t("global_muted_1hour");case 24:return l10n.t("global_muted_1day");case 168:return l10n.t("global_muted_1week");default:return o.log("DoNotDisturbSettings:globalMuteDurationLabel non standard global mute duration:"+e)(),l10n.t("global_muted")}},onSounds:function(){var e=!this.state.sounds;this.setState({sounds:e}),Store.Mute.setGlobalSounds(e)},onNotifications:function(){var e=!this.state.notifications;this.setState({notifications:e}),Store.Mute.setGlobalNotifications(e)},onPreviews:function(){var e=!this.state.previews;this.setState({previews:e}),Store.Mute.setGlobalPreviews(e)},onDND:function(e){var t=parseInt(e.target.value,10);if(0===t)return this.setState({dnd:u.title}),void Store.Mute.globalMute().unmute();this.setState({dnd:t});var n=moment().unix()+60*e.target.value*60;Store.Mute.globalMute().mute(n)},onClose:function(e){a.closeModal()},render:function(){var e=[];if(window.Notification){e.push(r.createElement("div",{className:"controls-section",onClick:this.onNotifications,key:0},r.createElement("div",{"data-a8n":i.key("menu-icon-notifications"),className:"control"},r.createElement(s,{onChange:this.onNotifications,checked:this.state.notifications})),r.createElement("div",{className:"label"},l10n.t("option_desktop_notifications"))));var t=l("controls-section",{disabled:!this.state.notifications});e.push(r.createElement("div",{className:t,onClick:this.onPreviews,key:1},r.createElement("div",{"data-a8n":i.key("menu-icon-notifications"),className:"control"},r.createElement(s,{onChange:this.onPreviews,checked:this.state.previews})),r.createElement("div",{className:"label"},l10n.t("option_msg_previews"),r.createElement("div",{className:"hint"},l10n.t("option_msg_previews_hint_text")))))}return r.createElement("div",{className:"controls-container"},r.createElement("div",{className:"controls-section",onClick:this.onSounds},r.createElement("div",{"data-a8n":i.key("menu-icon-notifications"),className:"control"},r.createElement(s,{onChange:this.onSounds,checked:this.state.sounds})),r.createElement("div",{className:"label"},l10n.t("option_sounds"))),e,r.createElement("div",{className:"controls-section controls-section-wide"},r.createElement("div",{className:"select"},r.createElement("select",{value:this.state.dnd,onChange:this.onDND},r.createElement("option",{value:u.title,disabled:this.state.state===u.title},l10n.t("option_select_mute")),r.createElement("option",{value:u.hour,disabled:this.state.state===u.hour},l10n.t("mute_1hour")),r.createElement("option",{value:u.day,disabled:this.state.state===u.day},l10n.t("mute_1day")),r.createElement("option",{value:u.week,disabled:this.state.state===u.week},l10n.t("mute_1week"))))))}});e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(46),o=r.createClass({displayName:"DrawerSectionFooter",propTypes:{children:r.PropTypes.node.isRequired,separator:r.PropTypes.bool},getDefaultProps:function(){return{separator:!0}},render:function(){var e=i("drawer-section-footer",{separator:this.props.separator});return r.createElement("div",{className:e},r.createElement("div",{className:"col-main"},this.props.children))}});e.exports=o},function(e,t,n){"use strict";var r=n(6),i=n(9),o=n(61),a=n(22),s=r.createClass({displayName:"E2EInfoModal",propTypes:{e2eSubtype:r.PropTypes.string.isRequired,jid:r.PropTypes.string,chatId:r.PropTypes.string},onLearnMore:function(){var e;switch(this.props.e2eSubtype){case"identity":e="https://www.whatsapp.com/faq/general/28030014/";break;case"encrypt":default:e="https://www.whatsapp.com/security/"}var t=o.build(e,{lg:Store.Conn.lg,lc:Store.Conn.lc});window.open(t,"_blank")},render:function(){var e;switch(this.props.e2eSubtype){case"identity":var t=Store.Contact.get(this.props.jid),n=t?t.formattedName:"";e=l10n.t("web_security_code_change_description",{name:n});break;case"encrypt":default:e=a.isGroup(this.props.chatId)?l10n.t("web_group_encryption_state_change_description"):a.isBroadcast(this.props.chatId)?l10n.t("web_broadcast_encryption_state_change_description"):l10n.t("web_individual_chat_encryption_state_change_description")}var o=r.createElement("button",{className:"btn-plain popup-controls-item",onClick:i.closeModal.bind(i)},l10n.t("web_ok")),s=r.createElement("button",{className:"btn-plain popup-controls-item",onClick:this.onLearnMore},l10n.t("learn_more"));return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:"popup"},r.createElement("div",{className:"popup-body"},r.createElement("div",{className:"popup-contents"},e)),r.createElement("div",{className:"popup-controls"},s,o))))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(9),o=n(102),a=n(802),s=n(804),c=n(803),l=n(818),u=n(972),d=n(909),p=n(832),h=n(107),f=n(809),m=n(798),g=n(837),v=n(46),y=n(7),_=r.createClass({displayName:"GroupMsgInfoDrawer",mixins:[o],propTypes:{msg:r.PropTypes.instanceOf(m)},getInitialState:function(){return{msgInfo:void 0}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg).then(function(t){e.setState({msgInfo:t}),e.addObserver(t.played,"add remove"),e.addObserver(t.read,"add remove"),e.addObserver(t.delivery,"add remove"),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](function(){e.setState({unimplemented:!0}),i.openToast(r.createElement(f,{msg:l10n.t("msg_info_failed"),id:f.genId("msg_info_failed")}))})},getAnimateEnterClass:function(e){return"animate-enter"+(-1===e?"":e)},componentDidMount:function(){this.props.msg.type===m.TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight)},onClose:function(){i.closeDrawer(this.props.type)},render:function(){var e,t=this.props.msg,n=this.state,i=n.msgInfo,o=n.unimplemented,f=-1,_=24,E=26,b=void 0,w=void 0;if(i&&i.isPTT){var S=r.createElement("span",{className:"icon icon-status-ptt-blue"}),T=i.played.map(function(e){return r.createElement(d,{participant:e,key:e.id})}),C=T.length>0?r.createElement("div",{className:"chatlist-plain"},T):null,M=i.playedRemaining>0?r.createElement(u,{separator:0!==i.played.length},l10n.t("message_info_remaining",{count:i.playedRemaining,_plural:i.playedRemaining})):null,N=v(this.getAnimateEnterClass(f),{"drawer-section-bottom":!(i&&i.deliveryRemaining>0||i&&!(i.played.length>0&&0===i.readRemaining))});w=l10n.t("message_info_seen_by"),e=M?_+E:_,R=g.minHeight(T,e),b=r.createElement(l,{classes:N,key:"played-section",expands:!0,style:R,title:l10n.t("message_info_played_by"),subtitle:S,footer:M},C)}var k=void 0;if(i&&(i.read.length>0||i.playedRemaining>0)){var x=r.createElement("span",{className:"icon icon-status-dblcheck-ack"}),P=i.read.map(function(e){return r.createElement(d,{participant:e,key:e.id})}),D=P.length>0?r.createElement("div",{className:"chatlist-plain"},P):null,A=i.readRemaining>0?r.createElement(u,{separator:0!==i.read.length},l10n.t("message_info_remaining",{count:i.readRemaining,_plural:i.readRemaining})):null,I=v(this.getAnimateEnterClass(f),{"drawer-section-bottom":!(i&&i.deliveryRemaining>0)});w=w||l10n.t("message_info_read_by"),e=A?_+E:_;var R=g.minHeight(P,e);k=r.createElement(l,{classes:I,key:"read-section",expands:!0,title:w,style:R,subtitle:x,footer:A},D)}var O=void 0;if(i&&(i.delivery.length>0||i.deliveryRemaining>0)){var L=r.createElement("span",{className:"icon icon-status-dblcheck"}),U=i.delivery.map(function(e){return r.createElement(d,{participant:e,key:e.id})}),F=U.length>0?r.createElement("div",{className:"chatlist-plain"},U):null,B=i.deliveryRemaining>0?r.createElement(u,{separator:0!==i.delivery.length},l10n.t("message_info_remaining",{count:i.deliveryRemaining,_plural:i.deliveryRemaining})):null,G=v(this.getAnimateEnterClass(f),"drawer-section-bottom");e=B?_+E:_,R=g.minHeight(U,e),O=r.createElement(l,{classes:G,key:"delivered-section",expands:!0,style:R,title:l10n.t("message_info_delivered_to"),subtitle:L,footer:B},F)}var j=void 0;i||o||(j=r.createElement(l,{classes:"drawer-section-spinner",key:"spinner"},r.createElement(h,{size:50,stroke:4})));var W=v("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":t.type===m.TYPE.PTT||t.type===m.TYPE.IMAGE||t.type===m.TYPE.LOCATION||t.type===m.TYPE.VCARD});return r.createElement(a,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement(s,{title:l10n.t("message_info"),type:s.Type.SMALL,onCancel:this.onClose}),r.createElement("div",{className:W,ref:"scrollable"},r.createElement("div",{className:"pane-preview"},r.createElement("div",{className:"pane-chat-tile"}),r.createElement(p,{msg:t,displayType:y.DISP_TYPE.MSG_INFO,position:p.Position.END}))),r.createElement(c,{classes:"drawer-body-msg-info"},j,b,k,O))}});e.exports=_},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(887),c=n(801),l=n(820),u=n(808),d=n(815),p=a.createClass({displayName:"GroupsModal",propTypes:{chats:a.PropTypes.arrayOf(a.PropTypes.instanceOf(c)),filter:a.PropTypes.func,onCancel:a.PropTypes.func.isRequired,onGroup:a.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(){return!0}}},getInitialState:function(){return this.selection=new u,{loading:!0,searchFilter:void 0}},componentWillMount:function(){var e=this,t=this.props.chats;o["default"].delay(300).then(function(){var e=_(t).filter(function(e){return e.groupMetadata.stale}).map(function(e){return e.groupMetadata.update()["catch"](_.noop)}).value();return o["default"].all(e)}).then(function(){return e.setState({loading:!1})})},onSelect:function(e,t){var n=t.props.chat;this.props.filter(n)===!0&&this.props.onGroup(t.props.chat)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this,t=this.props,n=t.chats,r=t.onGroup,i=t.filter,o=t.onCancel,c=void 0;return this.state.loading?c=a.createElement(d.Loading,null):!function(){var t=l10n.accentFold(e.state.searchFilter),o=n.filter(function(e){return i(e)&&(!t||t&&e.contact.searchMatch(t))});o.length?(e.selection.init(_.pluck(o.filter(function(e){return i(e)===!0}),"id")),c=o.map(function(t){var n=void 0,o=void 0;return _.isString(i(t))&&(n=a.createElement("div",{className:"chat-status ellipsify",title:i(t)},i(t)),o="member"),a.createElement(l,{chat:t,mode:l.Mode.INFO,active:e.selection,secondary:n,noContext:!0,className:o,onClick:_.isString(i(t))?void 0:r.bind(null,t),key:t.id})})):c=a.createElement(d.SearchGroups,null)}(),a.createElement(s,{title:l10n.t("web_groups"),selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_groups"),onSelect:this.onSelect,onCancel:o},c)}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(798),a=n(799),s=n(104),c=n(81),l=n(800),u=n(805),d=n(831),p=n(927),h=n(867),f=n(821),m=n(840),g=n(58),v=n(9),y=n(844),E=n(347),b=n(154),w=n(17),S=n(897),T=n(46),C=500,M=r.createClass({displayName:"MediaViewerModal",mixins:[a,c],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired,zoomIn:r.PropTypes.bool,getZoomNode:r.PropTypes.func,onBack:r.PropTypes.func.isRequired,onNext:r.PropTypes.func,onPrev:r.PropTypes.func},getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},componentWillMount:function(){var e=this;if(g.push(this,g.MEDIA_VIEWER,{escapable:!0}),this.regCmd("open_chat",this.onClose),this.props.zoomIn){var t=this.props.getZoomNode;t||(t=function(t){return v.isMsgVisible(e.props.msg.id,t)}),t(function(t){e.setState({zoomElement:t,style:t?{transition:"transform 2s",visibility:"hidden"}:{}})})}},onImageLoad:function(e){var t=this.state.zoomElement,n=e.target;t&&n&&this.props.zoomIn&&this.animateZoom(t,e.target)},animateZoom:function(e,t){var n=this,r=t.getBoundingClientRect(),i=e.getBoundingClientRect(),o=i.top-r.top,a=i.left-r.left,s=e.clientWidth/t.clientWidth;this.setState({style:{visibility:"hidden",transform:"translateX("+a+"px) translateY("+o+"px) scale("+s+")",transition:"transform 0s"}},function(){n.setState({style:{transform:"translateX(0px) translateY(0px) scale(1)",transition:"transform "+C+"ms cubic-bezier(.1,.82,.25,1)"}})})},stopPropagation:function(e){w.startDownloading(),e.stopPropagation()},openForwardFlow:function(e){e.stopPropagation();var t=this.props.msg;t.ack<1&&t.isMMS&&t.isSentByMe?v.openModal(r.createElement(E,{title:l10n.t("err_unsent_forward_title"),onOK:v.closeModal.bind(v),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text"))):v.openModal(r.createElement(y,{msgs:[this.props.msg]}),"modal-flow")},onScroll:function(e){this.onClose()},onClose:function(){g.find(g.MEDIA_VIEWER)&&g.pop(g.MEDIA_VIEWER)},uimClose:function(e){var t=this,n=void 0;if(this.props.zoomIn){var r=this.props.getZoomNode;r||(r=function(e){return v.isMsgVisible(t.props.msg.id,e)}),r(function(e){n=e})}if(!n)return this.props.onBack();var o=this.refs.mediaImage,a=o&&o.refs?o.refs.image:null;if(!a)return this.props.onBack();a=i.findDOMNode(a);var s=a.getBoundingClientRect(),c=n.getBoundingClientRect(),l=c.top-s.top,u=c.left-s.left,d=n.clientWidth/a.clientWidth;Velocity(a,{translateX:[u,0],translateY:[l,0],scale:[d,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){t.props.onBack()})},render:function(){var e,t=this.props.msg;switch(t.type){case"image":e=r.createElement(N,{msg:t,key:t.id,style:this.state.style,onLoad:this.onImageLoad,ref:"mediaImage"});break;case"video":e=r.createElement(k,{msg:t,key:t.id});break;case"audio":e=r.createElement(P,{msg:t,key:t.id})}var n=this.props.onNext?r.createElement("button",{className:"btn btn-round btn-media-next",onClick:this.props.onNext},r.createElement("span",{className:"icon icon-chevron-right icon-l",title:l10n.t("next_button")},l10n.t("next_button"))):r.createElement("div",{className:"btn-media-next"}),i=this.props.onPrev?r.createElement("button",{className:"btn btn-round btn-media-prev",onClick:this.props.onPrev},r.createElement("span",{className:"icon icon-chevron-left icon-l",title:l10n.t("previous_button")},l10n.t("previous_button"))):r.createElement("div",{className:"btn-media-prev"}),o=null,a=null;if(t.url){o=r.createElement("div",{className:"menu-item"},r.createElement("span",{className:"icon btn-media-forward icon-forward",title:l10n.t("forward"),onClick:this.openForwardFlow},l10n.t("forward")));var s=t.filename?t.filename:"WhatsApp-"+_.capitalize(t.type)+"-"+moment.unix(t.t).format("YYYYMMDD");a=r.createElement("div",{className:"menu-item"},r.createElement("a",{className:"icon icon-download",title:l10n.t("web_button_download"),onClick:this.stopPropagation,download:s,target:"_blank",href:t.url},l10n.t("web_button_download")))}var c=t.displayName(!0,!0);t.isGroupMsg&&(c+=" @ "+t.chat.formattedTitle);var d=T("media-viewer",{"media-viewer-animate":this.props.zoomIn}),p=T("media-panel-header",{});return r.createElement("div",{className:d,onWheel:this.onScroll,onClick:this.onClose},r.createElement("div",{className:p},r.createElement("div",{className:"chat media-chat"},r.createElement("div",{className:"chat-avatar"},r.createElement(u,{id:t.sender})),r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},r.createElement(l,{text:c})),r.createElement("div",{className:"chat-secondary"},r.createElement("div",{className:"chat-status ellipsify"},b.relativeDateAndTimeStr(t.t))))),r.createElement("div",{className:"menu menu-horizontal media-panel-tools"},o,a,r.createElement("div",{className:"menu-item"},r.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.onClose},l10n.t("web_close"))))),r.createElement("div",{className:"media-content",dir:"ltr",ref:"container"},i,r.createElement("div",{className:"media"},r.createElement(D,{msg:t}),e),n))}}),N=r.createClass({displayName:"MediaImage",mixins:[a,s],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired,style:r.PropTypes.object,onLoad:r.PropTypes.func
},getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},componentDidMount:function(){this.props.msg.forceDownloadMedia()},onImageClick:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t="media-viewer-img";if(e.mediaState===o.MEDIA_STATE.RESOLVED){var n={width:e.fullWidth,height:e.fullHeight};return r.createElement(f,{type:f.TYPES.SCALE_DOWN,size:n,style:{overflow:"visible"}},r.createElement(d,{src:e.url,style:this.props.style,ref:"image",onLoad:this.props.onLoad,onClick:this.onImageClick,className:t}))}return r.createElement(x,{msg:e})}}),k=r.createClass({displayName:"MediaVideo",mixins:[a,s],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired},getInitialState:function(){return{played:!1,mediaState:this.async("msg.mediaState")}},componentDidMount:function(){var e=this.props.msg;e.forceDownloadMedia()},onPlayerError:function(e){},onPlayerClick:function(e){e.stopPropagation();var t=i.findDOMNode(this.refs.player);e.clientY>t.clientHeight+t.offsetTop-44||(t.paused?t.play():t.pause())},render:function(){var e=this.props.msg,t="media-viewer-img";if(e.mediaState===o.MEDIA_STATE.RESOLVED){var n={width:e.fullWidth,height:e.fullHeight};return r.createElement(f,{type:f.TYPES.SCALE_DOWN,size:n},r.createElement(p,{msg:e,ref:"player",className:t,onError:this.onPlayerError,onClick:this.onPlayerClick,autoPlay:!0,controls:!0},l10n.t("video_playback_not_supported")))}return r.createElement(x,{msg:e})}}),x=r.createClass({displayName:"BlurredImage",render:function(){var e=this.props.msg,t="data:image/jpeg;base64,"+e.body,n=S.boundHeightWidth(10*e.height,10*e.width,500,500),i={width:n.width,height:n.height};return r.createElement("div",{className:"media-viewer-blur-crop",style:i},r.createElement("img",{className:"media-viewer-blur-img",src:t}))}}),P=r.createClass({displayName:"MediaAudio",mixins:[a,s],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired},getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},onPlayerError:function(e){},render:function(){var e=this.props.msg,t="media-viewer-img media-viewer-audio";return e.mediaState===o.MEDIA_STATE.RESOLVED?r.createElement(h,{msg:e,ref:"player",className:t,onClick:this.onPlayerClick,onError:this.onPlayerError,autoPlay:!0,controls:!0},l10n.t("audio_playback_not_supported")):r.createElement("div",{className:"image-audio"})}}),D=r.createClass({displayName:"MediaState",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired},getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},downloadMedia:function(){this.props.msg.downloadMedia()},render:function(){var e=this.props.msg,t=null,n=null;if(e.local)return null;switch(e.mediaState){case o.MEDIA_STATE.RESOLVED:case o.MEDIA_STATE.ERROR_MISSING:return null;case o.MEDIA_STATE.NEED_POKE:t=r.createElement(m.Download,{filesize:e.size}),n=this.downloadMedia;break;default:t=r.createElement(m.Pending,null)}return r.createElement("div",{onClick:n},t)}});e.exports=M},function(e,t,n){"use strict";var r=n(6),i=n(801),o=n(9),a=function(){return[{label:l10n.t("web_mute_8hours"),duration:8},{label:l10n.t("web_mute_1week"),duration:168},{label:l10n.t("web_mute_1year"),duration:8760}]},s=r.createClass({displayName:"MutePopup",propTypes:{onCancel:r.PropTypes.func,onMute:r.PropTypes.func.isRequired,chat:r.PropTypes.instanceOf(i).isRequired},getInitialState:function(){return{mute:8}},onChange:function(e){this.setState({mute:parseInt(e.target.value,10)})},onMute:function(e){e.stopPropagation(),o.closeModal(),this.props.onMute(3600*this.state.mute+moment().unix(),!0)},render:function(){var e=this.props.onCancel||function(){o.closeModal()},t=this.state.mute,n=this,i=a().map(function(e){var i=e.duration;return r.createElement("li",{key:"mute-"+i},r.createElement("label",null,r.createElement("input",{type:"radio",name:"duration",value:e.duration,checked:t===i,onChange:n.onChange}),e.label))}),s=this.props.chat.isGroup?l10n.t("web_mute_time"):l10n.t("web_mute_time_chat");return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:"popup"},r.createElement("div",{className:"popup-body"},r.createElement("div",{className:"popup-title",dir:"auto"},s),r.createElement("div",{className:"popup-contents"},r.createElement("form",{ref:"form"},r.createElement("ol",{className:"choices"},i)))),r.createElement("div",{className:"popup-controls"},r.createElement("button",{className:"btn-plain popup-controls-item",onClick:e},l10n.t("web_cancel")),r.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:this.onMute},l10n.t("web_ok"))))))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(802),o=n(804),a=n(803),s=n(819),c=n(841),l=n(103),u=n(58),d=n(811),p=r.createClass({displayName:"NewGroupDrawer",propTypes:{thumb:r.PropTypes.string,full:r.PropTypes.string,subject:r.PropTypes.string,onBack:r.PropTypes.func.isRequired,onContinue:r.PropTypes.func.isRequired},getInitialState:function(){return{text:this.props.subject||"",thumb:this.props.thumb,full:this.props.full,emojiActive:!1}},componentDidMount:function(){this.refs.emojiInput.restoreFocus()},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.refs.emojiInput.restoreFocus()},onImageSet:function(e,t){this.setState({thumb:e,full:t})},onContinue:function(){var e=d.emojify(this.state.text.trim()),t=this.refs.photoPicker;if(t.state.isEditing){var n=this;t.cropImage().then(function(t){n.props.onContinue(e,t.thumb,t.full)})}else this.props.onContinue(e,this.state.thumb,this.state.full)},onInputChange:function(e){this.setState({text:e.target.value})},render:function(){var e=this.state.text.trim().length>0,t=e?r.createElement("div",{className:"drawer-section drawer-controls"},r.createElement("button",{className:"btn btn-round","data-ignore-capture":u.IGNORE_ANY,onClick:this.onContinue},r.createElement("span",{className:"icon icon-forward-light icon-l"}))):null;return r.createElement(i,{id:"new-group",onCancel:this.props.onBack},r.createElement(o,{title:l10n.t("new_group_flow_title"),type:o.Type.LARGE,onBack:this.props.onBack}),r.createElement(a,null,r.createElement("div",{className:"drawer-section"},r.createElement(c,{type:c.Type.GROUP,startImage:this.state.full,onImageSet:this.onImageSet,ref:"photoPicker"})),r.createElement("div",{className:"drawer-section",onMouseDown:this.preventBlur},r.createElement(s,{id:u.SUBJECT_INPUT,ref:"emojiInput",placeholder:l10n.t("group_subject"),floating:!0,value:this.state.text,editable:!0,showRemaining:!0,maxLength:25,onEnter:e?this.onContinue:_.noop,onChange:this.onInputChange})),r.createElement(l,{transitionName:"btn"},t)))}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(802),o=n(804),a=n(803),s=n(866),c=n(916),l=n(102),u=n(7),d=n(9),p=n(809),h=n(58),f=n(103),m=n(105),g=m.HotKeys,v=p.genId("max_participant_toast"),y=r.createClass({displayName:"NewGroupParticipantsDrawer",mixins:[l],propTypes:{thumb:r.PropTypes.string,full:r.PropTypes.string,subject:r.PropTypes.string.isRequired,onBack:r.PropTypes.func.isRequired,onContinue:r.PropTypes.func.isRequired},getInitialState:function(){return{searchText:"",participants:[],shouldFocus:!0}},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts();e=_.difference(e,this.state.participants);var t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},componentDidMount:function(){this.focus()},componentDidUpdate:function(){this.adjustInput()},onKeyDown:function(e){if("Backspace"!==e.key||this.state.searchText||_.isEmpty(this.state.participants))"Enter"===e.key&&_.size(this.state.participants)&&this.onContinue();else{e.preventDefault();var t=this.state.participants;this.setState({participants:t.slice(0,t.length-1),shouldFocus:!0})}},onInput:function(e){this.setState({searchText:e.target.value})},adjustInput:function(){var e=this.refs.input.offsetParent.offsetWidth-10,t=this.refs.sizer.offsetWidth,n=t>e?e:t;this.refs.input.style.width=n+"px";var r;r=e-this.refs.input.offsetLeft-n>0?e-this.refs.input.offsetLeft:e,this.refs.input.style.width=r+"px",this.state.shouldFocus&&this.focus()},onReset:function(){this.setState({searchText:"",shouldFocus:!0})},focus:function(){h.focusNode(this.refs.input)},uimFocus:function(){this.focus()},onBack:function(){var e=this.props;e.onBack(e.subject,e.thumb,e.full)},onContinue:function(){var e=this.props;e.onContinue(e.subject,e.thumb,e.full,this.state.participants)},onDelete:function(e,t){var n=_.without(this.state.participants,t);this.setState({participants:n,shouldFocus:!n.length})},onContactClick:function(e,t){var n=this.state.participants;if(_.contains(n,t))this.setState({participants:_.without(n,t),shouldFocus:!0});else if(n.length>=u.MAX_GROUP_SIZE){var i=l10n.t("action_group_create_failed_participant",{max:u.MAX_GROUP_SIZE});d.openToast(r.createElement(p,{msg:i,id:v}))}else this.setState({participants:n.concat(t),searchText:"",shouldFocus:!0})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),g.flashFocus=Date.now(),this.refs.list.focusFirst())},onFocusParticipants:function(e){e.repeat||0!==this.refs.input.selectionStart||this.refs.participantList&&(e.preventDefault(),e.stopPropagation(),g.flashFocus=null,this.refs.participantList.focusLast())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.first(this.getFilteredContacts());t&&this.onContactClick(e,t)},onFocusSearch:function(e){g.flashFocus=Date.now(),h.focusNode(this.refs.input)},render:function(){var e=_.size(this.state.participants)?r.createElement("button",{className:"btn btn-round","data-ignore-capture":h.IGNORE_ANY,onClick:this.onContinue},r.createElement("span",{className:"icon icon-checkmark-light"})):null,t=_.size(this.state.participants)?" ":l10n.t("group_participant_hint"),n={down:this.onFocusList,enter:this.state.searchText?this.onSelectFirst:_.size(this.state.participants)?this.onContinue:_.noop,up:this.onFocusParticipants};return n[l10n.LR("left","right")]=this.onFocusParticipants,r.createElement(i,{id:"new-group",onCancel:this.onBack},r.createElement(o,{title:l10n.t("add_group_participants_title"),type:o.Type.LARGE,onBack:this.onBack}),r.createElement(a,{flex:!0},r.createElement("div",{className:"drawer-section new-group-search"},r.createElement("div",{className:"input-clear input-ext"},r.createElement(g,{handlers:n,className:"input input-line"},r.createElement("div",{className:"list-names list-deletable new-group-preview"},r.createElement("div",{className:"new-group-participants","data-list-scroll-container":!0},r.createElement(c,{ref:"participantList",contacts:this.state.participants,onDelete:this.onDelete,onFocusSearch:this.onFocusSearch}))),r.createElement("input",{className:"inputarea",ref:"input",placeholder:t,onKeyDown:this.onKeyDown,onChange:this.onInput,value:this.state.searchText}),r.createElement("span",{className:"inputarea-sizer",ref:"sizer"},this.state.searchText)))),r.createElement("div",{className:"new-group-contacts","data-list-scroll-container":!0},r.createElement(s,{ref:"list",contacts:this.getFilteredContacts(),onFocusSearch:this.onFocusSearch,onClick:this.onContactClick})),r.createElement(f,{transitionName:"btn",className:"drawer-section drawer-controls"},e)))}});e.exports=y},function(e,t,n){"use strict";var r=n(6),i=n(347),o=n(9),a=n(10),s=n(819),c=n(7),l=n(363),u=r.createClass({displayName:"SendLogsPopup",getInitialState:function(){return{email:"",logText:""}},onSend:function(){var e=l.format(Store.Conn.me.split("@")[0]);a.uploadUserReport(e,this.state.email,"Webclient Issue Reported",this.state.logText),o.closeModal()},onCancel:function(){o.closeModal()},onEmailChange:function(e){this.setState({email:e.target.value})},onChange:function(e){this.setState({logText:e.target.value})},render:function(){return r.createElement(i,{title:l10n.t("menuitem_send_logs"),okText:l10n.t("send_logs_confirm"),onOK:this.onSend,onCancel:this.onCancel},r.createElement(s,{placeholder:"email address",value:this.state.email,maxLength:140,editable:!0,floating:!0,disableEmoji:!0,className:"send-logs-input",multiline:!1,onChange:this.onEmailChange}),r.createElement(s,{placeholder:l10n.t("describe_logs"),value:this.state.logText,maxLength:c.MAX_STATUS_LENGTH,editable:!0,floating:!0,disableEmoji:!0,className:"send-logs-input",multiline:!0,onChange:this.onChange}))}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(9),o=n(802),a=n(804),s=n(803),c=n(46),l=n(971),u=n(103),d=n(1),p=n(10),h=n(805),f=n(800),m=n(799),g=r.createClass({displayName:"SettingsDrawer",mixins:[m],propTypes:{profileId:r.PropTypes.string.isRequired,onClose:r.PropTypes.func.isRequired,onBlocked:r.PropTypes.func.isRequired,onProfile:r.PropTypes.func.isRequired},getInitialState:function(){return{status:this.async("profileId.Status.status")||l10n.t("contact_status_loading"),notifications:!1,help:!1}},onNotifications:function(){this.setState({notifications:!this.state.notifications,help:!1})},onHelp:function(){p.upload("help-page-opened"),this.setState({notifications:!1,help:!this.state.help})},getHelpContent:function(){var e,t,n=Store.Conn.PLATFORMS;switch(e=Store.Conn.platform||"unknown"){case n.ANDROID:t=l10n.t("guide_help_description_android");break;case n.BB:t=l10n.t("guide_help_description_bb");break;case n.BBX:t=l10n.t("guide_help_description_bbx");break;case n.WP7:t=l10n.t("guide_help_description_wp7");break;case n.SYMBIAN:t=l10n.t("guide_help_description_symbian");break;case n.S40:t=l10n.t("guide_help_description_s40");break;case n.IPHONE:t=l10n.t("guide_help_description_iphone");break;default:d.log("chatlistHeader:onHelp unknown platform: "+e)()}var o=function(){i.closeModal(),window.open("http://www.whatsapp.com/faq/web","_blank")};return r.createElement("div",null,r.createElement("div",{className:"controls-container"},r.createElement("div",{className:"controls-section"},l10n.t("guide_help_faq")+" "+t),r.createElement("div",{className:"controls-section controls-section-last"},r.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:o},l10n.t("web_settings_faq")))),r.createElement("a",{href:"https://www.whatsapp.com/legal/",target:"_blank"},l10n.t("terms_and_privacy_link")))},render:function(){var e=r.createElement("div",{className:"chat",onClick:this.props.onProfile,"data-ignore-capture":"any"},r.createElement("div",{className:"chat-avatar"},r.createElement(h,{id:Store.Conn.me,size:h.MEDIUM,quality:h.HIGH})),r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},r.createElement("div",{className:"chat-title"},r.createElement("span",{className:"emojitext ellipsify",dir:"auto"},r.createElement(f,{text:Store.Conn.pushname,direction:"auto"})))),r.createElement("div",{className:"chat-status"},r.createElement("span",{className:"emojitext ellipsify",dir:"auto"},r.createElement(f,{text:this.state.status,direction:"auto"}))))),t=this.state.notifications?r.createElement("div",null,r.createElement(l,{key:"notifications"})):null,n=this.getHelpContent(),i=this.state.help?n:null,d={notifications:c({first:!0,active:this.state.notifications}),help:c({active:this.state.help})};return r.createElement(o,{id:"settings",onCancel:this.props.onClose},r.createElement(a,{title:l10n.t("settings_flow_title"),onBack:this.props.onClose,type:a.Type.LARGE}),r.createElement(s,null,r.createElement("div",{className:"chatlist list-profile"},e),r.createElement("div",{className:"chatlist list-icons list-settings"},r.createElement(v,{iconClass:"icon-settings-notifications",className:d.notifications,title:l10n.t("menuitem_notifications"),onClick:this.onNotifications}),r.createElement(u,{transitionName:"settings",className:"list-icons-item"},t),r.createElement(v,{iconClass:"icon-settings-blocked",title:l10n.t("menuitem_blocked"),onClick:this.props.onBlocked}),r.createElement(v,{iconClass:"icon-settings-help",className:d.help,title:l10n.t("menuitem_help"),onClick:this.onHelp}),r.createElement(u,{transitionName:"settings",className:"list-icons-item"},i))))}}),v=r.createClass({displayName:"ListItemIcon",propTypes:{onClick:r.PropTypes.func,iconClass:r.PropTypes.string,className:r.PropTypes.string},render:function(){var e={icon:c("icon",this.props.iconClass),container:c("chat",this.props.className)};return r.createElement("div",{className:e.container,"data-ignore-capture":"any"},r.createElement("div",{className:"chat-cell"},r.createElement("div",{className:"chat-avatar",onClick:this.props.onClick},r.createElement("div",{className:"avatar"},r.createElement("span",{className:e.icon}))),r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main",onClick:this.props.onClick},r.createElement("div",{className:"chat-title"},r.createElement("span",{className:"emojitext ellipsify",dir:"auto"},this.props.title))))))}});e.exports=g},function(e,t,n){"use strict";var r=n(6),i=n(28),o=n(9),a=n(802),s=n(815),c=n(804),l=n(803),u=n(102),d=n(11),p=n(103),h=n(943),f=n(808),m=n(58),g=n(105),v=g.HotKeys,y=r.createClass({displayName:"StarredDrawer",mixins:[u],componentWillMount:function(){this.currSelection=new f([],function(e){return e.id.toString()}),this.activeSelection=new f([],function(e){return e.id.toString()})},componentDidMount:function(){this.focus();var e=Store.StarredMsg;e.syncState===e.SYNC_STATES.SYNCED?this.initObservers():this.addObserverOnce(e,"sync",this.initObservers),this.addObserver(d,"change:stream",function(){d.stream===d.STREAM.CONNECTED&&e.sync()})},componentWillUnmount:function(){this._firstSyncComplete&&this._firstSyncComplete.cancel()},initObservers:function(){var e=this;this.addObserverAndRun(Store.StarredMsg,"add remove sync",function(){e.initSelectionObjects(),e.setState({})}),this.onFocusGain()},initSelectionObjects:function(){var e=Store.StarredMsg.models;this.currSelection.init(e,!0),this.activeSelection.init(e)},onClose:function(){o.closeDrawer(this.props.type)},focus:function(){m.focusNode(i.findDOMNode(this.refs.body))},onFocusGain:function(e){var t=e?e.target:document.activeElement;t===i.findDOMNode(this.refs.body)&&(this.currSelection.index<0?this.currSelection.setFirst():this.currSelection.reset())},onNextMsg:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.currSelection.next();this.currSelection.index!==t&&this.currSelection.setNext()},onPrevMsg:function(e){e&&(e.stopPropagation(),e.preventDefault());var t=this.currSelection.prev();t>-1&&this.currSelection.setPrev()},selectMsg:function(e){this.currSelection.setVal(e),this.activeSelection.setVal(e),o.openChat(e.chat,e.chat.getSearchContext(e),!1),o.focusShowMsg(e.id)},render:function(){var e=this,t=Store.StarredMsg.models,n=void 0;if(t.length>0){var i=t.map(function(t){return r.createElement(h,{key:t.id,msg:t,currSelection:e.currSelection,activeSelection:e.activeSelection,onSelectMsg:e.selectMsg})});n=r.createElement(p,{transitionName:"slide"},i)}else n=Store.StarredMsg.syncState===Store.StarredMsg.SYNC_STATES.INIT?r.createElement(s.Loading,null):r.createElement(s.StarredMsgs,null);var o={down:this.onNextMsg,up:this.onPrevMsg};return r.createElement(a,{id:"starred",onCancel:this.onClose},r.createElement(v,{className:"drawer",handlers:o,onFocus:this.onFocusGain,"data-tab":2,ref:"body"},r.createElement(c,{title:l10n.t("starred_flow_title"),onBack:this.onClose,type:c.Type.LARGE}),r.createElement(l,null,r.createElement("div",null,n))))}});e.exports=y},function(e,t,n){"use strict";var r=n(6),i=n(102),o=n(9),a=n(11),s=r.createClass({displayName:"TermsOfServiceModal",mixins:[i],componentDidMount:function(){this.addObserver(Store.Conn,"change:tos",this.close)},close:function(){0===Store.Conn.tos&&o.closeModal()},logout:function(){o.closeModal(),a.logout()},render:function(){var e,t=null;switch(Store.Conn.tos){default:case 1:e=l10n.t("web_terms_of_service_1"),t=r.createElement("div",{className:"popup-controls"},r.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:o.closeModal.bind(o)},l10n.t("ok_got_it")));break;case 2:e=l10n.t("web_terms_of_service_2"),t=r.createElement("div",{className:"popup-controls"},r.createElement("button",{className:"btn-plain popup-controls-item",onClick:this.logout},l10n.t("menuitem_logout")))}return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:"popup"},r.createElement("div",{className:"popup-body"},r.createElement("div",{className:"popup-contents"},e)),t)))}});e.exports=s},function(e,t,n){"use strict";var r=n(60),i=n(156),o=r.extend({Collection:"Blocklist",children:{contact:i},props:{id:"string"},initialize:function(){this.contact=Store.Contact.gadd({id:this.id}),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact"))}});e.exports=o},function(e,t,n){"use strict";var r=n(348),i=n(984),o=r.extend({model:i,handle:function(e){var t=e.shift(),n=t.blocklist,r=_.map(n,function(e){return{id:e}});this.set(r)}});e.exports=new o},function(e,t,n){"use strict";var r=n(1),i=n(60),o=n(9),a=i.extend({Collection:"Call",props:{id:"string",type:"string",from:"string"},initialize:function(){this.listenToAndRun(this,"change:type",this.updateNotification)},updateNotification:function(){r.log("call:"+this.type+" id:"+this.id+" from:"+this.from)(),"offer"===this.type?o.alertCall(this.id,this.from):o.cancelCall(this.id)}});e.exports=a},function(e,t,n){"use strict";var r=n(348),i=n(986),o=n(162),a=r.extend({model:i,handle:function(e){var t=e.shift();switch(t.type){case"offer":case"accept":case"reject":case"terminate":o.tosShowCallNotification&&this.add(t,{merge:!0})}}});e.exports=new a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(23),o=r(i),a=n(3),s=r(a),c=n(6),l=n(7),u=n(1),d=n(348),p=n(801),h=n(35),f=n(29),m=n(108),g=n(9),v=n(21),y=n(80),E=n(82).ActionToast,b=n(82).ActionType,w=d.extend({model:p,comparator:function(e,t){return e.t?t.t?""+e.t+e.id>""+t.t+t.id?-1:1:-1:1},initialize:function(){d.prototype.initialize.call(this),this.listenTo(this,"change:t",this.sort)},active:function S(){var S=_.first(this.filter("active"));return S?S.id:void 0},_find:function(e){return s["default"].resolve({id:e,createdLocally:!0})},_findQuery:function(e){var t=this;return h.chatFindQuery(!!e.retry).then(function(e){return"preempted"===e?s["default"].reject("chats preempted"):(t.trigger(l.COLLECTION_HAS_SYNCED),s["default"].resolve(e))})},handle:function(e){var t=e.shift(),n=this;if(_.isArray(t)){var r=[],i=[];t.forEach(function(e){if("c.us"===e.id)i.push(e);else{var t=!!n.get(e.id),a=["delete","clear","archive","unarchive","star","unstar","spam","modify_tag"].indexOf(e.type)>-1;t||a?t&&a?i.push(e):u.log("Model:chat:handle received junk chat record: "+(0,o["default"])(e))():r.push(e)}}),n.add(r,{merge:!0}),i.forEach(function(e){var t=e.type;if("c.us"===e.id)switch(t){case"clear":u.log("Model:chat:handle:clear:all before: "+e.before)(),n.forEach(function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star):t.deleteMsgs(e.star)});break;case"delete":u.log("Model:chat:handle:delete:all")(),n.forEach(function(e){e["delete"]()});break;case"archive":u.log("Model:chat:handle:archive:all")(),n.forEach(function(e){e.archive=!0});break;case"unarchive":u.log("Model:chat:handle:unarchive:all")(),n.forEach(function(e){e.archive=!1});break;case"unstar":u.log("Model:chat:handle:unstar:all")(),n.forEach(function(e){e.unstarAll()});break;default:u.error("Model:chat:handle unknown "+(0,o["default"])(e),e)()}else{var r=n.get(e.id);if(!r)return;switch(t){case"clear":case"star":case"unstar":if(e.keys){for(var i=e.keys.length,a="star"===t,s=[],c=[],l=[],d=0;i>d;d++){var p,h,f,g,v,E,b,w,S=e.keys[d];_.isArray(S)?(p=S[0],h=S[1],f=S[2],g=h?Store.Conn.me:e.id,v=h?e.id:Store.Conn.me,E=h?"out":"in",b=new m(g,v,p,f,E),w=Store.Msg.get(b),w&&("clear"===t?w["delete"]():w.star=a)):_.isObject(S)&&"star"===t&&(p=S.id,g=S.from,v=S.to,f=S.participant,E=S.self,b=new m(g,v,p,f,E),w=Store.Msg.get(b),w?(w.star=!0,l.push(w)):c.push(S)),s.push(b.toString())}"star"!==t&&"unstar"!==t||(y.gte([0,9])?Store.StarredMsg.update(a,c,l):a?Store.StarredMsg.sync():Store.StarredMsg.update(!1)),u.log("model:Chat:handle:messages:"+[t,e.id,s.join(),e.modifyTag].join())()}else"clear"===t?("number"==typeof e.before?r.deleteMsgsOlderThan(e.before,e.star):r.deleteMsgs(e.star),u.log("model:Chat:handle cleared chat:"+[e.id,e.before,e.modifyTag].join())()):"unstar"===t&&(r.unstarAll(),u.log("model:Chat:handle unstarred chat: "+e.id)());isNaN(e.modifyTag)||(r.modifyTag=e.modifyTag);break;case"delete":r["delete"](),u.log("model:Chat:handle deleted chat for "+e.id)();break;case"archive":r.archive=!0;break;case"unarchive":r.archive=!1;break;case"spam":r.notSpam=e.notSpam;break;case"modify_tag":r.modifyTag=e.modifyTag}}})}else if("leave"===t.cmd)t.gids.forEach(function(e){var t=n.get(e);t&&t.exit()});else if("preempt"===t.cmd)Store.Chat.add(t.response,{merge:!0}),this.trigger(l.COLLECTION_HAS_SYNCED);else if("action"===t.cmd){var a=t.id,s=t.data;if("create"===s[0]||"introduce"===s[0]){var c=s[1],d=s[2],p=_.map(d.admins,function(e){return{id:e,isAdmin:!0}}).concat(_.map(d.regulars,function(e){return{id:e,isAdmin:!1}}));Store.GroupMetadata.add({id:a,creation:d.creation,owner:c,participants:p,stale:!1},{merge:!0}),Store.Contact.add({id:a,name:d.subject},{merge:!0});var h=Store.Chat.get(a);if(!h)return;var f=h.msgs.last();if(!f)return;"gp2"===f.type&&"add"===f.subtype&&_.first(f.recipients)===Store.Conn.me&&g.alertNewMsg(f)}else{var v=Store.Chat.get(t.id);v?v.handleGroupAction.apply(v,t.data):u.error("model:chat: unknown chat for action "+(0,o["default"])(t))()}}else u.error("model:chat: unknown payload: "+(0,o["default"])(t))()},createGroup:function(e,t,n,r,i){var o=this,a=_.pluck(r,"id"),s=h.createGroup(e,a),l=new b(l10n.t("action_group_creating"));i=i||E.genId();var d=s.then(function(e){return 200===e.status?new b(l10n.t("action_group_created")):406===e.status?new b(l10n.t("action_group_create_failed")+" "+l10n.t("action_group_create_failed_406")):void 0})["catch"](function(a){return u.error("models:chatCollection:createGroup dropped")(a),new b(l10n.t("action_group_create_failed"),l10n.t("action_try_again"),o.createGroup.bind(o,e,t,n,r,i))});return g.openToast(c.createElement(E,{id:i,initialAction:l,pendingAction:d})),s.then(function(e){if(200===e.status&&e.gid&&Store.Chat.find(e.gid).then(function(e){g.openChat(e)}),200===e.status&&!e._duplicate&&t&&n){var r=Store.ProfilePicThumb.gadd(e.gid);return r.setPicture(t,n)}200===e.status&&e._duplicate&&u.error("createGroup failed to set picture.")()})},sync:function(){return this.findQuery({})["catch"](v.WapDrop,_.noop),s["default"].all([f.waitForBBEvent(this,l.COLLECTION_HAS_SYNCED),Store.Msg._hasSynced()])},resyncMessages:function(){u.log("ChatStore:resyncMessages")();var e=Store.Chat.filter(function(e){return!e.isNewlyCreated()}),t=e.map(function(e){var t=e.id,n={wid:t,archive:e.archive,mute:e.mute.expiration,active:e.active,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,unreadCount:e.unreadCount,notSpam:e.notSpam},r=Store.Msg.lastReceivedKey[t];if(r){var i=r;n.id=i.id,n.fromMe=i.fromMe.toString(),n.participant=i.participant}return n});return h.resyncMessages(t).then(function(e){return e.status>=400?(u.error("ChatStore:resyncMessages resume error "+e.status)(),s["default"].reject(new Error("ChatStore:resyncMessages resume error "+e.status))):(u.log("ChatStore:resyncMessages resume success")(),e.checksum&&Store.Contact.resyncContacts(e.checksum),e.data.forEach(function(e){if("delete"!==e.type){var t=Store.Contact.get(e.id);t?e.name&&(t.name=e.name):Store.Contact.add({id:e.id,name:e.name})}var n=Store.Chat.get(e.id);if(!n)return void Store.Chat.add(e);if("clear"===e.type){var r=[];n.msgs.forEach(function(e){r.push(e)}),_.each(r,function(e){e["delete"]()}),n.set({t:e.t,unreadCount:e.unreadCount,createdLocally:!1,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,msgs:[],notSpam:e.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:!1}),n.mute.setMute(e.muteExpiration),u.log("model:chat:resume: cleared chat for "+e.id)()}else"delete"===e.type?(n["delete"](),u.log("model:chat:resume: deleted chat for "+e.id)()):(n.set(e,{merge:!0}),n.mute.setMute(e.muteExpiration))}),s["default"].resolve())})["catch"](v.WapDrop,function(e){return u.error("ChatStore:resyncMessages resume dropped")(),s["default"].reject(e)})}});e.exports=new w},function(e,t,n){"use strict";var r=n(7),i=n(1),o=n(10),a=n(21),s={handle:function(e){var t=e.shift();switch(t.type){case"const":r[t.key]=t.value;break;case"read":case"unread":var n=Store.Chat.get(t.jid);n&&("read"===t.type?n.markSeen():"unread"===t.type&&n.markUnseen());break;case"picture":Store.ProfilePicThumb.imageChanged(t.jid,t.tag);break;case"log":o.upload("server-requested");break;case"privacy":t.jid?(Store.Presence.update(t.jid)["catch"](a.WapDrop,_.noop),Store.ProfilePicThumb.update(t.jid)["catch"](a.WapDrop,_.noop),Store.Status.update(t.jid)["catch"](a.WapDrop,_.noop)):i.error("Store:Cmd:handle:privacy no jid",t)();break;case"identity":break;default:i.warn("Store.Cmd:handle:unknown "+t.type,t)()}}};e.exports=s},function(e,t,n){"use strict";var r=n(60),i=r.extend({idAttribute:"char",props:{"char":"string",variant:"string"}});e.exports=i},function(e,t,n){"use strict";var r=n(348),i=n(990),o=n(353),a=r.extend({model:i,initialize:function(){r.prototype.initialize.call(this,{CachePolicy:{id:"emoji_variant_collection",policy:r.CACHE_POLICY.LOAD,delay:1e3}})},setVariant:function(e,t){var n=o.skinToneEmojis[e];if(!n)throw new Error("attempt to store variantless emoji");this.gadd({"char":n,variant:t})},getVariant:function(e){if(o.skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}throw new Error("attempt to get variantless emoji")}});e.exports=new a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(1),s=n(348),c=n(847),l=n(35),u=n(21),d=n(22),p=s.extend({model:c,initialize:function(){s.prototype.initialize.call(this,{staleCollection:!0})},onResume:function(){_.union(Store.Chat.where({active:!0}).filter(function(e){return e.isGroup||e.isBroadcast}),Store.Chat.where({isBroadcast:!0})).forEach(function(e){Store.GroupMetadata.find(e.id)["catch"](u.WapDrop,_.noop)})},_find:function(e){var t=this;if(d.isGroup(e)){var n=Store.Chat.get(e);return n&&n.isReadOnly?l.groupMetadataFindFromPhone(e).then(function(t){return"ok"===t.status?t.data:"missing"===t.status?void _.defer(function(){Store.Chat.get(e)["delete"]()}):"error"===t.status?(a.error("model:GroupMetadata:find error "+t.info)(),o["default"].reject(new Error("model:GroupMetadata:find error"))):void 0}):l.groupMetadataFind(e).then(function(n){if(n.status>=400)return{id:e,stale:!1};var r=[],i=t.get(e);return i?i.participants.set(n.participants):r=n.participants,t.updateSubject(e,n.subject),{id:n.id,owner:n.owner,creation:n.creation,participants:r,stale:!1}})}return d.isBroadcast(e)?l.contactFindBroadcast(e).then(function(t){if(200===t.status){var n=Store.GroupMetadata.get(e);if(n&&!n.stale)return o["default"].resolve(n);var r=[];return n?n.participants.set(t.recipients):r=t.recipients,o["default"].resolve({id:e,stale:!1,participants:r})}return 404===t.status?o["default"].reject("False broadcast list query."):(a.error("models:GroupMetadataCollection:_find:bclist error: "+t.status)(),o["default"].reject(new Error("models:GroupMetadataCollection:_find:bclist error: "+t.status)))}):(a.log("groupMetadata:find trying to fetch non-group/bclist wid "+e)(),o["default"].reject(new Error("groupMetadata:find trying to fetch non-group/bclist wid "+e)))},_handle:function(e){return e},updateSubject:function(e,t){_.isString(t)&&Store.Contact.find(e).then(function(e){e.name||(e.name=t)})}});e.exports=new p},function(e,t,n){"use strict";e.exports={Blocklist:n(985),Call:n(987),Chat:n(988),Cmd:n(989),GroupMetadata:n(992),Msg:n(994),MsgInfo:n(996),StarredMsg:n(1003),Mute:n(997),Presence:n(998),ProfilePicThumb:n(999),
Props:n(1e3),RecentEmoji:n(1002),EmojiVariant:n(991),Status:n(1004)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e.notifyName){var t=Store.Contact.get(e.sender);t&&(!t.notifyName||t.notifyName.t<e.t)&&(t.notifyName={name:e.notifyName,t:e.t})}}function o(e,t,n,r){var o=[],a=[];if(t.forEach(function(t,s){t.id=new M(t.from,t.to,t.id,t.participant,t.self),_.isString(e)&&b.isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<0&&(t.ack=0);var c=Store.Msg.get(t.id);if(c){t.ack<c.ack&&delete t.ack;for(var l in t)t.hasOwnProperty(l)&&"undefined"==typeof t[l]&&delete t[l];t.id.fromMe&&!c.clientUrl&&t.clientUrl&&(c.promises.mediaPromise?c.promises.mediaPromise.control.phoneResolved(!0):t.mediaState=S.MEDIA_STATE.INIT),c.set(t),n.isHistory&&(c.recvFresh||r)&&!c.search?(v.warn("model:Msg:handle:processMM:"+(c.recvFresh?"dup:":"overlap:")+c.id)(),a.push(c)):n.isHistory&&c.search?(c.search=!1,v.warn("model:Msg:handle:processMM load search as history "+c.id)(),o.push(c.toJSON())):"search"!==n.add&&"resync"!==n.add||o.push(c.toJSON()),i(c)}else S.typeIsMMS(t.type)&&!t.clientUrl&&(t.id.fromMe&&0===t.ack?t.mediaState=S.MEDIA_STATE.REMOTE_UPLOADING:t.mediaState=S.MEDIA_STATE.REMOTE_NEED_UPLOAD),"search"===n.add&&(t.search=!0),n.update||o.push(t)}),0===o.length&&0===a.length)return m["default"].resolve(t.map(function(e){return Store.Msg.get(e.id)}));var s=d(o).then(function(e){var t=Store.Msg.add(e,{merge:!0});return _.each(t,function(e){i(e)}),t});return e?m["default"].all([s,Store.Chat.find(e)]).spread(function(i,o){var s,l,d="after"===n.add||"last"===n.add,p=!n.isHistory,h=!1;if("unread"===n.add?(s=r,o.msgChunks.push(s),l=n.firstUnreadKey):"last"===n.add&&n.resume?(s=r,h=!0):s="function"==typeof r?r():r,c(t,i,a,o,d,s||o.msgs,l,h),n.pendingMsgsDone&&(o.pendingMsgs=!1),p&&b.isBroadcast(e)&&i.forEach(function(t){if("broadcast_notification"===t.type){var n=Store.GroupMetadata.get(e);"add"===t.subtype?n.participants.add({id:t.body},{merge:!0}):"remove"===t.subtype&&n.participants.remove(t.body),o.groupMetadata.stale=!1}else t.recvFresh&&!t.isNotification&&u(t)}),w.supportsFeature(w.F.RECENT_EMOJI_SYNC)&&!Store.RecentEmoji.syncDue)for(var f=0;f<i.length;f++){var m=i[f];if(m.isNewMsg&&m.isSentByMe&&m.containsEmoji){Store.RecentEmoji.periodicSync();break}}return t.map(function(e){return Store.Msg.get(e.id)})}):s.then(function(e){return t.map(function(e){return Store.Msg.get(e.id)})})}function a(e,t,n,r,i,o){var a=r||t.msgs;if(e=_.isArray(e)?e:[e],0!==e.length){n?a.add(e):a.add(e,{at:0});var s=a===t.msgs;if(o)if(s)v.error("models:msg:store:resetMostRecentMsgs .msgs === cmc !")();else{var c=new x;c.replace(t.msgs),t.msgChunks.push(c),t.replaceMsgsCollection(a)}if(s=a===t.msgs,n&&s){var l=_.last(e).id,u=l.remote;Store.Msg.lastReceivedKey[u]=l}if(n&&s||!Store.Msg.lastReceivedReceipt[t.id])for(var d=e.length,p=d-1;p>=0;p--){var h=e[p],f=h.id;if(f.fromMe&&!h.isNotification){Store.Msg.updateLastReceipt(f.remote,h.t);break}}i&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=_.find(e,function(e){return e.id.toString()===i.toString()}))}}function s(e,t,n,r,i){var o,a,s,c={},l={},u=n.length,d=i;if(0===u)return{msgs:t,collection:d};for(o=0;u>o;o++)a=n[o],l[a.id]=a;for(u=t.length,o=0;u>o;o++)a=t[o],c[a.id]=a;var p=[];for(u=e.length,o=0;u>o;o++)if(a=e[o],s=c[a.id],s&&p.push(s),s=l[a.id])if(s.recvFresh)p.push(s),r.removeMsg(s),s.unset("recvFresh");else{var h=r.getAllCMCs(),f=_.find(h,function(e){return e.get(a.id)});i&&f===i||(f?(f.forEach(function(e){p.push(e),delete l[e.id]}),f===r.msgs?(r.replaceMsgsCollection(i),d=r.msgs):(r.notifyMsgCollectionMerge(i,f,i),r.removeMsgsCollection(f))):(v.error("models:Msg:reorder trying to merge CMC of orphaned message "+a.id,a)(),p.push(l[a.id])))}return{msgs:p,collection:d}}function c(e,t,n,r,i,o,c,l){var u=s(e,t,n,r,o);a(u.msgs,r,i,u.collection,c,l)}function l(e){return _.isObject(e)?JSON.parse((0,h["default"])(e)):e}function u(e){function t(t){var n=new M(e.from,t,r.id);if(!Store.Msg.some(_.matches({id:n}))){var i=l(e);i.to=t,i.id=n,i.broadcast=!0;var o=Store.Msg.add(i,{merge:!0});Store.Chat.find(t).then(function(e){a(o,e,!0)})}}var n,r=e.id;if(!e.invis)if(e.recipients&&0!==e.recipients.length)n=e.recipients,e.recipients.forEach(t);else{var i=Store.GroupMetadata.get(r.remote);i?(n=l(i.participants),_.pluck(n,"id").forEach(t)):v.log("model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: "+r.remote)()}return n}function d(e){return m["default"].all(e.map(function(e){return["image","video"].indexOf(e.type)>-1&&!parseInt(e.width||0,10)&&e.body?new m["default"](function(t,n){var r=new Image;r.onload=function(){e.width=r.width,e.height=r.height,t(e)},r.src="data:image/jpeg;base64,"+e.body}):m["default"].resolve(e)}))}var p=n(23),h=r(p),f=n(3),m=r(f),g=n(7),v=n(1),y=n(348),E=n(21),b=n(22),w=n(80),S=n(798),T=n(29),C=n(61),M=n(108),N=n(11),k=n(35),x=n(824),P=y.extend({model:S,initialize:function(){y.prototype.initialize.call(this),this.lastReceivedKey={},this.lastReceivedReceipt={},this.preAck={},this.pendingAdd={},this.listenTo(N,"change:stream",function(){N.stream===N.STREAM.DISCONNECTED&&(this.preAck={})})},_findQuery:function(e){var t,n=this;switch(e.direction){case"before":case"after":t=e.direction;break;default:t="before"}return k.msgFindQuery(t,e).then(function(r){if(r.status>=400)return v.error("model:Msg:findQuery error "+r.status)(),m["default"].reject(r.status);var i=function(){var t=n.get(e),r=Store.Chat.get(e.remote);return t?t.msgChunk:r?r.msgs:void 0};return r.forEach(function(e){e.invis=!0}),v.log("model:Msg:findQuery:got:"+r.length+":"+e.direction)(),n.processMultipleMessages(e.remote,r,{add:t,isHistory:!0},i)})},resyncChatMsgs:function(e,t){var n=this,r="number"!=typeof t||isNaN(t)?g.PAGE_SIZE:t;return k.msgFindQuery("before",{remote:e,count:r}).then(function(e){return e.status>=400?(v.error("model:Msg:resyncChatMsgs error "+e.status)(),m["default"].reject(e.status)):n.processMultipleMessages(void 0,e,{add:"resync"})})},getStarred:function(e,t,n){var r=this,i={count:"number"!=typeof t||isNaN(t)?g.PAGE_SIZE:t,chat:e&&_.isString(e)?e:void 0,remote:n&&n.remote,id:n&&n.id,fromMe:n&&n.fromMe,participant:n&&n.participant};return k.msgFindQuery("star",i).then(function(e){return e.status>=400?(v.error("model:Msg:getStarred error "+e.status)(),m["default"].reject(e.status)):r.processMultipleMessages(void 0,e,{add:"search"})})},incrementalStarredUpdate:function(e){return this.processMultipleMessages(void 0,e,{add:"search"})},search:function(e,t,n){var r=this,i={searchTerm:e,page:t&&_.isNumber(t)?t:1,count:n&&_.isNumber(n)?n:g.PAGE_SIZE};return k.msgFindQuery("search",i).then(function(e){if(e.status>=400)return v.error("model:Msg:search error "+e.status)(),m["default"].reject(e.status);var t=_.isArray(e)?e:e.messages,n=_.isArray(e)?!0:e.eof;return m["default"].props({messages:r.processMultipleMessages(void 0,t,{add:"search"}),eof:n})})},queryMedia:function(e,t,n,r){var i=this,o={remote:e,count:t&&_.isNumber(t)?t:g.PAGE_SIZE,id:r&&r.id,fromMe:r&&r.fromMe,participant:r&&r.participant,direction:n};return k.msgFindQuery("media",o).then(function(e){return e.status>=400?(v.error("model:Msg:media error "+e.status)(),m["default"].reject(e.status)):i.processMultipleMessages(void 0,e,{add:"search"})})},getContext:function(e,t){var n=this;return m["default"].all([k.msgFindQuery("before",e),k.msgFindQuery("after",e)]).spread(function(r,i){return _.isArray(r)&&_.isArray(i)?m["default"].all([n.processMultipleMessages(e.remote,r,{add:"before",isHistory:!0},t),n.processMultipleMessages(e.remote,i,{add:"after",isHistory:!0},t)]):(v.error("model:msg:getContext fetch error",r,i)(),m["default"].reject(r.status||i.status))})},handle:function(e){function t(e,t){var n=new M(a.from,e,t,void 0,"out"),r=o.get(n);if(r){r.updateAck(a.ack),o.updateLastReceipt(n.remote,a.t);var i=n.remote;b.isUser(i)&&(Store.MsgInfo.update(t,a.from,e,a.ack,i,a.t),b.isBroadcast(a.broadcast)&&Store.MsgInfo.update(t,a.from,a.broadcast,a.ack,i,a.t))}else v.log("Msg:out of order ack",a)(),o.preAck[n]=a}var n,r,i,o=this,a=e.shift();if("ack"===a.cmd){var s=[a.to];if(b.isBroadcast(a.to)&&1===a.ack){var c=Store.GroupMetadata.get(a.to);c&&Array.prototype.push.apply(s,_.pluck(c.participants.toArray(),"id"))}return s.forEach(function(e){t(e,a.id)}),!0}if("acks"===a.cmd)return a.id.forEach(function(e){t(a.to,e)}),!0;if(a.msg)return a.msg.recvFresh=!0,a.msg.isNewMsg=!0,this.processMultipleMessages(a.chat,[a.msg],{add:"after",update:"update"===a.meta.add,isHistory:!1}),!0;if(a.msgs){var l=a.msgs.length;if(!l)return!1;if(r=a.meta,r.isHistory=!0,"unread"===r.add){var u=r.unreadFromMe?Store.Conn.me:a.chat,d=r.unreadFromMe?a.chat:Store.Conn.me;r.firstUnreadKey=new M(u,d,r.unreadId,r.unreadParticipant,"in"),i=new x}for(var p=0;l>p;p++)n=a.msgs[p],n.invis=!0;return this.processMultipleMessages(a.chat,a.msgs,r,i),!0}if(a.recent){r=a.meta,delete a.recent,delete a.meta,this.trigger(g.COLLECTION_HAS_SYNCED),r.isHistory=!0;for(var h in a)"last"===r.add&&r.resume&&(i=new x),n=a[h],n.invis=!0,this.processMultipleMessages(h,[n],r,i)}else v.log("************** Msg else clause. something strange is going on")()},_hasSynced:function(){return T.waitForBBEvent(this,g.COLLECTION_HAS_SYNCED)},"delete":function(){y.prototype["delete"].call(this),this.lastReceivedKey={},this.lastReceivedReceipt={},this.preAck={}},send:function(e){return new m["default"](function(t,n){var r=e.id,i=r,o=e.toJSON();if(w.supportsFeature(w.F.SPAM)&&Store.Chat.find(e.id.remote).then(function(e){e.isTrusted()||e.sendNotSpam()["catch"](_.noop)}),e.isNewMsg=!0,!e.isGroupMsg&&Store.Blocklist.get(e.to))return void n(new E.ContactBlocked("Contact is blocked"));if(b.isBroadcast(o.to))var a=u(o);delete o.status,delete o.mimetype,delete o.height,delete o.width,delete o.recipients,delete o.chat,delete o.broadcast,delete o.ack,delete o.invis,delete o.filehash,delete o.recvFresh,C.isHttp(e.url)||delete o.url,C.isHttp(e.clientUrl)||delete o.clientUrl;for(var s in o)null!==o[s]&&"undefined"!=typeof o[s]||delete o[s];o.id=i.id,e.isMMS&&(o.avparams=e.avParams()),"chat"!==o.type||"url"!==o.subtype||w.supportsFeature(w.F.URL)||delete o.subtype,Store.Chat.find(e.id.remote).then(function(t){return t.sendSeen(),k.msgCreateRecord(o,e.local)}).then(function(n){if(200===n.status){var o=i.remote,s=i.fromMe&&i.remote===Store.Conn.me?3:n.data?n.data.ack:1;e.updateAck(s),Store.Msg.lastReceivedKey[o]=r,Store.Msg.updateLastReceipt(o,n.t),b.isBroadcast(o)&&(a?a.forEach(function(e){var t=new M(Store.Conn.me,e.id,i.id),n=Store.Msg.get(t);n&&(n.ack=1,Store.Msg.lastReceivedKey[e]=t,Store.Msg.updateLastReceipt(e,n.t))}):v.log("model:msg:createRecord bclist server ack, no recipients")()),t("success")}})["catch"](function(e){throw t("dropped"),v.error("model:msg:createRecord dropped msg: "+o.id)(o.type),e})})},resyncReceipts:function(){v.log("Msg:resyncReceipts")();var e=[];for(var t in Store.Msg.lastReceivedReceipt){var n,r=Store.Chat.get(t);if(n=r?w.gte([0,5])?r.getFirstMsgWithStatus():r.getFirstMsgFromMe():void 0){var i=n.id;i.t=Store.Msg.lastReceivedReceipt[t],e.push(i)}else v.error("Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: "+t)()}return 0===e.length?m["default"].resolve():k.resyncReceipts(e).then(function(e){_.isArray(e)?(v.log("Msg:resyncReceipts success")(),e.forEach(function(e){Store.Msg.updateLastReceipt(e.id,e.t),e.acks.forEach(function(t){if(4===t.length){var n=t[1],r=n?Store.Conn.me:e.id,i=n?e.id:Store.Conn.me,o=new M(r,i,t[0],t[2]),a=Store.Msg.get(o);a&&a.updateAck(t[3])}else v.error("Msg:resyncReceipts invalid response: "+(0,h["default"])(t))()})})):v.error("Msg:resyncReceipts error",e)()})["catch"](E.LogoutDrop,E.EphemeralDrop,E.BrowserReplacedDrop,_.noop)["catch"](function(){throw v.error("Msg:resyncReceipts dropped")(),new Error("Msg:resyncReceipts dropped")})},updateLastReceipt:function(e,t){var n=this.lastReceivedReceipt[e];(!n||t>n)&&(this.lastReceivedReceipt[e]=t)},processMultipleMessages:function(e,t,n,r){var i=this,a=arguments;if(e){var s,c=this.pendingAdd[e];return s=c?c.then(function(){return o.apply(i,a)}):o.apply(i,a),s["finally"](function(){i.pendingAdd[e]===s&&(i.pendingAdd[e]=null)}),this.pendingAdd[e]=s}return o.apply(i,a)}});e.exports=new P},function(e,t,n){"use strict";var r=n(60),i=n(889),o=n(156),a=n(355),s=n(358),c=r.extend({props:{id:"id",t:"number"},children:{contact:o},initialize:function(){this.contact=Store.Contact.gadd({id:this.id}),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact"))},getCollection:function(){return this.collection}}),l=a.extend(s,{model:c,comparator:function(e,t){return o.Comparator(e.contact,t.contact)},isStateStale:function(e){var t=this.get(e);return t&&t.stale}}),u=r.extend(i,{Collection:"MsgInfo",props:{id:"msgKey",isPTT:"boolean",playedRemaining:{type:"number","default":0},readRemaining:{type:"number","default":0},deliveryRemaining:{type:"number","default":0}},collections:{played:l,read:l,delivery:l},derived:{settled:{deps:["isPTT","playedRemaining","readRemaining"],fn:function(){return this.isPTT?!this.playedRemaining:!this.readRemaining}}}});e.exports=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(1),s=n(22),c=n(108),l=n(348),u=n(798),d=n(995),p=n(11),h=n(35),f=l.extend({model:d,initialize:function(){l.prototype.initialize.call(this,{staleCollection:!0})},_initializeStaleCollection:function(){var e=this;this.listenTo(p,"change:stream",function(){p.stream===p.STREAM.DISCONNECTED&&e.forEach(function(e){e.settled||e.set("stale",!0)})})},_find:function(e){return e.isSentByMe?h.queryMsgInfo(e.id).then(function(t){return t.status>=400?(a.log("model:MsgInfo:findQuery error "+t.status)(),o["default"].reject(t.status)):(t.id=e.id,t.isPTT=e.type===u.TYPE.PTT,o["default"].resolve(t))}):o["default"].reject("message not sent by me")},update:function(e,t,n,r,i,o){var l=new c(t,n,e,i),u=new c(t,n,e),d=this.get(l)?this.get(l):this.get(u),p=s.isUser(u.remote),h=void 0,f=void 0;if(d)switch(r){case 4:if(h=d.played.get(i),h||(d.played.add({id:i,t:o}),d.playedRemaining-=1),p)break;case 3:if(f=d.read.filter(function(e){return e.id===i}),d.read.remove(f),3===r&&(d.read.add({id:i,t:o}),0===f.length&&(d.readRemaining-=1)),p)break;case 2:f=d.delivery.filter(function(e){return e.id===i}),d.delivery.remove(f),2===r&&(d.delivery.add({id:i,t:o}),0===f.length&&(d.deliveryRemaining-=1));break;default:a.error("model:MsgInfo:handle ack err: "+r,arguments)()}},handle:function(e){var t=this,n=e.shift();switch(n.cmd){case"ack":this.update(n.id,n.from,n.to,n.ack,n.participant,n.t);break;case"acks":n.id.forEach(function(e){t.update(e,n.from,n.to,n.ack,n.participant,n.t)})}}});e.exports=new f},function(e,t,n){"use strict";var r=n(1),i=n(348),o=n(890),a=n(14),s="global_mute",c=!0,l=!0,u=!0,d=i.extend({model:o,initialize:function(){i.prototype.initialize.call(this,{CachePolicy:{id:"mute",policy:i.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){var e=a.getGlobalSounds();this.setGlobalSounds(e);var t=a.getGlobalNotifications();this.setGlobalNotifications(t);var n=a.getGlobalPreviews();this.setGlobalPreviews(n)},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id;r.log("models:mute:cache-save: "+e)(),a.setCollection(e,[this.globalMute().toJSON()])}},globalMute:function(){var e=this.get(s);return e?e:this.add({id:s})},getGlobalSounds:function(){return c},setGlobalSounds:function(e){c=e,a.setGlobalSounds(e)},getGlobalNotifications:function(){return l},setGlobalNotifications:function(e){l=e,a.setGlobalNotifications(e)},getGlobalPreviews:function(){return u},setGlobalPreviews:function(e){u=e,a.setGlobalPreviews(e)},handle:function(e){for(var t=0;t<e.length;t++){var n=e[t],r=Store.Chat.get(n.id);r&&"mute"===n.type&&r.mute.setMute(n.muteExpiration)}}});e.exports=new d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(1),s=n(348),c=n(834),l=n(35),u=n(48),d=n(21),p=s.extend({model:c,initialize:function(){s.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(u,"change:phoneActive",this.onPresenceSubscribabilityChange)},_find:function(e){var t=this.gadd(e);return t.isUser?(t.isSubscribed=!0,l.presenceSubscribe(e)["catch"](function(e){return t.isSubscribed=!1,o["default"].reject(e)})["catch"](d.WapDrop,_.noop),l.lastseenFind(e).then(function(n){return 423===n.status?{id:e,stale:!0,hasData:!1}:401===n.status?(t.handle({id:e,deny:!0}),{id:e}):(n.id=e,t.handle(n),{id:e})})):o["default"].resolve({id:e})},handle:function(e){var t=e.shift();if(t.id===Store.Conn.me)"unavailable"===t.type?this.forEach(function(e){"unavailable"===e.type||e.stale||this.add({id:e.id,type:"unavailable",t:t.t,stale:!1},{merge:!0})}.bind(this)):a.log('models:presence:handle for self is not "unavailable" !')();else{var n=this.get(t.id);n&&("unsubscribe"===t.type?n.set({isSubscribed:!1,stale:!0}):(n.handle(t),n.stale=!1))}},onPresenceSubscribabilityChange:function(){u.phoneActive?Store.Chat.forEach(function(e){e.active&&e.presence.isUser&&e.presence.update()["catch"](d.WapDrop,_.noop)}):this.forEach(function(e){e.reset(),e.set({stale:!0,isSubscribed:!1})})}});e.exports=new p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(1),s=n(348),c=n(364),l=n(14),u=n(35),d=n(21),p=n(22),h=n(360),f=n(48),m=n(11),g=s.extend({model:c,initialize:function(){s.prototype.initialize.call(this,{staleCollection:!0,CachePolicy:{id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:s.CACHE_POLICY.LOAD,delay:5e3}}),this.listenTo(f,"change:phoneActive",function(){f.phoneActive&&this.onPhoneActive()})},get:function(e){var t=s.prototype.get.call(this,e);if(!_.isString(e))return t;var n=s.prototype.get.call(this,h(e));if(n){if(this.remove(n,{silent:!0}),t)return t;var r=n.toJSON();return r.id=e,this.add(r,{silent:!0})}return t?t:void 0},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id,t=this.models.filter(function(e){return p.isWid(e.id)});t=t.map(function(e){return e=e.toJSON(),e.id=h(e.id),e}),a.log("models:profilePic:cache-save: "+e)(),l.setCollection(e,t)}},onPhoneActive:function(){if(m.stream===m.STREAM.CONNECTED){var e=[];this.forEach(function(t){t._uiObservers&&t.stale&&(t.tag||t.unset("tag",{silent:!0}),e.push(t))}),this.resyncPictures(e)}},onResume:function(){var e=this.filter(_.property("_uiObservers")).map(function(e){return e.tag||e.unset("tag",{silent:!0}),e});this.resyncPictures(e)},_find:function(e){var t=Store.Chat.get(e);return t&&t.isReadOnly?u.profilePicFindThumbFromPhone(e,this.get(e)):u.profilePicFind(e).then(function(t){return 401===t.status?{id:e,raw:void 0,tag:""}:423===t.status?{id:e,stale:!0}:t.status>=400?{id:e,tag:null}:"undefined"==typeof t.status?{id:e,tag:t.tag,raw:null,eurl:t.eurl}:void 0})["catch"](d.WapDrop,function(){return{id:e,stale:!0}})},imageChanged:function(e,t){var n=Store.ProfilePicThumb.get(e);n&&("remove"===t?n.unset("tag"):n.tag!==t&&n.update()["catch"](d.WapDrop,_.noop))},resyncPictures:function(e){return 0===e.length?o["default"].resolve():u.resyncPictures(e.map(function(e){return{id:e.id,tag:e.tag}})).then(function(e){if(423===e.status)a.warn("ProfilePicThumbStore:resyncPictures blocked")();else{if(e.status>=400)throw a.error("ProfilePicThumbStore:resyncPictures error")(),new Error("ProfilePicThumbStore:resyncPictures error");if(!_.isArray(e))throw a.error("ProfilePicThumbStore:resyncPictures unknown reply",e)(),new Error("ProfilePicThumbStore:resyncPictures unknown reply");a.log("ProfilePicThumbStore:resyncPictures success")(),e.forEach(function(e){var t=Store.ProfilePicThumb.get(e.id);t&&t.set({tag:e.tag,raw:void 0,stale:!1})})}})["catch"](d.WapDrop,_.noop)["catch"](function(e){throw a.error("ProfilePicThumbStore:resyncPictures dropped: "+e)(),new Error("ProfilePicThumbStore:resyncPictures dropped: "+e)})}});e.exports=new g},function(e,t,n){"use strict";function r(e){return"number"==typeof e&&e>0?e-1:s.MAX_GROUP_SIZE}function i(e){return"number"==typeof e&&e>0?1024*e*1024:s.MAX_MEDIA_UPLOAD_SIZE}function o(e){return"number"==typeof e&&e>0?1024*e:s.IMG_MAX_BYTES}function a(e){var t;c.Global.webcBucket=e.bucket||null;for(t in d)if("undefined"!=typeof e[t]){var n,r,i=d[t];_.isArray(i)?(n=i[0],r=i[1](e[t])):(n=i,r=e[t]),n&&(s[n]=r)}for(t in u.F)"undefined"!=typeof e[t]&&u.setFeature(t,!!e[t])}var s=n(7),c=n(38),l=n(35),u=n(80),d={bucket:null,imageMaxEdge:"IMG_MAX_EDGE",imageMaxKBytes:["IMG_MAX_BYTES",o],maxParticipants:["MAX_GROUP_SIZE",r],maxSubject:"MAX_SUBJECT_LENGTH",media:["MAX_MEDIA_UPLOAD_SIZE",i]},p={handle:function(e){var t=e.shift();"number"==typeof t.status&&t.status>=400||a(t)},fetch:function(){return l.queryServerProps().then(function(e){"number"==typeof e.status&&e.status>=400||a(e)})}};e.exports=p},function(e,t,n){"use strict";var r=n(60),i=r.extend({idAttribute:"char",props:{"char":"string",weight:"number"}});e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(7),s=n(1),c=n(348),l=n(1001),u=n(35),d=n(21),p=n(353),h=n(80),f=c.extend({model:l,comparator:function(e,t){return e.weight>t.weight?-1:1},initialize:function(){c.prototype.initialize.call(this,{CachePolicy:{id:"recent_emoji_collection",policy:c.CACHE_POLICY.LOAD,delay:2e3}}),this.listenTo(this,"change:weight change:length",this.sortTrimScale),this.dirty=!1,this.syncDue=!1},"delete":function(){c.prototype["delete"].call(this),this.dirty=!1,this.syncDue=!1},_findQuery:function(e){return h.supportsFeature(h.F.RECENT_EMOJI_SYNC)?u.recentEmojiQuery(e?this.toArray():void 0).then(function(e){return _.isArray(e)?(e.forEach(function(e){e["char"]=p.normalizeEmoji(e["char"])}),o["default"].resolve(e)):(s.error("models:recentEmoji:findQuery error",e)(),o["default"].reject("recent emoji fetch error"))}):o["default"].reject("gk recent emoji sync unsupported")},sync:function(){var e=this;return this.findQuery(this.dirty)["finally"](function(){e.dirty=!1})["catch"](d.WapDrop,_.noop)},_sync:_.throttle(function(e,t){e.sync()["finally"](t)},a.EMOJI_SYNC_DELAY,{leading:!1}),periodicSync:function(){h.supportsFeature(h.F.RECENT_EMOJI_SYNC)&&(s.log("models:recentEmoji:periodicSync due:"+this.syncDue+" dirty: "+this.dirty)(),this.syncDue=!0,this._sync(this,function(){this.syncDue=!1}.bind(this)))},sortTrimScale:function(){var e=this.length;e&&(this.sort(),e>30&&this.remove(this.models.slice(30)),_.first(this.models).weight<10&&_.last(this.models).weight>.01||this.forEach(function(t,n){t.weight=1+3*((e-n)/e)}))},increment:function(e){this.forEach(function(t){t["char"]===e?t.weight+=1:t.weight*=.9,t.weight=Math.round(1e3*t.weight)/1e3}),this.get(e)||this.add({"char":e,weight:1}),this.dirty=!0,this.periodicSync()}});e.exports=new f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(348),s=n(798),c=n(11),l=n(80),u=n(1),d=a.extend({model:s,initialize:function(){var e=this;a.prototype.initialize.call(this);var t={NONE:"none",INIT:"init",SYNCING:"syncing",SYNCED:"synced",ERROR:"error"};this.SYNC_STATES=t,this.syncState=this.SYNC_STATES.NONE,this.listenTo(c,"change:stream",function(){c.stream===c.STREAM.DISCONNECTED&&(e.syncState=e.SYNC_STATES.NONE)})},comparator:function(e,t){return t.t-e.t},sync:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];if(this.syncState!==this.SYNC_STATES.SYNCING&&(this.syncState!==this.SYNC_STATES.SYNCED||e)&&l.supportsFeature(l.F.FULL_TEXT_SEARCH)){var t=this;t.syncState===this.SYNC_STATES.NONE?t.syncState=this.SYNC_STATES.INIT:t.syncState=this.SYNC_STATES.SYNCING,t.trigger("sync"),Store.Msg.getStarred().then(function(e){t.set(e),t.syncState=t.SYNC_STATES.SYNCED,t.trigger("sync")})["catch"](function(e){u.error("starred msg sync error: ",e)(),t.syncState=t.SYNC_STATES.ERROR})}},update:function(e,t,n){var r=this;if(this.syncState===this.SYNC_STATES.SYNCED)if(e){var i=t.length>0?Store.Msg.incrementalStarredUpdate(t):o["default"].resolve([]);i.then(function(e){r.add(e.concat(n))})["catch"](function(e){u.error("models:starred:update:error: ",e)()})}else this.filter(function(e){return!e.star}).forEach(function(e){r.remove(e)})},"delete":function(){a.prototype["delete"].call(this),this.syncState=this.SYNC_STATES.NONE}});e.exports=new d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(1),c=n(348),l=n(359),u=n(35),d=n(21),p=n(48),h=n(11),f=n(9),m=n(80),g=n(82).ActionToast,v=n(82).ActionType,y=c.extend({model:l,initialize:function(){c.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(p,"change:phoneActive",function(){p.phoneActive&&this.onPhoneActive()})},onPhoneActive:function(){h.stream===h.STREAM.CONNECTED&&this.onResume()},onResume:function(){this.filter(_.property("_uiObservers")).forEach(function(e){Store.Status.find(e.id)["catch"](d.WapDrop,_.noop)})},_find:function(e){return u.statusFind(e).then(function(t){return _.isNumber(t.status)?423===t.status?{id:e,stale:!0,status:""}:t.status>=400?{id:e,status:""}:void 0:{id:e,status:t.status}})["catch"](d.WapDrop,function(){return{id:e,stale:!0,status:""}})},_handle:function(e){return e},canSetMyStatus:function(){return m.supportsFeature(m.F.SET_STATUS)},setMyStatus:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=arguments[1];if(t=t.trim(),!t)return o["default"].reject(new d.ActionError);if(!this.canSetMyStatus())return o["default"].reject(new d.ActionError);var r=u.sendSetStatus(t),i=new v(l10n.t("action_status_setting")),c=this.get(Store.Conn.me).status;n=n||g.genId();var l=r.then(function(t){return 200===t.status?new v(l10n.t("action_status_set"),l10n.t("action_undo"),e.setMyStatus.bind(e,c,n)):t.status>=400?new v(l10n.t("action_status_set_failed")):void 0})["catch"](function(r){throw s.error("models:statusCollection:setMyStatus dropped")(r),new v(l10n.t("action_status_set_failed"),l10n.t("action_try_again"),e.setMyStatus.bind(e,t,n))});return f.openToast(a.createElement(g,{id:n,initialAction:i,pendingAction:l})),r.bind(this).then(function(e){200!==e.status||e._duplicate||(this.get(Store.Conn.me).status=t)})}});e.exports=new y},function(e,t,n){"use strict";var r=n(6),i=n(798),o=n(801),a=n(9),s=n(347),c=n(800),l=n(844),u=n(80),d=n(102),p=r.createClass({displayName:"MultiselectFooter",mixins:[d],propTypes:{chat:r.PropTypes.instanceOf(o).isRequired,selectedMessages:r.PropTypes.arrayOf(r.PropTypes.instanceOf(i)).isRequired,onCancel:r.PropTypes.func.isRequired},componentWillMount:function(){this.componentWillReceiveProps()},componentWillReceiveProps:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=t.selectedMessages||[],r=this.props.selectedMessages;_.difference(n,r).forEach(function(t){return e.addObserver(t,"change:star")}),_.difference(r,n).forEach(function(t){return e.removeObserver(t,"change:star")})},onStarSelected:function(){this.props.chat.sendStarMsgs(this.props.selectedMessages,!0),this.props.onCancel()},onUnstarSelected:function(){this.props.chat.sendStarMsgs(this.props.selectedMessages,!1),this.props.onCancel()},onDeleteSelected:function(){var e=this,t=this.props.selectedMessages,n=function(){a.closeModal(),e.props.chat.sendDeleteMsgs(t),e.props.onCancel()},i=_.size(t),o=l10n.t("delete_message_confirmation",{count:i,_plural:i});a.openModal(r.createElement(s,{onOK:n,okText:l10n.t("web_delete"),onCancel:a.closeModal.bind(a),cancelText:l10n.t("web_cancel")},r.createElement(c,{text:o})))},onForwardSelected:function(){var e=this,t=this.props.selectedMessages,n=_.size(t),i=function(){e.props.onCancel()};if(_.any(t,"canForward"))if(_.some(t,_.negate(_.property("canForward")))){var o=_.filter(t,_.property("canForward"));a.openModal(r.createElement(s,{title:l10n.t("confirm_forward_partial_messages_title"),onOK:function(){return a.openModal(r.createElement(l,{msgs:o,onForward:i}),"modal-flow")},okText:l10n.t("web_ok"),onCancel:a.closeModal.bind(a),cancelText:l10n.t("web_cancel")},l10n.t("confirm_forward_partial_messages_text")))}else a.openModal(r.createElement(l,{msgs:t,onForward:i}),"modal-flow");else a.openModal(r.createElement(s,{title:l10n.t("err_unsent_forward_title"),onOK:a.closeModal.bind(a),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text",{count:n,_plural:n})))},render:function(){var e,t=this.props.selectedMessages,n=_.size(t),o=u.supportsFeature(u.F.ENC_DOC)||_.every(t,function(e){return e.type!==i.TYPE.DOCUMENT}),a=r.createElement("button",{className:"btn-icon btn-forward",disabled:n&&o?null:"disabled",title:l10n.t("forward_message",{count:n,_plural:n}),onClick:this.onForwardSelected},r.createElement("span",{className:"icon icon-forward"}));u.supportsFeature(u.F.MESSAGE_DELETE)&&(e=r.createElement("button",{className:"btn-icon btn-delete",disabled:n?null:"disabled",title:l10n.t("delete_message",{count:n,_plural:n}),onClick:this.onDeleteSelected},r.createElement("span",{className:"icon icon-delete"})));var s;if(u.supportsFeature(u.F.STARRED)){var c,l,d;n&&_.every(t,"star")?(c=this.onUnstarSelected,l=r.createElement("span",{className:"icon icon-unstar-btn"}),d=l10n.t("unstar_message",{count:n,_plural:n})):(c=this.onStarSelected,l=r.createElement("span",{className:"icon icon-star-btn"}),d=l10n.t("star_message",{count:n,_plural:n})),s=r.createElement("button",{className:"btn-icon btn-star",disabled:n?null:"disabled",title:d,onClick:c},l)}return r.createElement("div",{className:"multi-controls"},r.createElement("button",{className:"btn-icon btn-cancel",onClick:this.props.onCancel},r.createElement("span",{className:"icon icon-x"})),r.createElement("span",{className:"multi-count"},l10n.t("selected_count",{count:n,_plural:n})),s,e,a)}});e.exports=p},function(e,t){"use strict";e.exports={Action:"keyboard_action",Event:"keyboard_event",Events:{LOGGED_IN:"logged_in",LOGGED_OUT:"logged_out",ARCHIVE:"archived",MUTE:"muted",READ:"read",READ_ONLY:"read_only",CHAT_KIND:"chat_kind"},Actions:{PREFERENCES:"preferences",NEW_CHAT:"new_chat",NEW_GROUP:"new_group",PROFILE_STATUS:"profile_status",LOGOUT:"logout",SEARCH:"search",ZOOM_IN:"zoom_in",ZOOM_OUT:"zoom_out",ZOOM_RESET:"zoom_reset",TOGGLE_UNREAD:"toggle_unread",DELETE_CHAT:"delete_chat",DELETE_GROUP:"delete_group",EXIT_GROUP:"exit_group",TOGGLE_ARCHIVE:"toggle_archive",TOGGLE_MUTE:"toggle_mute",NEXT_CHAT:"next_chat",PREV_CHAT:"prev_chat"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(6),s=n(7),c=n(81),l=n(102),u=n(104),d=n(22),p=n(48),h=n(21),f=n(811),m=n(164),g=a.createClass({displayName:"NotificationManager",mixins:[c,l,u],componentWillMount:function(){this.tone=new Audio(s.NOTIFICATION_TONE_PATH),this.regCmd("alert_new_msg",this.alertNewMsg),this.regCmd("alert_call",this.showCallNotification),this.regCmd("cancel_call",this.cancelCallNotification),this.addObserver(Store.Chat,"add remove reset change:archive change:unreadCount",this.updateUnreadCount),this.addObserver(Store.Chat,"change:hasUnread",this.closeNotifications),this.addObserver(p,"change:displayInfo",this.updateUnreadCount)},componentDidMount:function(){this.updateUnreadCount()},componentWillUnmount:function(){m.setTitleAndIcon(0),m.closeAllNotifications()},closeNotifications:function(e,t){t||m.closeChatNotifications(e.id)},updateUnreadCount:function(){var e;e=p.displayInfo===p.INFO.OFFLINE?-1:p.displayInfo===p.INFO.TIMEOUT?-1:Store.Chat.filter(function(e){return!e.archive&&e.isDirty()}).length,this.count!==e&&(this.count=e,m.setTitleAndIcon(e))},matchesFilter:function(e){return!1},alertNewMsg:function(e){var t=e.chat;if((!document.hasFocus()||!t.get("active"))&&!Store.Mute.globalMute().isMuted&&!t.mute.isMuted&&("chat"!==e.type||!this.matchesFilter(e.body))&&(Store.Mute.getGlobalNotifications()&&this.showDesktopNotification(e),Store.Mute.getGlobalSounds()))if(t.isGroup){var n=Date.now(),r=t.squelch||0;n>r&&(this.playAudioNotification(),
Store.GroupMetadata.find(t.id).then(function(e){var r=e.participants.length,i=1e3*Math.min(120,30+5*r);t.squelch=n+i})["catch"](h.WapDrop,function(){t.squelch=n+6e4}))}else this.playAudioNotification()},showCallNotification:function(e,t){if(window.Notification&&window.Notification.permission===s.PERMISSION_ALLOWED){var n=Store.Contact.get(t),r=n?n.get("formattedName"):d.formattedUser(t),i=l10n.t("incoming_call_notification_title",{name:r}),a=l10n.t("incoming_call_notification_text");Store.ProfilePicThumb.find(t).timeout(1e3,"showCallNotificationTimeout").then(function(n){var r=n&&n.get("img")?n.get("img"):s.USER_DEFAULT_ICON;m.showNotification(t,e,i,a,r,!0)})["catch"](h.WapDrop,o["default"].TimeoutError,function(n){m.showNotification(t,e,i,a,s.USER_DEFAULT_ICON,!0)}),Store.Mute.getGlobalSounds()&&this.playAudioNotification()}},cancelCallNotification:function(e){m.closeNotification(e),Store.Call.remove(Store.Call.get(e))},showDesktopNotification:function(e){if(window.Notification&&window.Notification.permission===s.PERMISSION_ALLOWED){var t=e.get("chat"),n=t.get("id"),r=f.asDesktopNotification(e);r&&r.charCodeAt(0)>=128&&(r=" "+r);var i=t.isGroup?s.GROUP_DEFAULT_ICON:s.USER_DEFAULT_ICON,a=t.isGroup?l10n.t("default_group_message_notification_title"):l10n.t("default_contact_message_notification_title");Store.ProfilePicThumb.find(n).timeout(1500,"showDesktopNotificationTimeout").then(function(o){var s=t.contact.formattedName||a,c=o?o.img:"";m.showNotification(n,e.id,s,r,c||i)})["catch"](h.WapDrop,o["default"].TimeoutError,function(o){var s=t.contact.formattedName||a;m.showNotification(n,e.id,s,r,i)})}},playAudioNotification:function(){this.tone.play()},render:function(){return null}});e.exports=g},function(e,t,n){"use strict";var r=n(6),i=n(81),o=n(103),a=n(47),s=n(809),c=3,l=r.createClass({displayName:"ToastManager",mixins:[i],componentWillMount:function(){this.regCmd("open_toast",this.openToast),this.regCmd("close_toast",this.closeToast)},getInitialState:function(){return{toasts:{}}},openToast:function(e,t){var n;(n=this.refs[e.props.id])&&n instanceof s?n.restartDelay():(this.state.toasts[e.props.id]=e,this.setState({toasts:this.state.toasts}))},closeToast:function(e){var t=this.state.toasts;t[e.props.id]&&this.setState({toasts:_.omit(t,e.props.id)})},componentWillUpdate:function(e,t){this.animateEnter=_.size(this.state.toasts)>_.size(t.toasts)},render:function(){var e=this.animateEnter,t=_.chain(this.state.toasts).sortBy("id").reverse().map(function(t,n){var i=c>n?"slide"+n:"slide"+c;return 0!==n||e||(i=""),r.cloneElement(t,{key:t.props.id,ref:t.props.id,className:i})}).value(),n=a.isTrident?"fade_sifo":"toast-transition";return r.createElement(o,{transitionName:n},t)}});e.exports=l},function(e,t){"use strict";e.exports={"Smileys & People":["ordered1359","ordered1403","ordered1360","ordered1361","ordered1362","ordered1363","ordered1364","ordered1365","ordered1366","ordered1368","ordered1369","ordered1425","ordered1426","ordered0078","ordered1370","ordered1371","ordered1372","ordered1383","ordered1382","ordered1384","ordered1385","ordered1387","ordered1388","ordered1386","ordered1592","ordered1594","ordered1373","ordered1598","ordered1374","ordered1413","ordered1375","ordered1376","ordered1377","ordered1427","ordered1595","ordered1410","ordered1389","ordered1390","ordered1391","ordered1392","ordered1379","ordered1380","ordered1424","ordered0077","ordered1394","ordered1381","ordered1402","ordered1400","ordered1395","ordered1405","ordered1408","ordered1399","ordered1407","ordered1406","ordered1397","ordered1398","ordered1393","ordered1396","ordered1401","ordered1378","ordered1404","ordered1412","ordered1409","ordered1591","ordered1414","ordered1593","ordered1596","ordered1411","ordered1114","ordered1119","ordered1367","ordered1043","ordered1032","ordered1033","ordered1044","ordered1034","ordered1041","ordered1597","ordered1417","ordered1415","ordered1416","ordered1418","ordered1419","ordered1420","ordered1423","ordered1422","ordered1421","ordered1455","ordered0896","ordered0872","ordered0884","ordered0890","ordered0866","ordered0144","ordered0156","ordered0878","ordered0150","ordered0902","ordered1120","ordered1473","ordered0063","ordered0842","ordered0848","ordered0854","ordered0860","ordered1322","ordered1316","ordered1599","ordered1328","ordered0162","ordered1064","ordered0840","ordered0841","ordered0828","ordered0834","ordered0826","ordered0825","ordered0927","ordered0928","ordered1349","ordered1014","ordered0929","ordered0935","ordered0941","ordered0947","ordered0984","ordered1002","ordered1008","ordered0990","ordered0996","ordered0971","ordered1020","ordered1051","ordered1306","ordered0616","ordered1035","ordered1026","ordered0978","ordered1548","ordered0678","ordered1057","ordered0977","ordered0968","ordered0969","ordered0970","ordered1440","ordered1045","ordered1428","ordered1434","ordered1449","ordered1467","ordered1461","ordered1076","ordered1070","ordered1093","ordered1095","ordered1094","ordered1089","ordered1091","ordered1090","ordered0953","ordered0960","ordered0961","ordered0959","ordered0962","ordered0963","ordered0965","ordered0966","ordered0964","ordered0967","ordered0954","ordered0956","ordered0957","ordered0955","ordered0958","ordered0917","ordered0912","ordered0913","ordered0911","ordered0914","ordered0916","ordered0915","ordered1063","ordered1085","ordered0926","ordered0923","ordered0924","ordered0925","ordered0921","ordered0922","ordered0909","ordered0652","ordered0635","ordered0908","ordered0119","ordered0634","ordered0920","ordered0918","ordered0919","ordered1143","ordered0910","ordered1307","ordered1087","ordered0487"],"Animals & Nature":["ordered0815","ordered0810","ordered0806","ordered0818","ordered0809","ordered0820","ordered0821","ordered0801","ordered0808","ordered1606","ordered0807","ordered0816","ordered0822","ordered0817","ordered0786","ordered0814","ordered1446","ordered1447","ordered1448","ordered0779","ordered0781","ordered0800","ordered0799","ordered0797","ordered0796","ordered0798","ordered0819","ordered0784","ordered0813","ordered1609","ordered0790","ordered0788","ordered0773","ordered0791","ordered0789","ordered1308","ordered1607","ordered1605","ordered0774","ordered0795","ordered0793","ordered0792","ordered0794","ordered0805","ordered0812","ordered0772","ordered0771","ordered0767","ordered0766","ordered0764","ordered0763","ordered0765","ordered0803","ordered0804","ordered0785","ordered0777","ordered0776","ordered0778","ordered0775","ordered0783","ordered0761","ordered0762","ordered0780","ordered1608","ordered1273","ordered0782","ordered0802","ordered0769","ordered0768","ordered0824","ordered0823","ordered0770","ordered0811","ordered0536","ordered0615","ordered0533","ordered0534","ordered0535","ordered0532","ordered0546","ordered0062","ordered0547","ordered0629","ordered0627","ordered0550","ordered0549","ordered0548","ordered0545","ordered0541","ordered0542","ordered0540","ordered0538","ordered0543","ordered0539","ordered1092","ordered0551","ordered0531","ordered0614","ordered0787","ordered1309","ordered0499","ordered0498","ordered0500","ordered0506","ordered0507","ordered0508","ordered0509","ordered0502","ordered0503","ordered0504","ordered0505","ordered0511","ordered0514","ordered0512","ordered0513","ordered0515","ordered0510","ordered0200","ordered0516","ordered1126","ordered0174","ordered0057","ordered0053","ordered0519","ordered0115","ordered0520","ordered0521","ordered0054","ordered0522","ordered0116","ordered0524","ordered0107","ordered1247","ordered1115","ordered0177","ordered0523","ordered0056","ordered0114","ordered0527","ordered1118","ordered0525","ordered0526","ordered0055","ordered0060","ordered1117","ordered1116","ordered0495"],"Food & Drink":["ordered0562","ordered0561","ordered0563","ordered0557","ordered0558","ordered0559","ordered0556","ordered0554","ordered0566","ordered0555","ordered0565","ordered0564","ordered0560","ordered0552","ordered0553","ordered0537","ordered0544","ordered0579","ordered0594","ordered0577","ordered1610","ordered0570","ordered0569","ordered0583","ordered0598","ordered0567","ordered0578","ordered0528","ordered0568","ordered0576","ordered0529","ordered0530","ordered0575","ordered0597","ordered0584","ordered0582","ordered0596","ordered0574","ordered0572","ordered0573","ordered0571","ordered0581","ordered0580","ordered0586","ordered0587","ordered0585","ordered0595","ordered0613","ordered0593","ordered0591","ordered0592","ordered0590","ordered0610","ordered0588","ordered0589","ordered0605","ordered0606","ordered0602","ordered0603","ordered0604","ordered0609","ordered0601","ordered0600","ordered0061","ordered0607","ordered0599","ordered0608"],Activity:["ordered0112","ordered0675","ordered0698","ordered0113","ordered0673","ordered0716","ordered0699","ordered0660","ordered0127","ordered0712","ordered0719","ordered0753","ordered0718","ordered0717","ordered0715","ordered0674","ordered0130","ordered0677","ordered0131","ordered0754","ordered0646","ordered1514","ordered0700","ordered0684","ordered1563","ordered0132","ordered0706","ordered1536","ordered1542","ordered0692","ordered1305","ordered0691","ordered0672","ordered0690","ordered0636","ordered0637","ordered0751","ordered0654","ordered0642","ordered0656","ordered0651","ordered0653","ordered0647","ordered0650","ordered0671","ordered0668","ordered0666","ordered0669","ordered0667","ordered0670","ordered0655","ordered0657","ordered1042","ordered0658","ordered0661","ordered0659","ordered0662"],"Travel & Places":["ordered1502","ordered1500","ordered1504","ordered1491","ordered1493","ordered0714","ordered1498","ordered1496","ordered1497","ordered1495","ordered1505","ordered1506","ordered1507","ordered0713","ordered1534","ordered1524","ordered1499","ordered1492","ordered1503","ordered1501","ordered1512","ordered1511","ordered1510","ordered1482","ordered1490","ordered1508","ordered1483","ordered1484","ordered1487","ordered1509","ordered1481","ordered1485","ordered1486","ordered1489","ordered1488","ordered1480","ordered1586","ordered0142","ordered1587","ordered1588","ordered0129","ordered1585","ordered1520","ordered0128","ordered1590","ordered1479","ordered1589","ordered1141","ordered0099","ordered1523","ordered0139","ordered1494","ordered1522","ordered1521","ordered0676","ordered1513","ordered0644","ordered0645","ordered0643","ordered0723","ordered0486","ordered1355","ordered0745","ordered0126","ordered0633","ordered0124","ordered0720","ordered1354","ordered0496","ordered1357","ordered0721","ordered0138","ordered0730","ordered1583","ordered1584","ordered0490","ordered0489","ordered0728","ordered0722","ordered0729","ordered0492","ordered0491","ordered0725","ordered0488","ordered0494","ordered0497","ordered0517","ordered0623","ordered0622","ordered0493","ordered0724","ordered0748","ordered0747","ordered0731","ordered1356","ordered0732","ordered0733","ordered0726","ordered0734","ordered0744","ordered0735","ordered0736","ordered0737","ordered0738","ordered0740","ordered0742","ordered0743","ordered0741","ordered1096","ordered0727","ordered0123","ordered1275","ordered1276","ordered1274","ordered0122"],Objects:["ordered0027","ordered1196","ordered1197","ordered1142","ordered0029","ordered1334","ordered1335","ordered1336","ordered1337","ordered1310","ordered1345","ordered1144","ordered1145","ordered1146","ordered1147","ordered1207","ordered1202","ordered1203","ordered1204","ordered0648","ordered1208","ordered0641","ordered1177","ordered0058","ordered1178","ordered1179","ordered1205","ordered1206","ordered0638","ordered0639","ordered0640","ordered0038","ordered0039","ordered0037","ordered1303","ordered0040","ordered0028","ordered1180","ordered1221","ordered1222","ordered1111","ordered1248","ordered1302","ordered1342","ordered1582","ordered1139","ordered1136","ordered1135","ordered1137","ordered1138","ordered1131","ordered1134","ordered1088","ordered0101","ordered1249","ordered1250","ordered0098","ordered1580","ordered0118","ordered1251","ordered0103","ordered0120","ordered1253","ordered1113","ordered1252","ordered1348","ordered0100","ordered1581","ordered1528","ordered0069","ordered0110","ordered0111","ordered0755","ordered1256","ordered1209","ordered1082","ordered0102","ordered1255","ordered1254","ordered1304","ordered1084","ordered1083","ordered0518","ordered0752","ordered1232","ordered1560","ordered1562","ordered1569","ordered1227","ordered1346","ordered1574","ordered1575","ordered1578","ordered1526","ordered1577","ordered1338","ordered1353","ordered0125","ordered1358","ordered1576","ordered0624","ordered0631","ordered0611","ordered0612","ordered0626","ordered0625","ordered0630","ordered0632","ordered0628","ordered0746","ordered0143","ordered1188","ordered1187","ordered1186","ordered1086","ordered1193","ordered1189","ordered1190","ordered1191","ordered1192","ordered1185","ordered1194","ordered1184","ordered1183","ordered1175","ordered1150","ordered1164","ordered1157","ordered1155","ordered1156","ordered1151","ordered1152","ordered1153","ordered1344","ordered1154","ordered1340","ordered1352","ordered1341","ordered1158","ordered1343","ordered1148","ordered1149","ordered1339","ordered1347","ordered1195","ordered1166","ordered1168","ordered1170","ordered1171","ordered1172","ordered1167","ordered1165","ordered1173","ordered1169","ordered1233","ordered1161","ordered1311","ordered0140","ordered1163","ordered1162","ordered1159","ordered1160","ordered1525","ordered0749","ordered0750","ordered1226","ordered1228","ordered1229","ordered1225","ordered1312","ordered1313","ordered0169","ordered1176","ordered0168","ordered1315","ordered1314","ordered1223","ordered1224"],Symbols:["ordered0186","ordered1105","ordered1104","ordered1103","ordered1106","ordered1098","ordered0185","ordered1099","ordered1108","ordered1097","ordered1101","ordered1100","ordered1102","ordered1107","ordered1109","ordered0074","ordered0172","ordered0073","ordered1272","ordered0076","ordered0173","ordered1257","ordered1277","ordered0075","ordered0072","ordered1579","ordered0117","ordered0079","ordered0080","ordered0081","ordered0082","ordered0083","ordered0084","ordered0085","ordered0086","ordered0087","ordered0088","ordered0089","ordered0090","ordered0216","ordered0104","ordered0475","ordered0481","ordered0070","ordered0071","ordered1199","ordered1198","ordered0478","ordered0472","ordered0480","ordered0482","ordered0479","ordered0176","ordered0222","ordered0484","ordered1129","ordered0483","ordered0205","ordered0204","ordered0476","ordered0477","ordered0474","ordered0208","ordered0209","ordered0212","ordered0213","ordered0210","ordered0220","ordered0121","ordered1174","ordered1527","ordered0179","ordered0201","ordered1112","ordered0095","ordered1554","ordered1531","ordered1535","ordered1533","ordered1240","ordered1200","ordered0184","ordered0183","ordered0181","ordered0182","ordered0015","ordered0016","ordered1130","ordered1215","ordered1216","ordered1259","ordered0105","ordered0203","ordered0106","ordered1555","ordered1258","ordered0096","ordered0473","ordered1140","ordered0178","ordered0175","ordered0180","ordered0141","ordered1110","ordered0485","ordered0192","ordered0501","ordered0044","ordered0739","ordered0471","ordered1570","ordered1571","ordered1572","ordered1573","ordered0097","ordered1529","ordered1561","ordered0211","ordered1532","ordered1556","ordered1557","ordered1559","ordered1558","ordered1530","ordered0649","ordered1201","ordered0470","ordered0218","ordered0219","ordered0221","ordered0214","ordered0217","ordered0215","ordered0003","ordered0004","ordered0005","ordered0006","ordered0007","ordered0008","ordered0009","ordered0010","ordered0011","ordered0012","ordered1241","ordered1244","ordered0047","ordered0041","ordered0036","ordered0042","ordered0043","ordered0034","ordered0035","ordered0030","ordered0031","ordered1210","ordered1211","ordered1212","ordered0048","ordered1270","ordered1271","ordered0032","ordered0033","ordered0190","ordered0195","ordered0196","ordered0197","ordered0022","ordered0023","ordered0024","ordered0021","ordered0020","ordered0019","ordered1214","ordered0026","ordered0025","ordered0193","ordered0194","ordered0001","ordered0002","ordered0018","ordered1246","ordered1243","ordered1242","ordered1245","ordered0664","ordered0665","ordered0202","ordered0191","ordered0170","ordered1213","ordered0187","ordered0188","ordered0189","ordered0171","ordered1133","ordered1132","ordered0013","ordered0014","ordered0017","ordered1236","ordered1235","ordered1237","ordered1239","ordered1238","ordered0059","ordered1234","ordered0108","ordered0109","ordered1262","ordered1263","ordered1266","ordered1267","ordered1264","ordered1265","ordered1268","ordered0045","ordered0046","ordered0198","ordered0199","ordered1269","ordered0050","ordered0049","ordered0052","ordered0051","ordered1260","ordered1261","ordered1218","ordered1219","ordered1220","ordered1217","ordered1182","ordered1181","ordered1230","ordered1231","ordered0207","ordered0206","ordered0091","ordered0092","ordered0093","ordered0094","ordered0663","ordered0827","ordered1128","ordered1351","ordered1127","ordered1278","ordered1279","ordered1280","ordered1281","ordered1282","ordered1283","ordered1284","ordered1285","ordered1286","ordered1287","ordered1288","ordered1289","ordered1290","ordered1291","ordered1292","ordered1293","ordered1294","ordered1295","ordered1296","ordered1297","ordered1298","ordered1299","ordered1300","ordered1301"],Flags:["ordered0225","ordered0237","ordered0228","ordered0283","ordered0233","ordered0223","ordered0230","ordered0227","ordered0231","ordered0226","ordered0232","ordered0229","ordered0236","ordered0235","ordered0234","ordered0238","ordered0254","ordered0245","ordered0241","ordered0240","ordered0257","ordered0242","ordered0258","ordered0247","ordered0249","ordered0255","ordered0251","ordered0252","ordered0239","ordered0256","ordered0253","ordered0328","ordered0458","ordered0250","ordered0244","ordered0243","ordered0246","ordered0273","ordered0339","ordered0268","ordered0259","ordered0322","ordered0346","ordered0262","ordered0435","ordered0267","ordered0269","ordered0275","ordered0260","ordered0270","ordered0341","ordered0263","ordered0261","ordered0266","ordered0271","ordered0319","ordered0272","ordered0274","ordered0276","ordered0277","ordered0280","ordered0279","ordered0281","ordered0282","ordered0284","ordered0286","ordered0430","ordered0310","ordered0288","ordered0285","ordered0290","ordered0291","ordered0294","ordered0296","ordered0293","ordered0292","ordered0297","ordered0302","ordered0396","ordered0436","ordered0298","ordered0307","ordered0301","ordered0278","ordered0304","ordered0305","ordered0311","ordered0306","ordered0300","ordered0309","ordered0314","ordered0313","ordered0303","ordered0308","ordered0315","ordered0316","ordered0320","ordered0318","ordered0317","ordered0321","ordered0331","ordered0327","ordered0323","ordered0330","ordered0329","ordered0324","ordered0326","ordered0325","ordered0332","ordered0265","ordered0334","ordered0336","ordered0333","ordered0335","ordered0347","ordered0337","ordered0340","ordered0464","ordered0345","ordered0338","ordered0348","ordered0357","ordered0349","ordered0354","ordered0353","ordered0358","ordered0351","ordered0355","ordered0356","ordered0369","ordered0365","ordered0363","ordered0377","ordered0379","ordered0376","ordered0366","ordered0374","ordered0364","ordered0371","ordered0372","ordered0375","ordered0466","ordered0378","ordered0295","ordered0361","ordered0360","ordered0368","ordered0362","ordered0373","ordered0359","ordered0380","ordered0367","ordered0381","ordered0390","ordered0389","ordered0387","ordered0382","ordered0392","ordered0386","ordered0383","ordered0385","ordered0391","ordered0384","ordered0370","ordered0343","ordered0388","ordered0393","ordered0399","ordered0406","ordered0404","ordered0394","ordered0397","ordered0407","ordered0395","ordered0398","ordered0402","ordered0400","ordered0405","ordered0403","ordered0408","ordered0409","ordered0410","ordered0412","ordered0413","ordered0248","ordered0420","ordered0342","ordered0350","ordered0401","ordered0456","ordered0463","ordered0424","ordered0429","ordered0414","ordered0425","ordered0411","ordered0416","ordered0423","ordered0419","ordered0431","ordered0422","ordered0421","ordered0415","ordered0426","ordered0467","ordered0312","ordered0344","ordered0428","ordered0289","ordered0352","ordered0417","ordered0427","ordered0433","ordered0418","ordered0264","ordered0432","ordered0448","ordered0439","ordered0449","ordered0438","ordered0441","ordered0437","ordered0440","ordered0444","ordered0446","ordered0443","ordered0445","ordered0442","ordered0434","ordered0447","ordered0451","ordered0450","ordered0224","ordered0299","ordered0452","ordered0459","ordered0453","ordered0454","ordered0461","ordered0455","ordered0457","ordered0460","ordered0462","ordered0287","ordered0465","ordered0468","ordered0469"]}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(106),o=r(i),a=n(155),s=r(a),c=function(){function e(){(0,o["default"])(this,e)}return(0,s["default"])(e,[{key:"trigger",value:function(e){}}]),e}();e.exports=new c},function(e,t,n){"use strict";function r(e){var t=R.exec(e);if(!t)return null;var n=t[T].length,r=t[0],i=t.index+n;if(t[k]){var a=parseInt(t[k].slice(1),10);if("0"===t[k][1]||!(a>0&&65536>a))return null}var s=o.find([D,P,x],function(e){return t[e]})||0;if(s){for(var c=[],l=t[s],u=0,d=0,p=0;p<l.length;p++){var h=l.charCodeAt(p);h===d?(d=c.pop()||0,0===d&&(u=p)):h in I?(0!==d&&c.push(d),d=I[h]):h in A||0===d&&(u=p)}for(;0!==c.length;)c.pop();r=u!==l.length-1?o.compact(t.slice(C,s)).join("")+l.slice(0,u+1):r.slice(n)}else r=r.slice(n);var f=r,m=t[C];return m?m=m.toLowerCase():(m=0===f.toLowerCase().indexOf("irc.")?"irc://":0===f.toLowerCase().indexOf("ftp.")?"ftp://":t[M]?"mailto:":"https://",f=m+f),{href:f,url:r,index:i,scheme:m,username:t[M],domain:t[N],port:t[k],path:t[x],params:t[P],anchor:t[D]}}function i(e){var t=r(e);return t&&t.url===e&&"mailto:"===t.scheme&&t.username&&!t.params&&!t.anchor?t:null}var o=n(84),a="ac|academy|ad|adult|ae|aero|af|ag|agency|ai|al|am|ao|app|ar|as|asia|at|au|audio|az|ba|bank|bb|bd|be|best|bf|bg|bh|bi|bid|bike|bio|biz|bj|black|blue|bm|bn|bnpparibas|bo|br|bradesco|brussels|bs|bt|buzz|bw|by|bz|bzh|ca|cab|camera|canon|capital|cards|careers|casa|cash|casino|cat|cc|cd|center|cern|cf|cg|ch|chat|church|ci|city|cl|click|cloud|club|cm|cn|co|coach|codes|com|community|company|cool|coop|cr|cu|cv|cx|cy|cz|date|dating|de|deals|desi|design|dev|digital|direct|directory|dj|dk|do|domains|download|dz|ec|edu|education|ee|eg|email|energy|es|et|eu|eus|events|exchange|expert|farm|fi|finance|fit|fj|flights|fm|fo|forsale|fr|fund|futbol|ga|gal|gallery|gd|ge|gg|gh|gi|gift|gl|global|gold|google|gov|gp|gq|gr|gratis|gs|gt|guide|guru|gy|haus|help|hiphop|hk|hm|hn|horse|host|hosting|house|how|hr|ht|hu|id|ie|il|im|in|info|ink|int|io|iq|ir|is|istanbul|it|je|jm|jo|jobs|jp|ke|kg|kh|kim|kiwi|kr|krd|kred|kw|kz|la|land|lat|lb|lc|li|life|limited|link|live|lk|lol|london|love|ls|lt|lu|lv|ly|ma|market|marketing|md|me|media|menu|mg|mil|mk|ml|mm|mn|mo|mobi|moe|moscow|movie|mr|ms|mt|mu|museum|mv|mw|mx|my|mz|na|nagoya|name|nc|net|network|news|nf|ng|ni|ninja|nl|no|np|nu|nyc|nz|office|okinawa|om|one|onl|online|ooo|org|ovh|pa|paris|party|pe|pf|pg|ph|photo|photos|pics|pictures|pink|pk|pl|place|plus|pm|pn|porn|post|pr|press|pro|prod|ps|pt|pub|pw|py|qa|racing|re|red|report|rest|review|reviews|ro|rocks|rs|ru|run|rw|sa|sale|sc|science|scot|sd|se|services|sex|sexy|sg|sh|shiksha|show|si|singles|site|sk|sm|sn|so|social|software|solutions|space|sr|st|studio|style|su|supply|support|sv|sx|sy|systems|sz|taipei|tc|team|tech|technology|tf|tg|th|tips|tj|tk|tl|tm|tn|to|today|tokyo|tools|top|tr|trade|training|travel|tt|tv|tw|tz|ua|ug|uk|uno|uol|us|uy|uz|va|vc|ve|vg|video|vn|vote|vu|wales|wang|watch|webcam|website|wf|wiki|win|work|works|world|ws|wtf|xn--80asehdb|xn--p1ai|xyz|ye|yt|za|zm|zone|zw",s="\\w+://|mailto:",c="\\w|%[0-9a-f][0-9a-f]",l="(?:"+c+")|(?:"+c+")(?:"+c+"|-)*(?:"+c+")",u="(?:(?:"+l+")\\.)+(?:"+a+")(?!\\."+l+")",d="(?:\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])",p=d+"\\."+d+"\\."+d+"\\."+d,h=":\\d{1,5}",f="+@!.\\-?,(\\[{<«‘“:",m="(?:"+c+"|[^\\s%])",g="/"+m+"*?",v="["+f+"]*(?!"+m+"|#)",y="\\?(?!"+v+")"+m+"*?",_="#"+m+"*?",E="0-9a-z!#$%&'*+/=?^_`{|}~\\-",b="\\b\\w["+E+"]*(?:\\.["+E+"]+)*",w="^|\\W\\.|[^/\\w.]|_",S="("+w+")("+s+")?("+b+"@)?("+u+"|"+p+"(?=[:/]))(?:(?=\\b[^:/?#])|("+h+")?("+g+")?("+y+")?("+_+")?(?="+v+"))",T=1,C=2,M=3,N=4,k=5,x=6,P=7,D=8,A={34:34,39:39,41:40,62:60,93:91,125:123,187:171,8217:8216,8221:8220},I={34:34,39:39,40:41,60:62,91:93,123:125,171:187,8216:8217,8220:8221},R=new RegExp(""+S,"i");window.validateEmail=i,e.exports={findLink:r,validateEmail:i}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(59),o=r(i),a=n(106),s=r(a),c=n(155),l=r(c),u=n(350),d=r(u),p=n(349),h=r(p),f=n(828),m=n(165),g=n(47),v=function(e){function t(e){(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,o["default"])(t).call(this));return n._length=e,n._regex=new RegExp("("+m.arabic+"{"+e+"})("+m.arabic+")"),n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"mutate",value:function(e,t){return t[1]+"​"+t[2]}},{key:"match",value:function(e){return g.isWebkit?e.length<=this._length?null:this._regex.exec(e):null}},{key:"isFragment",get:function(){return!0}},{key:"alwaysApply",get:function(){return!0}}]),t}(f);e.exports=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(709),o=r(i),a=n(59),s=r(a),c=n(106),l=r(c),u=n(155),d=r(u),p=n(350),h=r(p),f=n(349),m=r(f),g=n(84),v=n(711),y=n(851),_=n(353),E=n(827),b=n(899),w=n(848),S=n(850),T=n(852),C=n(853),M=function(e){function t(){(0,l["default"])(this,t);var e=(0,h["default"])(this,(0,s["default"])(t).call(this));return e.handlers=[],e._addHandler(b,e._doEmoji),e._addHandler(S,e._doLink),e._addHandler(E,e.createAndApplyClasses("code")),e._addHandler(C,e.createAndApplyClasses("strong")),e._addHandler(w,e.createAndApplyClasses("em")),e._addHandler(T,e.createAndApplyClasses("del")),e}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"createAndApplyClasses",value:function(e){var t=this;return function(n,r){var i=document.createElement(e);return t._applyProps(i,n.args)}}},{key:"onRoot",value:function(e){var t=document.createDocumentFragment();e.forEach(function(e){return t.appendChild(e)});var n=document.createElement("div");return n.appendChild(t),n.innerHTML}},{key:"onMutatorNode",value:function(e,t){var n=this._getHandler(e.mutator);v(n,"Missing HTML handler for "+e.mutator.constructor);var r=n.call(this,e,t);return r?(t.forEach(function(e){return r.appendChild(e)}),r):r}},{key:"onDelimiter",value:function(e){return null}},{key:"onText",value:function(e){return document.createTextNode(e)}},{key:"_doEmoji",value:function(e){var t=_.emojiToImage(e.args.emoji,e.args.classes,e.args.size);return t?t.cloneNode():null}},{key:"_doLink",value:function(e){var t=document.createElement("a");return this._applyProps(t,e.args.props)}},{key:"_addHandler",value:function(e,t){this.handlers.push([e,t])}},{key:"_getHandler",value:function(e){return(g.find(this.handlers,function(t){var n=(0,o["default"])(t,1),r=n[0];return e.constructor===r})||[])[1]}},{key:"_applyProps",value:function(e,t){for(var n in t)e[n]=t[n];return e}}]),t}(y);e.exports=M},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(710),o=r(i),a=n(59),s=r(a),c=n(155),l=r(c),u=n(350),d=r(u),p=n(349),h=r(p),f=n(106),m=r(f),g=n(711),v=function w(e){(0,m["default"])(this,w),this.parent=e},y=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0],n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];(0,m["default"])(this,t);var r=(0,d["default"])(this,(0,s["default"])(t).call(this,e));return r.children=[],r.addChild.apply(r,(0,o["default"])(n)),r}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"addChild",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this._addRemoveIndex(this.children.length,!1,t)}},{key:"removeChild",value:function(e){this._addRemoveChild(e,!0)}},{key:"replaceChild",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];this._addRemoveChild(e,!0,0,n)}},{key:"addChildBefore",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];this._addRemoveChild(e,!1,0,n)}},{key:"addChildAfter",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];this._addRemoveChild(e,!1,1,n)}},{key:"mapChildren",value:function(e){return this.children=this.children.map(function(t){return e(t)}),this}},{key:"filterChildren",value:function(e){return this.children=this.children.filter(function(t){return e(t)}),this}},{key:"_getChildIndex",value:function(e){var t=this.children.indexOf(e);return g(-1!==t,"Child does not belong to this Node instance"),t}},{key:"_addRemoveIndex",value:function(e,t){var n,r=this,i=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];(n=this.children).splice.apply(n,[e,t?1:0].concat((0,o["default"])(i.map(function(n){var i=r.children.indexOf(n);return g(-1===i||i===e&&t,"Attempting to add a duplicate child"),g(r!==n,"Unable to make a Node a child of itself"),n instanceof v&&(n.parent=r),n}))))}},{key:"_addRemoveChild",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?0:arguments[2],r=arguments.length<=3||void 0===arguments[3]?[]:arguments[3];this._addRemoveIndex(this._getChildIndex(e)+n,t,r)}}]),t}(v),_=function(e){function t(e,n,r){var i=arguments.length<=3||void 0===arguments[3]?[]:arguments[3];(0,m["default"])(this,t);var o=(0,d["default"])(this,(0,s["default"])(t).call(this,e,n));return o.mutator=r,o.args=i,o}return(0,h["default"])(t,e),t}(y),E=function(e){function t(e,n){(0,m["default"])(this,t);var r=e instanceof y,i=(0,d["default"])(this,(0,s["default"])(t).call(this,r?e:null));return i.value=r?n:e,i}return(0,h["default"])(t,e),t}(v),b=function(e){function t(){return(0,m["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),t}(E);e.exports={ChildNode:v,Delimiter:b,MutatorNode:_,Node:y,Text:E}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(59),o=r(i),a=n(106),s=r(a),c=n(155),l=r(c),u=n(350),d=r(u),p=n(349),h=r(p),f=n(851),m=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"onRoot",value:function(e){return e.join("")}},{key:"onMutatorNode",value:function(e,t){return t.join("")}},{key:"onDelimiter",value:function(){return""}}]),t}(f);e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){return v++,g?g:new window.AudioContext}function o(){v--,0===v&&g&&g.close()}var a=n(3),s=r(a),c=n(106),l=r(c),u=n(155),d=r(u),p=n(61),h=n(109),f=n(904),m="audio/wav",g=void 0,v=0,y=function(){function e(t){(0,l["default"])(this,e),this.oggBlob=t}return(0,d["default"])(e,[{key:"generateBlob",value:function(){return this.oggBlobToWAVBlob(this.oggBlob,1)}},{key:"oggBlobToWAVBlob",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?2:arguments[1];return new s["default"](function(r,a){var s=new f,c=[],l=[],u=i(),d={outputBufferSampleRate:u.sampleRate,bufferLength:4096};s.onmessage=function(e){if(null===e.data){for(var i=function(e){c.forEach(function(t,n){t=t[e]||t[0];for(var r=0;r<t.length;r++)l.push(t[r])})},a=0;n>a;a++)i(a);var s=t.encodeWAV(l,u,n),d=new Blob([s],{type:m});o(),r(d)}else c.push(e.data),n=c[0].length},s.postMessage({command:"decode-init",config:d}),t.blobToArrayBuffer(e).then(function(e){s.postMessage({command:"decode",pages:new Uint8Array(e)}),s.postMessage({command:"decode-done"})})})}},{key:"encodeWAV",value:function(e,t,n){var r=new ArrayBuffer(44+2*e.length),i=new DataView(r);
return this.writeString(i,0,"RIFF"),i.setUint32(4,36+2*e.length,!0),this.writeString(i,8,"WAVE"),this.writeString(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,n,!0),i.setUint32(24,t.sampleRate,!0),i.setUint32(28,4*t.sampleRate,!0),i.setUint16(32,2*n,!0),i.setUint16(34,16,!0),this.writeString(i,36,"data"),i.setUint32(40,2*e.length,!0),this.floatTo16BitPCM(i,44,e),i}},{key:"writeString",value:function(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}},{key:"floatTo16BitPCM",value:function(e,t,n){for(var r=0;r<n.length;r++,t+=2){var i=Math.max(-1,Math.min(1,n[r]));e.setInt16(t,0>i?32768*i:32767*i,!0)}}},{key:"blobToArrayBuffer",value:function(e){return new s["default"](function(t,n){var r=new FileReader;r.onload=function(e){t(r.result)},r.readAsArrayBuffer(e)})}},{key:"urlToArrayBuffer",value:function(e){return p.isBlob(e)?new s["default"](function(t,n){var r=new FileReader;r.onload=function(e){t(r.result)},r.readAsArrayBuffer(e)}):h.get(this.props.msg.url,h.RESP_TYPE.ARRAY_BUFFER).then(function(e){var t=e.response;return s["default"].resolve(t)})}}]),e}();e.exports=y},function(e,t,n){"use strict";var r=n(904),i=function o(e){if(!o.isRecordingSupported())throw"Recording is not supported in this browser";this.audioContext=new window.AudioContext,this.config=e=e||{},this.config.command="encode-init",this.config.bufferLength=e.bufferLength||4096,this.config.monitorGain=e.monitorGain||0,this.config.numberOfChannels=e.numberOfChannels||1,this.config.originalSampleRate=this.audioContext.sampleRate,this.config.encoderSampleRate=e.encoderSampleRate||48e3,this.config.streamPages=e.streamPages||!1,this.config.leaveStreamOpen=e.leaveStreamOpen||!1,this.config.maxBuffersPerPage=e.maxBuffersPerPage||40,this.config.encoderApplication=e.encoderApplication||2049,this.config.encoderFrameSize=e.encoderFrameSize||20,this.config.streamOptions=e.streamOptions||{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}},this.state="inactive",this.eventTarget=document.createDocumentFragment(),this.createAudioNodes()};i.isRecordingSupported=function(){return window.AudioContext&&navigator.getUserMedia},i.prototype.addEventListener=function(e,t,n){this.eventTarget.addEventListener(e,t,n)},i.prototype.clearStream=function(){this.stream&&(this.stream.getTracks().forEach(function(e){e.stop()}),delete this.stream)},i.prototype.createAudioNodes=function(){var e=this;this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.onaudioprocess=function(t){e.encodeBuffers(t.inputBuffer)},this.monitorNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.config.sampleRate<this.audioContext.sampleRate&&this.createButterworthFilter()},i.prototype.createButterworthFilter=function(){this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode2=this.audioContext.createBiquadFilter(),this.filterNode3=this.audioContext.createBiquadFilter(),this.filterNode.type=this.filterNode2.type=this.filterNode3.type="lowpass";var e=this.config.sampleRate/2;this.filterNode.frequency.value=this.filterNode2.frequency.value=this.filterNode3.frequency.value=e-e/3.5355,this.filterNode.Q.value=.51764,this.filterNode2.Q.value=.70711,this.filterNode3.Q.value=1.93184,this.filterNode.connect(this.filterNode2),this.filterNode2.connect(this.filterNode3),this.filterNode3.connect(this.scriptProcessorNode)},i.prototype.encodeBuffers=function(e){if("recording"===this.state){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);this.encoder.postMessage({command:"encode",buffers:t}),this.duration+=e.duration,this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration}))}},i.prototype.initStream=function(e){if(this.stream)return void this.eventTarget.dispatchEvent(new Event("streamReady"));if(e)return this.stream=e,this.sourceNode=this.audioContext.createMediaStreamSource(e),this.sourceNode.connect(this.filterNode||this.scriptProcessorNode),this.sourceNode.connect(this.monitorNode),void this.eventTarget.dispatchEvent(new Event("streamReady"));var t=this;navigator.getUserMedia({audio:this.config.streamOptions},function(e){t.stream=e,t.sourceNode=t.audioContext.createMediaStreamSource(e),t.sourceNode.connect(t.filterNode||t.scriptProcessorNode),t.sourceNode.connect(t.monitorNode),t.eventTarget.dispatchEvent(new Event("streamReady"))},function(e){t.eventTarget.dispatchEvent(new ErrorEvent("streamError",{error:e}))})},i.prototype.pause=function(){"recording"===this.state&&(this.state="paused",this.eventTarget.dispatchEvent(new Event("pause")))},i.prototype.removeEventListener=function(e,t,n){this.eventTarget.removeEventListener(e,t,n)},i.prototype.resume=function(){"paused"===this.state&&(this.state="recording",this.eventTarget.dispatchEvent(new Event("resume")))},i.prototype.setMonitorGain=function(e){this.monitorNode.gain.value=e},i.prototype.start=function(){if("inactive"===this.state&&this.stream){var e=this;this.encoder=new r,this.config.streamPages?this.encoder.addEventListener("message",function(t){e.streamPage(t.data)}):(this.recordedPages=[],this.totalLength=0,this.encoder.addEventListener("message",function(t){e.storePage(t.data)})),this.encodeBuffers=function(){delete this.encodeBuffers},this.duration=0,this.state="recording",this.monitorNode.connect(this.audioContext.destination),this.scriptProcessorNode.connect(this.audioContext.destination),this.eventTarget.dispatchEvent(new Event("start")),this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration})),this.encoder.postMessage(this.config)}},i.prototype.stop=function(){"inactive"!==this.state&&(this.state="inactive",this.audioContext.close(),this.monitorNode.disconnect(),this.scriptProcessorNode.disconnect(),this.config.leaveStreamOpen||this.clearStream(),this.encoder.postMessage({command:"encode-done"}))},i.prototype.storePage=function(e){if(this.recordedPages.push(e),this.totalLength+=e.length,4&e[5]){for(var t=new Uint8Array(this.totalLength),n=0,r=0;r<this.recordedPages.length;r++)t.set(this.recordedPages[r],n),n+=this.recordedPages[r].length;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([t],{type:"audio/ogg; codecs=opus"})})),this.recordedPages=[],this.eventTarget.dispatchEvent(new Event("stop"))}},i.prototype.streamPage=function(e){this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([e],{type:"audio/ogg; codecs=opus"})})),4&e[5]&&this.eventTarget.dispatchEvent(new Event("stop"))},e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(106),o=r(i),a=n(155),s=r(a),c=50,l=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],n=arguments.length<=1||void 0===arguments[1]?function(){return c}:arguments[1];(0,o["default"])(this,e),this.cursorSize=n,this.index=Math.max(t,0),this.init(t)}return(0,s["default"])(e,[{key:"init",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this.before=this.cursorSize(),this.after=this.cursorSize(),this.index=e,this}},{key:"setIndex",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments[1];this.index=e;var n=this.cursorSize();this.before=Math.min(e,Math.max(this.before,n)),this.after=Math.min(t-e,Math.max(this.after,n))}},{key:"loadBefore",value:function(e){var t=e||2*this.cursorSize();return this.before=this.before+t,this}},{key:"loadAfter",value:function(e){var t=e||2*this.cursorSize();return this.after=this.after+t,this}},{key:"start",get:function(){return this.index-this.before}},{key:"end",get:function(){return this.index+this.after}}]),e}();e.exports=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(3),o=r(i),a=n(7),s=n(836),c=n(61),l={vCardPrepareForSend:function(e){return new o["default"](function(t,n){var r=new FileReader;r.onload=function(){var e=l.vCardParse(r.result),n=e.vcard.FN||{},i=e.vcard.PHOTO;if(i){var o=a.MAX_VCARD_PHOTO_SIDE,u="data:image/jpeg;base64,"+i.value;return s.resizeDataURI(u,o,o).then(function(r){var o=c.parseDataURL(r);i.value=o.data,i.line="PHOTO;BASE64:"+o.data,t(l.vCardSerialize(e.rows),n.value)})}t(l.vCardSerialize(e.rows),n.value)},r.onerror=n,r.readAsText(e)})},vCardParse:function(e){function t(e){var t={line:e},n=e.split(/:/,2);return t.key=t.fullkey=n[0],t.value=n[1],n=t.key.split(/;/,2),n.length>1&&(t.key=n[0]),t}if(e){e=e.replace(/\n^ /gm,"");var n=e.split(/\n/),r="BEGIN VERSION FN N TEL EMAIL ADR PHOTO END".split(/ /),i={};r.forEach(function(e){i[e]=!0});for(var o=[],a={},s=0;s<n.length;++s){var c=t(n[s]);i[c.key]&&(o.push(c),a[c.key]=c)}return{vcard:a,rows:o}}},vCardSerialize:function(e){return e.map(function(e){return e.line.replace(/(.{75,75})/g,"$1\n ").replace(/\n^-$/gm,"")}).join("\n")},thumbnail:function(e){if(e){e=e.replace(/\n^ /gm,"");var t=e.match(/^PHOTO;(BASE64|ENCODING=b;TYPE=image\/jpeg):(.*)$/m);return t?t[2]:void 0}}};e.exports=l},function(e,t,n){e.exports={"default":n(1024),__esModule:!0}},function(e,t,n){n(357),n(1027),e.exports=n(16).Array.from},function(e,t,n){n(362),n(357),e.exports=n(1025)},function(e,t,n){n(362),n(357),e.exports=n(1026)},function(e,t,n){n(1028),e.exports=n(16).Math.trunc},function(e,t,n){var r=n(50),i=n(361);e.exports=n(16).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,n){var r=n(167),i=n(24)("iterator"),o=n(65);e.exports=n(16).isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||o.hasOwnProperty(r(t))}},function(e,t,n){"use strict";var r=n(64),i=n(40),o=n(112),a=n(369),s=n(368),c=n(371),l=n(361);i(i.S+i.F*!n(370)(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,u,d=o(e),p="function"==typeof this?this:Array,h=arguments,f=h.length,m=f>1?h[1]:void 0,g=void 0!==m,v=0,y=l(d);if(g&&(m=r(m,f>2?h[2]:void 0,2)),void 0==y||p==Array&&s(y))for(t=c(d.length),n=new p(t);t>v;v++)n[v]=g?m(d[v],v):d[v];else for(u=y.call(d),n=new p;!(i=u.next()).done;v++)n[v]=g?a(u,m,[i.value,v],!0):i.value;return n.length=v,n}})},function(e,t,n){var r=n(40);r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},,,function(e,t){e.exports=[65,26,32,26,73,1,11,1,5,1,6,23,24,31,32,449,451,7,21,2,16,5,14,1,130,4,6,2,4,4,5,1,7,1,2,3,4,1,2,20,21,83,84,140,147,166,167,38,40,7,8,39,40,1,7,-1,46,-1,2,-1,3,-1,3,-1,2,-56,64,-1,3,-1,2,-1,14,-48,82,-3,4,-101,116,-2,9,-2,12,-23,24,-30,57,-91,102,-58,67,-2,6,-28,32,-1,10,-1,4,-1,6,-43,46,-135,167,55,56,1,2,4,12,4,5,3,10,10,12,29,30,2,3,8,10,2,4,22,23,7,8,1,4,4,7,4,10,2,4,2,3,1,9,1,5,2,3,3,7,12,14,7,15,1,2,6,10,2,4,22,23,7,8,2,3,2,3,2,6,3,27,4,5,1,8,10,12,3,17,1,2,9,10,3,4,22,23,7,8,2,3,5,8,4,12,1,2,2,5,1,16,2,6,11,19,1,9,2,3,8,10,2,4,22,23,7,8,2,3,5,8,2,3,1,7,2,4,2,12,1,5,2,3,3,7,18,29,1,2,6,9,3,4,4,7,2,3,1,2,2,5,2,5,3,6,12,16,2,3,2,5,3,4,3,6,1,7,1,15,13,27,3,4,8,9,3,4,23,24,16,19,1,4,4,23,3,8,2,6,10,25,1,3,2,3,8,9,3,4,23,24,10,11,5,8,8,9,3,4,2,11,2,9,1,2,2,6,10,11,2,17,2,3,8,9,3,4,41,43,4,9,3,4,3,4,1,9,1,8,3,7,16,19,7,9,2,3,18,21,24,25,9,10,1,3,7,15,3,9,8,14,10,12,3,15,48,49,2,14,7,15,13,50,2,3,1,3,2,3,1,3,1,7,4,5,7,8,3,4,1,2,1,3,2,3,4,5,2,11,1,3,5,6,1,10,10,12,4,36,24,26,27,28,1,2,1,6,10,11,36,54,1,6,1,3,5,54,8,9,6,7,13,50,45,49,1,7,1,3,2,4,25,27,4,7,16,20,13,14,2,4,6,7,15,16,40,41,1,6,1,3,377,378,4,6,7,8,1,2,4,6,41,42,4,6,33,34,4,6,7,8,1,2,4,6,15,16,57,58,4,6,67,72,29,32,16,32,86,88,6,9,639,640,26,31,89,96,13,14,4,18,18,21,2,11,18,32,13,14,3,18,52,54,1,8,8,9,2,13,7,8,1,4,10,48,10,16,88,96,41,42,1,6,70,80,31,35,4,6,3,7,2,3,6,19,40,42,5,16,44,48,26,32,11,48,23,25,2,5,56,57,1,10,1,2,2,10,6,19,10,16,10,16,14,100,48,49,1,6,1,2,5,6,9,13,27,36,9,14,32,36,2,4,1,4,56,57,1,3,3,4,1,4,2,10,48,56,2,7,15,18,51,115,8,19,1,14,1,8,4,5,6,7,2,11,192,256,278,280,6,8,38,40,6,8,8,9,1,2,1,2,1,2,31,33,53,54,7,8,1,4,3,4,7,10,4,6,6,10,13,18,3,4,7,24,1,1,-1,98,1,14,1,17,13,114,1,5,1,3,10,11,1,4,5,11,1,2,1,2,1,2,4,5,11,13,4,9,5,9,2,18,41,470,69,95,1,263,78,528,1,340,256,1024,47,48,47,48,133,139,4,7,2,14,38,39,1,6,1,3,56,63,2,17,23,32,7,8,7,8,7,8,7,8,7,8,7,8,7,8,7,557,3,28,9,13,2,3,5,7,5,9,86,92,3,4,90,91,4,9,41,44,94,95,43,96,45,48,48,64,28,31,50,65,12,16,47,48,119,123,99,101,31,32,6582,6656,20950,20992,1165,1232,317,320,28,48,47,64,30,32,80,82,6,48,102,103,37,39,8,71,11,12,3,4,4,5,25,27,1,9,8,16,52,64,68,78,12,36,12,14,38,46,25,36,2,13,30,36,48,49,2,6,2,3,17,18,11,15,7,8,25,26,41,47,2,4,2,13,3,4,8,9,1,3,10,12,32,33,51,52,1,4,2,4,5,7,1,2,1,25,17,19,8,19,6,8,6,8,6,15,7,8,7,8,54,64,117,118,2,3,4,7,10,16,11172,11184,23,27,49,2101,6766,6768,106,144,7,19,5,10,-1,2,-10,11,-532,534,-144,176,-13,14,-2,114,-143,177,26,32,26,37,89,92,6,8,6,8,6,8,3,38,12,13,26,27,19,20,2,3,15,17,14,48,123,128,1,2,1,5,45,48,9,153,45,176,29,32,49,96,36,48,27,32,38,48,30,31,37,41,14,56,158,160,10,96,40,48,52,63,1,145,311,320,22,32,8,160,-287,288,-225,228,-1,3,-5,9,-40,43,-4,5,-165,167,-82,89,-800,831,-385,385,1,2,54,69,7,31,10,28,49,53,2,4,7,21,25,32,10,19,36,41,1,10,14,26,35,36,3,14,52,61,11,14,1,3,16,17,20,31,18,19,28,31,2,3,1,3,6,72,7,8,1,2,4,5,15,16,11,17,47,48,3,16,10,18,2,3,8,10,2,4,22,23,7,8,2,3,5,8,3,4,4,6,2,4,3,5,1,7,1,6,7,291,51,57,1,2,4,6,1,3,4,12,10,176,50,56,4,6,1,3,27,63,51,59,2,3,1,3,4,15,10,48,43,44,1,2,2,8,1,10,10,64,26,32,2,6,1,10,16,368,83,95,1,449,57,1344,922,1024,111,112,5,16,196,2944,1071,5120,583,9216,569,576,31,32,10,14,2,98,30,37,1,11,48,55,15,25,10,11,7,8,21,26,19,899,69,80,47,67,13,16493,2,3072,107,112,13,16,9,16,10,12,1,3,1,4961,246,256,39,41,62,65,9,25,2,9,30,34,59,434,18,160,85,86,71,72,2,4,1,3,2,4,4,5,12,13,1,2,7,8,65,66,4,6,8,9,7,8,28,29,4,5,5,6,1,4,7,8,340,342,51,52,57,58,57,58,57,58,57,58,8,60,512,567,4,54,8,9,14,15,7,3451,-208,215,-1561,1563,-270,542,31,32,58,64,43,118,29,42,43,48,9,16,2,3504,42711,42752,4149,4160,222,224,5762,16352,542,788480,65534,65536,65534]},function(e,t,n){e.exports=function(){return n(797)('/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */\n!function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.oe=function(t){throw t},e.p="/",e(e.s=11)}([function(t,e,r){!function(r,n){t.exports=e=n()}(this,function(){var t=t||function(t,e){var r={},n=r.lib={},i=n.Base=function(){function t(){}return{extend:function(e){t.prototype=this;var r=new t;return e&&r.mixIn(e),r.hasOwnProperty("init")||(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),o=n.WordArray=i.extend({init:function(t,r){t=this.words=t||[],r!=e?this.sigBytes=r:this.sigBytes=4*t.length},toString:function(t){return(t||a).stringify(this)},concat:function(t){var e=this.words,r=t.words,n=this.sigBytes,i=t.sigBytes;if(this.clamp(),n%4)for(var o=0;i>o;o++){var f=r[o>>>2]>>>24-o%4*8&255;e[n+o>>>2]|=f<<24-(n+o)%4*8}else for(var o=0;i>o;o+=4)e[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var r,n=[],i=function(e){var e=e,r=987654321,n=4294967295;return function(){r=36969*(65535&r)+(r>>16)&n,e=18e3*(65535&e)+(e>>16)&n;var i=(r<<16)+e&n;return i/=4294967296,i+=.5,i*(t.random()>.5?1:-1)}},f=0;e>f;f+=4){var a=i(4294967296*(r||t.random()));r=987654071*a(),n.push(4294967296*a()|0)}return new o.init(n,e)}}),f=r.enc={},a=f.Hex={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;r>i;i++){var o=e[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;e>n;n+=2)r[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new o.init(r,e/2)}},u=f.Latin1={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;r>i;i++){var o=e[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;e>n;n++)r[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new o.init(r,e)}},s=f.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},h=n.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=s.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r=this._data,n=r.words,i=r.sigBytes,f=this.blockSize,a=4*f,u=i/a;u=e?t.ceil(u):t.max((0|u)-this._minBufferSize,0);var s=u*f,h=t.min(4*s,i);if(s){for(var l=0;s>l;l+=f)this._doProcessBlock(n,l);var c=n.splice(0,s);r.sigBytes-=h}return new o.init(c,h)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),l=(n.Hasher=h.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var e=this._doFinalize();return e},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new l.HMAC.init(t,r).finalize(e)}}}),r.algo={});return r}(Math);return t})},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e,r){!function(n,i){t.exports=e=i(r(0))}(this,function(t){return function(){var e=t,r=e.lib,n=r.WordArray,i=e.enc;i.Base64={stringify:function(t){var e=t.words,r=t.sigBytes,n=this._map;t.clamp();for(var i=[],o=0;r>o;o+=3)for(var f=e[o>>>2]>>>24-o%4*8&255,a=e[o+1>>>2]>>>24-(o+1)%4*8&255,u=e[o+2>>>2]>>>24-(o+2)%4*8&255,s=f<<16|a<<8|u,h=0;4>h&&r>o+.75*h;h++)i.push(n.charAt(s>>>6*(3-h)&63));var l=n.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(t){var e=t.length,r=this._map,i=r.charAt(64);if(i){var o=t.indexOf(i);-1!=o&&(e=o)}for(var f=[],a=0,u=0;e>u;u++)if(u%4){var s=r.indexOf(t.charAt(u-1))<<u%4*2,h=r.indexOf(t.charAt(u))>>>6-u%4*2,l=s|h;f[a>>>2]|=l<<24-a%4*8,a++}return n.create(f,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),t.enc.Base64})},function(t,e){"use strict";function r(t){"string"==typeof t?t=t.split(""):"undefined"==typeof t.length&&(t=new Uint8Array(t));for(var e=Math.ceil(4*t.length/3),r=4*Math.ceil(t.length/3),n=new Array(r),i=0,o=0;r>i;i+=4,o+=3){var f=t[o]<<16|t[o+1]<<8|t[o+2];n[i]=f>>18,n[i+1]=f>>12&63,n[i+2]=f>>6&63,n[i+3]=63&f}for(var a=0;e>a;a++){var u=n[a];if(0>u||u>=64)return null;26>u?n[a]=65+u:52>u?n[a]=71+u:62>u?n[a]=u-4:62===u?n[a]=43:n[a]=47}for(var s=e;r>s;s++)n[s]=61;return String.fromCharCode.apply(String,n)}function n(t,e){for(var r=t.length,n=new Int32Array(r+r%4),i=0;r>i;i++){var o=t.charCodeAt(i);if(o>=65&&90>=o)n[i]=o-65;else if(o>=97&&122>=o)n[i]=o-71;else if(o>=48&&57>=o)n[i]=o+4;else if(43===o)n[i]=62;else{if(47!==o){if(61===o){r=i;break}return null}n[i]=63}}for(var f=n.length/4,a=0,u=0;f>a;a++,u+=4)n[a]=n[u]<<18|n[u+1]<<12|n[u+2]<<6|n[u+3];for(var s=Math.floor(3*r/4),h=new Uint8Array(s),l=0,c=0;s>=c+3;l++,c+=3){var p=n[l];h[c]=p>>16,h[c+1]=p>>8&255,h[c+2]=255&p}switch(s-c){case 2:h[c]=n[l]>>16,h[c+1]=n[l]>>8&255;break;case 1:h[c]=n[l]>>16}return e?Array.prototype.slice.call(h):h}function i(t){return t.replace(/\\+/g,"-").replace(/\\//g,"_")}t.exports={encode:r,decode:n,urlSafe:i}},function(t,e,r){!function(n,i){t.exports=e=i(r(0))}(this,function(t){!function(){var e=t,r=e.lib,n=r.Base,i=e.enc,o=i.Utf8,f=e.algo;f.HMAC=n.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=o.parse(e));var r=t.blockSize,n=4*r;e.sigBytes>n&&(e=t.finalize(e)),e.clamp();for(var i=this._oKey=e.clone(),f=this._iKey=e.clone(),a=i.words,u=f.words,s=0;r>s;s++)a[s]^=1549556828,u[s]^=909522486;i.sigBytes=f.sigBytes=n,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,r=e.finalize(t);e.reset();var n=e.finalize(this._oKey.clone().concat(r));return n}})}()})},function(t,e,r){var n,i,o;(function(t){/**\r\n	 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>\r\n	 * Released under the Apache License, Version 2.0\r\n	 * see: https://github.com/dcodeIO/long.js for details\r\n	 */\n!function(f,a){r(6).amd?(i=[],n=a,o="function"==typeof n?n.apply(e,i):n,!(void 0!==o&&(t.exports=o))):"object"==typeof t&&t&&t.exports?t.exports=a():(f.dcodeIO=f.dcodeIO||{}).Long=a()}(this,function(){"use strict";function t(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function e(t){return(t&&t.__isLong__)===!0}function r(t,e){var r,n,o;return e?(t>>>=0,(o=t>=0&&256>t)&&(n=u[t])?n:(r=i(t,0>(0|t)?-1:0,!0),o&&(u[t]=r),r)):(t|=0,(o=t>=-128&&128>t)&&(n=a[t])?n:(r=i(t,0>t?-1:0,!1),o&&(a[t]=r),r))}function n(t,e){if(isNaN(t)||!isFinite(t))return e?d:v;if(e){if(0>t)return d;if(t>=c)return _}else{if(-p>=t)return E;if(t+1>=p)return b}return 0>t?n(-t,e).neg():i(t%l|0,t/l|0,e)}function i(e,r,n){return new t(e,r,n)}function o(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return v;if("number"==typeof e?(r=e,e=!1):e=!!e,r=r||10,2>r||r>36)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return o(t.substring(1),e,r).neg();for(var f=n(s(r,8)),a=v,u=0;u<t.length;u+=8){var h=Math.min(8,t.length-u),l=parseInt(t.substring(u,u+h),r);if(8>h){var c=n(s(r,h));a=a.mul(c).add(n(l))}else a=a.mul(f),a=a.add(n(l))}return a.unsigned=e,a}function f(e){return e instanceof t?e:"number"==typeof e?n(e):"string"==typeof e?o(e):i(e.low,e.high,e.unsigned)}t.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var a={},u={};t.fromInt=r,t.fromNumber=n,t.fromBits=i;var s=Math.pow;t.fromString=o,t.fromValue=f;var h=1<<24,l=4294967296,c=0x10000000000000000,p=c/2,g=r(h),v=r(0);t.ZERO=v;var d=r(0,!0);t.UZERO=d;var y=r(1);t.ONE=y;var w=r(1,!0);t.UONE=w;var m=r(-1);t.NEG_ONE=m;var b=i(-1,2147483647,!1);t.MAX_VALUE=b;var _=i(-1,-1,!0);t.MAX_UNSIGNED_VALUE=_;var E=i(0,-2147483648,!1);t.MIN_VALUE=E;var x=t.prototype;return x.toInt=function(){return this.unsigned?this.low>>>0:this.low},x.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},x.toString=function(t){if(t=t||10,2>t||t>36)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(E)){var e=n(t),r=this.div(e),i=r.mul(e).sub(this);return r.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var o=n(s(t,6),this.unsigned),f=this,a="";;){var u=f.div(o),h=f.sub(u.mul(o)).toInt()>>>0,l=h.toString(t);if(f=u,f.isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},x.getHighBits=function(){return this.high},x.getHighBitsUnsigned=function(){return this.high>>>0},x.getLowBits=function(){return this.low},x.getLowBitsUnsigned=function(){return this.low>>>0},x.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},x.isZero=function(){return 0===this.high&&0===this.low},x.isNegative=function(){return!this.unsigned&&this.high<0},x.isPositive=function(){return this.unsigned||this.high>=0},x.isOdd=function(){return 1===(1&this.low)},x.isEven=function(){return 0===(1&this.low)},x.equals=function(t){return e(t)||(t=f(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},x.eq=x.equals,x.notEquals=function(t){return!this.eq(t)},x.neq=x.notEquals,x.lessThan=function(t){return this.comp(t)<0},x.lt=x.lessThan,x.lessThanOrEqual=function(t){return this.comp(t)<=0},x.lte=x.lessThanOrEqual,x.greaterThan=function(t){return this.comp(t)>0},x.gt=x.greaterThan,x.greaterThanOrEqual=function(t){return this.comp(t)>=0},x.gte=x.greaterThanOrEqual,x.compare=function(t){if(e(t)||(t=f(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},x.comp=x.compare,x.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(y)},x.neg=x.negate,x.add=function(t){e(t)||(t=f(t));var r=this.high>>>16,n=65535&this.high,o=this.low>>>16,a=65535&this.low,u=t.high>>>16,s=65535&t.high,h=t.low>>>16,l=65535&t.low,c=0,p=0,g=0,v=0;return v+=a+l,g+=v>>>16,v&=65535,g+=o+h,p+=g>>>16,g&=65535,p+=n+s,c+=p>>>16,p&=65535,c+=r+u,c&=65535,i(g<<16|v,c<<16|p,this.unsigned)},x.subtract=function(t){return e(t)||(t=f(t)),this.add(t.neg())},x.sub=x.subtract,x.multiply=function(t){if(this.isZero())return v;if(e(t)||(t=f(t)),t.isZero())return v;if(this.eq(E))return t.isOdd()?E:v;if(t.eq(E))return this.isOdd()?E:v;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(g)&&t.lt(g))return n(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,o=65535&this.high,a=this.low>>>16,u=65535&this.low,s=t.high>>>16,h=65535&t.high,l=t.low>>>16,c=65535&t.low,p=0,d=0,y=0,w=0;return w+=u*c,y+=w>>>16,w&=65535,y+=a*c,d+=y>>>16,y&=65535,y+=u*l,d+=y>>>16,y&=65535,d+=o*c,p+=d>>>16,d&=65535,d+=a*l,p+=d>>>16,d&=65535,d+=u*h,p+=d>>>16,d&=65535,p+=r*c+o*l+a*h+u*s,p&=65535,i(y<<16|w,p<<16|d,this.unsigned)},x.mul=x.multiply,x.divide=function(t){if(e(t)||(t=f(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?d:v;var r,i,o;if(this.unsigned)t.unsigned||(t=t.toUnsigned());else{if(this.eq(E)){if(t.eq(y)||t.eq(m))return E;if(t.eq(E))return y;var a=this.shr(1);return r=a.div(t).shl(1),r.eq(v)?t.isNegative()?y:m:(i=this.sub(t.mul(r)),o=r.add(i.div(t)))}if(t.eq(E))return this.unsigned?d:v;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg()}if(this.unsigned){if(t.gt(this))return d;if(t.gt(this.shru(1)))return w;o=d}else o=v;for(i=this;i.gte(t);){r=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var u=Math.ceil(Math.log(r)/Math.LN2),h=48>=u?1:s(2,u-48),l=n(r),c=l.mul(t);c.isNegative()||c.gt(i);)r-=h,l=n(r,this.unsigned),c=l.mul(t);l.isZero()&&(l=y),o=o.add(l),i=i.sub(c)}return o},x.div=x.divide,x.modulo=function(t){return e(t)||(t=f(t)),this.sub(this.div(t).mul(t))},x.mod=x.modulo,x.not=function(){return i(~this.low,~this.high,this.unsigned)},x.and=function(t){return e(t)||(t=f(t)),i(this.low&t.low,this.high&t.high,this.unsigned)},x.or=function(t){return e(t)||(t=f(t)),i(this.low|t.low,this.high|t.high,this.unsigned)},x.xor=function(t){return e(t)||(t=f(t)),i(this.low^t.low,this.high^t.high,this.unsigned)},x.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0===(t&=63)?this:32>t?i(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):i(0,this.low<<t-32,this.unsigned)},x.shl=x.shiftLeft,x.shiftRight=function(t){return e(t)&&(t=t.toInt()),0===(t&=63)?this:32>t?i(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):i(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},x.shr=x.shiftRight,x.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),t&=63,0===t)return this;var r=this.high;if(32>t){var n=this.low;return i(n>>>t|r<<32-t,r>>>t,this.unsigned)}return 32===t?i(r,0,this.unsigned):i(r>>>t-32,0,this.unsigned)},x.shru=x.shiftRightUnsigned,x.toSigned=function(){return this.unsigned?i(this.low,this.high,!1):this},x.toUnsigned=function(){return this.unsigned?this:i(this.low,this.high,!0)},t})}).call(e,r(1)(t))},function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e,r){"use strict";function n(t){return CryptoJS.lib.WordArray.create(new Uint8Array(t))}var i=r(16),o=r(12),f=r(13),a=r(3),u=r(26),s={image:"WhatsApp Image Keys",video:"WhatsApp Video Keys",audio:"WhatsApp Audio Keys",ptt:"WhatsApp Audio Keys",document:"WhatsApp Document Keys"},h={decryptE2EMedia:function(t,e,r,f){try{if(e.length<10)throw new o.MediaEncryptionError("ciphertext too short: "+e.length);var a=this.computeKeys(t,r),s=a.iv,h=a.cipherKey,l=a.macKey,c=i.wrap(e),p=c.slice(c.limit-10).toBase64(),g=c.slice(c.offset,c.limit-10).toBuffer(),v=i.concat([new Uint8Array(s),g]).toBuffer(),d=CryptoJS.lib.WordArray.create(v),y=CryptoJS.HmacSHA256(d,n(l)).toString(CryptoJS.enc.Base64),w=i.fromBase64(y).slice(0,10).toBase64();if(!w||!p||w!==p)throw new o.MediaEncryptionError("hmac fail computed: "+y+" given: "+p);var m=CryptoJS.AES.decrypt({ciphertext:CryptoJS.lib.WordArray.create(g),salt:void 0},n(h),{iv:n(s),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),b=i.fromBase64(m.toString(CryptoJS.enc.Base64)).toBuffer();if(!f){var _=u(new Uint8Array(b,0,Math.min(262,b.byteLength)));if(_)f=_.mime;else{if("image"!==t)throw new o.MediaEncryptionError("unknown mime decrypt error for type:"+t);f="image/jpeg"}}return new Blob([b],{type:f})}catch(E){throw E instanceof o.MediaEncryptionError?E:new o.MediaEncryptionError("unknown decrypt error: "+E+" stack: "+E.stack)}},encryptE2EMedia:function(t,e,r){try{var f=this.computeKeys(t,r),a=f.iv,u=f.cipherKey,s=f.macKey,h=CryptoJS.AES.encrypt(CryptoJS.lib.WordArray.create(e),n(u),{iv:n(a),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),l=h.iv.concat(h.ciphertext),c=CryptoJS.HmacSHA256(l,n(s));c.sigBytes=10,c.clamp();var p=h.ciphertext.concat(c),g=i.fromBase64(p.toString(CryptoJS.enc.Base64)).toBuffer();return new Blob([g])}catch(v){throw v instanceof o.MediaEncryptionError?v:new o.MediaEncryptionError("unknown encrypt error: "+v+" stack: "+v.stack)}},computeKeys:function(t,e){var r=s[t];if(!e||!r)throw new o.MediaEncryptionError("computeKeys fail: !!mediakey: "+!!e+" info: "+r+" type: "+t);var n=f.extractAndExpand(a.decode(e),void 0,r,112,!0);if(!n||n.length<112)throw new o.MediaEncryptionError("computeKeys:hkdf error");return{iv:n.slice(0,16),cipherKey:n.slice(16,48),macKey:n.slice(48,80),refKey:n.slice(80,112)}}};t.exports=h},function(t,e,r){!function(n,i,o){t.exports=e=i(r(0),r(2),r(23),r(22),r(21))}(this,function(t){return function(){var e=t,r=e.lib,n=r.BlockCipher,i=e.algo,o=[],f=[],a=[],u=[],s=[],h=[],l=[],c=[],p=[],g=[];!function(){for(var t=[],e=0;256>e;e++)128>e?t[e]=e<<1:t[e]=e<<1^283;for(var r=0,n=0,e=0;256>e;e++){var i=n^n<<1^n<<2^n<<3^n<<4;i=i>>>8^255&i^99,o[r]=i,f[i]=r;var v=t[r],d=t[v],y=t[d],w=257*t[i]^16843008*i;a[r]=w<<24|w>>>8,u[r]=w<<16|w>>>16,s[r]=w<<8|w>>>24,h[r]=w;var w=16843009*y^65537*d^257*v^16843008*r;l[i]=w<<24|w>>>8,c[i]=w<<16|w>>>16,p[i]=w<<8|w>>>24,g[i]=w,r?(r=v^t[t[t[y^v]]],n^=t[t[n]]):r=n=1}}();var v=[0,1,2,4,8,16,32,64,128,27,54],d=i.AES=n.extend({_doReset:function(){for(var t=this._key,e=t.words,r=t.sigBytes/4,n=this._nRounds=r+6,i=4*(n+1),f=this._keySchedule=[],a=0;i>a;a++)if(r>a)f[a]=e[a];else{var u=f[a-1];a%r?r>6&&a%r==4&&(u=o[u>>>24]<<24|o[u>>>16&255]<<16|o[u>>>8&255]<<8|o[255&u]):(u=u<<8|u>>>24,u=o[u>>>24]<<24|o[u>>>16&255]<<16|o[u>>>8&255]<<8|o[255&u],u^=v[a/r|0]<<24),f[a]=f[a-r]^u}for(var s=this._invKeySchedule=[],h=0;i>h;h++){var a=i-h;if(h%4)var u=f[a];else var u=f[a-4];4>h||4>=a?s[h]=u:s[h]=l[o[u>>>24]]^c[o[u>>>16&255]]^p[o[u>>>8&255]]^g[o[255&u]]}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,a,u,s,h,o)},decryptBlock:function(t,e){var r=t[e+1];t[e+1]=t[e+3],t[e+3]=r,this._doCryptBlock(t,e,this._invKeySchedule,l,c,p,g,f);var r=t[e+1];t[e+1]=t[e+3],t[e+3]=r},_doCryptBlock:function(t,e,r,n,i,o,f,a){for(var u=this._nRounds,s=t[e]^r[0],h=t[e+1]^r[1],l=t[e+2]^r[2],c=t[e+3]^r[3],p=4,g=1;u>g;g++){var v=n[s>>>24]^i[h>>>16&255]^o[l>>>8&255]^f[255&c]^r[p++],d=n[h>>>24]^i[l>>>16&255]^o[c>>>8&255]^f[255&s]^r[p++],y=n[l>>>24]^i[c>>>16&255]^o[s>>>8&255]^f[255&h]^r[p++],w=n[c>>>24]^i[s>>>16&255]^o[h>>>8&255]^f[255&l]^r[p++];s=v,h=d,l=y,c=w}var v=(a[s>>>24]<<24|a[h>>>16&255]<<16|a[l>>>8&255]<<8|a[255&c])^r[p++],d=(a[h>>>24]<<24|a[l>>>16&255]<<16|a[c>>>8&255]<<8|a[255&s])^r[p++],y=(a[l>>>24]<<24|a[c>>>16&255]<<16|a[s>>>8&255]<<8|a[255&h])^r[p++],w=(a[c>>>24]<<24|a[s>>>16&255]<<16|a[h>>>8&255]<<8|a[255&l])^r[p++];t[e]=v,t[e+1]=d,t[e+2]=y,t[e+3]=w},keySize:8});e.AES=n._createHelper(d)}(),t.AES})},function(t,e,r){!function(n,i,o){t.exports=e=i(r(0),r(25),r(4))}(this,function(t){return t.HmacSHA256})},function(t,e,r){!function(n,i){t.exports=e=i(r(0))}(this,function(t){return function(){if("function"==typeof ArrayBuffer){var e=t,r=e.lib,n=r.WordArray,i=n.init,o=n.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var e=t.byteLength,r=[],n=0;e>n;n++)r[n>>>2]|=t[n]<<24-n%4*8;i.call(this,r,e)}else i.apply(this,arguments)};o.prototype=n}}(),t.lib.WordArray})},function(t,e,r){"use strict";function n(t){var e=t.data,r=e.type,n=e.buffer,i=e.mediaKey,f=e.mimetype;postMessage(o.decryptE2EMedia(r,n,i,f))}function i(t){var e=t.data,r=e.type,n=e.buffer,i=e.mediaKey;postMessage(o.encryptE2EMedia(r,n,i))}self.CryptoJS=r(0),r(10),r(2),r(9),r(8);var o=r(7);self.onmessage=function(t){switch(t.data.command){case"decrypt-e2e-media":n(t);break;case"encrypt-e2e-media":i(t);break;default:throw new Error("unknown crypto worker command: "+t.data.command)}}},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e,r,n){function i(t){l.isFunction(e)?this.message=e.apply(this,arguments):arguments.length>0?this.message=""+t:e?this.message=e:this.message=this.name;var r=this.message!==this.name?this.name+": "+this.message:this.name,i=new Error(r).stack;if(!i)try{throw new Error(r)}catch(o){i=o.stack,i||(i="Error: "+r+"\\n    at (unspecified)")}this.stack=i,l.isFunction(n)&&n.apply(this,l.rest(arguments))}return r=r||Error,i.prototype=(0,h["default"])(r.prototype),i.prototype.name=t,i}function o(t,e){return l.reduce(t,function(t,r,n){var o,f;return l.isString(n)?(o=n,f=r):o=r,t[o]=i(o,f,e),t},{})}function f(t){this.event=t;try{return(0,u["default"])(t)}catch(e){return""+t}}var a=r(14),u=n(a),s=r(15),h=n(s),l=r(27),c=i("WAPStatusCode"),p=i("401",null,c),g=i("404",null,c),v=i("500",null,c),d=i("WapDrop"),y=i("EphemeralDrop",null,d),w=i("LogoutDrop",null,d),m=i("Server5xxDrop",null,d),b=i("ConventionViolationDrop",null,d),_=i("BrowserReplacedDrop",null,d),E=i("ShouldLoop"),x=i("GaveUpRetry"),A=i("GUMError"),I=o({NotSupportedError:"The operation is not supported.",PermissionDeniedError:"The user did not grant permission for the operation",ConstraintNotSatisfiedError:"One of the mandatory Constraints could not be satisfied.",OverconstrainedError:"Due to changes in the environment, one or more mandatory constraints can no longer be satisfied.",NotFoundError:"The object can not be found here.",AbortError:"The operation was aborted.",SourceUnavailableError:"The source of the MediaStream could not be accessed due to a hardware error (e.g. lock from another process)."},A),T=i("MediaNeedsReupload"),S=i("MediaFileError"),L=i("InvalidMediaFileType",null,S),U=i("MediaFileTooLarge",function(t){return this.file=t,"File ("+t.type+") size = "+t.size},S),k=i("MediaEncryptionError",null,S),B=i("ImageError","Image failed to load.",null,function(t){this.src=t,this.target={src:t}}),R=i("ContactBlocked","Contact is blocked",null,function(t){this.contact=t}),C=i("CapabilityError"),N=i("CapabilityUnsupported",null,C,function(t){this.jidCapabilities=t}),O=i("CapabilityInvalid",null,C),F=i("CapabilityUnknown",null,C),M=i("MediaMissing","Media is no longer available on your phone"),z=i("MediaLoadError",null,null,function(t){this.src=t}),D=i("MediaDragDropError",null,z,function(t){this.src=t}),j=i("SocketError",f),H=i("SocketClosed",f),P=i("SocketNotOpen",function(t){return"socket not open, is "+t}),W=i("BlockedByProxy");t.exports={define:i,defineAll:o,QueryDrop:i("QueryDrop"),WapDrop:d,EphemeralDrop:y,LogoutDrop:w,Server5xxDrop:m,ConventionViolationDrop:b,BrowserReplacedDrop:_,ShouldLoop:E,GaveUpRetry:x,MediaFileError:S,InvalidMediaFileType:L,MediaFileTooLarge:U,MediaEncryptionError:k,WAPStatusCode:c,E401:p,E404:g,E500:v,SocketError:j,SocketClosed:H,SocketNotOpen:P,BlockedByProxy:W,ImageError:B,ContactBlocked:R,MediaNeedsReupload:T,MediaMissing:M,MediaLoadError:z,MediaDragDropError:D,CapabilityError:C,CapabilityUnsupported:N,CapabilityInvalid:O,CapabilityUnknown:F,CanNotSendUnencrypted:i("CanNotSendUnencrypted"),ActionError:i("ActionError","Could not perform action."),GUM:l.defaults(I,{GUMError:A,PERMISSION_DENIED:I.PermissionDeniedError,NOT_SUPPORTED_ERROR:I.ConstraintNotSatisfiedError,MANDATORY_UNSATISFIED_ERROR:I.NotFoundError}),Unmount:i("unmount")}},function(t,e,r){"use strict";function n(t){return"string"==typeof t?t:CryptoJS.lib.WordArray.create(new Uint8Array(t))}function i(t,e){return u.decode(t.toString(CryptoJS.enc.Base64),!!e)}function o(t){var e=arguments.length<=1||void 0===arguments[1]?new Uint8Array(s):arguments[1],r=arguments[2];return i(CryptoJS.HmacSHA256(n(t),n(e)),r)}function f(t,e,r,o){if(0>r||r>255*s)return null;var f=n(t),a=n(e),u=Math.ceil(r/s),h=new Array(u+1);h[0]="";for(var l=new Uint8Array(1),c=0;u>c;c++){l[0]=c+1;var p=CryptoJS.algo.HMAC.create(CryptoJS.algo.SHA256,f);p.update(h[c]),p.update(a),p.update(n(l)),h[c+1]=p.finalize()}for(var g=new Uint8Array(r),v=0,d=0;u>v;v++)for(var y=i(h[v+1]),w=0;s>w&&r>d;w++,d++)g[d]=y[w];return o?Array.prototype.slice.call(g):g}function a(t,e,r,n,i){return f(o(t,e),r,n,i)}var u=r(3),s=32;t.exports={extract:o,expand:f,extractAndExpand:a}},function(t,e,r){t.exports={"default":r(17),__esModule:!0}},function(t,e,r){t.exports={"default":r(18),__esModule:!0}},function(t,e,r){var n,i,o;(function(t){/**\r\n	 * @license bytebuffer.js (c) 2015 Daniel Wirtz <dcode@dcode.io>\r\n	 * Backing buffer: ArrayBuffer, Accessor: Uint8Array\r\n	 * Released under the Apache License, Version 2.0\r\n	 * see: https://github.com/dcodeIO/bytebuffer.js for details\r\n	 */\n!function(f,a){r(6).amd?(i=[r(5)],n=a,o="function"==typeof n?n.apply(e,i):n,!(void 0!==o&&(t.exports=o))):"object"==typeof t&&t&&t.exports?t.exports=function(){var t;try{t=r(5)}catch(e){}return a(t)}():(f.dcodeIO=f.dcodeIO||{}).ByteBuffer=a(f.dcodeIO.Long)}(this,function(t){"use strict";function e(t){var e=0;return function(){return e<t.length?t.charCodeAt(e++):null}}function r(){var t=[],e=[];return function(){return 0===arguments.length?e.join("")+u.apply(String,t):(t.length+arguments.length>1024&&(e.push(u.apply(String,t)),t.length=0),void Array.prototype.push.apply(t,arguments))}}function n(t,e,r,n,i){var o,f,a=8*i-n-1,u=(1<<a)-1,s=u>>1,h=-7,l=r?i-1:0,c=r?-1:1,p=t[e+l];for(l+=c,o=p&(1<<-h)-1,p>>=-h,h+=a;h>0;o=256*o+t[e+l],l+=c,h-=8);for(f=o&(1<<-h)-1,o>>=-h,h+=n;h>0;f=256*f+t[e+l],l+=c,h-=8);if(0===o)o=1-s;else{if(o===u)return f?NaN:(p?-1:1)*(1/0);f+=Math.pow(2,n),o-=s}return(p?-1:1)*f*Math.pow(2,o-n)}function i(t,e,r,n,i,o){var f,a,u,s=8*o-i-1,h=(1<<s)-1,l=h>>1,c=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,g=n?1:-1,v=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,f=h):(f=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-f))<1&&(f--,u*=2),e+=f+l>=1?c/u:c*Math.pow(2,1-l),e*u>=2&&(f++,u/=2),f+l>=h?(a=0,f=h):f+l>=1?(a=(e*u-1)*Math.pow(2,i),f+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,i),f=0));i>=8;t[r+p]=255&a,p+=g,a/=256,i-=8);for(f=f<<i|a,s+=i;s>0;t[r+p]=255&f,p+=g,f/=256,s-=8);t[r+p-g]|=128*v}var o=function(t,e,r){if("undefined"==typeof t&&(t=o.DEFAULT_CAPACITY),"undefined"==typeof e&&(e=o.DEFAULT_ENDIAN),"undefined"==typeof r&&(r=o.DEFAULT_NOASSERT),!r){if(t=0|t,0>t)throw RangeError("Illegal capacity");e=!!e,r=!!r}this.buffer=0===t?a:new ArrayBuffer(t),this.view=0===t?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=t,this.littleEndian=e,this.noAssert=r};o.VERSION="5.0.1",o.LITTLE_ENDIAN=!0,o.BIG_ENDIAN=!1,o.DEFAULT_CAPACITY=16,o.DEFAULT_ENDIAN=o.BIG_ENDIAN,o.DEFAULT_NOASSERT=!1,o.Long=t||null;var f=o.prototype;f.__isByteBuffer__,Object.defineProperty(f,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var a=new ArrayBuffer(0),u=String.fromCharCode;o.accessor=function(){return Uint8Array},o.allocate=function(t,e,r){return new o(t,e,r)},o.concat=function(t,e,r,n){"boolean"!=typeof e&&"string"==typeof e||(n=r,r=e,e=void 0);for(var i,f=0,a=0,u=t.length;u>a;++a)o.isByteBuffer(t[a])||(t[a]=o.wrap(t[a],e)),i=t[a].limit-t[a].offset,i>0&&(f+=i);if(0===f)return new o(0,r,n);var s,h=new o(f,r,n);for(a=0;u>a;)s=t[a++],i=s.limit-s.offset,0>=i||(h.view.set(s.view.subarray(s.offset,s.limit),h.offset),h.offset+=i);return h.limit=h.offset,h.offset=0,h},o.isByteBuffer=function(t){return(t&&t.__isByteBuffer__)===!0},o.type=function(){return ArrayBuffer},o.wrap=function(t,e,r,n){if("string"!=typeof e&&(n=r,r=e,e=void 0),"string"==typeof t)switch("undefined"==typeof e&&(e="utf8"),e){case"base64":return o.fromBase64(t,r);case"hex":return o.fromHex(t,r);case"binary":return o.fromBinary(t,r);case"utf8":return o.fromUTF8(t,r);case"debug":return o.fromDebug(t,r);default:throw Error("Unsupported encoding: "+e)}if(null===t||"object"!=typeof t)throw TypeError("Illegal buffer");var i;if(o.isByteBuffer(t))return i=f.clone.call(t),i.markedOffset=-1,i;if(t instanceof Uint8Array)i=new o(0,r,n),t.length>0&&(i.buffer=t.buffer,i.offset=t.byteOffset,i.limit=t.byteOffset+t.byteLength,i.view=new Uint8Array(t.buffer));else if(t instanceof ArrayBuffer)i=new o(0,r,n),t.byteLength>0&&(i.buffer=t,i.offset=0,i.limit=t.byteLength,i.view=t.byteLength>0?new Uint8Array(t):null);else{if("[object Array]"!==Object.prototype.toString.call(t))throw TypeError("Illegal buffer");i=new o(t.length,r,n),i.limit=t.length;for(var a=0;a<t.length;++a)i.view[a]=t[a]}return i},f.writeBitSet=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if(!(t instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var n,i=e,o=t.length,f=o>>3,a=0;for(e+=this.writeVarint32(o,e);f--;)n=1&!!t[a++]|(1&!!t[a++])<<1|(1&!!t[a++])<<2|(1&!!t[a++])<<3|(1&!!t[a++])<<4|(1&!!t[a++])<<5|(1&!!t[a++])<<6|(1&!!t[a++])<<7,this.writeByte(n,e++);if(o>a){var u=0;for(n=0;o>a;)n|=(1&!!t[a++])<<u++;this.writeByte(n,e++)}return r?(this.offset=e,this):e-i},f.readBitSet=function(t){var e="undefined"==typeof t;e&&(t=this.offset);var r,n=this.readVarint32(t),i=n.value,o=i>>3,f=0,a=[];for(t+=n.length;o--;)r=this.readByte(t++),a[f++]=!!(1&r),a[f++]=!!(2&r),a[f++]=!!(4&r),a[f++]=!!(8&r),a[f++]=!!(16&r),a[f++]=!!(32&r),a[f++]=!!(64&r),a[f++]=!!(128&r);if(i>f){var u=0;for(r=this.readByte(t++);i>f;)a[f++]=!!(r>>u++&1)}return e&&(this.offset=t),a},f.readBytes=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+"+t+") <= "+this.buffer.byteLength)}var n=this.slice(e,e+t);return r&&(this.offset+=t),n},f.writeBytes=f.append,f.writeInt8=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=1,this.view[e]=t,r&&(this.offset+=1),this},f.writeByte=f.writeInt8,f.readInt8=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=this.view[t];return 128===(128&r)&&(r=-(255-r+1)),e&&(this.offset+=1),r},f.readByte=f.readInt8,f.writeUint8=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=1,this.view[e]=t,r&&(this.offset+=1),this},f.writeUInt8=f.writeUint8,f.readUint8=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=this.view[t];return e&&(this.offset+=1),r},f.readUInt8=f.readUint8,f.writeInt16=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),r&&(this.offset+=2),this},f.writeShort=f.writeInt16,f.readInt16=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t],r|=this.view[t+1]<<8):(r=this.view[t]<<8,r|=this.view[t+1]),32768===(32768&r)&&(r=-(65535-r+1)),e&&(this.offset+=2),r},f.readShort=f.readInt16,f.writeUint16=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),r&&(this.offset+=2),this},f.writeUInt16=f.writeUint16,f.readUint16=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t],r|=this.view[t+1]<<8):(r=this.view[t]<<8,r|=this.view[t+1]),e&&(this.offset+=2),r},f.readUInt16=f.readUint16,f.writeInt32=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),r&&(this.offset+=4),this},f.writeInt=f.writeInt32,f.readInt32=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0),r|=0,e&&(this.offset+=4),r},f.readInt=f.readInt32,f.writeUint32=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),r&&(this.offset+=4),this},f.writeUInt32=f.writeUint32,f.readUint32=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0),e&&(this.offset+=4),r},f.readUInt32=f.readUint32,t&&(f.writeInt64=function(e,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof r||r%1!==0)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),r+=8;var i=this.buffer.byteLength;r>i&&this.resize((i*=2)>r?i:r),r-=8;var o=e.low,f=e.high;return this.littleEndian?(this.view[r+3]=o>>>24&255,this.view[r+2]=o>>>16&255,this.view[r+1]=o>>>8&255,this.view[r]=255&o,r+=4,this.view[r+3]=f>>>24&255,this.view[r+2]=f>>>16&255,this.view[r+1]=f>>>8&255,this.view[r]=255&f):(this.view[r]=f>>>24&255,this.view[r+1]=f>>>16&255,this.view[r+2]=f>>>8&255,this.view[r+3]=255&f,r+=4,this.view[r]=o>>>24&255,this.view[r+1]=o>>>16&255,this.view[r+2]=o>>>8&255,this.view[r+3]=255&o),n&&(this.offset+=8),this},f.writeLong=f.writeInt64,f.readInt64=function(e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var n=0,i=0;this.littleEndian?(n=this.view[e+2]<<16,n|=this.view[e+1]<<8,n|=this.view[e],n+=this.view[e+3]<<24>>>0,e+=4,i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0,e+=4,n=this.view[e+1]<<16,n|=this.view[e+2]<<8,n|=this.view[e+3],n+=this.view[e]<<24>>>0);var o=new t(n,i,!1);return r&&(this.offset+=8),o},f.readLong=f.readInt64,f.writeUint64=function(e,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof r||r%1!==0)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),r+=8;var i=this.buffer.byteLength;r>i&&this.resize((i*=2)>r?i:r),r-=8;var o=e.low,f=e.high;return this.littleEndian?(this.view[r+3]=o>>>24&255,this.view[r+2]=o>>>16&255,this.view[r+1]=o>>>8&255,this.view[r]=255&o,r+=4,this.view[r+3]=f>>>24&255,this.view[r+2]=f>>>16&255,this.view[r+1]=f>>>8&255,this.view[r]=255&f):(this.view[r]=f>>>24&255,this.view[r+1]=f>>>16&255,this.view[r+2]=f>>>8&255,this.view[r+3]=255&f,r+=4,this.view[r]=o>>>24&255,this.view[r+1]=o>>>16&255,this.view[r+2]=o>>>8&255,this.view[r+3]=255&o),n&&(this.offset+=8),this},f.writeUInt64=f.writeUint64,f.readUint64=function(e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var n=0,i=0;this.littleEndian?(n=this.view[e+2]<<16,n|=this.view[e+1]<<8,n|=this.view[e],n+=this.view[e+3]<<24>>>0,e+=4,i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0,e+=4,n=this.view[e+1]<<16,n|=this.view[e+2]<<8,n|=this.view[e+3],n+=this.view[e]<<24>>>0);var o=new t(n,i,!0);return r&&(this.offset+=8),o},f.readUInt64=f.readUint64),f.writeFloat32=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=4,i(this.view,t,e,this.littleEndian,23,4),r&&(this.offset+=4),this},f.writeFloat=f.writeFloat32,f.readFloat32=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=n(this.view,t,this.littleEndian,23,4);return e&&(this.offset+=4),r},f.readFloat=f.readFloat32,f.writeFloat64=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=8;var n=this.buffer.byteLength;return e>n&&this.resize((n*=2)>e?n:e),e-=8,i(this.view,t,e,this.littleEndian,52,8),r&&(this.offset+=8),this},f.writeDouble=f.writeFloat64,f.readFloat64=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var r=n(this.view,t,this.littleEndian,52,8);return e&&(this.offset+=8),r},f.readDouble=f.readFloat64,o.MAX_VARINT32_BYTES=5,o.calculateVarint32=function(t){return t>>>=0,128>t?1:16384>t?2:1<<21>t?3:1<<28>t?4:5},o.zigZagEncode32=function(t){return((t|=0)<<1^t>>31)>>>0},o.zigZagDecode32=function(t){return t>>>1^-(1&t)|0},f.writeVarint32=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var n,i=o.calculateVarint32(t);e+=i;var f=this.buffer.byteLength;for(e>f&&this.resize((f*=2)>e?f:e),e-=i,t>>>=0;t>=128;)n=127&t|128,this.view[e++]=n,t>>>=7;return this.view[e++]=t,r?(this.offset=e,this):i},f.writeVarint32ZigZag=function(t,e){return this.writeVarint32(o.zigZagEncode32(t),e)},f.readVarint32=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r,n=0,i=0;do{if(!this.noAssert&&t>this.limit){var o=Error("Truncated");throw o.truncated=!0,o}r=this.view[t++],5>n&&(i|=(127&r)<<7*n),++n}while(0!==(128&r));return i|=0,e?(this.offset=t,i):{value:i,length:n}},f.readVarint32ZigZag=function(t){var e=this.readVarint32(t);return"object"==typeof e?e.value=o.zigZagDecode32(e.value):e=o.zigZagDecode32(e),e},t&&(o.MAX_VARINT64_BYTES=10,o.calculateVarint64=function(e){"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e));var r=e.toInt()>>>0,n=e.shiftRightUnsigned(28).toInt()>>>0,i=e.shiftRightUnsigned(56).toInt()>>>0;return 0==i?0==n?16384>r?128>r?1:2:1<<21>r?3:4:16384>n?128>n?5:6:1<<21>n?7:8:128>i?9:10},o.zigZagEncode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):e.unsigned!==!1&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},o.zigZagDecode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):e.unsigned!==!1&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(t.ONE).toSigned().negate()).toSigned()},f.writeVarint64=function(e,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof r||r%1!==0)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):e.unsigned!==!1&&(e=e.toSigned());var i=o.calculateVarint64(e),f=e.toInt()>>>0,a=e.shiftRightUnsigned(28).toInt()>>>0,u=e.shiftRightUnsigned(56).toInt()>>>0;r+=i;var s=this.buffer.byteLength;switch(r>s&&this.resize((s*=2)>r?s:r),r-=i,i){case 10:this.view[r+9]=u>>>7&1;case 9:this.view[r+8]=9!==i?128|u:127&u;case 8:this.view[r+7]=8!==i?a>>>21|128:a>>>21&127;case 7:this.view[r+6]=7!==i?a>>>14|128:a>>>14&127;case 6:this.view[r+5]=6!==i?a>>>7|128:a>>>7&127;case 5:this.view[r+4]=5!==i?128|a:127&a;case 4:this.view[r+3]=4!==i?f>>>21|128:f>>>21&127;case 3:this.view[r+2]=3!==i?f>>>14|128:f>>>14&127;case 2:this.view[r+1]=2!==i?f>>>7|128:f>>>7&127;case 1:this.view[r]=1!==i?128|f:127&f}return n?(this.offset+=i,this):i},f.writeVarint64ZigZag=function(t,e){return this.writeVarint64(o.zigZagEncode64(t),e)},f.readVarint64=function(e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var n=e,i=0,o=0,f=0,a=0;if(a=this.view[e++],i=127&a,128&a&&(a=this.view[e++],i|=(127&a)<<7,(128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[e++],i|=(127&a)<<14,(128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[e++],i|=(127&a)<<21,(128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[e++],o=127&a,(128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[e++],o|=(127&a)<<7,(128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[e++],o|=(127&a)<<14,(128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[e++],o|=(127&a)<<21,(128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[e++],f=127&a,(128&a||this.noAssert&&"undefined"==typeof a)&&(a=this.view[e++],f|=(127&a)<<7,128&a||this.noAssert&&"undefined"==typeof a))))))))))throw Error("Buffer overrun");var u=t.fromBits(i|o<<28,o>>>4|f<<24,!1);return r?(this.offset=e,u):{value:u,length:e-n}},f.readVarint64ZigZag=function(e){var r=this.readVarint64(e);return r&&r.value instanceof t?r.value=o.zigZagDecode64(r.value):r=o.zigZagDecode64(r),r}),f.writeCString=function(t,r){var n="undefined"==typeof r;n&&(r=this.offset);var i,o=t.length;if(!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");for(i=0;o>i;++i)if(0===t.charCodeAt(i))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof r||r%1!==0)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}o=h.calculateUTF16asUTF8(e(t))[1],r+=o+1;var f=this.buffer.byteLength;return r>f&&this.resize((f*=2)>r?f:r),r-=o+1,h.encodeUTF16toUTF8(e(t),function(t){this.view[r++]=t}.bind(this)),this.view[r++]=0,n?(this.offset=r,this):o},f.readCString=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n,i=t,o=-1;return h.decodeUTF8toUTF16(function(){if(0===o)return null;if(t>=this.limit)throw RangeError("Illegal range: Truncated data, "+t+" < "+this.limit);return o=this.view[t++],0===o?null:o}.bind(this),n=r(),!0),e?(this.offset=t,n()):{string:n(),length:t-i}},f.writeIString=function(t,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof r||r%1!==0)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var i,o=r;i=h.calculateUTF16asUTF8(e(t),this.noAssert)[1],r+=4+i;var f=this.buffer.byteLength;if(r>f&&this.resize((f*=2)>r?f:r),r-=4+i,this.littleEndian?(this.view[r+3]=i>>>24&255,this.view[r+2]=i>>>16&255,this.view[r+1]=i>>>8&255,this.view[r]=255&i):(this.view[r]=i>>>24&255,this.view[r+1]=i>>>16&255,this.view[r+2]=i>>>8&255,this.view[r+3]=255&i),r+=4,h.encodeUTF16toUTF8(e(t),function(t){this.view[r++]=t}.bind(this)),r!==o+4+i)throw RangeError("Illegal range: Truncated data, "+r+" == "+(r+4+i));return n?(this.offset=r,this):r-o},f.readIString=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=t,n=this.readUint32(t),i=this.readUTF8String(n,o.METRICS_BYTES,t+=4);return t+=i.length,e?(this.offset=t,i.string):{string:i.string,length:t-r}},o.METRICS_CHARS="c",o.METRICS_BYTES="b",f.writeUTF8String=function(t,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!==0)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var i,o=r;i=h.calculateUTF16asUTF8(e(t))[1],r+=i;var f=this.buffer.byteLength;return r>f&&this.resize((f*=2)>r?f:r),r-=i,h.encodeUTF16toUTF8(e(t),function(t){this.view[r++]=t}.bind(this)),n?(this.offset=r,this):r-o},f.writeString=f.writeUTF8String,o.calculateUTF8Chars=function(t){return h.calculateUTF16asUTF8(e(t))[0]},o.calculateUTF8Bytes=function(t){return h.calculateUTF16asUTF8(e(t))[1]},o.calculateString=o.calculateUTF8Bytes,f.readUTF8String=function(t,e,n){"number"==typeof e&&(n=e,e=void 0);var i="undefined"==typeof n;if(i&&(n=this.offset),"undefined"==typeof e&&(e=o.METRICS_CHARS),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal length: "+t+" (not an integer)");if(t|=0,"number"!=typeof n||n%1!==0)throw TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var f,a=0,u=n;if(e===o.METRICS_CHARS){if(f=r(),h.decodeUTF8(function(){return t>a&&n<this.limit?this.view[n++]:null}.bind(this),function(t){++a,h.UTF8toUTF16(t,f)}),a!==t)throw RangeError("Illegal range: Truncated data, "+a+" == "+t);return i?(this.offset=n,f()):{string:f(),length:n-u}}if(e===o.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof n||n%1!==0)throw TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+"+t+") <= "+this.buffer.byteLength)}var s=n+t;if(h.decodeUTF8toUTF16(function(){return s>n?this.view[n++]:null}.bind(this),f=r(),this.noAssert),n!==s)throw RangeError("Illegal range: Truncated data, "+n+" == "+s);return i?(this.offset=n,f()):{string:f(),length:n-u}}throw TypeError("Unsupported metrics: "+e)},f.readString=f.readUTF8String,f.writeVString=function(t,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof r||r%1!==0)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var i,f,a=r;i=h.calculateUTF16asUTF8(e(t),this.noAssert)[1],f=o.calculateVarint32(i),r+=f+i;var u=this.buffer.byteLength;if(r>u&&this.resize((u*=2)>r?u:r),r-=f+i,r+=this.writeVarint32(i,r),h.encodeUTF16toUTF8(e(t),function(t){this.view[r++]=t}.bind(this)),r!==a+i+f)throw RangeError("Illegal range: Truncated data, "+r+" == "+(r+i+f));return n?(this.offset=r,this):r-a},f.readVString=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=t,n=this.readVarint32(t),i=this.readUTF8String(n.value,o.METRICS_BYTES,t+=n.length);return t+=i.length,e?(this.offset=t,i.string):{string:i.string,length:t-r}},f.append=function(t,e,r){"number"!=typeof e&&"string"==typeof e||(r=e,e=void 0);var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!==0)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}t instanceof o||(t=o.wrap(t,e));var i=t.limit-t.offset;if(0>=i)return this;r+=i;var f=this.buffer.byteLength;return r>f&&this.resize((f*=2)>r?f:r),r-=i,this.view.set(t.view.subarray(t.offset,t.limit),r),t.offset+=i,n&&(this.offset+=i),this},f.appendTo=function(t,e){return t.append(this,e),this},f.assert=function(t){return this.noAssert=!t,this},f.capacity=function(){return this.buffer.byteLength},f.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},f.clone=function(t){var e=new o(0,this.littleEndian,this.noAssert);return t?(e.buffer=new ArrayBuffer(this.buffer.byteLength),e.view=new Uint8Array(e.buffer)):(e.buffer=this.buffer,e.view=this.view),e.offset=this.offset,e.markedOffset=this.markedOffset,e.limit=this.limit,e},f.compact=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>t||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(0===t&&e===this.buffer.byteLength)return this;var r=e-t;if(0===r)return this.buffer=a,this.view=null,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=0,this;var n=new ArrayBuffer(r),i=new Uint8Array(n);return i.set(this.view.subarray(t,e)),this.buffer=n,this.view=i,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=r,this},f.copy=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>t||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(t===e)return new o(0,this.littleEndian,this.noAssert);var r=e-t,n=new o(r,this.littleEndian,this.noAssert);return n.offset=0,n.limit=r,n.markedOffset>=0&&(n.markedOffset-=t),this.copyTo(n,0,t,e),n},f.copyTo=function(t,e,r,n){var i,f;if(!this.noAssert&&!o.isByteBuffer(t))throw TypeError("Illegal target: Not a ByteBuffer");if(e=(f="undefined"==typeof e)?t.offset:0|e,r=(i="undefined"==typeof r)?this.offset:0|r,n="undefined"==typeof n?this.limit:0|n,0>e||e>t.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+e+" <= "+t.buffer.byteLength);if(0>r||n>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+r+" <= "+this.buffer.byteLength);var a=n-r;return 0===a?t:(t.ensureCapacity(e+a),t.view.set(this.view.subarray(r,n),e),i&&(this.offset+=a),f&&(t.offset+=a),this)},f.ensureCapacity=function(t){var e=this.buffer.byteLength;return t>e?this.resize((e*=2)>t?e:t):this},f.fill=function(t,e,r){var n="undefined"==typeof e;if(n&&(e=this.offset),"string"==typeof t&&t.length>0&&(t=t.charCodeAt(0)),"undefined"==typeof e&&(e=this.offset),"undefined"==typeof r&&(r=this.limit),!this.noAssert){\nif("number"!=typeof t||t%1!==0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof r||r%1!==0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,0>e||e>r||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+r+" <= "+this.buffer.byteLength)}if(e>=r)return this;for(;r>e;)this.view[e++]=t;return n&&(this.offset=e),this},f.flip=function(){return this.limit=this.offset,this.offset=0,this},f.mark=function(t){if(t="undefined"==typeof t?this.offset:t,!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=t,this},f.order=function(t){if(!this.noAssert&&"boolean"!=typeof t)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!t,this},f.LE=function(t){return this.littleEndian="undefined"!=typeof t?!!t:!0,this},f.BE=function(t){return this.littleEndian="undefined"!=typeof t?!t:!1,this},f.prepend=function(t,e,r){"number"!=typeof e&&"string"==typeof e||(r=e,e=void 0);var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!==0)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}t instanceof o||(t=o.wrap(t,e));var i=t.limit-t.offset;if(0>=i)return this;var f=i-r;if(f>0){var a=new ArrayBuffer(this.buffer.byteLength+f),u=new Uint8Array(a);u.set(this.view.subarray(r,this.buffer.byteLength),i),this.buffer=a,this.view=u,this.offset+=f,this.markedOffset>=0&&(this.markedOffset+=f),this.limit+=f,r+=f}else{new Uint8Array(this.buffer)}return this.view.set(t.view.subarray(t.offset,t.limit),r-i),t.offset=t.limit,n&&(this.offset-=i),this},f.prependTo=function(t,e){return t.prepend(this,e),this},f.printDebug=function(t){"function"!=typeof t&&(t=console.log.bind(console)),t(this.toString()+"\\n-------------------------------------------------------------------\\n"+this.toDebug(!0))},f.remaining=function(){return this.limit-this.offset},f.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},f.resize=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal capacity: "+t+" (not an integer)");if(t|=0,0>t)throw RangeError("Illegal capacity: 0 <= "+t)}if(this.buffer.byteLength<t){var e=new ArrayBuffer(t),r=new Uint8Array(e);r.set(this.view),this.buffer=e,this.view=r}return this},f.reverse=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>t||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}return t===e?this:(Array.prototype.reverse.call(this.view.subarray(t,e)),this)},f.skip=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal length: "+t+" (not an integer)");t|=0}var e=this.offset+t;if(!this.noAssert&&(0>e||e>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+t+" <= "+this.buffer.byteLength);return this.offset=e,this},f.slice=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>t||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var r=this.clone();return r.offset=t,r.limit=e,r},f.toBuffer=function(t){var e=this.offset,r=this.limit;if(!this.noAssert){if("number"!=typeof e||e%1!==0)throw TypeError("Illegal offset: Not an integer");if(e>>>=0,"number"!=typeof r||r%1!==0)throw TypeError("Illegal limit: Not an integer");if(r>>>=0,0>e||e>r||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+r+" <= "+this.buffer.byteLength)}if(!t&&0===e&&r===this.buffer.byteLength)return this.buffer;if(e===r)return a;var n=new ArrayBuffer(r-e);return new Uint8Array(n).set(new Uint8Array(this.buffer).subarray(e,r),0),n},f.toArrayBuffer=f.toBuffer,f.toString=function(t,e,r){if("undefined"==typeof t)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof t&&(t="utf8",e=t,r=e),t){case"utf8":return this.toUTF8(e,r);case"base64":return this.toBase64(e,r);case"hex":return this.toHex(e,r);case"binary":return this.toBinary(e,r);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+t)}};var s=function(){for(var t={},e=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],r=[],n=0,i=e.length;i>n;++n)r[e[n]]=n;return t.encode=function(t,r){for(var n,i;null!==(n=t());)r(e[n>>2&63]),i=(3&n)<<4,null!==(n=t())?(i|=n>>4&15,r(e[63&(i|n>>4&15)]),i=(15&n)<<2,null!==(n=t())?(r(e[63&(i|n>>6&3)]),r(e[63&n])):(r(e[63&i]),r(61))):(r(e[63&i]),r(61),r(61))},t.decode=function(t,e){function n(t){throw Error("Illegal character code: "+t)}for(var i,o,f;null!==(i=t());)if(o=r[i],"undefined"==typeof o&&n(i),null!==(i=t())&&(f=r[i],"undefined"==typeof f&&n(i),e(o<<2>>>0|(48&f)>>4),null!==(i=t()))){if(o=r[i],"undefined"==typeof o){if(61===i)break;n(i)}if(e((15&f)<<4>>>0|(60&o)>>2),null!==(i=t())){if(f=r[i],"undefined"==typeof f){if(61===i)break;n(i)}e((3&o)<<6>>>0|f)}}},t.test=function(t){return/^(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+\\/]{3}=)?$/.test(t)},t}();f.toBase64=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),t=0|t,e=0|e,0>t||e>this.capacity||t>e)throw RangeError("begin, end");var n;return s.encode(function(){return e>t?this.view[t++]:null}.bind(this),n=r()),n()},o.fromBase64=function(t,r){if("string"!=typeof t)throw TypeError("str");var n=new o(t.length/4*3,r),i=0;return s.decode(e(t),function(t){n.view[i++]=t}),n.limit=i,n},o.btoa=function(t){return o.fromBinary(t).toBase64()},o.atob=function(t){return o.fromBase64(t).toBinary()},f.toBinary=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),t|=0,e|=0,0>t||e>this.capacity()||t>e)throw RangeError("begin, end");if(t===e)return"";for(var r=[],n=[];e>t;)r.push(this.view[t++]),r.length>=1024&&(n.push(String.fromCharCode.apply(String,r)),r=[]);return n.join("")+String.fromCharCode.apply(String,r)},o.fromBinary=function(t,e){if("string"!=typeof t)throw TypeError("str");for(var r,n=0,i=t.length,f=new o(i,e);i>n;){if(r=t.charCodeAt(n),r>255)throw RangeError("illegal char code: "+r);f.view[n++]=r}return f.limit=i,f},f.toDebug=function(t){for(var e,r=-1,n=this.buffer.byteLength,i="",o="",f="";n>r;){if(-1!==r&&(e=this.view[r],i+=16>e?"0"+e.toString(16).toUpperCase():e.toString(16).toUpperCase(),t&&(o+=e>32&&127>e?String.fromCharCode(e):".")),++r,t&&r>0&&r%16===0&&r!==n){for(;i.length<51;)i+=" ";f+=i+o+"\\n",i=o=""}i+=r===this.offset&&r===this.limit?r===this.markedOffset?"!":"|":r===this.offset?r===this.markedOffset?"[":"<":r===this.limit?r===this.markedOffset?"]":">":r===this.markedOffset?"\'":t||0!==r&&r!==n?" ":""}if(t&&" "!==i){for(;i.length<51;)i+=" ";f+=i+o+"\\n"}return t?f:i},o.fromDebug=function(t,e,r){for(var n,i,f=t.length,a=new o((f+1)/3|0,e,r),u=0,s=0,h=!1,l=!1,c=!1,p=!1,g=!1;f>u;){switch(n=t.charAt(u++)){case"!":if(!r){if(l||c||p){g=!0;break}l=c=p=!0}a.offset=a.markedOffset=a.limit=s,h=!1;break;case"|":if(!r){if(l||p){g=!0;break}l=p=!0}a.offset=a.limit=s,h=!1;break;case"[":if(!r){if(l||c){g=!0;break}l=c=!0}a.offset=a.markedOffset=s,h=!1;break;case"<":if(!r){if(l){g=!0;break}l=!0}a.offset=s,h=!1;break;case"]":if(!r){if(p||c){g=!0;break}p=c=!0}a.limit=a.markedOffset=s,h=!1;break;case">":if(!r){if(p){g=!0;break}p=!0}a.limit=s,h=!1;break;case"\'":if(!r){if(c){g=!0;break}c=!0}a.markedOffset=s,h=!1;break;case" ":h=!1;break;default:if(!r&&h){g=!0;break}if(i=parseInt(n+t.charAt(u++),16),!r&&(isNaN(i)||0>i||i>255))throw TypeError("Illegal str: Not a debug encoded string");a.view[s++]=i,h=!0}if(g)throw TypeError("Illegal str: Invalid symbol at "+u)}if(!r){if(!l||!p)throw TypeError("Illegal str: Missing offset or limit");if(s<a.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+s+" < "+f)}return a},f.toHex=function(t,e){if(t="undefined"==typeof t?this.offset:t,e="undefined"==typeof e?this.limit:e,!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>t||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}for(var r,n=new Array(e-t);e>t;)r=this.view[t++],16>r?n.push("0",r.toString(16)):n.push(r.toString(16));return n.join("")},o.fromHex=function(t,e,r){if(!r){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(t.length%2!==0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var n,i=t.length,f=new o(i/2|0,e),a=0,u=0;i>a;a+=2){if(n=parseInt(t.substring(a,a+2),16),!r&&(!isFinite(n)||0>n||n>255))throw TypeError("Illegal str: Contains non-hex characters");f.view[u++]=n}return f.limit=u,f};var h=function(){var t={};return t.MAX_CODEPOINT=1114111,t.encodeUTF8=function(t,e){var r=null;for("number"==typeof t&&(r=t,t=function(){return null});null!==r||null!==(r=t());)128>r?e(127&r):2048>r?(e(r>>6&31|192),e(63&r|128)):65536>r?(e(r>>12&15|224),e(r>>6&63|128),e(63&r|128)):(e(r>>18&7|240),e(r>>12&63|128),e(r>>6&63|128),e(63&r|128)),r=null},t.decodeUTF8=function(t,e){for(var r,n,i,o,f=function(t){t=t.slice(0,t.indexOf(null));var e=Error(t.toString());throw e.name="TruncatedError",e.bytes=t,e};null!==(r=t());)if(0===(128&r))e(r);else if(192===(224&r))null===(n=t())&&f([r,n]),e((31&r)<<6|63&n);else if(224===(240&r))(null===(n=t())||null===(i=t()))&&f([r,n,i]),e((15&r)<<12|(63&n)<<6|63&i);else{if(240!==(248&r))throw RangeError("Illegal starting byte: "+r);(null===(n=t())||null===(i=t())||null===(o=t()))&&f([r,n,i,o]),e((7&r)<<18|(63&n)<<12|(63&i)<<6|63&o)}},t.UTF16toUTF8=function(t,e){for(var r,n=null;;){if(null===(r=null!==n?n:t()))break;r>=55296&&57343>=r&&null!==(n=t())&&n>=56320&&57343>=n?(e(1024*(r-55296)+n-56320+65536),n=null):e(r)}null!==n&&e(n)},t.UTF8toUTF16=function(t,e){var r=null;for("number"==typeof t&&(r=t,t=function(){return null});null!==r||null!==(r=t());)65535>=r?e(r):(r-=65536,e((r>>10)+55296),e(r%1024+56320)),r=null},t.encodeUTF16toUTF8=function(e,r){t.UTF16toUTF8(e,function(e){t.encodeUTF8(e,r)})},t.decodeUTF8toUTF16=function(e,r){t.decodeUTF8(e,function(e){t.UTF8toUTF16(e,r)})},t.calculateCodePoint=function(t){return 128>t?1:2048>t?2:65536>t?3:4},t.calculateUTF8=function(t){for(var e,r=0;null!==(e=t());)r+=128>e?1:2048>e?2:65536>e?3:4;return r},t.calculateUTF16asUTF8=function(e){var r=0,n=0;return t.UTF16toUTF8(e,function(t){++r,n+=128>t?1:2048>t?2:65536>t?3:4}),[r,n]},t}();return f.toUTF8=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!==0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!==0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>t||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var n;try{h.decodeUTF8toUTF16(function(){return e>t?this.view[t++]:null}.bind(this),n=r())}catch(i){if(t!==e)throw RangeError("Illegal range: Truncated data, "+t+" != "+e)}return n()},o.fromUTF8=function(t,r,n){if(!n&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");var i=new o(h.calculateUTF16asUTF8(e(t),!0)[1],r,n),f=0;return h.encodeUTF16toUTF8(e(t),function(t){i.view[f++]=t}),i.limit=f,i},o})}).call(e,r(1)(t))},function(t,e,r){var n=r(19);t.exports=function(t){return(n.JSON&&n.JSON.stringify||JSON.stringify).apply(JSON,arguments)}},function(t,e,r){var n=r(20);t.exports=function(t,e){return n.create(t,e)}},function(t,e){var r=t.exports={version:"1.2.6"};"number"==typeof __e&&(__e=r)},function(t,e){var r=Object;t.exports={create:r.create,getProto:r.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:r.getOwnPropertyDescriptor,setDesc:r.defineProperty,setDescs:r.defineProperties,getKeys:r.keys,getNames:r.getOwnPropertyNames,getSymbols:r.getOwnPropertySymbols,each:[].forEach}},function(t,e,r){!function(n,i){t.exports=e=i(r(0))}(this,function(t){t.lib.Cipher||function(e){var r=t,n=r.lib,i=n.Base,o=n.WordArray,f=n.BufferedBlockAlgorithm,a=r.enc,u=(a.Utf8,a.Base64),s=r.algo,h=s.EvpKDF,l=n.Cipher=f.extend({cfg:i.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,r){this.cfg=this.cfg.extend(r),this._xformMode=t,this._key=e,this.reset()},reset:function(){f.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){t&&this._append(t);var e=this._doFinalize();return e},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?x:b}return function(e){return{encrypt:function(r,n,i){return t(n).encrypt(e,r,n,i)},decrypt:function(r,n,i){return t(n).decrypt(e,r,n,i)}}}}()}),c=(n.StreamCipher=l.extend({_doFinalize:function(){var t=this._process(!0);return t},blockSize:1}),r.mode={}),p=n.BlockCipherMode=i.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),g=c.CBC=function(){function t(t,r,n){var i=this._iv;if(i){var o=i;this._iv=e}else var o=this._prevBlock;for(var f=0;n>f;f++)t[r+f]^=o[f]}var r=p.extend();return r.Encryptor=r.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize;t.call(this,e,r,i),n.encryptBlock(e,r),this._prevBlock=e.slice(r,r+i)}}),r.Decryptor=r.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize,o=e.slice(r,r+i);n.decryptBlock(e,r),t.call(this,e,r,i),this._prevBlock=o}}),r}(),v=r.pad={},d=v.Pkcs7={pad:function(t,e){for(var r=4*e,n=r-t.sigBytes%r,i=n<<24|n<<16|n<<8|n,f=[],a=0;n>a;a+=4)f.push(i);var u=o.create(f,n);t.concat(u)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},y=(n.BlockCipher=l.extend({cfg:l.cfg.extend({mode:g,padding:d}),reset:function(){l.reset.call(this);var t=this.cfg,e=t.iv,r=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=r.createEncryptor;else{var n=r.createDecryptor;this._minBufferSize=1}this._mode=n.call(r,this,e&&e.words)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else{var e=this._process(!0);t.unpad(e)}return e},blockSize:4}),n.CipherParams=i.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}})),w=r.format={},m=w.OpenSSL={stringify:function(t){var e=t.ciphertext,r=t.salt;if(r)var n=o.create([1398893684,1701076831]).concat(r).concat(e);else var n=e;return n.toString(u)},parse:function(t){var e=u.parse(t),r=e.words;if(1398893684==r[0]&&1701076831==r[1]){var n=o.create(r.slice(2,4));r.splice(0,4),e.sigBytes-=16}return y.create({ciphertext:e,salt:n})}},b=n.SerializableCipher=i.extend({cfg:i.extend({format:m}),encrypt:function(t,e,r,n){n=this.cfg.extend(n);var i=t.createEncryptor(r,n),o=i.finalize(e),f=i.cfg;return y.create({ciphertext:o,key:r,iv:f.iv,algorithm:t,mode:f.mode,padding:f.padding,blockSize:t.blockSize,formatter:n.format})},decrypt:function(t,e,r,n){n=this.cfg.extend(n),e=this._parse(e,n.format);var i=t.createDecryptor(r,n).finalize(e.ciphertext);return i},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),_=r.kdf={},E=_.OpenSSL={execute:function(t,e,r,n){n||(n=o.random(8));var i=h.create({keySize:e+r}).compute(t,n),f=o.create(i.words.slice(e),4*r);return i.sigBytes=4*e,y.create({key:i,iv:f,salt:n})}},x=n.PasswordBasedCipher=b.extend({cfg:b.cfg.extend({kdf:E}),encrypt:function(t,e,r,n){n=this.cfg.extend(n);var i=n.kdf.execute(r,t.keySize,t.ivSize);n.iv=i.iv;var o=b.encrypt.call(this,t,e,i.key,n);return o.mixIn(i),o},decrypt:function(t,e,r,n){n=this.cfg.extend(n),e=this._parse(e,n.format);var i=n.kdf.execute(r,t.keySize,t.ivSize,e.salt);n.iv=i.iv;var o=b.decrypt.call(this,t,e,i.key,n);return o}})}()})},function(t,e,r){!function(n,i,o){t.exports=e=i(r(0),r(24),r(4))}(this,function(t){return function(){var e=t,r=e.lib,n=r.Base,i=r.WordArray,o=e.algo,f=o.MD5,a=o.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:f,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var r=this.cfg,n=r.hasher.create(),o=i.create(),f=o.words,a=r.keySize,u=r.iterations;f.length<a;){s&&n.update(s);var s=n.update(t).finalize(e);n.reset();for(var h=1;u>h;h++)s=n.finalize(s),n.reset();o.concat(s)}return o.sigBytes=4*a,o}});e.EvpKDF=function(t,e,r){return a.create(r).compute(t,e)}}(),t.EvpKDF})},function(t,e,r){!function(n,i){t.exports=e=i(r(0))}(this,function(t){return function(e){function r(t,e,r,n,i,o,f){var a=t+(e&r|~e&n)+i+f;return(a<<o|a>>>32-o)+e}function n(t,e,r,n,i,o,f){var a=t+(e&n|r&~n)+i+f;return(a<<o|a>>>32-o)+e}function i(t,e,r,n,i,o,f){var a=t+(e^r^n)+i+f;return(a<<o|a>>>32-o)+e}function o(t,e,r,n,i,o,f){var a=t+(r^(e|~n))+i+f;return(a<<o|a>>>32-o)+e}var f=t,a=f.lib,u=a.WordArray,s=a.Hasher,h=f.algo,l=[];!function(){for(var t=0;64>t;t++)l[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=h.MD5=s.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var f=0;16>f;f++){var a=e+f,u=t[a];t[a]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}var s=this._hash.words,h=t[e+0],c=t[e+1],p=t[e+2],g=t[e+3],v=t[e+4],d=t[e+5],y=t[e+6],w=t[e+7],m=t[e+8],b=t[e+9],_=t[e+10],E=t[e+11],x=t[e+12],A=t[e+13],I=t[e+14],T=t[e+15],S=s[0],L=s[1],U=s[2],k=s[3];S=r(S,L,U,k,h,7,l[0]),k=r(k,S,L,U,c,12,l[1]),U=r(U,k,S,L,p,17,l[2]),L=r(L,U,k,S,g,22,l[3]),S=r(S,L,U,k,v,7,l[4]),k=r(k,S,L,U,d,12,l[5]),U=r(U,k,S,L,y,17,l[6]),L=r(L,U,k,S,w,22,l[7]),S=r(S,L,U,k,m,7,l[8]),k=r(k,S,L,U,b,12,l[9]),U=r(U,k,S,L,_,17,l[10]),L=r(L,U,k,S,E,22,l[11]),S=r(S,L,U,k,x,7,l[12]),k=r(k,S,L,U,A,12,l[13]),U=r(U,k,S,L,I,17,l[14]),L=r(L,U,k,S,T,22,l[15]),S=n(S,L,U,k,c,5,l[16]),k=n(k,S,L,U,y,9,l[17]),U=n(U,k,S,L,E,14,l[18]),L=n(L,U,k,S,h,20,l[19]),S=n(S,L,U,k,d,5,l[20]),k=n(k,S,L,U,_,9,l[21]),U=n(U,k,S,L,T,14,l[22]),L=n(L,U,k,S,v,20,l[23]),S=n(S,L,U,k,b,5,l[24]),k=n(k,S,L,U,I,9,l[25]),U=n(U,k,S,L,g,14,l[26]),L=n(L,U,k,S,m,20,l[27]),S=n(S,L,U,k,A,5,l[28]),k=n(k,S,L,U,p,9,l[29]),U=n(U,k,S,L,w,14,l[30]),L=n(L,U,k,S,x,20,l[31]),S=i(S,L,U,k,d,4,l[32]),k=i(k,S,L,U,m,11,l[33]),U=i(U,k,S,L,E,16,l[34]),L=i(L,U,k,S,I,23,l[35]),S=i(S,L,U,k,c,4,l[36]),k=i(k,S,L,U,v,11,l[37]),U=i(U,k,S,L,w,16,l[38]),L=i(L,U,k,S,_,23,l[39]),S=i(S,L,U,k,A,4,l[40]),k=i(k,S,L,U,h,11,l[41]),U=i(U,k,S,L,g,16,l[42]),L=i(L,U,k,S,y,23,l[43]),S=i(S,L,U,k,b,4,l[44]),k=i(k,S,L,U,x,11,l[45]),U=i(U,k,S,L,T,16,l[46]),L=i(L,U,k,S,p,23,l[47]),S=o(S,L,U,k,h,6,l[48]),k=o(k,S,L,U,w,10,l[49]),U=o(U,k,S,L,I,15,l[50]),L=o(L,U,k,S,d,21,l[51]),S=o(S,L,U,k,x,6,l[52]),k=o(k,S,L,U,g,10,l[53]),U=o(U,k,S,L,_,15,l[54]),L=o(L,U,k,S,c,21,l[55]),S=o(S,L,U,k,m,6,l[56]),k=o(k,S,L,U,T,10,l[57]),U=o(U,k,S,L,y,15,l[58]),L=o(L,U,k,S,A,21,l[59]),S=o(S,L,U,k,v,6,l[60]),k=o(k,S,L,U,E,10,l[61]),U=o(U,k,S,L,p,15,l[62]),L=o(L,U,k,S,b,21,l[63]),s[0]=s[0]+S|0,s[1]=s[1]+L|0,s[2]=s[2]+U|0,s[3]=s[3]+k|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=e.floor(n/4294967296),f=n;r[(i+64>>>9<<4)+15]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[(i+64>>>9<<4)+14]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),t.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,u=a.words,s=0;4>s;s++){var h=u[s];u[s]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return a},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}});f.MD5=s._createHelper(c),f.HmacMD5=s._createHmacHelper(c)}(Math),t.MD5})},function(t,e,r){!function(n,i){t.exports=e=i(r(0))}(this,function(t){return function(){var e=t,r=e.lib,n=r.WordArray,i=r.Hasher,o=e.algo,f=[],a=o.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],a=r[3],u=r[4],s=0;80>s;s++){if(16>s)f[s]=0|t[e+s];else{var h=f[s-3]^f[s-8]^f[s-14]^f[s-16];f[s]=h<<1|h>>>31}var l=(n<<5|n>>>27)+u+f[s];l+=20>s?(i&o|~i&a)+1518500249:40>s?(i^o^a)+1859775393:60>s?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,u=a,a=o,o=i<<30|i>>>2,i=n,n=l}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+u|0},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,n=8*t.sigBytes;return e[n>>>5]|=128<<24-n%32,e[(n+64>>>9<<4)+14]=Math.floor(r/4294967296),e[(n+64>>>9<<4)+15]=r,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA1=i._createHelper(a),e.HmacSHA1=i._createHmacHelper(a)}(),t.SHA1})},function(t,e,r){!function(n,i){t.exports=e=i(r(0))}(this,function(t){return function(e){var r=t,n=r.lib,i=n.WordArray,o=n.Hasher,f=r.algo,a=[],u=[];!function(){function t(t){for(var r=e.sqrt(t),n=2;r>=n;n++)if(!(t%n))return!1;return!0}function r(t){return 4294967296*(t-(0|t))|0}for(var n=2,i=0;64>i;)t(n)&&(8>i&&(a[i]=r(e.pow(n,.5))),u[i]=r(e.pow(n,1/3)),i++),n++}();var s=[],h=f.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(t,e){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],f=r[3],a=r[4],h=r[5],l=r[6],c=r[7],p=0;64>p;p++){if(16>p)s[p]=0|t[e+p];else{var g=s[p-15],v=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,d=s[p-2],y=(d<<15|d>>>17)^(d<<13|d>>>19)^d>>>10;s[p]=v+s[p-7]+y+s[p-16]}var w=a&h^~a&l,m=n&i^n&o^i&o,b=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),_=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),E=c+_+w+u[p]+s[p],x=b+m;c=l,l=h,h=a,a=f+E|0,f=o,o=i,i=n,n=E+x|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+f|0,r[4]=r[4]+a|0,r[5]=r[5]+h|0,r[6]=r[6]+l|0,r[7]=r[7]+c|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return r[i>>>5]|=128<<24-i%32,r[(i+64>>>9<<4)+14]=e.floor(n/4294967296),r[(i+64>>>9<<4)+15]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});r.SHA256=o._createHelper(h),r.HmacSHA256=o._createHmacHelper(h)}(Math),t.SHA256})},function(t,e){"use strict";t.exports=function(t){return t&&t.length>1?255===t[0]&&216===t[1]&&255===t[2]?{ext:"jpg",mime:"image/jpeg"}:137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]?{ext:"png",mime:"image/png"}:71===t[0]&&73===t[1]&&70===t[2]?{ext:"gif",mime:"image/gif"}:87===t[8]&&69===t[9]&&66===t[10]&&80===t[11]?{ext:"webp",mime:"image/webp"}:(73===t[0]&&73===t[1]&&42===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&42===t[3])&&67===t[8]&&82===t[9]?{ext:"cr2",mime:"image/x-canon-cr2"}:73===t[0]&&73===t[1]&&42===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&42===t[3]?{ext:"tif",mime:"image/tiff"}:66===t[0]&&77===t[1]?{ext:"bmp",mime:"image/bmp"}:73===t[0]&&73===t[1]&&188===t[2]?{ext:"jxr",mime:"image/vnd.ms-photo"}:56===t[0]&&66===t[1]&&80===t[2]&&83===t[3]?{ext:"psd",mime:"image/vnd.adobe.photoshop"}:80===t[0]&&75===t[1]&&3===t[2]&&4===t[3]&&109===t[30]&&105===t[31]&&109===t[32]&&101===t[33]&&116===t[34]&&121===t[35]&&112===t[36]&&101===t[37]&&97===t[38]&&112===t[39]&&112===t[40]&&108===t[41]&&105===t[42]&&99===t[43]&&97===t[44]&&116===t[45]&&105===t[46]&&111===t[47]&&110===t[48]&&47===t[49]&&101===t[50]&&112===t[51]&&117===t[52]&&98===t[53]&&43===t[54]&&122===t[55]&&105===t[56]&&112===t[57]?{ext:"epub",mime:"application/epub+zip"}:80===t[0]&&75===t[1]&&3===t[2]&&4===t[3]&&77===t[30]&&69===t[31]&&84===t[32]&&65===t[33]&&45===t[34]&&73===t[35]&&78===t[36]&&70===t[37]&&47===t[38]&&109===t[39]&&111===t[40]&&122===t[41]&&105===t[42]&&108===t[43]&&108===t[44]&&97===t[45]&&46===t[46]&&114===t[47]&&115===t[48]&&97===t[49]?{ext:"xpi",mime:"application/x-xpinstall"}:80!==t[0]||75!==t[1]||3!==t[2]&&5!==t[2]&&7!==t[2]||4!==t[3]&&6!==t[3]&&8!==t[3]?117===t[257]&&115===t[258]&&116===t[259]&&97===t[260]&&114===t[261]?{ext:"tar",mime:"application/x-tar"}:82!==t[0]||97!==t[1]||114!==t[2]||33!==t[3]||26!==t[4]||7!==t[5]||0!==t[6]&&1!==t[6]?31===t[0]&&139===t[1]&&8===t[2]?{ext:"gz",mime:"application/gzip"}:66===t[0]&&90===t[1]&&104===t[2]?{ext:"bz2",mime:"application/x-bzip2"}:55===t[0]&&122===t[1]&&188===t[2]&&175===t[3]&&39===t[4]&&28===t[5]?{ext:"7z",mime:"application/x-7z-compressed"}:120===t[0]&&1===t[1]?{ext:"dmg",mime:"application/x-apple-diskimage"}:0===t[0]&&0===t[1]&&0===t[2]&&(24===t[3]||32===t[3])&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]||51===t[0]&&103===t[1]&&112===t[2]&&53===t[3]||0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&109===t[8]&&112===t[9]&&52===t[10]&&50===t[11]&&109===t[16]&&112===t[17]&&52===t[18]&&49===t[19]&&109===t[20]&&112===t[21]&&52===t[22]&&50===t[23]&&105===t[24]&&115===t[25]&&111===t[26]&&109===t[27]||0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&105===t[8]&&115===t[9]&&111===t[10]&&109===t[11]||0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&109===t[8]&&112===t[9]&&52===t[10]&&50===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&0===t[15]?{ext:"mp4",mime:"video/mp4"}:0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&77===t[8]&&52===t[9]&&86===t[10]?{ext:"m4v",mime:"video/x-m4v"}:77===t[0]&&84===t[1]&&104===t[2]&&100===t[3]?{ext:"mid",mime:"audio/midi"}:109===t[31]&&97===t[32]&&116===t[33]&&114===t[34]&&111===t[35]&&115===t[36]&&107===t[37]&&97===t[38]?{ext:"mkv",mime:"video/x-matroska"}:26===t[0]&&69===t[1]&&223===t[2]&&163===t[3]?{ext:"webm",mime:"video/webm"}:0===t[0]&&0===t[1]&&0===t[2]&&20===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]?{ext:"mov",mime:"video/quicktime"}:82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&65===t[8]&&86===t[9]&&73===t[10]?{ext:"avi",mime:"video/x-msvideo"}:48===t[0]&&38===t[1]&&178===t[2]&&117===t[3]&&142===t[4]&&102===t[5]&&207===t[6]&&17===t[7]&&166===t[8]&&217===t[9]?{ext:"wmv",mime:"video/x-ms-wmv"}:0===t[0]&&0===t[1]&&1===t[2]&&"b"===t[3].toString(16)[0]?{ext:"mpg",mime:"video/mpeg"}:73===t[0]&&68===t[1]&&51===t[2]||255===t[0]&&251===t[1]?{ext:"mp3",mime:"audio/mpeg"}:102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&77===t[8]&&52===t[9]&&65===t[10]||77===t[0]&&52===t[1]&&65===t[2]&&32===t[3]?{ext:"m4a",mime:"audio/m4a"}:79===t[28]&&112===t[29]&&117===t[30]&&115===t[31]&&72===t[32]&&101===t[33]&&97===t[34]&&100===t[35]?{ext:"opus",mime:"audio/opus"}:79===t[0]&&103===t[1]&&103===t[2]&&83===t[3]?{ext:"ogg",mime:"audio/ogg"}:102===t[0]&&76===t[1]&&97===t[2]&&67===t[3]?{ext:"flac",mime:"audio/x-flac"}:82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&87===t[8]&&65===t[9]&&86===t[10]&&69===t[11]?{ext:"wav",mime:"audio/x-wav"}:35===t[0]&&33===t[1]&&65===t[2]&&77===t[3]&&82===t[4]&&10===t[5]?{ext:"amr",mime:"audio/amr"}:37===t[0]&&80===t[1]&&68===t[2]&&70===t[3]?{ext:"pdf",mime:"application/pdf"}:77===t[0]&&90===t[1]?{ext:"exe",mime:"application/x-msdownload"}:67!==t[0]&&70!==t[0]||87!==t[1]||83!==t[2]?123===t[0]&&92===t[1]&&114===t[2]&&116===t[3]&&102===t[4]?{ext:"rtf",mime:"application/rtf"}:119===t[0]&&79===t[1]&&70===t[2]&&70===t[3]&&(0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]||79===t[4]&&84===t[5]&&84===t[6]&&79===t[7])?{ext:"woff",mime:"application/font-woff"}:119===t[0]&&79===t[1]&&70===t[2]&&50===t[3]&&(0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]||79===t[4]&&84===t[5]&&84===t[6]&&79===t[7])?{ext:"woff2",mime:"application/font-woff"}:76===t[34]&&80===t[35]&&(0===t[8]&&0===t[9]&&1===t[10]||1===t[8]&&0===t[9]&&2===t[10]||2===t[8]&&0===t[9]&&2===t[10])?{ext:"eot",mime:"application/octet-stream"}:0===t[0]&&1===t[1]&&0===t[2]&&0===t[3]&&0===t[4]?{ext:"ttf",mime:"application/font-sfnt"}:79===t[0]&&84===t[1]&&84===t[2]&&79===t[3]&&0===t[4]?{ext:"otf",mime:"application/font-sfnt"}:0===t[0]&&0===t[1]&&1===t[2]&&0===t[3]?{ext:"ico",mime:"image/x-icon"}:70===t[0]&&76===t[1]&&86===t[2]&&1===t[3]?{ext:"flv",mime:"video/x-flv"}:37===t[0]&&33===t[1]?{ext:"ps",mime:"application/postscript"}:253===t[0]&&55===t[1]&&122===t[2]&&88===t[3]&&90===t[4]&&0===t[5]?{ext:"xz",mime:"application/x-xz"}:83===t[0]&&81===t[1]&&76===t[2]&&105===t[3]?{ext:"sqlite",mime:"application/x-sqlite3"}:78===t[0]&&69===t[1]&&83===t[2]&&26===t[3]?{ext:"nes",mime:"application/x-nintendo-nes-rom"}:67===t[0]&&114===t[1]&&50===t[2]&&52===t[3]?{ext:"crx",mime:"application/x-google-chrome-extension"}:77===t[0]&&83===t[1]&&67===t[2]&&70===t[3]||73===t[0]&&83===t[1]&&99===t[2]&&40===t[3]?{ext:"cab",mime:"application/vnd.ms-cab-compressed"}:33===t[0]&&60===t[1]&&97===t[2]&&114===t[3]&&99===t[4]&&104===t[5]&&62===t[6]&&10===t[7]&&100===t[8]&&101===t[9]&&98===t[10]&&105===t[11]&&97===t[12]&&110===t[13]&&45===t[14]&&98===t[15]&&105===t[16]&&110===t[17]&&97===t[18]&&114===t[19]&&121===t[20]?{ext:"deb",mime:"application/x-deb"}:33===t[0]&&60===t[1]&&97===t[2]&&114===t[3]&&99===t[4]&&104===t[5]&&62===t[6]?{ext:"ar",mime:"application/x-unix-archive"}:237===t[0]&&171===t[1]&&238===t[2]&&219===t[3]?{ext:"rpm",mime:"application/x-rpm"}:31===t[0]&&160===t[1]||31===t[0]&&157===t[1]?{ext:"Z",mime:"application/x-compress"}:76===t[0]&&90===t[1]&&73===t[2]&&80===t[3]?{ext:"lz",mime:"application/x-lzip"}:208===t[0]&&207===t[1]&&17===t[2]&&224===t[3]&&161===t[4]&&177===t[5]&&26===t[6]&&225===t[7]?{ext:"msi",mime:"application/x-msi"}:null:{ext:"swf",mime:"application/x-shockwave-flash"}:{ext:"rar",mime:"application/x-rar-compressed"}:{ext:"zip",mime:"application/zip"}:null}},function(t,e,r){var n;(function(t,i){(function(){function o(t,e){if(t!==e){var r=null===t,n=t===S,i=t===t,o=null===e,f=e===S,a=e===e;if(t>e&&!o||!i||r&&!f&&a||n&&a)return 1;if(e>t&&!r||!a||o&&!n&&i||f&&i)return-1}return 0}function f(t,e,r){for(var n=t.length,i=r?n:-1;r?i--:++i<n;)if(e(t[i],i,t))return i;return-1}function a(t,e,r){if(e!==e)return w(t,r);for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}function u(t){return"function"==typeof t||!1}function s(t){return null==t?"":t+""}function h(t,e){for(var r=-1,n=t.length;++r<n&&e.indexOf(t.charAt(r))>-1;);return r}function l(t,e){for(var r=t.length;r--&&e.indexOf(t.charAt(r))>-1;);return r}function c(t,e){return o(t.criteria,e.criteria)||t.index-e.index}function p(t,e,r){for(var n=-1,i=t.criteria,f=e.criteria,a=i.length,u=r.length;++n<a;){var s=o(i[n],f[n]);if(s){if(n>=u)return s;var h=r[n];return s*("asc"===h||h===!0?1:-1)}}return t.index-e.index}function g(t){return Kt[t]}function v(t){return Zt[t]}function d(t,e,r){return e?t=Xt[t]:r&&(t=Yt[t]),"\\\\"+t}function y(t){return"\\\\"+Yt[t]}function w(t,e,r){for(var n=t.length,i=e+(r?0:-1);r?i--:++i<n;){var o=t[i];if(o!==o)return i}return-1}function m(t){return!!t&&"object"==typeof t}function b(t){return 160>=t&&t>=9&&13>=t||32==t||160==t||5760==t||6158==t||t>=8192&&(8202>=t||8232==t||8233==t||8239==t||8287==t||12288==t||65279==t)}function _(t,e){for(var r=-1,n=t.length,i=-1,o=[];++r<n;)t[r]===e&&(t[r]=K,o[++i]=r);return o}function E(t,e){for(var r,n=-1,i=t.length,o=-1,f=[];++n<i;){var a=t[n],u=e?e(a,n,t):a;\nn&&r===u||(r=u,f[++o]=a)}return f}function x(t){for(var e=-1,r=t.length;++e<r&&b(t.charCodeAt(e)););return e}function A(t){for(var e=t.length;e--&&b(t.charCodeAt(e)););return e}function I(t){return Jt[t]}function T(t){function e(t){if(m(t)&&!ka(t)&&!(t instanceof i)){if(t instanceof n)return t;if(ef.call(t,"__chain__")&&ef.call(t,"__wrapped__"))return pn(t)}return new n(t)}function r(){}function n(t,e,r){this.__wrapped__=t,this.__actions__=r||[],this.__chain__=!!e}function i(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Uf,this.__views__=[]}function b(){var t=new i(this.__wrapped__);return t.__actions__=te(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=te(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=te(this.__views__),t}function Q(){if(this.__filtered__){var t=new i(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function nt(){var t=this.__wrapped__.value(),e=this.__dir__,r=ka(t),n=0>e,i=r?t.length:0,o=qr(0,i,this.__views__),f=o.start,a=o.end,u=a-f,s=n?a:f-1,h=this.__iteratees__,l=h.length,c=0,p=Af(u,this.__takeCount__);if(!r||P>i||i==u&&p==u)return rr(n&&r?t.reverse():t,this.__actions__);var g=[];t:for(;u--&&p>c;){s+=e;for(var v=-1,d=t[s];++v<l;){var y=h[v],w=y.iteratee,m=y.type,b=w(d);if(m==V)d=b;else if(!b){if(m==W)continue t;break t}}g[c++]=d}return g}function ot(){this.__data__={}}function Kt(t){return this.has(t)&&delete this.__data__[t]}function Zt(t){return"__proto__"==t?S:this.__data__[t]}function Jt(t){return"__proto__"!=t&&ef.call(this.__data__,t)}function $t(t,e){return"__proto__"!=t&&(this.__data__[t]=e),this}function Xt(t){var e=t?t.length:0;for(this.data={hash:wf(null),set:new cf};e--;)this.push(t[e])}function Yt(t,e){var r=t.data,n="string"==typeof e||Ni(e)?r.set.has(e):r.hash[e];return n?0:-1}function Gt(t){var e=this.data;"string"==typeof t||Ni(t)?e.set.add(t):e.hash[t]=!0}function Qt(t,e){for(var r=-1,n=t.length,i=-1,o=e.length,f=Ho(n+o);++r<n;)f[r]=t[r];for(;++i<o;)f[r++]=e[i];return f}function te(t,e){var r=-1,n=t.length;for(e||(e=Ho(n));++r<n;)e[r]=t[r];return e}function ee(t,e){for(var r=-1,n=t.length;++r<n&&e(t[r],r,t)!==!1;);return t}function re(t,e){for(var r=t.length;r--&&e(t[r],r,t)!==!1;);return t}function oe(t,e){for(var r=-1,n=t.length;++r<n;)if(!e(t[r],r,t))return!1;return!0}function fe(t,e,r,n){for(var i=-1,o=t.length,f=n,a=f;++i<o;){var u=t[i],s=+e(u);r(s,f)&&(f=s,a=u)}return a}function ae(t,e){for(var r=-1,n=t.length,i=-1,o=[];++r<n;){var f=t[r];e(f,r,t)&&(o[++i]=f)}return o}function ue(t,e){for(var r=-1,n=t.length,i=Ho(n);++r<n;)i[r]=e(t[r],r,t);return i}function se(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}function he(t,e,r,n){var i=-1,o=t.length;for(n&&o&&(r=t[++i]);++i<o;)r=e(r,t[i],i,t);return r}function le(t,e,r,n){var i=t.length;for(n&&i&&(r=t[--i]);i--;)r=e(r,t[i],i,t);return r}function ce(t,e){for(var r=-1,n=t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function pe(t,e){for(var r=t.length,n=0;r--;)n+=+e(t[r])||0;return n}function ge(t,e){return t===S?e:t}function ve(t,e,r,n){return t!==S&&ef.call(n,r)?t:e}function de(t,e,r){for(var n=-1,i=Ha(e),o=i.length;++n<o;){var f=i[n],a=t[f],u=r(a,e[f],f,t,e);(u===u?u===a:a!==a)&&(a!==S||f in t)||(t[f]=u)}return t}function ye(t,e){return null==e?t:me(e,Ha(e),t)}function we(t,e){for(var r=-1,n=null==t,i=!n&&Xr(t),o=i?t.length:0,f=e.length,a=Ho(f);++r<f;){var u=e[r];i?a[r]=Yr(u,o)?t[u]:S:a[r]=n?S:t[u]}return a}function me(t,e,r){r||(r={});for(var n=-1,i=e.length;++n<i;){var o=e[n];r[o]=t[o]}return r}function be(t,e,r){var n=typeof t;return"function"==n?e===S?t:or(t,e,r):null==t?Lo:"object"==n?De(t):e===S?No(t):je(t,e)}function _e(t,e,r,n,i,o,f){var a;if(r&&(a=i?r(t,n,i):r(t)),a!==S)return a;if(!Ni(t))return t;var u=ka(t);if(u){if(a=Kr(t),!e)return te(t,a)}else{var s=nf.call(t),h=s==G;if(s!=et&&s!=Z&&(!h||i))return qt[s]?Jr(t,s,e):i?t:{};if(a=Zr(h?{}:t),!e)return ye(a,t)}o||(o=[]),f||(f=[]);for(var l=o.length;l--;)if(o[l]==t)return f[l];return o.push(t),f.push(a),(u?ee:Be)(t,function(n,i){a[i]=_e(n,e,r,i,t,o,f)}),a}function Ee(t,e,r){if("function"!=typeof t)throw new Xo(q);return pf(function(){t.apply(S,r)},e)}function xe(t,e){var r=t?t.length:0,n=[];if(!r)return n;var i=-1,o=Pr(),f=o==a,u=f&&e.length>=P?gr(e):null,s=e.length;u&&(o=Yt,f=!1,e=u);t:for(;++i<r;){var h=t[i];if(f&&h===h){for(var l=s;l--;)if(e[l]===h)continue t;n.push(h)}else o(e,h,0)<0&&n.push(h)}return n}function Ae(t,e){var r=!0;return Mf(t,function(t,n,i){return r=!!e(t,n,i)}),r}function Ie(t,e,r,n){var i=n,o=i;return Mf(t,function(t,f,a){var u=+e(t,f,a);(r(u,i)||u===n&&u===o)&&(i=u,o=t)}),o}function Te(t,e,r,n){var i=t.length;for(r=null==r?0:+r||0,0>r&&(r=-r>i?0:i+r),n=n===S||n>i?i:+n||0,0>n&&(n+=i),i=r>n?0:n>>>0,r>>>=0;i>r;)t[r++]=e;return t}function Se(t,e){var r=[];return Mf(t,function(t,n,i){e(t,n,i)&&r.push(t)}),r}function Le(t,e,r,n){var i;return r(t,function(t,r,o){return e(t,r,o)?(i=n?r:t,!1):void 0}),i}function Ue(t,e,r,n){n||(n=[]);for(var i=-1,o=t.length;++i<o;){var f=t[i];m(f)&&Xr(f)&&(r||ka(f)||Ii(f))?e?Ue(f,e,r,n):se(n,f):r||(n[n.length]=f)}return n}function ke(t,e){return Df(t,e,to)}function Be(t,e){return Df(t,e,Ha)}function Re(t,e){return jf(t,e,Ha)}function Ce(t,e){for(var r=-1,n=e.length,i=-1,o=[];++r<n;){var f=e[r];Ci(t[f])&&(o[++i]=f)}return o}function Ne(t,e,r){if(null!=t){r!==S&&r in ln(t)&&(e=[r]);for(var n=0,i=e.length;null!=t&&i>n;)t=t[e[n++]];return n&&n==i?t:S}}function Oe(t,e,r,n,i,o){return t===e?!0:null==t||null==e||!Ni(t)&&!m(e)?t!==t&&e!==e:Fe(t,e,Oe,r,n,i,o)}function Fe(t,e,r,n,i,o,f){var a=ka(t),u=ka(e),s=J,h=J;a||(s=nf.call(t),s==Z?s=et:s!=et&&(a=Wi(t))),u||(h=nf.call(e),h==Z?h=et:h!=et&&(u=Wi(e)));var l=s==et,c=h==et,p=s==h;if(p&&!a&&!l)return zr(t,e,s);if(!i){var g=l&&ef.call(t,"__wrapped__"),v=c&&ef.call(e,"__wrapped__");if(g||v)return r(g?t.value():t,v?e.value():e,n,i,o,f)}if(!p)return!1;o||(o=[]),f||(f=[]);for(var d=o.length;d--;)if(o[d]==t)return f[d]==e;o.push(t),f.push(e);var y=(a?Mr:Dr)(t,e,r,n,i,o,f);return o.pop(),f.pop(),y}function Me(t,e,r){var n=e.length,i=n,o=!r;if(null==t)return!i;for(t=ln(t);n--;){var f=e[n];if(o&&f[2]?f[1]!==t[f[0]]:!(f[0]in t))return!1}for(;++n<i;){f=e[n];var a=f[0],u=t[a],s=f[1];if(o&&f[2]){if(u===S&&!(a in t))return!1}else{var h=r?r(u,s,a):S;if(!(h===S?Oe(s,u,r,!0):h))return!1}}return!0}function ze(t,e){var r=-1,n=Xr(t)?Ho(t.length):[];return Mf(t,function(t,i,o){n[++r]=e(t,i,o)}),n}function De(t){var e=Wr(t);if(1==e.length&&e[0][2]){var r=e[0][0],n=e[0][1];return function(t){return null==t?!1:t[r]===n&&(n!==S||r in ln(t))}}return function(t){return Me(t,e)}}function je(t,e){var r=ka(t),n=Qr(t)&&rn(e),i=t+"";return t=cn(t),function(o){if(null==o)return!1;var f=i;if(o=ln(o),(r||!n)&&!(f in o)){if(o=1==t.length?o:Ne(o,Je(t,0,-1)),null==o)return!1;f=Tn(t),o=ln(o)}return o[f]===e?e!==S||f in o:Oe(e,o[f],S,!0)}}function He(t,e,r,n,i){if(!Ni(t))return t;var o=Xr(e)&&(ka(e)||Wi(e)),f=o?S:Ha(e);return ee(f||e,function(a,u){if(f&&(u=a,a=e[u]),m(a))n||(n=[]),i||(i=[]),Pe(t,e,u,He,r,n,i);else{var s=t[u],h=r?r(s,a,u,t,e):S,l=h===S;l&&(h=a),h===S&&(!o||u in t)||!l&&(h===h?h===s:s!==s)||(t[u]=h)}}),t}function Pe(t,e,r,n,i,o,f){for(var a=o.length,u=e[r];a--;)if(o[a]==u)return void(t[r]=f[a]);var s=t[r],h=i?i(s,u,r,t,e):S,l=h===S;l&&(h=u,Xr(u)&&(ka(u)||Wi(u))?h=ka(s)?s:Xr(s)?te(s):[]:ji(u)||Ii(u)?h=Ii(s)?Ji(s):ji(s)?s:{}:l=!1),o.push(u),f.push(h),l?t[r]=n(h,u,i,o,f):(h===h?h!==s:s===s)&&(t[r]=h)}function We(t){return function(e){return null==e?S:e[t]}}function Ve(t){var e=t+"";return t=cn(t),function(r){return Ne(r,t,e)}}function qe(t,e){for(var r=t?e.length:0;r--;){var n=e[r];if(n!=i&&Yr(n)){var i=n;gf.call(t,n,1)}}return t}function Ke(t,e){return t+mf(Sf()*(e-t+1))}function Ze(t,e,r,n,i){return i(t,function(t,i,o){r=n?(n=!1,t):e(r,t,i,o)}),r}function Je(t,e,r){var n=-1,i=t.length;e=null==e?0:+e||0,0>e&&(e=-e>i?0:i+e),r=r===S||r>i?i:+r||0,0>r&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var o=Ho(i);++n<i;)o[n]=t[n+e];return o}function $e(t,e){var r;return Mf(t,function(t,n,i){return r=e(t,n,i),!r}),!!r}function Xe(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}function Ye(t,e,r){var n=jr(),i=-1;e=ue(e,function(t){return n(t)});var o=ze(t,function(t){var r=ue(e,function(e){return e(t)});return{criteria:r,index:++i,value:t}});return Xe(o,function(t,e){return p(t,e,r)})}function Ge(t,e){var r=0;return Mf(t,function(t,n,i){r+=+e(t,n,i)||0}),r}function Qe(t,e){var r=-1,n=Pr(),i=t.length,o=n==a,f=o&&i>=P,u=f?gr():null,s=[];u?(n=Yt,o=!1):(f=!1,u=e?[]:s);t:for(;++r<i;){var h=t[r],l=e?e(h,r,t):h;if(o&&h===h){for(var c=u.length;c--;)if(u[c]===l)continue t;e&&u.push(l),s.push(h)}else n(u,l,0)<0&&((e||f)&&u.push(l),s.push(h))}return s}function tr(t,e){for(var r=-1,n=e.length,i=Ho(n);++r<n;)i[r]=t[e[r]];return i}function er(t,e,r,n){for(var i=t.length,o=n?i:-1;(n?o--:++o<i)&&e(t[o],o,t););return r?Je(t,n?0:o,n?o+1:i):Je(t,n?o+1:0,n?i:o)}function rr(t,e){var r=t;r instanceof i&&(r=r.value());for(var n=-1,o=e.length;++n<o;){var f=e[n];r=f.func.apply(f.thisArg,se([r],f.args))}return r}function nr(t,e,r){var n=0,i=t?t.length:n;if("number"==typeof e&&e===e&&Rf>=i){for(;i>n;){var o=n+i>>>1,f=t[o];(r?e>=f:e>f)&&null!==f?n=o+1:i=o}return i}return ir(t,e,Lo,r)}function ir(t,e,r,n){e=r(e);for(var i=0,o=t?t.length:0,f=e!==e,a=null===e,u=e===S;o>i;){var s=mf((i+o)/2),h=r(t[s]),l=h!==S,c=h===h;if(f)var p=c||n;else p=a?c&&l&&(n||null!=h):u?c&&(n||l):null==h?!1:n?e>=h:e>h;p?i=s+1:o=s}return Af(o,Bf)}function or(t,e,r){if("function"!=typeof t)return Lo;if(e===S)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 3:return function(r,n,i){return t.call(e,r,n,i)};case 4:return function(r,n,i,o){return t.call(e,r,n,i,o)};case 5:return function(r,n,i,o,f){return t.call(e,r,n,i,o,f)}}return function(){return t.apply(e,arguments)}}function fr(t){var e=new af(t.byteLength),r=new vf(e);return r.set(new vf(t)),e}function ar(t,e,r){for(var n=r.length,i=-1,o=xf(t.length-n,0),f=-1,a=e.length,u=Ho(a+o);++f<a;)u[f]=e[f];for(;++i<n;)u[r[i]]=t[i];for(;o--;)u[f++]=t[i++];return u}function ur(t,e,r){for(var n=-1,i=r.length,o=-1,f=xf(t.length-i,0),a=-1,u=e.length,s=Ho(f+u);++o<f;)s[o]=t[o];for(var h=o;++a<u;)s[h+a]=e[a];for(;++n<i;)s[h+r[n]]=t[o++];return s}function sr(t,e){return function(r,n,i){var o=e?e():{};if(n=jr(n,i,3),ka(r))for(var f=-1,a=r.length;++f<a;){var u=r[f];t(o,u,n(u,f,r),r)}else Mf(r,function(e,r,i){t(o,e,n(e,r,i),i)});return o}}function hr(t){return yi(function(e,r){var n=-1,i=null==e?0:r.length,o=i>2?r[i-2]:S,f=i>2?r[2]:S,a=i>1?r[i-1]:S;for("function"==typeof o?(o=or(o,a,5),i-=2):(o="function"==typeof a?a:S,i-=o?1:0),f&&Gr(r[0],r[1],f)&&(o=3>i?S:o,i=1);++n<i;){var u=r[n];u&&t(e,u,o)}return e})}function lr(t,e){return function(r,n){var i=r?Wf(r):0;if(!en(i))return t(r,n);for(var o=e?i:-1,f=ln(r);(e?o--:++o<i)&&n(f[o],o,f)!==!1;);return r}}function cr(t){return function(e,r,n){for(var i=ln(e),o=n(e),f=o.length,a=t?f:-1;t?a--:++a<f;){var u=o[a];if(r(i[u],u,i)===!1)break}return e}}function pr(t,e){function r(){var i=this&&this!==ne&&this instanceof r?n:t;return i.apply(e,arguments)}var n=dr(t);return r}function gr(t){return wf&&cf?new Xt(t):null}function vr(t){return function(e){for(var r=-1,n=Io(ho(e)),i=n.length,o="";++r<i;)o=t(o,n[r],r);return o}}function dr(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var r=Ff(t.prototype),n=t.apply(r,e);return Ni(n)?n:r}}function yr(t){function e(r,n,i){i&&Gr(r,n,i)&&(n=S);var o=Fr(r,t,S,S,S,S,S,n);return o.placeholder=e.placeholder,o}return e}function wr(t,e){return yi(function(r){var n=r[0];return null==n?n:(r.push(e),t.apply(S,r))})}function mr(t,e){return function(r,n,i){if(i&&Gr(r,n,i)&&(n=S),n=jr(n,i,3),1==n.length){r=ka(r)?r:hn(r);var o=fe(r,n,t,e);if(!r.length||o!==e)return o}return Ie(r,n,t,e)}}function br(t,e){return function(r,n,i){if(n=jr(n,i,3),ka(r)){var o=f(r,n,e);return o>-1?r[o]:S}return Le(r,n,t)}}function _r(t){return function(e,r,n){return e&&e.length?(r=jr(r,n,3),f(e,r,t)):-1}}function Er(t){return function(e,r,n){return r=jr(r,n,3),Le(e,r,t,!0)}}function xr(t){return function(){for(var e,r=arguments.length,i=t?r:-1,o=0,f=Ho(r);t?i--:++i<r;){var a=f[o++]=arguments[i];if("function"!=typeof a)throw new Xo(q);!e&&n.prototype.thru&&"wrapper"==Hr(a)&&(e=new n([],!0))}for(i=e?-1:r;++i<r;){a=f[i];var u=Hr(a),s="wrapper"==u?Pf(a):S;e=s&&tn(s[0])&&s[1]==(F|R|N|M)&&!s[4].length&&1==s[9]?e[Hr(s[0])].apply(e,s[3]):1==a.length&&tn(a)?e[u]():e.thru(a)}return function(){var t=arguments,n=t[0];if(e&&1==t.length&&ka(n)&&n.length>=P)return e.plant(n).value();for(var i=0,o=r?f[i].apply(this,t):n;++i<r;)o=f[i].call(this,o);return o}}}function Ar(t,e){return function(r,n,i){return"function"==typeof n&&i===S&&ka(r)?t(r,n):e(r,or(n,i,3))}}function Ir(t){return function(e,r,n){return"function"==typeof r&&n===S||(r=or(r,n,3)),t(e,r,to)}}function Tr(t){return function(e,r,n){return"function"==typeof r&&n===S||(r=or(r,n,3)),t(e,r)}}function Sr(t){return function(e,r,n){var i={};return r=jr(r,n,3),Be(e,function(e,n,o){var f=r(e,n,o);n=t?f:n,e=t?e:f,i[n]=e}),i}}function Lr(t){return function(e,r,n){return e=s(e),(t?e:"")+Rr(e,r,n)+(t?"":e)}}function Ur(t){var e=yi(function(r,n){var i=_(n,e.placeholder);return Fr(r,t,S,n,i)});return e}function kr(t,e){return function(r,n,i,o){var f=arguments.length<3;return"function"==typeof n&&o===S&&ka(r)?t(r,n,i,f):Ze(r,jr(n,o,4),i,f,e)}}function Br(t,e,r,n,i,o,f,a,u,s){function h(){for(var w=arguments.length,m=w,b=Ho(w);m--;)b[m]=arguments[m];if(n&&(b=ar(b,n,i)),o&&(b=ur(b,o,f)),g||d){var E=h.placeholder,x=_(b,E);if(w-=x.length,s>w){var A=a?te(a):S,I=xf(s-w,0),T=g?x:S,L=g?S:x,B=g?b:S,R=g?S:b;e|=g?N:O,e&=~(g?O:N),v||(e&=~(U|k));var C=[t,e,r,B,T,R,L,A,u,I],F=Br.apply(S,C);return tn(t)&&Vf(F,C),F.placeholder=E,F}}var M=c?r:this,z=p?M[t]:t;return a&&(b=un(b,a)),l&&u<b.length&&(b.length=u),this&&this!==ne&&this instanceof h&&(z=y||dr(t)),z.apply(M,b)}var l=e&F,c=e&U,p=e&k,g=e&R,v=e&B,d=e&C,y=p?S:dr(t);return h}function Rr(t,e,r){var n=t.length;if(e=+e,n>=e||!_f(e))return"";var i=e-n;return r=null==r?" ":r+"",yo(r,yf(i/r.length)).slice(0,i)}function Cr(t,e,r,n){function i(){for(var e=-1,a=arguments.length,u=-1,s=n.length,h=Ho(s+a);++u<s;)h[u]=n[u];for(;a--;)h[u++]=arguments[++e];var l=this&&this!==ne&&this instanceof i?f:t;return l.apply(o?r:this,h)}var o=e&U,f=dr(t);return i}function Nr(t){var e=qo[t];return function(t,r){return r=r===S?0:+r||0,r?(r=hf(10,r),e(t*r)/r):e(t)}}function Or(t){return function(e,r,n,i){var o=jr(n);return null==n&&o===be?nr(e,r,t):ir(e,r,o(n,i,1),t)}}function Fr(t,e,r,n,i,o,f,a){var u=e&k;if(!u&&"function"!=typeof t)throw new Xo(q);var s=n?n.length:0;if(s||(e&=~(N|O),n=i=S),s-=i?i.length:0,e&O){var h=n,l=i;n=i=S}var c=u?S:Pf(t),p=[t,e,r,n,i,h,l,o,f,a];if(c&&(nn(p,c),e=p[1],a=p[9]),p[9]=null==a?u?0:t.length:xf(a-s,0)||0,e==U)var g=pr(p[0],p[2]);else g=e!=N&&e!=(U|N)||p[4].length?Br.apply(S,p):Cr.apply(S,p);var v=c?Hf:Vf;return v(g,p)}function Mr(t,e,r,n,i,o,f){var a=-1,u=t.length,s=e.length;if(u!=s&&!(i&&s>u))return!1;for(;++a<u;){var h=t[a],l=e[a],c=n?n(i?l:h,i?h:l,a):S;if(c!==S){if(c)continue;return!1}if(i){if(!ce(e,function(t){return h===t||r(h,t,n,i,o,f)}))return!1}else if(h!==l&&!r(h,l,n,i,o,f))return!1}return!0}function zr(t,e,r){switch(r){case $:case X:return+t==+e;case Y:return t.name==e.name&&t.message==e.message;case tt:return t!=+t?e!=+e:t==+e;case rt:case it:return t==e+""}return!1}function Dr(t,e,r,n,i,o,f){var a=Ha(t),u=a.length,s=Ha(e),h=s.length;if(u!=h&&!i)return!1;for(var l=u;l--;){var c=a[l];if(!(i?c in e:ef.call(e,c)))return!1}for(var p=i;++l<u;){c=a[l];var g=t[c],v=e[c],d=n?n(i?v:g,i?g:v,c):S;if(!(d===S?r(g,v,n,i,o,f):d))return!1;p||(p="constructor"==c)}if(!p){var y=t.constructor,w=e.constructor;if(y!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof w&&w instanceof w))return!1}return!0}function jr(t,r,n){var i=e.callback||To;return i=i===To?be:i,n?i(t,r,n):i}function Hr(t){for(var e=t.name,r=Of[e],n=r?r.length:0;n--;){var i=r[n],o=i.func;if(null==o||o==t)return i.name}return e}function Pr(t,r,n){var i=e.indexOf||An;return i=i===An?a:i,t?i(t,r,n):i}function Wr(t){for(var e=eo(t),r=e.length;r--;)e[r][2]=rn(e[r][1]);return e}function Vr(t,e){var r=null==t?S:t[e];return Mi(r)?r:S}function qr(t,e,r){for(var n=-1,i=r.length;++n<i;){var o=r[n],f=o.size;switch(o.type){case"drop":t+=f;break;case"dropRight":e-=f;break;case"take":e=Af(e,t+f);break;case"takeRight":t=xf(t,e-f)}}return{start:t,end:e}}function Kr(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&ef.call(t,"index")&&(r.index=t.index,r.input=t.input),r}function Zr(t){var e=t.constructor;return"function"==typeof e&&e instanceof e||(e=Zo),new e}function Jr(t,e,r){var n=t.constructor;switch(e){case ft:return fr(t);case $:case X:return new n(+t);case at:case ut:case st:case ht:case lt:case ct:case pt:case gt:case vt:var i=t.buffer;return new n(r?fr(i):i,t.byteOffset,t.length);case tt:case it:return new n(t);case rt:var o=new n(t.source,Nt.exec(t));o.lastIndex=t.lastIndex}return o}function $r(t,e,r){null==t||Qr(e,t)||(e=cn(e),t=1==e.length?t:Ne(t,Je(e,0,-1)),e=Tn(e));var n=null==t?t:t[e];return null==n?S:n.apply(t,r)}function Xr(t){return null!=t&&en(Wf(t))}function Yr(t,e){return t="number"==typeof t||Mt.test(t)?+t:-1,e=null==e?Cf:e,t>-1&&t%1==0&&e>t}function Gr(t,e,r){if(!Ni(r))return!1;var n=typeof e;if("number"==n?Xr(r)&&Yr(e,r.length):"string"==n&&e in r){var i=r[e];return t===t?t===i:i!==i}return!1}function Qr(t,e){var r=typeof t;if("string"==r&&St.test(t)||"number"==r)return!0;if(ka(t))return!1;var n=!Tt.test(t);return n||null!=e&&t in ln(e)}function tn(t){var r=Hr(t);if(!(r in i.prototype))return!1;var n=e[r];if(t===n)return!0;var o=Pf(n);return!!o&&t===o[0]}function en(t){return"number"==typeof t&&t>-1&&t%1==0&&Cf>=t}function rn(t){return t===t&&!Ni(t)}function nn(t,e){var r=t[1],n=e[1],i=r|n,o=F>i,f=n==F&&r==R||n==F&&r==M&&t[7].length<=e[8]||n==(F|M)&&r==R;if(!o&&!f)return t;n&U&&(t[2]=e[2],i|=r&U?0:B);var a=e[3];if(a){var u=t[3];t[3]=u?ar(u,a,e[4]):te(a),t[4]=u?_(t[3],K):te(e[4])}return a=e[5],a&&(u=t[5],t[5]=u?ur(u,a,e[6]):te(a),t[6]=u?_(t[5],K):te(e[6])),a=e[7],a&&(t[7]=te(a)),n&F&&(t[8]=null==t[8]?e[8]:Af(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i,t}function on(t,e){return t===S?e:Ba(t,e,on)}function fn(t,e){t=ln(t);for(var r=-1,n=e.length,i={};++r<n;){var o=e[r];o in t&&(i[o]=t[o])}return i}function an(t,e){var r={};return ke(t,function(t,n,i){e(t,n,i)&&(r[n]=t)}),r}function un(t,e){for(var r=t.length,n=Af(e.length,r),i=te(t);n--;){var o=e[n];t[n]=Yr(o,r)?i[o]:S}return t}function sn(t){for(var e=to(t),r=e.length,n=r&&t.length,i=!!n&&en(n)&&(ka(t)||Ii(t)),o=-1,f=[];++o<r;){var a=e[o];(i&&Yr(a,n)||ef.call(t,a))&&f.push(a)}return f}function hn(t){return null==t?[]:Xr(t)?Ni(t)?t:Zo(t):oo(t)}function ln(t){return Ni(t)?t:Zo(t)}function cn(t){if(ka(t))return t;var e=[];return s(t).replace(Lt,function(t,r,n,i){e.push(n?i.replace(Rt,"$1"):r||t)}),e}function pn(t){return t instanceof i?t.clone():new n(t.__wrapped__,t.__chain__,te(t.__actions__))}function gn(t,e,r){e=(r?Gr(t,e,r):null==e)?1:xf(mf(e)||1,1);for(var n=0,i=t?t.length:0,o=-1,f=Ho(yf(i/e));i>n;)f[++o]=Je(t,n,n+=e);return f}function vn(t){for(var e=-1,r=t?t.length:0,n=-1,i=[];++e<r;){var o=t[e];o&&(i[++n]=o)}return i}function dn(t,e,r){var n=t?t.length:0;return n?((r?Gr(t,e,r):null==e)&&(e=1),Je(t,0>e?0:e)):[]}function yn(t,e,r){var n=t?t.length:0;return n?((r?Gr(t,e,r):null==e)&&(e=1),e=n-(+e||0),Je(t,0,0>e?0:e)):[]}function wn(t,e,r){return t&&t.length?er(t,jr(e,r,3),!0,!0):[]}function mn(t,e,r){return t&&t.length?er(t,jr(e,r,3),!0):[]}function bn(t,e,r,n){var i=t?t.length:0;return i?(r&&"number"!=typeof r&&Gr(t,e,r)&&(r=0,n=i),Te(t,e,r,n)):[]}function _n(t){return t?t[0]:S}function En(t,e,r){var n=t?t.length:0;return r&&Gr(t,e,r)&&(e=!1),n?Ue(t,e):[]}function xn(t){var e=t?t.length:0;return e?Ue(t,!0):[]}function An(t,e,r){var n=t?t.length:0;if(!n)return-1;if("number"==typeof r)r=0>r?xf(n+r,0):r;else if(r){var i=nr(t,e);return n>i&&(e===e?e===t[i]:t[i]!==t[i])?i:-1}return a(t,e,r||0)}function In(t){return yn(t,1)}function Tn(t){var e=t?t.length:0;return e?t[e-1]:S}function Sn(t,e,r){var n=t?t.length:0;if(!n)return-1;var i=n;if("number"==typeof r)i=(0>r?xf(n+r,0):Af(r||0,n-1))+1;else if(r){i=nr(t,e,!0)-1;var o=t[i];return(e===e?e===o:o!==o)?i:-1}if(e!==e)return w(t,i,!0);for(;i--;)if(t[i]===e)return i;return-1}function Ln(){var t=arguments,e=t[0];if(!e||!e.length)return e;for(var r=0,n=Pr(),i=t.length;++r<i;)for(var o=0,f=t[r];(o=n(e,f,o))>-1;)gf.call(e,o,1);return e}function Un(t,e,r){var n=[];if(!t||!t.length)return n;var i=-1,o=[],f=t.length;for(e=jr(e,r,3);++i<f;){var a=t[i];e(a,i,t)&&(n.push(a),o.push(i))}return qe(t,o),n}function kn(t){return dn(t,1)}function Bn(t,e,r){var n=t?t.length:0;return n?(r&&"number"!=typeof r&&Gr(t,e,r)&&(e=0,r=n),Je(t,e,r)):[]}function Rn(t,e,r){var n=t?t.length:0;return n?((r?Gr(t,e,r):null==e)&&(e=1),Je(t,0,0>e?0:e)):[]}function Cn(t,e,r){var n=t?t.length:0;return n?((r?Gr(t,e,r):null==e)&&(e=1),e=n-(+e||0),Je(t,0>e?0:e)):[]}function Nn(t,e,r){return t&&t.length?er(t,jr(e,r,3),!1,!0):[]}function On(t,e,r){return t&&t.length?er(t,jr(e,r,3)):[]}function Fn(t,e,r,n){var i=t?t.length:0;if(!i)return[];null!=e&&"boolean"!=typeof e&&(n=r,r=Gr(t,e,n)?S:e,e=!1);var o=jr();return null==r&&o===be||(r=o(r,n,3)),e&&Pr()==a?E(t,r):Qe(t,r)}function Mn(t){if(!t||!t.length)return[];var e=-1,r=0;t=ae(t,function(t){return Xr(t)?(r=xf(t.length,r),!0):void 0});for(var n=Ho(r);++e<r;)n[e]=ue(t,We(e));return n}function zn(t,e,r){var n=t?t.length:0;if(!n)return[];var i=Mn(t);return null==e?i:(e=or(e,r,4),ue(i,function(t){return he(t,e,S,!0)}))}function Dn(){for(var t=-1,e=arguments.length;++t<e;){var r=arguments[t];if(Xr(r))var n=n?se(xe(n,r),xe(r,n)):r}return n?Qe(n):[]}function jn(t,e){var r=-1,n=t?t.length:0,i={};for(!n||e||ka(t[0])||(e=[]);++r<n;){var o=t[r];e?i[o]=e[r]:o&&(i[o[0]]=o[1])}return i}function Hn(t){var r=e(t);return r.__chain__=!0,r}function Pn(t,e,r){return e.call(r,t),t}function Wn(t,e,r){return e.call(r,t)}function Vn(){return Hn(this)}function qn(){return new n(this.value(),this.__chain__)}function Kn(t){for(var e,n=this;n instanceof r;){var i=pn(n);e?o.__wrapped__=i:e=i;var o=i;n=n.__wrapped__}return o.__wrapped__=t,e}function Zn(){var t=this.__wrapped__,e=function(t){return r&&r.__dir__<0?t:t.reverse()};if(t instanceof i){var r=t;return this.__actions__.length&&(r=new i(this)),r=r.reverse(),r.__actions__.push({func:Wn,args:[e],thisArg:S}),new n(r,this.__chain__)}return this.thru(e)}function Jn(){return this.value()+""}function $n(){return rr(this.__wrapped__,this.__actions__)}function Xn(t,e,r){var n=ka(t)?oe:Ae;return r&&Gr(t,e,r)&&(e=S),"function"==typeof e&&r===S||(e=jr(e,r,3)),n(t,e)}function Yn(t,e,r){var n=ka(t)?ae:Se;return e=jr(e,r,3),n(t,e)}function Gn(t,e){return oa(t,De(e))}function Qn(t,e,r,n){var i=t?Wf(t):0;return en(i)||(t=oo(t),i=t.length),r="number"!=typeof r||n&&Gr(e,r,n)?0:0>r?xf(i+r,0):r||0,"string"==typeof t||!ka(t)&&Pi(t)?i>=r&&t.indexOf(e,r)>-1:!!i&&Pr(t,e,r)>-1}function ti(t,e,r){var n=ka(t)?ue:ze;return e=jr(e,r,3),n(t,e)}function ei(t,e){return ti(t,No(e))}function ri(t,e,r){var n=ka(t)?ae:Se;return e=jr(e,r,3),n(t,function(t,r,n){return!e(t,r,n)})}function ni(t,e,r){if(r?Gr(t,e,r):null==e){t=hn(t);var n=t.length;return n>0?t[Ke(0,n-1)]:S}var i=-1,o=Zi(t),n=o.length,f=n-1;for(e=Af(0>e?0:+e||0,n);++i<e;){var a=Ke(i,f),u=o[a];o[a]=o[i],o[i]=u}return o.length=e,o}function ii(t){return ni(t,Uf)}function oi(t){var e=t?Wf(t):0;return en(e)?e:Ha(t).length}function fi(t,e,r){var n=ka(t)?ce:$e;return r&&Gr(t,e,r)&&(e=S),"function"==typeof e&&r===S||(e=jr(e,r,3)),n(t,e)}function ai(t,e,r){if(null==t)return[];r&&Gr(t,e,r)&&(e=S);var n=-1;e=jr(e,r,3);var i=ze(t,function(t,r,i){return{criteria:e(t,r,i),index:++n,value:t}});return Xe(i,c)}function ui(t,e,r,n){return null==t?[]:(n&&Gr(e,r,n)&&(r=S),ka(e)||(e=null==e?[]:[e]),ka(r)||(r=null==r?[]:[r]),Ye(t,e,r))}function si(t,e){return Yn(t,De(e))}function hi(t,e){if("function"!=typeof e){if("function"!=typeof t)throw new Xo(q);var r=t;t=e,e=r}return t=_f(t=+t)?t:0,function(){return--t<1?e.apply(this,arguments):void 0}}function li(t,e,r){return r&&Gr(t,e,r)&&(e=S),e=t&&null==e?t.length:xf(+e||0,0),Fr(t,F,S,S,S,S,e)}function ci(t,e){var r;if("function"!=typeof e){if("function"!=typeof t)throw new Xo(q);var n=t;t=e,e=n}return function(){return--t>0&&(r=e.apply(this,arguments)),1>=t&&(e=S),r}}function pi(t,e,r){function n(){p&&uf(p),s&&uf(s),v=0,s=p=g=S}function i(e,r){r&&uf(r),s=p=g=S,e&&(v=da(),h=t.apply(c,u),p||s||(u=c=S))}function o(){var t=e-(da()-l);0>=t||t>e?i(g,s):p=pf(o,t)}function f(){i(y,p)}function a(){if(u=arguments,l=da(),c=this,g=y&&(p||!w),d===!1)var r=w&&!p;else{s||w||(v=l);var n=d-(l-v),i=0>=n||n>d;i?(s&&(s=uf(s)),v=l,h=t.apply(c,u)):s||(s=pf(f,n))}return i&&p?p=uf(p):p||e===d||(p=pf(o,e)),r&&(i=!0,h=t.apply(c,u)),!i||p||s||(u=c=S),h}var u,s,h,l,c,p,g,v=0,d=!1,y=!0;if("function"!=typeof t)throw new Xo(q);if(e=0>e?0:+e||0,r===!0){var w=!0;y=!1}else Ni(r)&&(w=!!r.leading,d="maxWait"in r&&xf(+r.maxWait||0,e),y="trailing"in r?!!r.trailing:y);return a.cancel=n,a}function gi(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new Xo(q);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var f=t.apply(this,n);return r.cache=o.set(i,f),f};return r.cache=new gi.Cache,r}function vi(t){if("function"!=typeof t)throw new Xo(q);return function(){return!t.apply(this,arguments)}}function di(t){return ci(2,t)}function yi(t,e){if("function"!=typeof t)throw new Xo(q);return e=xf(e===S?t.length-1:+e||0,0),function(){for(var r=arguments,n=-1,i=xf(r.length-e,0),o=Ho(i);++n<i;)o[n]=r[e+n];switch(e){case 0:return t.call(this,o);case 1:return t.call(this,r[0],o);case 2:return t.call(this,r[0],r[1],o)}var f=Ho(e+1);for(n=-1;++n<e;)f[n]=r[n];return f[e]=o,t.apply(this,f)}}function wi(t){if("function"!=typeof t)throw new Xo(q);return function(e){return t.apply(this,e)}}function mi(t,e,r){var n=!0,i=!0;if("function"!=typeof t)throw new Xo(q);return r===!1?n=!1:Ni(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),pi(t,e,{leading:n,maxWait:+e,trailing:i})}function bi(t,e){return e=null==e?Lo:e,Fr(e,N,S,[t],[])}function _i(t,e,r,n){return e&&"boolean"!=typeof e&&Gr(t,e,r)?e=!1:"function"==typeof e&&(n=r,r=e,e=!1),"function"==typeof r?_e(t,e,or(r,n,1)):_e(t,e)}function Ei(t,e,r){return"function"==typeof e?_e(t,!0,or(e,r,1)):_e(t,!0)}function xi(t,e){return t>e}function Ai(t,e){return t>=e}function Ii(t){return m(t)&&Xr(t)&&ef.call(t,"callee")&&!lf.call(t,"callee")}function Ti(t){return t===!0||t===!1||m(t)&&nf.call(t)==$}function Si(t){return m(t)&&nf.call(t)==X}function Li(t){return!!t&&1===t.nodeType&&m(t)&&!ji(t)}function Ui(t){return null==t?!0:Xr(t)&&(ka(t)||Pi(t)||Ii(t)||m(t)&&Ci(t.splice))?!t.length:!Ha(t).length}function ki(t,e,r,n){r="function"==typeof r?or(r,n,3):S;var i=r?r(t,e):S;return i===S?Oe(t,e,r):!!i}function Bi(t){return m(t)&&"string"==typeof t.message&&nf.call(t)==Y}function Ri(t){return"number"==typeof t&&_f(t)}function Ci(t){return Ni(t)&&nf.call(t)==G}function Ni(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Oi(t,e,r,n){return r="function"==typeof r?or(r,n,3):S,Me(t,Wr(e),r)}function Fi(t){return Di(t)&&t!=+t}function Mi(t){return null==t?!1:Ci(t)?ff.test(tf.call(t)):m(t)&&Ft.test(t)}function zi(t){return null===t}function Di(t){return"number"==typeof t||m(t)&&nf.call(t)==tt}function ji(t){var e;if(!m(t)||nf.call(t)!=et||Ii(t)||!ef.call(t,"constructor")&&(e=t.constructor,"function"==typeof e&&!(e instanceof e)))return!1;var r;return ke(t,function(t,e){r=e}),r===S||ef.call(t,r)}function Hi(t){return Ni(t)&&nf.call(t)==rt}function Pi(t){return"string"==typeof t||m(t)&&nf.call(t)==it}function Wi(t){return m(t)&&en(t.length)&&!!Vt[nf.call(t)]}function Vi(t){return t===S}function qi(t,e){return e>t}function Ki(t,e){return e>=t}function Zi(t){var e=t?Wf(t):0;return en(e)?e?te(t):[]:oo(t)}function Ji(t){return me(t,to(t))}function $i(t,e,r){var n=Ff(t);return r&&Gr(t,e,r)&&(e=S),e?ye(n,e):n}function Xi(t){return Ce(t,to(t))}function Yi(t,e,r){var n=null==t?S:Ne(t,cn(e),e+"");return n===S?r:n}function Gi(t,e){if(null==t)return!1;var r=ef.call(t,e);if(!r&&!Qr(e)){if(e=cn(e),t=1==e.length?t:Ne(t,Je(e,0,-1)),null==t)return!1;e=Tn(e),r=ef.call(t,e)}return r||en(t.length)&&Yr(e,t.length)&&(ka(t)||Ii(t))}function Qi(t,e,r){r&&Gr(t,e,r)&&(e=S);for(var n=-1,i=Ha(t),o=i.length,f={};++n<o;){var a=i[n],u=t[a];e?ef.call(f,u)?f[u].push(a):f[u]=[a]:f[u]=a}return f}function to(t){if(null==t)return[];Ni(t)||(t=Zo(t));var e=t.length;e=e&&en(e)&&(ka(t)||Ii(t))&&e||0;for(var r=t.constructor,n=-1,i="function"==typeof r&&r.prototype===t,o=Ho(e),f=e>0;++n<e;)o[n]=n+"";for(var a in t)f&&Yr(a,e)||"constructor"==a&&(i||!ef.call(t,a))||o.push(a);return o}function eo(t){t=ln(t);for(var e=-1,r=Ha(t),n=r.length,i=Ho(n);++e<n;){var o=r[e];i[e]=[o,t[o]]}return i}function ro(t,e,r){var n=null==t?S:t[e];return n===S&&(null==t||Qr(e,t)||(e=cn(e),t=1==e.length?t:Ne(t,Je(e,0,-1)),n=null==t?S:t[Tn(e)]),n=n===S?r:n),Ci(n)?n.call(t):n}function no(t,e,r){if(null==t)return t;var n=e+"";e=null!=t[n]||Qr(e,t)?[n]:cn(e);for(var i=-1,o=e.length,f=o-1,a=t;null!=a&&++i<o;){var u=e[i];Ni(a)&&(i==f?a[u]=r:null==a[u]&&(a[u]=Yr(e[i+1])?[]:{})),a=a[u]}return t}function io(t,e,r,n){var i=ka(t)||Wi(t);if(e=jr(e,n,4),null==r)if(i||Ni(t)){var o=t.constructor;r=i?ka(t)?new o:[]:Ff(Ci(o)?o.prototype:S)}else r={};return(i?ee:Be)(t,function(t,n,i){return e(r,t,n,i)}),r}function oo(t){return tr(t,Ha(t))}function fo(t){return tr(t,to(t))}function ao(t,e,r){return e=+e||0,r===S?(r=e,e=0):r=+r||0,t>=Af(e,r)&&t<xf(e,r)}function uo(t,e,r){r&&Gr(t,e,r)&&(e=r=S);var n=null==t,i=null==e;if(null==r&&(i&&"boolean"==typeof t?(r=t,t=1):"boolean"==typeof e&&(r=e,i=!0)),n&&i&&(e=1,i=!1),t=+t||0,i?(e=t,t=0):e=+e||0,r||t%1||e%1){var o=Sf();return Af(t+o*(e-t+sf("1e-"+((o+"").length-1))),e)}return Ke(t,e)}function so(t){return t=s(t),t&&t.charAt(0).toUpperCase()+t.slice(1)}function ho(t){return t=s(t),t&&t.replace(zt,g).replace(Bt,"")}function lo(t,e,r){t=s(t),e+="";var n=t.length;return r=r===S?n:Af(0>r?0:+r||0,n),r-=e.length,r>=0&&t.indexOf(e,r)==r}function co(t){return t=s(t),t&&Et.test(t)?t.replace(bt,v):t}function po(t){return t=s(t),t&&kt.test(t)?t.replace(Ut,d):t||"(?:)"}function go(t,e,r){t=s(t),e=+e;var n=t.length;if(n>=e||!_f(e))return t;var i=(e-n)/2,o=mf(i),f=yf(i);return r=Rr("",f,r),r.slice(0,o)+t+r}function vo(t,e,r){return(r?Gr(t,e,r):null==e)?e=0:e&&(e=+e),t=bo(t),Tf(t,e||(Ot.test(t)?16:10))}function yo(t,e){var r="";if(t=s(t),e=+e,1>e||!t||!_f(e))return r;do e%2&&(r+=t),e=mf(e/2),t+=t;while(e);return r}function wo(t,e,r){return t=s(t),r=null==r?0:Af(0>r?0:+r||0,t.length),t.lastIndexOf(e,r)==r}function mo(t,r,n){var i=e.templateSettings;n&&Gr(t,r,n)&&(r=n=S),t=s(t),r=de(ye({},n||r),i,ve);var o,f,a=de(ye({},r.imports),i.imports,ve),u=Ha(a),h=tr(a,u),l=0,c=r.interpolate||Dt,p="__p += \'",g=Jo((r.escape||Dt).source+"|"+c.source+"|"+(c===It?Ct:Dt).source+"|"+(r.evaluate||Dt).source+"|$","g"),v="//# sourceURL="+("sourceURL"in r?r.sourceURL:"lodash.templateSources["+ ++Wt+"]")+"\\n";t.replace(g,function(e,r,n,i,a,u){return n||(n=i),p+=t.slice(l,u).replace(jt,y),r&&(o=!0,p+="\' +\\n__e("+r+") +\\n\'"),a&&(f=!0,p+="\';\\n"+a+";\\n__p += \'"),n&&(p+="\' +\\n((__t = ("+n+")) == null ? \'\' : __t) +\\n\'"),l=u+e.length,e}),p+="\';\\n";var d=r.variable;d||(p="with (obj) {\\n"+p+"\\n}\\n"),p=(f?p.replace(dt,""):p).replace(yt,"$1").replace(wt,"$1;"),p="function("+(d||"obj")+") {\\n"+(d?"":"obj || (obj = {});\\n")+"var __t, __p = \'\'"+(o?", __e = _.escape":"")+(f?", __j = Array.prototype.join;\\nfunction print() { __p += __j.call(arguments, \'\') }\\n":";\\n")+p+"return __p\\n}";\nvar w=Ga(function(){return Vo(u,v+"return "+p).apply(S,h)});if(w.source=p,Bi(w))throw w;return w}function bo(t,e,r){var n=t;return(t=s(t))?(r?Gr(n,e,r):null==e)?t.slice(x(t),A(t)+1):(e+="",t.slice(h(t,e),l(t,e)+1)):t}function _o(t,e,r){var n=t;return t=s(t),t?(r?Gr(n,e,r):null==e)?t.slice(x(t)):t.slice(h(t,e+"")):t}function Eo(t,e,r){var n=t;return t=s(t),t?(r?Gr(n,e,r):null==e)?t.slice(0,A(t)+1):t.slice(0,l(t,e+"")+1):t}function xo(t,e,r){r&&Gr(t,e,r)&&(e=S);var n=z,i=D;if(null!=e)if(Ni(e)){var o="separator"in e?e.separator:o;n="length"in e?+e.length||0:n,i="omission"in e?s(e.omission):i}else n=+e||0;if(t=s(t),n>=t.length)return t;var f=n-i.length;if(1>f)return i;var a=t.slice(0,f);if(null==o)return a+i;if(Hi(o)){if(t.slice(f).search(o)){var u,h,l=t.slice(0,f);for(o.global||(o=Jo(o.source,(Nt.exec(o)||"")+"g")),o.lastIndex=0;u=o.exec(l);)h=u.index;a=a.slice(0,null==h?f:h)}}else if(t.indexOf(o,f)!=f){var c=a.lastIndexOf(o);c>-1&&(a=a.slice(0,c))}return a+i}function Ao(t){return t=s(t),t&&_t.test(t)?t.replace(mt,I):t}function Io(t,e,r){return r&&Gr(t,e,r)&&(e=S),t=s(t),t.match(e||Ht)||[]}function To(t,e,r){return r&&Gr(t,e,r)&&(e=S),m(t)?Uo(t):be(t,e)}function So(t){return function(){return t}}function Lo(t){return t}function Uo(t){return De(_e(t,!0))}function ko(t,e){return je(t,_e(e,!0))}function Bo(t,e,r){if(null==r){var n=Ni(e),i=n?Ha(e):S,o=i&&i.length?Ce(e,i):S;(o?o.length:n)||(o=!1,r=e,e=t,t=this)}o||(o=Ce(e,Ha(e)));var f=!0,a=-1,u=Ci(t),s=o.length;r===!1?f=!1:Ni(r)&&"chain"in r&&(f=r.chain);for(;++a<s;){var h=o[a],l=e[h];t[h]=l,u&&(t.prototype[h]=function(e){return function(){var r=this.__chain__;if(f||r){var n=t(this.__wrapped__),i=n.__actions__=te(this.__actions__);return i.push({func:e,args:arguments,thisArg:t}),n.__chain__=r,n}return e.apply(t,se([this.value()],arguments))}}(l))}return t}function Ro(){return ne._=of,this}function Co(){}function No(t){return Qr(t)?We(t):Ve(t)}function Oo(t){return function(e){return Ne(t,cn(e),e+"")}}function Fo(t,e,r){r&&Gr(t,e,r)&&(e=r=S),t=+t||0,r=null==r?1:+r||0,null==e?(e=t,t=0):e=+e||0;for(var n=-1,i=xf(yf((e-t)/(r||1)),0),o=Ho(i);++n<i;)o[n]=t,t+=r;return o}function Mo(t,e,r){if(t=mf(t),1>t||!_f(t))return[];var n=-1,i=Ho(Af(t,kf));for(e=or(e,r,1);++n<t;)kf>n?i[n]=e(n):e(n);return i}function zo(t){var e=++rf;return s(t)+e}function Do(t,e){return(+t||0)+(+e||0)}function jo(t,e,r){return r&&Gr(t,e,r)&&(e=S),e=jr(e,r,3),1==e.length?pe(ka(t)?t:hn(t),e):Ge(t,e)}t=t?ie.defaults(ne.Object(),t,ie.pick(ne,Pt)):ne;var Ho=t.Array,Po=t.Date,Wo=t.Error,Vo=t.Function,qo=t.Math,Ko=t.Number,Zo=t.Object,Jo=t.RegExp,$o=t.String,Xo=t.TypeError,Yo=Ho.prototype,Go=Zo.prototype,Qo=$o.prototype,tf=Vo.prototype.toString,ef=Go.hasOwnProperty,rf=0,nf=Go.toString,of=ne._,ff=Jo("^"+tf.call(ef).replace(/[\\\\^$.*+?()[\\]{}|]/g,"\\\\$&").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,"$1.*?")+"$"),af=t.ArrayBuffer,uf=t.clearTimeout,sf=t.parseFloat,hf=qo.pow,lf=Go.propertyIsEnumerable,cf=Vr(t,"Set"),pf=t.setTimeout,gf=Yo.splice,vf=t.Uint8Array,df=Vr(t,"WeakMap"),yf=qo.ceil,wf=Vr(Zo,"create"),mf=qo.floor,bf=Vr(Ho,"isArray"),_f=t.isFinite,Ef=Vr(Zo,"keys"),xf=qo.max,Af=qo.min,If=Vr(Po,"now"),Tf=t.parseInt,Sf=qo.random,Lf=Ko.NEGATIVE_INFINITY,Uf=Ko.POSITIVE_INFINITY,kf=4294967295,Bf=kf-1,Rf=kf>>>1,Cf=9007199254740991,Nf=df&&new df,Of={};e.support={};e.templateSettings={escape:xt,evaluate:At,interpolate:It,variable:"",imports:{_:e}};var Ff=function(){function t(){}return function(e){if(Ni(e)){t.prototype=e;var r=new t;t.prototype=S}return r||{}}}(),Mf=lr(Be),zf=lr(Re,!0),Df=cr(),jf=cr(!0),Hf=Nf?function(t,e){return Nf.set(t,e),t}:Lo,Pf=Nf?function(t){return Nf.get(t)}:Co,Wf=We("length"),Vf=function(){var t=0,e=0;return function(r,n){var i=da(),o=H-(i-e);if(e=i,o>0){if(++t>=j)return r}else t=0;return Hf(r,n)}}(),qf=yi(function(t,e){return m(t)&&Xr(t)?xe(t,Ue(e,!1,!0)):[]}),Kf=_r(),Zf=_r(!0),Jf=yi(function(t){for(var e=t.length,r=e,n=Ho(l),i=Pr(),o=i==a,f=[];r--;){var u=t[r]=Xr(u=t[r])?u:[];n[r]=o&&u.length>=120?gr(r&&u):null}var s=t[0],h=-1,l=s?s.length:0,c=n[0];t:for(;++h<l;)if(u=s[h],(c?Yt(c,u):i(f,u,0))<0){for(var r=e;--r;){var p=n[r];if((p?Yt(p,u):i(t[r],u,0))<0)continue t}c&&c.push(u),f.push(u)}return f}),$f=yi(function(t,e){e=Ue(e);var r=we(t,e);return qe(t,e.sort(o)),r}),Xf=Or(),Yf=Or(!0),Gf=yi(function(t){return Qe(Ue(t,!1,!0))}),Qf=yi(function(t,e){return Xr(t)?xe(t,e):[]}),ta=yi(Mn),ea=yi(function(t){var e=t.length,r=e>2?t[e-2]:S,n=e>1?t[e-1]:S;return e>2&&"function"==typeof r?e-=2:(r=e>1&&"function"==typeof n?(--e,n):S,n=S),t.length=e,zn(t,r,n)}),ra=yi(function(t){return t=Ue(t),this.thru(function(e){return Qt(ka(e)?e:[ln(e)],t)})}),na=yi(function(t,e){return we(t,Ue(e))}),ia=sr(function(t,e,r){ef.call(t,r)?++t[r]:t[r]=1}),oa=br(Mf),fa=br(zf,!0),aa=Ar(ee,Mf),ua=Ar(re,zf),sa=sr(function(t,e,r){ef.call(t,r)?t[r].push(e):t[r]=[e]}),ha=sr(function(t,e,r){t[r]=e}),la=yi(function(t,e,r){var n=-1,i="function"==typeof e,o=Qr(e),f=Xr(t)?Ho(t.length):[];return Mf(t,function(t){var a=i?e:o&&null!=t?t[e]:S;f[++n]=a?a.apply(t,r):$r(t,e,r)}),f}),ca=sr(function(t,e,r){t[r?0:1].push(e)},function(){return[[],[]]}),pa=kr(he,Mf),ga=kr(le,zf),va=yi(function(t,e){if(null==t)return[];var r=e[2];return r&&Gr(e[0],e[1],r)&&(e.length=1),Ye(t,Ue(e),[])}),da=If||function(){return(new Po).getTime()},ya=yi(function(t,e,r){var n=U;if(r.length){var i=_(r,ya.placeholder);n|=N}return Fr(t,n,e,r,i)}),wa=yi(function(t,e){e=e.length?Ue(e):Xi(t);for(var r=-1,n=e.length;++r<n;){var i=e[r];t[i]=Fr(t[i],U,t)}return t}),ma=yi(function(t,e,r){var n=U|k;if(r.length){var i=_(r,ma.placeholder);n|=N}return Fr(e,n,t,r,i)}),ba=yr(R),_a=yr(C),Ea=yi(function(t,e){return Ee(t,1,e)}),xa=yi(function(t,e,r){return Ee(t,e,r)}),Aa=xr(),Ia=xr(!0),Ta=yi(function(t,e){if(e=Ue(e),"function"!=typeof t||!oe(e,u))throw new Xo(q);var r=e.length;return yi(function(n){for(var i=Af(n.length,r);i--;)n[i]=e[i](n[i]);return t.apply(this,n)})}),Sa=Ur(N),La=Ur(O),Ua=yi(function(t,e){return Fr(t,M,S,S,S,Ue(e))}),ka=bf||function(t){return m(t)&&en(t.length)&&nf.call(t)==J},Ba=hr(He),Ra=hr(function(t,e,r){return r?de(t,e,r):ye(t,e)}),Ca=wr(Ra,ge),Na=wr(Ba,on),Oa=Er(Be),Fa=Er(Re),Ma=Ir(Df),za=Ir(jf),Da=Tr(Be),ja=Tr(Re),Ha=Ef?function(t){var e=null==t?S:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&Xr(t)?sn(t):Ni(t)?Ef(t):[]}:sn,Pa=Sr(!0),Wa=Sr(),Va=yi(function(t,e){if(null==t)return{};if("function"!=typeof e[0]){var e=ue(Ue(e),$o);return fn(t,xe(to(t),e))}var r=or(e[0],e[1],3);return an(t,function(t,e,n){return!r(t,e,n)})}),qa=yi(function(t,e){return null==t?{}:"function"==typeof e[0]?an(t,or(e[0],e[1],3)):fn(t,Ue(e))}),Ka=vr(function(t,e,r){return e=e.toLowerCase(),t+(r?e.charAt(0).toUpperCase()+e.slice(1):e)}),Za=vr(function(t,e,r){return t+(r?"-":"")+e.toLowerCase()}),Ja=Lr(),$a=Lr(!0),Xa=vr(function(t,e,r){return t+(r?"_":"")+e.toLowerCase()}),Ya=vr(function(t,e,r){return t+(r?" ":"")+(e.charAt(0).toUpperCase()+e.slice(1))}),Ga=yi(function(t,e){try{return t.apply(S,e)}catch(r){return Bi(r)?r:new Wo(r)}}),Qa=yi(function(t,e){return function(r){return $r(r,t,e)}}),tu=yi(function(t,e){return function(r){return $r(t,r,e)}}),eu=Nr("ceil"),ru=Nr("floor"),nu=mr(xi,Lf),iu=mr(qi,Uf),ou=Nr("round");return e.prototype=r.prototype,n.prototype=Ff(r.prototype),n.prototype.constructor=n,i.prototype=Ff(r.prototype),i.prototype.constructor=i,ot.prototype["delete"]=Kt,ot.prototype.get=Zt,ot.prototype.has=Jt,ot.prototype.set=$t,Xt.prototype.push=Gt,gi.Cache=ot,e.after=hi,e.ary=li,e.assign=Ra,e.at=na,e.before=ci,e.bind=ya,e.bindAll=wa,e.bindKey=ma,e.callback=To,e.chain=Hn,e.chunk=gn,e.compact=vn,e.constant=So,e.countBy=ia,e.create=$i,e.curry=ba,e.curryRight=_a,e.debounce=pi,e.defaults=Ca,e.defaultsDeep=Na,e.defer=Ea,e.delay=xa,e.difference=qf,e.drop=dn,e.dropRight=yn,e.dropRightWhile=wn,e.dropWhile=mn,e.fill=bn,e.filter=Yn,e.flatten=En,e.flattenDeep=xn,e.flow=Aa,e.flowRight=Ia,e.forEach=aa,e.forEachRight=ua,e.forIn=Ma,e.forInRight=za,e.forOwn=Da,e.forOwnRight=ja,e.functions=Xi,e.groupBy=sa,e.indexBy=ha,e.initial=In,e.intersection=Jf,e.invert=Qi,e.invoke=la,e.keys=Ha,e.keysIn=to,e.map=ti,e.mapKeys=Pa,e.mapValues=Wa,e.matches=Uo,e.matchesProperty=ko,e.memoize=gi,e.merge=Ba,e.method=Qa,e.methodOf=tu,e.mixin=Bo,e.modArgs=Ta,e.negate=vi,e.omit=Va,e.once=di,e.pairs=eo,e.partial=Sa,e.partialRight=La,e.partition=ca,e.pick=qa,e.pluck=ei,e.property=No,e.propertyOf=Oo,e.pull=Ln,e.pullAt=$f,e.range=Fo,e.rearg=Ua,e.reject=ri,e.remove=Un,e.rest=kn,e.restParam=yi,e.set=no,e.shuffle=ii,e.slice=Bn,e.sortBy=ai,e.sortByAll=va,e.sortByOrder=ui,e.spread=wi,e.take=Rn,e.takeRight=Cn,e.takeRightWhile=Nn,e.takeWhile=On,e.tap=Pn,e.throttle=mi,e.thru=Wn,e.times=Mo,e.toArray=Zi,e.toPlainObject=Ji,e.transform=io,e.union=Gf,e.uniq=Fn,e.unzip=Mn,e.unzipWith=zn,e.values=oo,e.valuesIn=fo,e.where=si,e.without=Qf,e.wrap=bi,e.xor=Dn,e.zip=ta,e.zipObject=jn,e.zipWith=ea,e.backflow=Ia,e.collect=ti,e.compose=Ia,e.each=aa,e.eachRight=ua,e.extend=Ra,e.iteratee=To,e.methods=Xi,e.object=jn,e.select=Yn,e.tail=kn,e.unique=Fn,Bo(e,e),e.add=Do,e.attempt=Ga,e.camelCase=Ka,e.capitalize=so,e.ceil=eu,e.clone=_i,e.cloneDeep=Ei,e.deburr=ho,e.endsWith=lo,e.escape=co,e.escapeRegExp=po,e.every=Xn,e.find=oa,e.findIndex=Kf,e.findKey=Oa,e.findLast=fa,e.findLastIndex=Zf,e.findLastKey=Fa,e.findWhere=Gn,e.first=_n,e.floor=ru,e.get=Yi,e.gt=xi,e.gte=Ai,e.has=Gi,e.identity=Lo,e.includes=Qn,e.indexOf=An,e.inRange=ao,e.isArguments=Ii,e.isArray=ka,e.isBoolean=Ti,e.isDate=Si,e.isElement=Li,e.isEmpty=Ui,e.isEqual=ki,e.isError=Bi,e.isFinite=Ri,e.isFunction=Ci,e.isMatch=Oi,e.isNaN=Fi,e.isNative=Mi,e.isNull=zi,e.isNumber=Di,e.isObject=Ni,e.isPlainObject=ji,e.isRegExp=Hi,e.isString=Pi,e.isTypedArray=Wi,e.isUndefined=Vi,e.kebabCase=Za,e.last=Tn,e.lastIndexOf=Sn,e.lt=qi,e.lte=Ki,e.max=nu,e.min=iu,e.noConflict=Ro,e.noop=Co,e.now=da,e.pad=go,e.padLeft=Ja,e.padRight=$a,e.parseInt=vo,e.random=uo,e.reduce=pa,e.reduceRight=ga,e.repeat=yo,e.result=ro,e.round=ou,e.runInContext=T,e.size=oi,e.snakeCase=Xa,e.some=fi,e.sortedIndex=Xf,e.sortedLastIndex=Yf,e.startCase=Ya,e.startsWith=wo,e.sum=jo,e.template=mo,e.trim=bo,e.trimLeft=_o,e.trimRight=Eo,e.trunc=xo,e.unescape=Ao,e.uniqueId=zo,e.words=Io,e.all=Xn,e.any=fi,e.contains=Qn,e.eq=ki,e.detect=oa,e.foldl=pa,e.foldr=ga,e.head=_n,e.include=Qn,e.inject=pa,Bo(e,function(){var t={};return Be(e,function(r,n){e.prototype[n]||(t[n]=r)}),t}(),!1),e.sample=ni,e.prototype.sample=function(t){return this.__chain__||null!=t?this.thru(function(e){return ni(e,t)}):ni(this.value())},e.VERSION=L,ee(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){e[t].placeholder=e}),ee(["drop","take"],function(t,e){i.prototype[t]=function(r){var n=this.__filtered__;if(n&&!e)return new i(this);r=null==r?1:xf(mf(r)||0,0);var o=this.clone();return n?o.__takeCount__=Af(o.__takeCount__,r):o.__views__.push({size:r,type:t+(o.__dir__<0?"Right":"")}),o},i.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),ee(["filter","map","takeWhile"],function(t,e){var r=e+1,n=r!=V;i.prototype[t]=function(t,e){var i=this.clone();return i.__iteratees__.push({iteratee:jr(t,e,1),type:r}),i.__filtered__=i.__filtered__||n,i}}),ee(["first","last"],function(t,e){var r="take"+(e?"Right":"");i.prototype[t]=function(){return this[r](1).value()[0]}}),ee(["initial","rest"],function(t,e){var r="drop"+(e?"":"Right");i.prototype[t]=function(){return this.__filtered__?new i(this):this[r](1)}}),ee(["pluck","where"],function(t,e){var r=e?"filter":"map",n=e?De:No;i.prototype[t]=function(t){return this[r](n(t))}}),i.prototype.compact=function(){return this.filter(Lo)},i.prototype.reject=function(t,e){return t=jr(t,e,1),this.filter(function(e){return!t(e)})},i.prototype.slice=function(t,e){t=null==t?0:+t||0;var r=this;return r.__filtered__&&(t>0||0>e)?new i(r):(0>t?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==S&&(e=+e||0,r=0>e?r.dropRight(-e):r.take(e-t)),r)},i.prototype.takeRightWhile=function(t,e){return this.reverse().takeWhile(t,e).reverse()},i.prototype.toArray=function(){return this.take(Uf)},Be(i.prototype,function(t,r){var o=/^(?:filter|map|reject)|While$/.test(r),f=/^(?:first|last)$/.test(r),a=e[f?"take"+("last"==r?"Right":""):r];a&&(e.prototype[r]=function(){var e=f?[1]:arguments,r=this.__chain__,u=this.__wrapped__,s=!!this.__actions__.length,h=u instanceof i,l=e[0],c=h||ka(u);c&&o&&"function"==typeof l&&1!=l.length&&(h=c=!1);var p=function(t){return f&&r?a(t,1)[0]:a.apply(S,se([t],e))},g={func:Wn,args:[p],thisArg:S},v=h&&!s;if(f&&!r)return v?(u=u.clone(),u.__actions__.push(g),t.call(u)):a.call(S,this.value())[0];if(!f&&c){u=v?u:new i(this);var d=t.apply(u,e);return d.__actions__.push(g),new n(d,r)}return this.thru(p)})}),ee(["join","pop","push","replace","shift","sort","splice","split","unshift"],function(t){var r=(/^(?:replace|split)$/.test(t)?Qo:Yo)[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",i=/^(?:join|pop|replace|shift)$/.test(t);e.prototype[t]=function(){var t=arguments;return i&&!this.__chain__?r.apply(this.value(),t):this[n](function(e){return r.apply(e,t)})}}),Be(i.prototype,function(t,r){var n=e[r];if(n){var i=n.name,o=Of[i]||(Of[i]=[]);o.push({name:r,func:n})}}),Of[Br(S,k).name]=[{name:"wrapper",func:S}],i.prototype.clone=b,i.prototype.reverse=Q,i.prototype.value=nt,e.prototype.chain=Vn,e.prototype.commit=qn,e.prototype.concat=ra,e.prototype.plant=Kn,e.prototype.reverse=Zn,e.prototype.toString=Jn,e.prototype.run=e.prototype.toJSON=e.prototype.valueOf=e.prototype.value=$n,e.prototype.collect=e.prototype.map,e.prototype.head=e.prototype.first,e.prototype.select=e.prototype.filter,e.prototype.tail=e.prototype.rest,e}var S,L="3.10.1",U=1,k=2,B=4,R=8,C=16,N=32,O=64,F=128,M=256,z=30,D="...",j=150,H=16,P=200,W=1,V=2,q="Expected a function",K="__lodash_placeholder__",Z="[object Arguments]",J="[object Array]",$="[object Boolean]",X="[object Date]",Y="[object Error]",G="[object Function]",Q="[object Map]",tt="[object Number]",et="[object Object]",rt="[object RegExp]",nt="[object Set]",it="[object String]",ot="[object WeakMap]",ft="[object ArrayBuffer]",at="[object Float32Array]",ut="[object Float64Array]",st="[object Int8Array]",ht="[object Int16Array]",lt="[object Int32Array]",ct="[object Uint8Array]",pt="[object Uint8ClampedArray]",gt="[object Uint16Array]",vt="[object Uint32Array]",dt=/\\b__p \\+= \'\';/g,yt=/\\b(__p \\+=) \'\' \\+/g,wt=/(__e\\(.*?\\)|\\b__t\\)) \\+\\n\'\';/g,mt=/&(?:amp|lt|gt|quot|#39|#96);/g,bt=/[&<>"\'`]/g,_t=RegExp(mt.source),Et=RegExp(bt.source),xt=/<%-([\\s\\S]+?)%>/g,At=/<%([\\s\\S]+?)%>/g,It=/<%=([\\s\\S]+?)%>/g,Tt=/\\.|\\[(?:[^[\\]]*|(["\'])(?:(?!\\1)[^\\n\\\\]|\\\\.)*?\\1)\\]/,St=/^\\w*$/,Lt=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|(["\'])((?:(?!\\2)[^\\n\\\\]|\\\\.)*?)\\2)\\]/g,Ut=/^[:!,]|[\\\\^$.*+?()[\\]{}|\\/]|(^[0-9a-fA-Fnrtuvx])|([\\n\\r\\u2028\\u2029])/g,kt=RegExp(Ut.source),Bt=/[\\u0300-\\u036f\\ufe20-\\ufe23]/g,Rt=/\\\\(\\\\)?/g,Ct=/\\$\\{([^\\\\}]*(?:\\\\.[^\\\\}]*)*)\\}/g,Nt=/\\w*$/,Ot=/^0[xX]/,Ft=/^\\[object .+?Constructor\\]$/,Mt=/^\\d+$/,zt=/[\\xc0-\\xd6\\xd8-\\xde\\xdf-\\xf6\\xf8-\\xff]/g,Dt=/($^)/,jt=/[\'\\n\\r\\u2028\\u2029\\\\]/g,Ht=function(){var t="[A-Z\\\\xc0-\\\\xd6\\\\xd8-\\\\xde]",e="[a-z\\\\xdf-\\\\xf6\\\\xf8-\\\\xff]+";return RegExp(t+"+(?="+t+e+")|"+t+"?"+e+"|"+t+"+|[0-9]+","g")}(),Pt=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","isFinite","parseFloat","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap"],Wt=-1,Vt={};Vt[at]=Vt[ut]=Vt[st]=Vt[ht]=Vt[lt]=Vt[ct]=Vt[pt]=Vt[gt]=Vt[vt]=!0,Vt[Z]=Vt[J]=Vt[ft]=Vt[$]=Vt[X]=Vt[Y]=Vt[G]=Vt[Q]=Vt[tt]=Vt[et]=Vt[rt]=Vt[nt]=Vt[it]=Vt[ot]=!1;var qt={};qt[Z]=qt[J]=qt[ft]=qt[$]=qt[X]=qt[at]=qt[ut]=qt[st]=qt[ht]=qt[lt]=qt[tt]=qt[et]=qt[rt]=qt[it]=qt[ct]=qt[pt]=qt[gt]=qt[vt]=!0,qt[Y]=qt[G]=qt[Q]=qt[nt]=qt[ot]=!1;var Kt={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Zt={"&":"&amp;","<":"&lt;",">":"&gt;",\'"\':"&quot;","\'":"&#39;","`":"&#96;"},Jt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":\'"\',"&#39;":"\'","&#96;":"`"},$t={"function":!0,object:!0},Xt={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"},Yt={"\\\\":"\\\\","\'":"\'","\\n":"n","\\r":"r","\\u2028":"u2028","\\u2029":"u2029"},Gt=$t[typeof e]&&e&&!e.nodeType&&e,Qt=$t[typeof t]&&t&&!t.nodeType&&t,te=Gt&&Qt&&"object"==typeof i&&i&&i.Object&&i,ee=$t[typeof self]&&self&&self.Object&&self,re=$t[typeof window]&&window&&window.Object&&window,ne=(Qt&&Qt.exports===Gt&&Gt,te||re!==(this&&this.window)&&re||ee||this),ie=T();ne._=ie,n=function(){return ie}.call(e,r,e,t),!(n!==S&&(t.exports=n))}).call(this)}).call(e,r(1)(t),function(){return this}())}]);',n.p+"d5fe3f4350eed2953136.worker.js");
}},function(e,t,n){e.exports=function(){return new Worker(n.p+"43f4cfb5f7d8d1a20475.worker.js")}}]));